[{"content":" è¿™æ˜¯ @skotaro åœ¨ 2018 å¹´å‘å¸ƒçš„ä¸€ç¯‡å…³äº Matplotlib Artist çš„é€šä¿—æ˜“æ‡‚çš„ä»‹ç»ï¼Œå¾ˆé€‚åˆä½œä¸ºå®˜æ–¹æ•™ç¨‹çš„å‰ç½®è¯»ç‰©ï¼Œæ•…ç¿»è¯‘äºæ­¤ï¼ŒåŸæ–‡æ ‡é¢˜æ˜¯ \u0026ldquo;Artist\u0026rdquo; in Matplotlib - something I wanted to know before spending tremendous hours on googling how-tos.ã€‚æ–‡ä¸­ç»å¤§éƒ¨åˆ†é“¾æ¥éƒ½é‡å®šå‘åˆ°äº†æœ€æ–°ç‰ˆæœ¬çš„ Matplotlib æ–‡æ¡£ï¼Œè¿˜è¯·è¯»è€…æ³¨æ„ã€‚\n æ¯«æ— ç–‘é—® Python é‡Œçš„ matplotlib æ˜¯ä¸ªéå¸¸æ£’çš„å¯è§†åŒ–å·¥å…·ï¼Œä½†åœ¨ matplotlib ä¸­æ…¢æ…¢è°ƒç»†èŠ‚ä¹Ÿæ˜¯ä»¶å¾ˆçƒ¦äººçš„äº‹ã€‚ä½ å¾ˆå®¹æ˜“æµªè´¹å¥½å‡ ä¸ªå°æ—¶å»æ‰¾ä¿®æ”¹å›¾é‡Œç»†èŠ‚çš„æ–¹æ³•ï¼Œæœ‰æ—¶ä½ è¿é‚£ä¸ªç»†èŠ‚çš„åå­—ä¹Ÿä¸çŸ¥é“çš„è¯ï¼Œæœç´¢èµ·æ¥ä¼šæ›´åŠ å›°éš¾ã€‚å°±ç®—ä½ åœ¨ Stack Overflow ä¸Šæ‰¾åˆ°äº†ç›¸å…³çš„æç¤ºï¼Œä¹Ÿå¯èƒ½å†èŠ±å‡ ä¸ªå°æ—¶æ ¹æ®éœ€æ±‚æ¥ä¿®æ”¹å®ƒã€‚ä¸è¿‡ï¼Œåªè¦äº†è§£äº† matplotlib å›¾çš„å…·ä½“ç»„æˆï¼Œä»¥åŠä½ å¯ä»¥å¯¹ç»„ä»¶æ‰§è¡Œçš„æ“ä½œï¼Œå°±èƒ½é¿å¼€è¿™äº›å¾’åŠ³æ— ç›Šçš„å·¥ä½œã€‚æˆ‘æƒ³ï¼Œæˆ‘è·Ÿä½ ä»¬ä¸­çš„å¤§å¤šæ•°äººä¸€æ ·ï¼Œåšå›¾æ—¶é‡åˆ°çš„å›°éš¾éƒ½æ˜¯é è¯» Stack Overflow ä¸Šé‚£äº› matplotlib é«˜æ‰‹ä»¬çš„ç­”æ¡ˆæ¥è§£å†³çš„ã€‚æœ€è¿‘æˆ‘å‘ç° å®˜æ–¹çš„ Artist å¯¹è±¡æ•™ç¨‹ ä¿¡æ¯å¾ˆä¸°å¯Œï¼Œæœ‰åŠ©äºæˆ‘ä»¬ç†è§£ matplotlib çš„ç”»å›¾è¿‡ç¨‹å¹¶èŠ‚çœè°ƒå›¾æ—¶é—´1ã€‚æœ¬æ–‡é‡Œæˆ‘ä¼šåˆ†äº«ä¸€äº›å…³äº matplotlib é‡Œ Artist å¯¹è±¡çš„åŸºæœ¬çŸ¥è¯†ï¼Œä»¥é¿å…æµªè´¹æ•°å°æ—¶è°ƒå›¾çš„æƒ…å†µå‡ºç°ã€‚\næœ¬æ–‡çš„ç›®çš„ æˆ‘å¹¶ä¸æ‰“ç®—å†™é‚£ç§â€œæƒ³è¦è¿™ä¸ªæ•ˆæœæ—¶ä½ å¾—å¦‚ä½•å¦‚ä½•â€çš„æ“ä½œè¯´æ˜ï¼Œè€Œæ˜¯æƒ³ä»‹ç» matplotlib ä¸­ Artist çš„åŸºæœ¬æ¦‚å¿µï¼Œè¿™æœ‰åŠ©äºä½ æŒ‘é€‰æœç´¢æ—¶çš„å…³é”®è¯ï¼Œå¹¶ä¸ºé‡åˆ°çš„åŒç±»é—®é¢˜æƒ³å‡ºè§£å†³æ–¹æ¡ˆã€‚è¯»å®Œæœ¬æ–‡ï¼Œä½ åº”è¯¥å°±èƒ½ç†è§£ç½‘ä¸Šé‚£äº›æµ·é‡çš„ç¨‹åºç‰‡æ®µäº†ã€‚æœ¬æ–‡åŒæ ·é€‚ç”¨äºç”¨ seaborn å’Œ pandas ç”»å›¾çš„äººâ€”â€”æ¯•ç«Ÿè¿™ä¸¤ä¸ªåŒ…åªæ˜¯å¯¹ matplotlib çš„å°è£…ç½¢äº†ã€‚\nå†…å®¹ æœ¬æ–‡åŸºæœ¬ä¸Šæ˜¯ æˆ‘ä¹‹å‰å†™çš„æ—¥æ–‡ç‰ˆæ–‡ç«  çš„è‹±æ–‡ç‰ˆï¼Œå†…å®¹ä¸»è¦åŸºäº Artist tutorial å’Œ Usage Guideï¼ˆåŸæ–‡å‘å¸ƒæ—¶ç‰ˆæœ¬ä¸º 2.1.1ï¼‰ã€‚\nç›®æ ‡è¯»è€… è¿™æ ·çš„ matplotlib ä½¿ç”¨è€…ï¼š\n æœ‰èƒ½åŠ›æ ¹æ®éœ€æ±‚ç”»å›¾ï¼Œä½†è¦æŠŠå›¾æ”¹åˆ°é€‚åˆå‡ºç‰ˆæˆ–å±•ç¤ºçš„æ°´å¹³æ€»æ˜¯ä¼šå¾ˆåƒåŠ›ï¼ˆå¹¶ä¸”ä¼šä¸ºç¦»é¢„æœŸæ•ˆæœå°±å·®é‚£ä¹ˆä¸€ç‚¹è€Œæ„Ÿåˆ°æ¼ç«ï¼‰ã€‚ æˆåŠŸåœ¨ Stack Overflow ä¸Šæ‰¾åˆ°äº†ç¡®åˆ‡çš„è§£å†³æ–¹æ¡ˆï¼Œä½†å¯¹å…¶å·¥ä½œåŸç†ä»ç„¶ä¸€çŸ¥åŠè§£ï¼Œä¹Ÿæ— æ³•ä¸¾ä¸€åä¸‰åˆ°å…¶å®ƒé—®é¢˜ä¸Šã€‚ æ‰¾åˆ°äº†å¥½å‡ ä¸ªå…³äºé—®é¢˜çš„æç¤ºï¼Œä½†ä¸ç¡®å®šè¦é€‰å“ªä¸ªã€‚  ç¯å¢ƒ  Python 3.6 matplotlib 2.2  %matplotlib inline\rimport matplotlib.pyplot as plt\rimport numpy as np\r å› ä¸ºæˆ‘å¼€å¯äº† Jupyter notebook çš„è¡Œå†…ç»˜å›¾ï¼Œæ‰€ä»¥æœ¬æ–‡ç•¥å»äº† plt.show()ã€‚\nä½ éœ€è¦æ³¨æ„çš„ä¸¤ç§ç”»å›¾é£æ ¼ åœ¨ç ”ç©¶ Artist å¯¹è±¡ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆæä¸€ä¸‹ plt.plot å’Œ ax.plotâ€”â€”æˆ–è€…è¯´ Pyplot å’Œé¢å‘å¯¹è±¡çš„ APIâ€”â€”ä¹‹é—´çš„å·®åˆ«ã€‚è™½ç„¶å®˜æ–¹æ¨èé¢å‘å¯¹è±¡çš„ API é£æ ¼ï¼Œä½†åŒ…æ‹¬å®˜æ–¹æ–‡æ¡£åœ¨å†…çš„å¾ˆå¤šåœ°æ–¹è¿˜æ˜¯å­˜åœ¨è®¸å¤š Pyplot é£æ ¼çš„ä¾‹å­å’Œä»£ç ï¼Œç”šè‡³è¿˜æœ‰è«åå…¶å¦™æ··ç”¨ä¸¤ç§é£æ ¼çš„ï¼Œè¿™æ˜¾ç„¶ä¼šè¿·æƒ‘åˆå­¦è€…ã€‚å› ä¸ºå®˜æ–¹æ–‡æ¡£å¯¹æ­¤å·²ç»æœ‰è¿‡å¾ˆå¥½çš„æ³¨è§£ï¼Œæ¯”å¦‚ A note on the Object-Oriented API vs. Pyplot å’Œ Coding Stylesï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œåªä¼šç®€å•è§£é‡Šä¸€ä¸‹ã€‚å¦‚æœä½ éœ€è¦å…³äºè¿™ä¸ªè¯é¢˜çš„å…¥é—¨èµ„æ–™ï¼Œæˆ‘æ¨èå®˜æ–¹æ•™ç¨‹ï¼š\n Tutorials \u0026gt; Introductory \u0026gt; The Lifecycle of a plot Tutorials \u0026gt; Introductory \u0026gt; Pyplot tutorial  é¢å‘å¯¹è±¡çš„ API æ¥å£ è¿™æ˜¯æœ€ä¸ºæ¨èçš„é£æ ¼ï¼Œä¸€èˆ¬ä»¥ fig, ax = plt.subplots() æˆ–å…¶å®ƒç­‰ä»·çš„è¯­å¥å¼€å¤´ï¼Œåè·Ÿ ax.plotã€ax.imshow ç­‰ã€‚å®é™…ä¸Šï¼Œè¿™é‡Œçš„ fig å’Œ ax å°±æ˜¯ Artistã€‚ä¸‹é¢æ˜¯å‡ ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼š\nfig, ax = plt.subplots()\rax.plot(x, y)\r fig = plt.figure()\rax = fig.add_subplot(1,1,1)\rax.plot(x, y)\r æœ‰äº›æ•™ç¨‹ä¼šç”¨ fig = plt.gcf() å’Œ ax = plt.gca()ï¼Œå½“ä½ ä» Pyplot æ¥å£åˆ‡æ¢åˆ°é¢å‘å¯¹è±¡æ¥å£æ—¶ç¡®å®åº”è¯¥è¿™ä¹ˆå†™ï¼Œä½†æœ‰äº›çº¯ Pyplot é£æ ¼çš„ä»£ç é‡Œè¿˜å†™äº›æ— æ„ä¹‰çš„ ax = plt.gca() ï¼Œè¿™æ˜¾ç„¶æ˜¯æ— è„‘ä»é¢å‘å¯¹è±¡ä»£ç é‡ŒæŠ„è¿‡æ¥çš„ã€‚å¦‚æœæœ‰æ„åˆ‡æ¢æ¥å£ï¼Œé‚£ä¹ˆä½¿ç”¨ plt.gcf() å’Œ plt.gca() å¹¶ä¸æ˜¯ä»€ä¹ˆåäº‹ã€‚è€ƒè™‘åˆ°éšå¼åˆ‡æ¢å¯èƒ½ä¼šè¿·æƒ‘åˆå­¦è€…ï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä»ä¸€å¼€å§‹å°±æ˜¾å¼åœ°ä½¿ç”¨ plt.subplots æˆ– fig.add_subplot å°±æ˜¯æœ€å¥½çš„åšæ³•ã€‚\nPyplot æ¥å£ è¿™æ˜¯ä¸€ç§ MATLAB ç”¨æˆ·ç†Ÿæ‚‰çš„ç”»å›¾é£æ ¼ï¼Œå…¶ä¸­æ‰€æœ‰æ“ä½œéƒ½æ˜¯ plt.xxx çš„å½¢å¼ï¼š\n# https://matplotlib.org/stable/tutorials/introductory/pyplot.html\rdef f(t):\rreturn np.exp(-t) * np.cos(2*np.pi*t)\rt1 = np.arange(0.0, 5.0, 0.1)\rt2 = np.arange(0.0, 5.0, 0.02)\rplt.figure(1)\rplt.subplot(211)\rplt.plot(t1, f(t1), 'bo', t2, f(t2), 'k')\rplt.subplot(212)\rplt.plot(t2, np.cos(2*np.pi*t2), 'r--')\rplt.show()\r åˆšå¼€å§‹çš„æ—¶å€™ä½ å¯èƒ½ä¼šè§‰å¾—è¿™ç§é£æ ¼éå¸¸ç®€å•ï¼Œå› ä¸ºä¸éœ€è¦è€ƒè™‘ä½ æ­£åœ¨æ“ä½œå“ªä¸ªå¯¹è±¡ï¼Œè€Œåªéœ€è¦çŸ¥é“ä½ æ­£å¤„äºå“ªä¸ªâ€œçŠ¶æ€â€ï¼Œå› æ­¤è¿™ç§é£æ ¼åˆè¢«ç§°ä½œâ€œçŠ¶æ€æœºâ€ã€‚è¿™é‡Œâ€œçŠ¶æ€â€çš„æ„æ€æ˜¯ç›®å‰ä½ åœ¨å“ªå¼ å›¾ï¼ˆfigureï¼‰å’Œå“ªå¼ å­å›¾ï¼ˆsubplotï¼‰é‡Œã€‚æ­£å¦‚ä½ åœ¨ Pyplot tutorial é‡Œçœ‹åˆ°çš„ï¼Œå¦‚æœä½ çš„å›¾ä¸æ˜¯å¾ˆç‰¹åˆ«å¤æ‚çš„è¯ï¼Œè¿™ç§é£æ ¼èƒ½ç»™å‡ºä¸é”™çš„æ•ˆæœã€‚è™½ç„¶ Pyplot æ¥å£æä¾›äº†è®¸å¤šå‡½æ•°æ¥è®¾ç½®å›¾ç‰‡ï¼Œä½†ä½ å¯èƒ½ä¸åˆ°ä¸€ä¼šå„¿å°±ä¼šå‘ç°è¿™äº›åŠŸèƒ½è¿˜ä¸å¤Ÿç”¨ï¼Œå…·ä½“æ—¶é—´å–å†³äºä½ æƒ³è¦çš„æ•ˆæœï¼Œä¹Ÿè®¸ä¸åˆ°å‡ å°æ—¶ã€å‡ å¤©ã€å‡ ä¸ªæœˆå°±ä¼šè¿™æ ·ï¼ˆå½“ç„¶è¿æ°”å¥½çš„è¯ä½ ä¸ä¼šç¢°åˆ°é—®é¢˜ï¼‰ã€‚åˆ°äº†è¿™ä¸€é˜¶æ®µä½ å°±éœ€è¦è½¬åˆ°é¢å‘å¯¹è±¡æ¥å£äº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æ¨èä»ä¸€å¼€å§‹å°±ä½¿ç”¨é¢å‘å¯¹è±¡æ¥å£çš„åŸå› ä¹‹ä¸€ã€‚ä¸è¿‡å½“ä½ éœ€è¦å¿«é€ŸéªŒè¯æˆ–åªæƒ³ç”»ç‚¹è‰å›¾æ—¶ï¼ŒPyplot è¿˜æ˜¯æœ‰æŒºæœ‰ç”¨çš„ã€‚\nMatplotlib çš„å±‚çº§ç»“æ„ åœ¨ç½‘ä¸Šæœç´¢å‡ æ¬¡åï¼Œä½ ä¼šæ³¨æ„åˆ° matplotlib æœ‰ä¸€ä¸ªå±‚çº§ç»“æ„ï¼Œç”±é€šå¸¸å«åš fig å’Œ ax çš„ä¸œè¥¿ç»„æˆã€‚Matplotlib 1.5 çš„æ—§æ–‡æ¡£ é‡Œæœ‰å¼ å›¾èƒ½å¾ˆå¥½åœ°è§£é‡Šè¿™ä¸ªï¼š\nå®é™…ä¸Šï¼Œå›¾ä¸­è¿™ä¸‰ä¸ªç»„ä»¶æ˜¯è¢«ç§°ä¸ºâ€œå®¹å™¨â€çš„ç‰¹æ®Š Artistï¼ˆTick æ˜¯ç¬¬å››ç§å®¹å™¨ï¼‰ï¼Œæˆ‘ä»¬åé¢è¿˜ä¼šå†è°ˆåˆ°å®¹å™¨ã€‚é€è¿‡è¿™ç§å±‚çº§ç»“æ„ï¼Œå‰é¢ä¸¾çš„ç®€å•ä¾‹å­ä¼šæ˜¾å¾—æ›´åŠ æ¸…æ™°ï¼š\nfig, ax = plt.subplots() # åˆ›å»º Figure å’Œå±äº fig çš„ Axes\r fig = plt.figure() # åˆ›å»º Figure\rax = fig.add_subplot(1,1,1) # åˆ›å»ºå±äº fig çš„ Axes\r è¿›ä¸€æ­¥æŸ¥çœ‹ fig å’Œ ax çš„å±æ€§èƒ½åŠ æ·±æˆ‘ä»¬å¯¹å±‚çº§ç»“æ„çš„ç†è§£ï¼š\nfig = plt.figure()\rax = fig.add_subplot(1,1,1) # åˆ›å»ºä¸€ä¸ªç©ºçš„ç»˜å›¾åŒºåŸŸ\rprint('fig.axes:', fig.axes)\rprint('ax.figure:', ax.figure)\rprint('ax.xaxis:', ax.xaxis)\rprint('ax.yaxis:', ax.yaxis)\rprint('ax.xaxis.axes:', ax.xaxis.axes)\rprint('ax.yaxis.axes:', ax.yaxis.axes)\rprint('ax.xaxis.figure:', ax.xaxis.figure)\rprint('ax.yaxis.figure:', ax.yaxis.figure)\rprint('fig.xaxis:', fig.xaxis)\r fig.axes: [\u0026lt;matplotlib.axes._subplots.AxesSubplot object at 0x1167b0630\u0026gt;]\rax.figure: Figure(432x288)\rax.xaxis: XAxis(54.000000,36.000000)\rax.yaxis: YAxis(54.000000,36.000000)\rax.xaxis.axes: AxesSubplot(0.125,0.125;0.775x0.755)\rax.yaxis.axes: AxesSubplot(0.125,0.125;0.775x0.755)\rax.xaxis.figure: Figure(432x288)\rax.yaxis.figure: Figure(432x288)\r--------------------------------------------------------------------------------\rAttributeError Traceback (most recent call last)\r\u0026lt;ipython-input-21-b9f2d5d9fe09\u0026gt; in \u0026lt;module\u0026gt;()\r9 print('ax.xaxis.figure:', ax.xaxis.figure)\r10 print('ax.yaxis.figure:', ax.yaxis.figure)\r--------\u0026gt; 11 print('fig.xaxis:', fig.xaxis)\rAttributeError: 'Figure' object has no attribute 'xaxis'\r æ ¹æ®è¿™äº›ç»“æœæˆ‘ä»¬å¯ä»¥å½’çº³ä»¥ä¸‹å‡ æ¡å…³äº Figureã€Axes å’Œ Axis å±‚çº§ç»“æ„çš„è§„åˆ™ï¼š\n Figure çŸ¥é“ Axesï¼Œä½†ä¸çŸ¥é“ Axisã€‚ Axes åŒæ—¶çŸ¥é“ Figure å’Œ Axisã€‚ Axis åŒæ—¶çŸ¥é“ Axes å’Œ Figureã€‚ Figure å¯ä»¥å®¹çº³å¤šä¸ª Axesï¼Œå› ä¸º fig.axes æ˜¯ä¸€ä¸ªç”± Axes ç»„æˆçš„åˆ—è¡¨ã€‚ Axes åªèƒ½å±äºä¸€ä¸ª Figureï¼Œå› ä¸º ax.figure ä¸æ˜¯åˆ—è¡¨ã€‚ åŸºäºç±»ä¼¼çš„ç†ç”±ï¼ŒAxes åªèƒ½æœ‰ä¸€ä¸ª XAxis å’Œä¸€ä¸ª YAxisã€‚ XAxis å’Œ YAxis åªèƒ½å±äºä¸€ä¸ª Axesï¼Œå› è€Œä¹Ÿåªèƒ½å±äºä¸€ä¸ª Figureã€‚  å›¾ä¸­ä¸€åˆ‡çš†ä¸º Artist ç›®å‰ Usage Guide é‡Œå¹¶æ²¡æœ‰æ”¾è§£é‡Šå±‚çº§ç»“æ„çš„å›¾ï¼Œè€Œæ˜¯æ”¾äº†ä¸€å¼ åä¸ºâ€å‰–æä¸€å¼ å›¾ï¼ˆAnatomy of a figureï¼‰â€œçš„ç¤ºæ„å›¾2ï¼ŒåŒæ ·ä¿¡æ¯é‡åè¶³ï¼Œé˜è¿°äº†ä¸€å¼ å›¾æ‰€å«çš„å…¨éƒ¨ç»„ä»¶3ã€‚\nä»ä»£è¡¨æ•°æ®çš„çº¿æ¡å’Œç‚¹åˆ° X è½´çš„å°åˆ»åº¦å’Œæ–‡æœ¬æ ‡ç­¾ï¼Œå›¾ä¸­æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ª Artist å¯¹è±¡4ã€‚Artist åˆ†ä¸ºå®¹å™¨ï¼ˆcontainerï¼‰å’Œå›¾å…ƒï¼ˆprimitiveï¼‰ä¸¤ç§ç±»å‹ã€‚æ­£å¦‚æˆ‘åœ¨ä¸Šä¸€èŠ‚å†™åˆ°çš„ï¼Œmatplotlib å±‚çº§ç»“æ„çš„ä¸‰ä¸ªç»„ä»¶â€”â€”Figureã€Axes å’Œ Axis éƒ½æ˜¯å®¹å™¨ï¼Œå¯ä»¥å®¹çº³æ›´ä½ä¸€çº§çš„å®¹å™¨å’Œå¤æ•°ä¸ªå›¾å…ƒï¼Œä¾‹å¦‚ç”± ax.plot åˆ›å»ºçš„ Line2Dã€ax.scatter åˆ›å»ºçš„ PathCollectionï¼Œæˆ– ax.annotate åˆ›å»ºçš„ Textã€‚äº‹å®ä¸Šï¼Œè¿åˆ»åº¦çº¿å’Œåˆ»åº¦æ ‡ç­¾éƒ½æ˜¯ Line2D å’Œ Textï¼Œå¹¶ä¸”éš¶å±äºç¬¬å››ç§å®¹å™¨ Tickã€‚\nå®¹å™¨æœ‰è®¸å¤šå­˜æ”¾å„ç§å›¾å…ƒçš„â€œç›’å­â€ï¼ˆæŠ€æœ¯å±‚é¢ä¸Šå°±æ˜¯ Python åˆ—è¡¨ï¼‰ï¼Œä¾‹å¦‚åˆšå®ä¾‹åŒ–çš„ Axes å¯¹è±¡ ax ä¼šå«æœ‰ä¸€ä¸ªç©ºåˆ—è¡¨ ax.linesï¼Œå¸¸ç”¨çš„ ax.plot å‘½ä»¤ä¼šå¾€è¿™ä¸ªåˆ—è¡¨é‡Œæ·»åŠ ä¸€ä¸ª Line2D å¯¹è±¡ï¼Œå¹¶åœ¨åå°é™é»˜åœ°è¿›è¡Œç›¸å…³è®¾ç½®ã€‚\nx = np.linspace(0, 2*np.pi, 100)\rfig = plt.figure()\rax = fig.add_subplot(1,1,1)\rprint('ax.lines before plot:\\n', ax.lines) # ç©ºçš„\rline1, = ax.plot(x, np.sin(x), label='1st plot') # å¾€ ax.lines é‡ŒåŠ  Line2D\rprint('ax.lines after 1st plot:\\n', ax.lines)\rline2, = ax.plot(x, np.sin(x+np.pi/8), label='2nd plot') # å†åŠ ä¸€ä¸ª Line2D\rprint('ax.lines after 2nd plot:\\n', ax.lines)\rax.legend()\rprint('line1:', line1)\rprint('line2:', line2)\r ax.lines before plot:\r[]\rax.lines after 1st plot:\r[\u0026lt;matplotlib.lines.Line2D object at 0x1171ca748\u0026gt;]\rax.lines after 2nd plot:\r[\u0026lt;matplotlib.lines.Line2D object at 0x1171ca748\u0026gt;, \u0026lt;matplotlib.lines.Line2D object at 0x117430550\u0026gt;]\rline1: Line2D(1st plot)\rline2: Line2D(2nd plot)\r æ¥ä¸‹æ¥æ¦‚è¿°ä¸€ä¸‹è¿™å››ç§å®¹å™¨ï¼Œè¡¨æ ¼æ‘˜è‡ª Artist tutorialã€‚\nFigure    Figure å±æ€§ æè¿°     fig.axes å«æœ‰ Axes å®ä¾‹çš„åˆ—è¡¨ï¼ˆåŒ…æ‹¬ Subplotï¼‰   fig.patch ç”¨ä½œ Figure èƒŒæ™¯çš„ Rectangle å®ä¾‹   fig.images å«æœ‰ FigureImages è¡¥ä¸ï¼ˆpatchï¼‰çš„åˆ—è¡¨â€”â€”ç”¨äºæ˜¾ç¤º raw pixel   fig.legends å«æœ‰ Figure Legend å®ä¾‹çš„åˆ—è¡¨ï¼ˆåŒºåˆ«äº Axes.legendsï¼‰   fig.lines å«æœ‰ Figure Line2D å®ä¾‹çš„åˆ—è¡¨ï¼ˆå¾ˆå°‘ç”¨åˆ°ï¼Œè¯¦è§ Axes.linesï¼‰   fig.patches å«æœ‰ Figure è¡¥ä¸çš„åˆ—è¡¨ï¼ˆå¾ˆå°‘ç”¨åˆ°ï¼Œè¯¦è§ Axes.patchesï¼‰   fig.texts å«æœ‰ Figure Text å®ä¾‹çš„åˆ—è¡¨    å¤æ•°åçš„å±æ€§æ˜¯åˆ—è¡¨ï¼Œè€Œå•æ•°åçš„åˆ™ä»£è¡¨å•ä¸ªå¯¹è±¡ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯å±äº Figure çš„ Artist éƒ½é»˜è®¤ä½¿ç”¨ Figure åæ ‡ï¼Œå®ƒ å¯ä»¥é€šè¿‡ Transforms è½¬æ¢ä¸º Axes æˆ–æ•°æ®çš„åæ ‡ï¼Œä¸è¿‡è¿™ä¸ªè¯é¢˜å°±è¶…å‡ºæœ¬æ–‡çš„èŒƒå›´äº†ã€‚\nfig.legend å’Œ ax.legend é€šè¿‡ fig.legend æ–¹æ³• å¯ä»¥æ·»åŠ å›¾ä¾‹ï¼ˆlegendï¼‰ï¼Œè€Œ fig.legends å°±æ˜¯ç”¨æ¥è£…è¿™äº›å›¾ä¾‹çš„â€œç›’å­â€ã€‚ä½ å¯èƒ½ä¼šè¯´â€œè¿™æœ‰ä»€ä¹ˆç”¨ï¼Ÿæˆ‘ä»¬å·²ç»æœ‰äº† ax.legend å•Šã€‚â€åŒºåˆ«åœ¨äºäºŒè€…çš„ä½œç”¨åŸŸä¸åŒï¼Œax.legend åªä¼šä»å±äº ax çš„ Artist é‡Œæ”¶é›†æ ‡ç­¾ï¼ˆlabelï¼‰ï¼Œè€Œ fig.legend ä¼šæ”¶é›† fig æ——ä¸‹æ‰€æœ‰ Axes é‡Œçš„æ ‡ç­¾ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ ç”¨ ax.twinx ç”»å›¾æ—¶ï¼Œå•çº¯è°ƒç”¨ ax.legend åªä¼šåˆ›å»ºå‡ºä¸¤ä¸ªç‹¬ç«‹çš„å›¾ä¾‹ï¼Œè¿™é€šå¸¸ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œè¿™æ—¶ fig.lengend å°±æ´¾ä¸Šç”¨åœºäº†ã€‚\nx = np.linspace(0, 2*np.pi, 100)\rfig = plt.figure()\rax = fig.add_subplot(111)\rax.plot(x, np.sin(x), label='sin(x)')\rax1 = ax.twinx()\rax1.plot(x, 2*np.cos(x), c='C1', label='2*cos(x)') # cf. 'CN' å½¢å¼çš„è®°å·\r# https://matplotlib.org/stable/tutorials/colors/colors.html#cn-color-selection\rax.legend()\rax1.legend()\r å°†ä¸¤ä¸ªå›¾ä¾‹åˆå¹¶åœ¨ä¸€èµ·çš„ç»å…¸æŠ€å·§æ˜¯ï¼ŒæŠŠä¸¤ä¸ª Axes çš„å›¾ä¾‹å¥æŸ„ï¼ˆhandleï¼‰å’Œæ ‡ç­¾ç»„åˆèµ·æ¥ï¼š\n# åœ¨å¦ä¸€ä¸ª notebook é‡Œæ‰§è¡Œè¿™éƒ¨åˆ†ä»¥æ˜¾ç¤ºæ›´æ–°åçš„å›¾åƒ\rhandler, label = ax.get_legend_handles_labels()\rhandler1, label1 = ax1.get_legend_handles_labels()\rax.legend(handler+handler1, label+label1, loc='upper center', title='ax.legend')\r# ax1.legend åˆ›å»ºçš„å›¾ä¾‹ä»ç„¶å­˜åœ¨\rfig\r è¿™ä¸ªéœ€æ±‚å¯ä»¥é€šè¿‡ä¸ç»™å‚æ•°ç›´æ¥è°ƒç”¨ fig.lengend æ¥è½»æ¾è§£å†³ï¼ˆè‡ª 2.1 ç‰ˆæœ¬ å¼•å…¥5ï¼‰ã€‚å›¾ä¾‹çš„ä½ç½®é»˜è®¤ä½¿ç”¨ Figure åæ ‡ï¼Œæƒ³æŠŠå›¾ä¾‹æ”¾åœ¨ç»˜å›¾æ¡†é‡Œé¢æ—¶ä¼šä¸å¤ªæ–¹ä¾¿ï¼Œä½ å¯ä»¥æŒ‡å®š bbox_transform å…³é”®å­—æ”¹ç”¨ Axes åæ ‡ï¼š\nfig.legend(loc='upper right', bbox_to_anchor=(1,1), bbox_transform=ax.transAxes, title='fig.legend\\nax.transAxes')\rfig\r Axes  matplotlib.axes.Axes æ˜¯ matplotlib ä½“ç³»çš„æ ¸å¿ƒã€‚\n è¿™å¥è¯å‡ºè‡ª Artist tutorialï¼Œè¯´çš„éå¸¸æ­£ç¡®ï¼Œå› ä¸ºåœ¨ matplotlib ä¸­æ•°æ®å¯è§†åŒ–çš„é‡è¦éƒ¨åˆ†éƒ½æ˜¯ç”± Axes çš„æ–¹æ³•å®Œæˆçš„ã€‚\n   Axes å±æ€§ æè¿°     ax.artists å«æœ‰ Artist å®ä¾‹çš„åˆ—è¡¨   ax.patch ç”¨ä½œ Axes èƒŒæ™¯çš„ Rectangle å®ä¾‹   ax.collections å«æœ‰ collection å®ä¾‹çš„åˆ—è¡¨   ax.images å«æœ‰ AxesImage å®ä¾‹çš„åˆ—è¡¨   ax.legends å«æœ‰ Legend å®ä¾‹çš„åˆ—è¡¨   ax.lines å«æœ‰ Line2D å®ä¾‹çš„åˆ—è¡¨   ax.patches å«æœ‰ Patch å®ä¾‹çš„åˆ—è¡¨   ax.texts å«æœ‰ Text å®ä¾‹çš„åˆ—è¡¨   ax.xaxis matplotlib.axis.XAxis å®ä¾‹   ax.yaxis matplotlib.axis.YAxis å®ä¾‹    å¸¸ç”¨çš„ ax.plot å’Œ ax.scatter ç­‰å‘½ä»¤è¢«ç§°ä¸ºâ€è¾…åŠ©æ–¹æ³•ï¼ˆhelper methodsï¼‰â€œï¼Œå®ƒä»¬ä¼šå°†ç›¸åº”çš„ Artist æ”¾å…¥åˆé€‚çš„å®¹å™¨å†…ï¼Œå¹¶æ‰§è¡Œå…¶å®ƒä¸€äº›æ‚åŠ¡ã€‚\n   è¾…åŠ©æ–¹æ³• Artist å®¹å™¨     ax.annotate Annotate ax.texts   ax.bar Rectangle ax.patches   ax.errorbar Line2D \u0026amp; Rectangle ax.lines \u0026amp; ax.patches   ax.fill Polygon ax.patches   ax.hist Rectangle ax.patches   ax.imshow AxesImage ax.images   ax.legend Legend ax.legends   ax.plot Line2D ax.lines   ax.scatter PathCollection ax.collections   ax.text Text ax.texts    ä¸‹é¢è¿™ä¸ªä¾‹å­å±•ç¤ºäº† ax.plot å’Œ ax.scatter åˆ†åˆ«å°† Line2D å’Œ PatchCollection å¯¹è±¡æ·»åŠ åˆ°å¯¹åº”åˆ—è¡¨é‡Œçš„è¿‡ç¨‹ï¼š\nx = np.linspace(0, 2*np.pi, 100)\rfig = plt.figure()\rax = fig.add_subplot(1,1,1)\rprint('ax.lines before plot:\\n', ax.lines) # ç©ºçš„ Axes.lines\rline1, = ax.plot(x, np.sin(x), label='1st plot') # æŠŠ Line2D åŠ å…¥ Axes.lines\rprint('ax.lines after 1st plot:\\n', ax.lines)\rline2, = ax.plot(x, np.sin(x+np.pi/8), label='2nd plot') # åŠ å…¥å¦ä¸€æ¡ Line2D print('ax.lines after 2nd plot:\\n', ax.lines)\rprint('ax.collections before scatter:\\n', ax.collections)\rscat = ax.scatter(x, np.random.rand(len(x)), label='scatter') # æŠŠ PathCollection åŠ å…¥ Axes.collections\rprint('ax.collections after scatter:\\n', ax.collections)\rax.legend()\rprint('line1:', line1)\rprint('line2:', line2)\rprint('scat:', scat)\rax.set_xlabel('x value')\rax.set_ylabel('y value')\r ax.lines before plot:\r[]\rax.lines after 1st plot:\r[\u0026lt;matplotlib.lines.Line2D object at 0x1181d16d8\u0026gt;]\rax.lines after 2nd plot:\r[\u0026lt;matplotlib.lines.Line2D object at 0x1181d16d8\u0026gt;, \u0026lt;matplotlib.lines.Line2D object at 0x1181d1e10\u0026gt;]\rax.collections before scatter:\r[]\rax.collections after scatter:\r[\u0026lt;matplotlib.collections.PathCollection object at 0x1181d74a8\u0026gt;]\rline1: Line2D(1st plot)\rline2: Line2D(2nd plot)\rscat: \u0026lt;matplotlib.collections.PathCollection object at 0x1181d74a8\u0026gt;\r ä¸å»ºè®®é‡å¤ä½¿ç”¨å·²ç»ç”»å¥½çš„å¯¹è±¡ åœ¨çŸ¥é“äº†ç”»å¥½çš„å¯¹è±¡ä¼šè¢«å­˜åœ¨åˆ—è¡¨é‡Œä¹‹åï¼Œä½ ä¹Ÿè®¸ä¼šçµæœºä¸€åŠ¨ï¼Œå°è¯•å¤ç”¨ Axes.lines ä¸­çš„è¿™äº›å¯¹è±¡ï¼Œå³æŠŠå®ƒä»¬æ·»åŠ åˆ°å¦ä¸€ä¸ª Axes.lines åˆ—è¡¨ä¸­ï¼Œä»¥æé«˜ç”»å›¾é€Ÿåº¦ã€‚Artist tutorial é‡Œæ˜ç¡®æŒ‡å‡ºä¸æ¨èè¿™æ ·åšï¼Œå› ä¸ºè¾…åŠ©æ–¹æ³•é™¤äº†åˆ›å»º Artist å¤–è¿˜ä¼šè¿›è¡Œå¾ˆå¤šå…¶å®ƒå¿…è¦çš„æ“ä½œã€‚éšä¾¿æµ‹è¯•ä¸€ä¸‹å°±ä¼šå‘ç°è¿™ä¸ªæ€è·¯ç¡®å®è¡Œä¸é€šï¼š\nx = np.linspace(0, 2*np.pi, 100)\rfig = plt.figure()\rax1 = fig.add_subplot(2,1,1) # ä¸Šé¢çš„å­å›¾\rline, = ax1.plot(x, np.sin(x), label='ax1 line') # åˆ›å»ºä¸€ä¸ª Line2D å¯¹è±¡\rax1.legend()\rax2 = fig.add_subplot(2,1,2) # ä¸‹é¢çš„å­å›¾\rax2.lines.append(line) # å°è¯•ç€æŠŠåŒä¸€ä¸ª Line2D å¯¹è±¡ç”¨äºå¦ä¸€ä¸ª Axes\r å°±ç®—æ˜¯ add_line æ–¹æ³•ä¹Ÿä¸è¡Œï¼š\nax2.add_line(line)\r ValueError: Can not reset the axes. You are probably trying to re-use an artist in more than one Axes which is not supported\r æŠ¥é”™ä¿¡æ¯è¡¨æ˜ï¼Œæ— è®ºä¸€ä¸ª Artist æ˜¯å®¹å™¨è¿˜æ˜¯å›¾å…ƒï¼Œéƒ½ä¸èƒ½è¢«å¤šä¸ªå®¹å™¨åŒæ—¶å®¹çº³ï¼Œè¿™ç‚¹ä¹Ÿä¸å‰é¢æè¿‡çš„ï¼Œæ¯ä¸ª Artist çš„çˆ¶å®¹å™¨æ˜¯å•ä¸ªå¯¹è±¡è€Œéåˆ—è¡¨çš„äº‹å®ç›¸ä¸€è‡´ï¼š\nprint('fig:', id(fig)) print('ax1:', id(ax1))\rprint('line.fig:', id(line.figure))\rprint('line.axes:', id(line.axes))\r fig: 4707121584\rax1: 4707121136\rline.fig: 4707121584\rline.axes: 4707121136\r ç†è®ºä¸Šå¦‚æœä½ ä»¥åˆé€‚çš„æ–¹å¼æŠŠæ‰€æœ‰å¿…è¦çš„æ“ä½œéƒ½åšå¥½äº†ï¼Œåº”è¯¥å°±è¡Œå¾—é€šï¼Œä½†è¿™å°±å®Œå…¨åç¦»äº†åªæ˜¯æƒ³å‘åˆ—è¡¨è¿½åŠ ä¸€ä¸ªå¯¹è±¡çš„åˆå¿ƒï¼Œè¿™ä¹ˆéº»çƒ¦çš„äº‹è¿˜æ˜¯åˆ«åšäº†å§ã€‚\nAxis Axis ä»¥ XAxis å’Œ YAxis çš„å½¢å¼å‡ºç°ï¼Œè™½ç„¶å®ƒä»¬åªå«æœ‰ä¸åˆ»åº¦å’Œæ ‡ç­¾ç›¸å…³çš„ Artistï¼Œä½†è‹¥æƒ³ç»†è°ƒè¿˜æ€»å¾—ä¸Šç½‘æœæœè¯¥æ€ä¹ˆåšï¼Œæœ‰æ—¶è¿™ä¼šè€—æ‰ä½ ä¸€ä¸ªé’Ÿå¤´çš„æ—¶é—´ã€‚æˆ‘å¸Œæœ›è¿™ä¸€å°èŠ‚èƒ½å¸®ä½ å¿«é€Ÿæå®šè¿™äº‹ã€‚\nArtist tutorial é‡Œ Axis ä¸åƒå…¶å®ƒå®¹å™¨é‚£æ ·æœ‰è¡¨æ ¼ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±åšäº†å¼ ç±»ä¼¼çš„ï¼š\n   Axis å±æ€§ æè¿°     Axis.label ç”¨ä½œåæ ‡è½´æ ‡ç­¾çš„ Text å®ä¾‹   Axis.majorTicks ç”¨ä½œå¤§åˆ»åº¦ï¼ˆmajor ticksï¼‰çš„ Tick å®ä¾‹çš„åˆ—è¡¨   Axis.minorTicks ç”¨ä½œå°åˆ»åº¦ï¼ˆminor ticksï¼‰çš„ Tick å®ä¾‹çš„åˆ—è¡¨    åœ¨å‰é¢ Axes å®¹å™¨çš„ä¾‹å­é‡Œæˆ‘ä»¬ç”¨åˆ°äº† ax.set_xlabel å’Œ ax.set_ylabelï¼Œä½ å¯èƒ½è®¤ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•è®¾ç½®çš„æ˜¯ Axes å®ä¾‹ï¼ˆaxï¼‰çš„ X å’Œ Y æ ‡ç­¾ï¼Œä½†å…¶å®å®ƒä»¬è®¾ç½®çš„æ˜¯ XAxis å’Œ YAxis çš„ label å±æ€§ï¼Œå³ ax.xaxis.label å’Œ ax.yaxis.labelã€‚\nxax = ax.xaxis\rprint('xax.label:', xax.label)\rprint('xax.majorTicks:\\n', xax.majorTicks) # ä¸ƒä¸ªå¤§åˆ»åº¦(ä»0åˆ°6)å’Œä¸¤ä¸ªå› ä¸ºå‡ºç•Œè€Œçœ‹ä¸åˆ°çš„åˆ»åº¦\rprint('xax.minorTicks:\\n', xax.minorTicks) # ä¸¤ä¸ªåˆ»åº¦å‡ºç•Œäº†(åœ¨å›¾å¤–é¢)\r xax.label: Text(0.5,17.2,'x value')\rxax.majorTicks:\r[\u0026lt;matplotlib.axis.XTick object at 0x117ae4400\u0026gt;, \u0026lt;matplotlib.axis.XTick object at 0x117941128\u0026gt;, \u0026lt;matplotlib.axis.XTick object at 0x11732c940\u0026gt;, \u0026lt;matplotlib.axis.XTick object at 0x1177d0470\u0026gt;, \u0026lt;matplotlib.axis.XTick object at 0x1177d0390\u0026gt;, \u0026lt;matplotlib.axis.XTick object at 0x1175058d0\u0026gt;, \u0026lt;matplotlib.axis.XTick object at 0x1175050b8\u0026gt;, \u0026lt;matplotlib.axis.XTick object at 0x117bf65c0\u0026gt;, \u0026lt;matplotlib.axis.XTick object at 0x117bf6b00\u0026gt;]\rxax.minorTicks:\r[\u0026lt;matplotlib.axis.XTick object at 0x117ab5940\u0026gt;, \u0026lt;matplotlib.axis.XTick object at 0x117b540f0\u0026gt;]\r ax.set_xxx æ–¹æ³•æ˜¯æš‚æ—¶æ€§çš„ Axes æœ‰å¾ˆå¤šå½¢å¦‚ set_xxx çš„è¾…åŠ©æ–¹æ³•ï¼Œå¯ä»¥ä¿®æ”¹ Axis å’Œ Tick çš„å±æ€§å’Œå€¼ã€‚è¿™äº›æ–¹æ³•ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œmatplotlib åˆå­¦è€…é‡åˆ°çš„å¤§éƒ¨åˆ†é—®é¢˜éƒ½å¯ä»¥å€ŸåŠ©å…¶ä¸­ä¸€äº›æ–¹æ³•æ¥è§£å†³ã€‚éœ€è¦æ³¨æ„ set_xxx æ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼Œå®ƒä»¬çš„ä¿®æ”¹ç»“æœå¹¶ä¸ä¼šéšä¹‹åçš„æ”¹åŠ¨è€Œæ›´æ–°ã€‚ä¾‹å¦‚ï¼Œä½ åœ¨ç¬¬ä¸€æ¬¡ plot ä¹‹åç”¨ ax.set_xticks æŠŠ X åˆ»åº¦æ”¹å¾—å¾ˆåˆé€‚ï¼Œæ¥ä¸‹æ¥ç¬¬äºŒæ¬¡ plot è¶…å‡ºäº†ç¬¬ä¸€æ¬¡ plot åœˆå®šçš„ X èŒƒå›´ï¼Œé‚£ä¹ˆç»“æœå°±ä¼šä¸åˆé¢„æœŸï¼š\nx = np.linspace(0, 2*np.pi, 100)\rfig = plt.figure()\rax = fig.add_subplot(1,1,1)\rline1, = ax.plot(x, np.sin(x), label='') # X èŒƒå›´: 0 to 2pi\rax.set_xticks([0, 0.5*np.pi, np.pi, 1.5*np.pi, 2*np.pi])\rline2, = ax.plot(1.5*x, np.sin(x), label='') # X èŒƒå›´: 0 to 3pi\r Ticker å¸®ä½ é€šé€šæå®š å¦‚æœä½ ä¸ç”¨ set_xxx æ–¹æ³•ä¿®æ”¹åˆ»åº¦å‚æ•°ï¼Œæ¯æ¬¡ç”»ä¸Šå†…å®¹æ—¶åˆ»åº¦å’Œåˆ»åº¦æ ‡ç­¾ï¼ˆtick labelï¼‰ä¼šè‡ªåŠ¨è¿›è¡Œç›¸åº”çš„æ›´æ–°ã€‚è¿™å½’åŠŸäº Tickerï¼Œæˆ–è€…æ›´å‡†ç¡®ç‚¹ï¼Œformatter å’Œ locatorã€‚å®ƒä»¬å¯¹äºè®¾ç½®åˆ»åº¦æ¥è¯´æå…¶é‡è¦ï¼Œä½†å¦‚æœä½ å¹³æ—¶åªé å¤åˆ¶ç²˜è´´ Stack Overflow ä¸Šçš„ç­”æ¡ˆæ¥è§£å†³é—®é¢˜ï¼Œææ€•ä½ å¯¹å®ƒä»¬çŸ¥ä¹‹ç”šå°‘6ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å‰ä¸€ä¸ªä¾‹å­é‡Œå…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆå§ï¼š\n è¯‘æ³¨ï¼šformatter å’Œ locator ä¼¼ä¹æ²¡æœ‰é€šç”¨çš„è¯‘åï¼Œæ‰€ä»¥è¿™é‡Œä¸è¯‘ã€‚\n xax = ax.xaxis\ryax = ax.yaxis\rprint('xax.get_major_formatter()', xax.get_major_formatter())\rprint('yax.get_major_formatter()', yax.get_major_formatter())\rprint('xax.get_major_locator():', xax.get_major_locator())\rprint('yax.get_major_locator():', yax.get_major_locator())\r xax.get_major_formatter() \u0026lt;matplotlib.ticker.ScalarFormatter object at 0x118af4d68\u0026gt;\ryax.get_major_formatter() \u0026lt;matplotlib.ticker.ScalarFormatter object at 0x118862be0\u0026gt;\rxax.get_major_locator(): \u0026lt;matplotlib.ticker.FixedLocator object at 0x1188d5908\u0026gt;\ryax.get_major_locator(): \u0026lt;matplotlib.ticker.AutoLocator object at 0x118aed1d0\u0026gt;\r X å’Œ Y è½´éƒ½è®¾ç½®æœ‰ ScalarFormatterï¼Œå› ä¸ºè¿™æ˜¯é»˜è®¤çš„ formatterï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿæ²¡æœ‰å¯¹å…¶è¿›è¡Œæ”¹åŠ¨ã€‚å¦ä¸€æ–¹é¢ï¼ŒY è½´è®¾ç½®çš„æ˜¯é»˜è®¤çš„ AutoLocatorï¼Œè€Œ X è½´å› ä¸ºæˆ‘ä»¬ç”¨ ax.set_xticks æ”¹å˜äº†åˆ»åº¦çš„ä½ç½®ï¼Œç°åœ¨è¢«è®¾ç½®ä¸º FixedLocatorã€‚é¡¾åæ€ä¹‰ï¼ŒFixedLocator ä½¿ç”¨å›ºå®šçš„åˆ»åº¦ä½ç½®ï¼Œå³ä¾¿ä¹‹åç”»å›¾åŒºåŸŸå˜äº†ä¹Ÿä¸ä¼šæ›´æ–°åˆ»åº¦ä½ç½®ã€‚\næ¥ç€è®©æˆ‘ä»¬ç”¨ ax.set_xticks ä»¥å¤–çš„æ–¹æ³•æ¥æ”¹å˜ä¸Šä¸ªä¾‹å­ä¸­çš„ Tickerï¼š\nimport matplotlib.ticker as ticker # æƒ³ä½¿ç”¨ Ticker å¿…é¡»è¦è¿™ä¸€å¥\rax.xaxis.set_major_locator(ticker.MultipleLocator(0.5*np.pi)) # æ¯éš” 0.5*pi ç¡®å®šä¸€ä¸ªåˆ»åº¦\rfig # å±•ç¤ºåº”ç”¨äº†æ–° locator çš„ figure\r å†æ¥çœ‹çœ‹ formatterï¼š\n@ticker.FuncFormatter # FuncFormatter å¯ä»¥ç”¨ä½œè£…é¥°å™¨\rdef major_formatter_radian(x, pos):\rreturn '{}$\\pi$'.format(x/np.pi) # è¿™å¯èƒ½ä¸æ˜¯æ˜¾ç¤ºå¼§åº¦å•ä½çš„åˆ»åº¦æ ‡ç­¾çš„æœ€å¥½æ–¹æ³•\rax.xaxis.set_major_formatter(major_formatter_radian)\rfig\r å¥½äº†ï¼Œå¯èƒ½ä½ è¿˜æœ‰æƒ³è°ƒæ•´çš„åœ°æ–¹ï¼Œä½†æˆ‘è§‰å¾—è®²åˆ°è¿™å„¿å·²ç»å¤Ÿæ¸…æ™°äº†ã€‚\nä½ å¯ä»¥åœ¨ matplotlib gallery é‡Œå­¦åˆ°æ›´å¤šï¼š\nGallery \u0026gt; Tick formatters\nGallery \u0026gt; Tick locators\nax.plot çš„ xunits å…³é”®å­— é¡ºä¾¿ä¸€æï¼Œax.plot æœ‰ä¸ªç›®å‰ è¿˜æ²¡æœ‰è¯´æ˜æ–‡æ¡£ çš„å…³é”®å­— xunitsï¼Œæˆ‘è‡ªå·±æ˜¯ä»æ¥æ²¡ç”¨è¿‡ï¼Œä½†ä½ å¯ä»¥åœ¨ Gallery \u0026gt; Radian ticks é¡µé¢çœ‹åˆ°ä¾‹å­ï¼Œæ›´å¤šå…³äº matplotlib.units.ConversionInterface çš„å†…å®¹è¯·ç‚¹ è¿™é‡Œã€‚\nimport numpy as np\rfrom basic_units import radians, degrees, cos\rfrom matplotlib.pyplot import figure, show\rx = [val*radians for val in np.arange(0, 15, 0.01)]\rfig = figure()\rfig.subplots_adjust(hspace=0.3)\rax = fig.add_subplot(211)\rline1, = ax.plot(x, cos(x), xunits=radians)\rax = fig.add_subplot(212)\rline2, = ax.plot(x, cos(x), xunits=degrees)\r Tick ç»ˆäºï¼Œæˆ‘ä»¬æŠµè¾¾äº† matplotlib å±‚çº§ç»“æ„çš„åº•éƒ¨ã€‚Tick æ˜¯ä¸ªå¾ˆå°çš„å®¹å™¨ï¼Œä¸»è¦å®¹çº³è¡¨ç¤ºåˆ»åº¦çš„çŸ­çº¿å’Œè¡¨ç¤ºåˆ»åº¦æ ‡ç­¾çš„æ–‡æœ¬ã€‚\n   Tick å±æ€§ æè¿°     Tick.tick1line Line2D å®ä¾‹   Tick.tick2line Line2D å®ä¾‹   Tick.gridline ç”¨ä½œç½‘æ ¼çš„ Line2D å®ä¾‹   Tick.label1 Text å®ä¾‹   Tick.label2 Text å®ä¾‹   Tick.gridOn æ§åˆ¶æ˜¯å¦ç”»å‡ºç½‘æ ¼çº¿çš„å¸ƒå°”é‡   Tick.tick1On æ§åˆ¶æ˜¯å¦ç”»å‡ºç¬¬ä¸€ç»„åˆ»åº¦çº¿çš„å¸ƒå°”é‡   Tick.tick2On æ§åˆ¶æ˜¯å¦ç”»å‡ºç¬¬äºŒç»„åˆ»åº¦çº¿çš„å¸ƒå°”é‡   Tick.label1On æ§åˆ¶æ˜¯å¦ç”»å‡ºç¬¬ä¸€ç»„åˆ»åº¦æ ‡ç­¾çš„å¸ƒå°”é‡   Tick.label2On æ§åˆ¶æ˜¯å¦ç”»å‡ºç¬¬äºŒç»„åˆ»åº¦æ ‡ç­¾çš„å¸ƒå°”é‡    ç±»ä¼¼äº Axisï¼ŒTick åŒæ ·ä»¥ XTick å’Œ YTick çš„å½¢å¼å‡ºç°ã€‚ç¬¬ä¸€ç»„å’Œç¬¬äºŒç»„åˆ†åˆ«æŒ‡ä¸Šè¾¹å’Œä¸‹è¾¹çš„ XTickï¼Œä»¥åŠå·¦è¾¹å’Œå³è¾¹çš„ YTickï¼Œä¸è¿‡ç¬¬äºŒç»„é»˜è®¤æ˜¯éšè—çš„ã€‚\nxmajortick = ax.xaxis.get_major_ticks()[2] # ä¸Šä¸€å¼ å›¾é‡Œæ¯éš” 0.5 pi å‡ºç°çš„åˆ»åº¦\rprint('xmajortick', xmajortick)\rprint('xmajortick.tick1line', xmajortick.tick1line)\rprint('xmajortick.tick2line', xmajortick.tick2line)\rprint('xmajortick.gridline', xmajortick.gridline)\rprint('xmajortick.label1', xmajortick.label1)\rprint('xmajortick.label2', xmajortick.label2)\rprint('xmajortick.gridOn', xmajortick.gridOn)\rprint('xmajortick.tick1On', xmajortick.tick1On)\rprint('xmajortick.tick2On', xmajortick.tick2On)\rprint('xmajortick.label1On', xmajortick.label1On)\rprint('xmajortick.label2On', xmajortick.label2On)\r xmajortick \u0026lt;matplotlib.axis.XTick object at 0x11eec0710\u0026gt;\rxmajortick.tick1line Line2D((1.5708,0))\rxmajortick.tick2line Line2D()\rxmajortick.gridline Line2D((0,0),(0,1))\rxmajortick.label1 Text(1.5708,0,'0.5$\\\\pi$')\rxmajortick.label2 Text(0,1,'0.5$\\\\pi$')\rxmajortick.gridOn False\rxmajortick.tick1On True\rxmajortick.tick2On False\rxmajortick.label1On True\rxmajortick.label2On False\r å¾—ç›Šäºå„ç§è¾…åŠ©æ–¹æ³•ã€Ticker å’Œ Axes.tick_paramsï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬ä¸éœ€è¦ç›´æ¥æ“ä½œ Tickã€‚\næ˜¯æ—¶å€™è‡ªå®šä¹‰ä½ çš„é»˜è®¤æ ·å¼äº† æ¥ç§ç§é»˜è®¤æ ·å¼çš„ä¸€ç³»åˆ—å‚æ•°å§ã€‚\nTutorials \u0026gt; Customizing matplotlib \u0026gt; A sample matplotlibrc file\næˆ‘çŒœä½ ç°åœ¨åº”è¯¥èƒ½ç†è§£å„ä¸ªå‚æ•°çš„ä½œç”¨ï¼Œå¹¶ä¸”çŸ¥é“å‚æ•°å…·ä½“ä½œç”¨äºå“ªä¸ª Artist äº†ï¼Œè¿™æ ·ä¸€æ¥ä»¥åæœç´¢æ—¶å¯ä»¥èŠ‚çœå¤§æŠŠæ—¶é—´7ã€‚é™¤äº†é€šè¿‡åˆ›å»º matplotlibrc æ–‡ä»¶æ¥è‡ªå®šä¹‰é»˜è®¤æ ·å¼ï¼Œä½ è¿˜å¯ä»¥ç›´æ¥åœ¨ä»£ç å¼€å¤´å†™ä¸Šè¿™ç§è¯­å¥ï¼š\nplt.rcParams['lines.linewidth'] = 2\r å»çœ‹æ–‡æ¡£å§ï¼ˆåˆæ¥äº†ï¼‰ æœ‰äº›è¯»è€…å¯èƒ½å¯¹ matplotlib æ–‡æ¡£å°è±¡ä¸å¥½ï¼Œæˆ‘ä¹Ÿæ‰¿è®¤ï¼Œä»é‚£ä¹ˆé•¿çš„æ–‡ç« åˆ—è¡¨é‡Œä¸ºä½ çš„é—®é¢˜æ‰¾å‡ºä¸€ä¸ªåˆé€‚çš„ä¾‹å­è¿˜æŒºéš¾çš„ã€‚ä½†å…¶å®æ–‡æ¡£è‡ª 2.1.0 ç‰ˆæœ¬ä»¥æ¥æ”¹è¿›äº†å¾ˆå¤š8ï¼Œå½“ä½ å¯¹æ¯”æ”¹è¿›å‰åçš„åŒä¸€é¡µé¢æ—¶å°¤ä¸ºæ˜æ˜¾ã€‚\n   2.1.0ï¼ˆ2017 å¹´ 10 æœˆï¼‰ 2.0.2ï¼ˆ2017 å¹´ 5 æœˆï¼‰     Gallery, Tutorials Matplotlib Examples, Thumbnail gallery   Overview Overview    æˆ‘æ¨èä½ çœ‹ä¸€çœ¼ æœ€æ–°çš„ gallery å’Œ Tutorialsï¼Œç°åœ¨çš„æ•ˆæœçœŸçš„å¾ˆèµå¿ƒæ‚¦ç›®ã€‚\n è¯‘æ³¨ï¼šç¥ç§˜çš„æ˜¯ï¼Œ2.1.0 å¼€å§‹ Examples é¡µé¢æ”¹åä¸º Galleryï¼Œè€Œåˆ°äº† 3.5.0ï¼Œåˆæ”¹å› Examples äº†ï¼Œä½†ç½‘å€é‡Œè¿˜æ˜¯å†™çš„ galleryã€‚\n æ„Ÿè°¢ä½ è¯»åˆ°è¿™é‡Œï¼Œå°½æƒ…äº«å— matplotlib ç»˜å›¾ï¼ˆå’Œç½‘ç»œæœç´¢ï¼‰å§ ğŸ“ˆğŸ¤—ğŸ“Š\nå°é¢å›¾æ¥è‡ª Caleb Salomons on Unsplash\n  æ²¡é”™ï¼Œå¦‚æœä½ ä¸æ˜¯é‚£ç§ä½¿ç”¨å‰è¿æ•™ç¨‹éƒ½ä¸è¯»çš„æ‡’äººï¼Œé‚£ä¹ˆæ•™ç¨‹æ€»ä¼šæ˜¯ä¿¡æ¯ä¸°å¯Œå’Œå¤§æœ‰è£¨ç›Šçš„ã€‚å…¶å®å‡ å¹´å‰æˆ‘åˆšå¼€å§‹ç”¨ matplotlib ç”»å›¾æ—¶å¥½åƒå°±è¯•è¿‡è¯» Artist çš„æ–‡æ¡£ï¼Œä½†å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œæˆ‘å½“æ—¶å¿ƒé‡Œè‚¯å®šæƒ³ç€â€œå¥½å§ï¼Œè¿™ä¸æ˜¯ç»™æˆ‘è¿™ç§ç”¨æˆ·è¯»çš„â€ï¼ˆä¹Ÿæœ‰å¯èƒ½å½“æ—¶è¯»çš„ä¸æ˜¯ç°åœ¨çš„å®˜æ–¹æ•™ç¨‹ï¼‰ã€‚\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n åˆ¶ä½œè¿™å¼ å›¾çš„ç¤ºä¾‹ä»£ç åœ¨ https://matplotlib.org/stable/gallery/showcase/anatomy.htmlã€‚\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n å½“ç„¶è¿˜å­˜åœ¨å…¶å®ƒçš„ Artistï¼Œæƒ³ä¸€è§ˆæ€»ä½“æ¦‚è²Œçš„è¯»è€…å¯ä»¥ä» è¿™ä¸ªé¡µé¢ å…¥æ‰‹ã€‚ç‚¹å‡»æ¯ä¸ª Artist çš„åå­—èƒ½çœ‹åˆ°æ›´å¤šè¯´æ˜ã€‚\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œåœ¨ matplotlib é‡Œï¼Œè‰ºæœ¯å®¶ï¼ˆArtistï¼‰ä¼šæŠŠä½ ç¾ä¸½çš„æ•°æ®ç»˜åˆ¶åœ¨ç”»å¸ƒï¼ˆcanvasï¼‰ä¸Šã€‚è¿™ä¿®è¾è¿˜è›®å¯çˆ±çš„ã€‚\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n ä»¥å‰ç‰ˆæœ¬é‡Œçš„ fig.legend è¦æ¯”ç°åœ¨éš¾ç”¨ï¼Œå› ä¸ºå¿…é¡»æ˜¾å¼ç»™å‡ºå›¾ä¾‹å¥æŸ„å’Œæ ‡ç­¾ä½œä¸ºå‚æ•°ï¼ˆæ® æ–‡æ¡£ 2.0.2ï¼‰ã€‚\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n å½“ä½ ä¸æ»¡äº set_xxx ä¹‹ç±»çš„æ–¹æ³•ï¼Œæ›´è¿›ä¸€æ­¥æœç´¢åˆ»åº¦ç›¸å…³çš„è®¾ç½®æ—¶ï¼Œå°†ä¼šé‡åˆ°è®¸å¤šä½¿ç”¨ formatter å’Œ locator çš„ç¨‹åºç‰‡æ®µâ€”â€”ç„¶åæ‘¸ä¸ç€å¤´è„‘ï¼Œåªèƒ½æ”¾å¼ƒåœ¨è‡ªå·±çš„é—®é¢˜é‡Œåº”ç”¨å®ƒä»¬ï¼ˆå…¶å®å‡ ä¸ªæœˆå‰çš„æˆ‘å°±æ˜¯è¿™æ ·çš„ï¼‰ã€‚\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n æˆ–è€…ä½ å¯ä»¥åƒæˆ‘ä¸€æ ·ç”¨çœä¸‹çš„æ—¶é—´ç»§ç»­é’»ç ” matplotlibã€‚\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n å…³äºæ”¹è¿›æ–‡æ¡£æœ‰å¤šå›°éš¾ï¼Œè¿™å„¿æœ‰ç¯‡ä¸é”™çš„èµ„æ–™å¯ä»¥è¯»è¯»ï¼šMatplotlib Lead Dev on Why He Can\u0026rsquo;t Fix the Docs | NumFOCUS\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n  ","date":"2021-11-23","permalink":"https://zhajiman.github.io/post/matplotlib_artist/","tags":["matplotlib"],"title":"Matplotlib ä¸­çš„ Artistâ€”â€”ä½ åœ¨æµªè´¹æ—¶é—´çç™¾åº¦ä¹‹å‰åº”è¯¥çŸ¥é“çš„ä¸œè¥¿"},{"content":"ä¹‹å‰æˆ‘åœ¨ Cartopy ç³»åˆ—ï¼šä»å…¥é—¨åˆ°æ”¾å¼ƒ ä¸€æ–‡ä¸­å®šä¹‰äº†è¿™æ ·ä¸€ä¸ªå‡½æ•°\ndef set_map_extent_and_ticks(\rax, extent, xticks, yticks, nx=0, ny=0,\rxformatter=LongitudeFormatter(),\ryformatter=LatitudeFormatter()\r):\r...\r å…¶åŠŸèƒ½æ˜¯é™åˆ¶ GeoAxes çš„ç»çº¬åº¦èŒƒå›´ï¼Œå¹¶ç”»å‡ºç»çº¬åº¦åˆ»åº¦ã€‚å…¶ä¸­ LongitudeFormatter å’Œ LatitudeFormatter æ˜¯ Cartopy å®šä¹‰çš„ä¸¤ä¸ª Formatter ç±»ï¼Œç”¨äºæ ¼å¼åŒ–ç»çº¬åº¦åˆ»åº¦æ ‡ç­¾ã€‚Formatter å¯¹è±¡å› ä¸ºå…¶å±æ€§å¯ä»¥ä»»æ„ä¿®æ”¹ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç®—ä½œå¯å˜å¯¹è±¡ï¼ˆare user defined classes mutableï¼‰ã€‚What the f*ck Python! ä¸­æåˆ°è¿‡\n Pythonä¸­å‡½æ•°çš„é»˜è®¤å¯å˜å‚æ•°å¹¶ä¸æ˜¯æ¯æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶éƒ½ä¼šè¢«åˆå§‹åŒ–ã€‚ç›¸åï¼Œå®ƒä»¬ä¼šä½¿ç”¨æœ€è¿‘åˆ†é…çš„å€¼ä½œä¸ºé»˜è®¤å€¼ï¼Œé™¤éæ˜ç¡®åœ°å°†å¯å˜å¯¹è±¡ä¼ é€’ç»™å‡½æ•°ã€‚\n ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤šæ¬¡è°ƒç”¨ set_map_extent_and_ticks æ—¶å¦‚æœä¸æŒ‡å®š xformatter å’Œ yformatterï¼Œå°±ä¼šä¸€ç›´æ²¿ç”¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆ›å»ºçš„ Formatter å¯¹è±¡ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡æ‰“å°å¯¹è±¡çš„ id æ¥éªŒè¯ã€‚è€Œ Formatter ä½œä¸ºä¸€ç§ Matplotlib Artistï¼Œè¢«é‡å¤ä½¿ç”¨æ—¶å¯èƒ½ä¼šäº§ç”Ÿé”™è¯¯çš„ç»“æœï¼ˆæ—©ãçŸ¥ã£ã¦ãŠããŸã‹ã£ãŸmatplotlibã®åŸºç¤çŸ¥è­˜ã€ã‚ã‚‹ã„ã¯è¦‹ãŸç›®ã®èª¿æ•´ãŒæ—ã‚‹Artistã®è©±ï¼‰ã€‚æˆ‘å°±å› ä¸ºå¯¹ä¸åŒæŠ•å½±çš„å¤šä¸ª GeoAxes è¿ç»­ä½¿ç”¨ set_map_extent_and_ticksï¼Œç”»å‡ºäº†é”™è¯¯çš„åˆ»åº¦ã€‚\né¿å…å¯å˜å‚æ•°å¯¼è‡´çš„é”™è¯¯çš„å¸¸è§åšæ³•æ˜¯å°† None æŒ‡å®šä¸ºå‚æ•°çš„é»˜è®¤å€¼ï¼Œåœ¨å‡½æ•°ä½“å†…åˆ¤æ–­æ˜¯å¦åˆ›å»ºé»˜è®¤çš„å¯å˜å¯¹è±¡ã€‚æ‰€ä»¥è¿™ä¸ªå‡½æ•°åº”è¯¥ä¿®æ”¹ä¸º\ndef set_map_extent_and_ticks(\rax, extent, xticks, yticks, nx=0, ny=0,\rxformatter=None, yformatter=None\r):\r...\r","date":"2021-11-14","permalink":"https://zhajiman.github.io/post/python_mutable_arguments/","tags":["python"],"title":"Python ç³»åˆ—ï¼šå°å¿ƒé»˜è®¤çš„å¯å˜å‚æ•°"},{"content":"å‰è¨€ å‡ å¹´å‰æ›¾å†™è¿‡ Cartopy ç³»åˆ—ï¼šä»å…¥é—¨åˆ°æ”¾å¼ƒï¼Œä½†ç°åœ¨æ¥çœ‹è¿˜æ˜¯é—æ¼äº†ä¸å°‘ç»†èŠ‚ï¼Œæ¯”å¦‚åˆå­¦è€…å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜\n ç»åº¦æ˜¯ç”¨ [-180Â°, 180Â°] è¿˜æ˜¯ [0Â°, 360Â°] èŒƒå›´ï¼Ÿ ä¸ºä»€ä¹ˆæœ‰æ—¶å€™è®¾ç½®çš„åˆ»åº¦æ˜¾ç¤ºä¸å…¨ï¼Ÿ æ€ä¹ˆæˆªå–è·¨è¶Šåœ°å›¾è¾¹ç•Œçš„åŒºåŸŸï¼Œç”»å›¾åˆæ€ä¹ˆè·¨è¶Šè¾¹ç•Œï¼Ÿ  æœ¬æ–‡å°†ä¼šç”¨åæ ‡å˜æ¢çš„æ€æƒ³æ¥è§£ç­”ä»¥ä¸Šé—®é¢˜ï¼Œå¸Œæœ›èƒ½ç»™è¯»è€…ä¸€äº›å®ç”¨çš„å¯ç¤ºã€‚æœ¬æ¥åº”è¯¥æŠŠè¿™äº›å†…å®¹å†™åˆ°å…¥é—¨æ•™ç¨‹é‡Œçš„ï¼Œä½†å¯èƒ½ä¼šå¤ªé•¿ï¼Œæ‰€ä»¥ç°åœ¨å•ç‹¬æˆç¯‡ã€‚æ–‡ä¸­çš„è®¨è®ºä¸»è¦é’ˆå¯¹æœ€å¸¸ç”¨çš„ Plate CarrÃ©e æŠ•å½±ï¼Œå…¶å®ƒæŠ•å½±éœ€è¦è¯»è€…è‡ªå·±æµ‹è¯•ã€‚ä»£ç åŸºäº Cartopy 0.18.0ï¼Œè™½ç„¶ç°åœ¨å·²ç»æ›´æ–°åˆ° 0.20.0 äº†ï¼Œä½†åŸºæœ¬æ€æƒ³æ˜¯ä¸€è‡´çš„ã€‚\nç»åº¦çš„å¾ªç¯æ€§ ç»åº¦çš„æ•°å€¼èŒƒå›´ä¸€èˆ¬æœ‰ä¸¤ç§è¡¨ç¤ºï¼š[-180Â°, 180Â°] æˆ– [0Â°, 360Â°]ã€‚å‰è€…è¡¨ç¤ºä»¥æœ¬åˆå­åˆçº¿ï¼ˆzero meridianï¼‰ä¸ºä¸­å¿ƒï¼Œå‘è¥¿å‘ä¸œå„ 180Â°ï¼Œå†åœ¨å¯¹å‘å­åˆçº¿ï¼ˆantimeridianï¼‰å¤„äº¤æ±‡ï¼›åè€…è¡¨ç¤ºä»¥æœ¬åˆå­åˆçº¿ä¸ºèµ·ç‚¹å‘ä¸œ 360Â°ï¼Œåˆç»•å›äº†æœ¬åˆå­åˆçº¿ã€‚ç»åº¦è¿™ç§ç»•åœˆè½¬çš„é‡å¾ˆå®¹æ˜“è®©äººè”æƒ³åˆ°æ—¶é’Ÿçš„è¡¨ç›˜ï¼Œæœ¬åˆå­åˆçº¿å°±å¯¹åº”äº 0 æ—¶ï¼ˆå®é™…ä¸Šâ€œå­åˆâ€ä¸€è¯æŒ‡çš„å°±æ˜¯å¤œåŠå’Œæ­£åˆï¼‰ï¼Œ[-180Â°, 180Â°] èŒƒå›´å¯¹åº”äºä½¿ç”¨ AM å’Œ PM æ ‡è®°çš„è®¡æ—¶æ–¹å¼ï¼Œ[0Â°, 360Â°] èŒƒå›´å¯¹åº”äºäºŒåå››å°æ—¶åˆ¶ã€‚å¦‚ä¸‹å›¾æ‰€æç»˜çš„é‚£æ ·\nä¸€ä¸ªå°åŒºåˆ«æ˜¯ï¼šè¡¨ç›˜çš„æŒ‡é’ˆæ˜¯é¡ºæ—¶é’ˆæ—‹è½¬çš„ï¼Œè€Œç»åº¦çš„â€œæŒ‡é’ˆâ€ä»åŒ—æå¾€ä¸‹çœ‹çš„è¯ï¼Œæ˜¯è‡ªè¥¿å‘ä¸œï¼Œä¹Ÿå°±æ˜¯é€†æ—¶é’ˆæ—‹è½¬çš„ã€‚\nä¸¤ä¸ªèŒƒå›´çš„ç»åº¦åœ¨ [0Â°, 180Â°] åŒºé—´æ˜¯ç­‰ä»·çš„ï¼Œå¤§äº 180Â° çš„ç»åº¦å‡å» 360Â° åˆå¯ä»¥æ¢ç®—åˆ° [-180Â°, 0Â°] èŒƒå›´å†…ï¼Œä¾‹å¦‚ 240Â° å°±ç­‰ä»·äº 240Â° - 360Â° = -120Â°ã€‚åœ¨ Python ä¸­å¯ä»¥é€šè¿‡ä¸‹é¢çš„å…¬å¼å°† [0Â°, 360Â°] èŒƒå›´çš„ç»åº¦æ¢ç®—åˆ° [-180Â°, 180Â°] ä¸Š\ndef convert_lon(lon):\r'''å°†ç»åº¦æ¢ç®—åˆ°[-180, 180]èŒƒå›´å†….'''\rreturn (lon + 180) % 360 - 180\rfor lon in range(-270, 450 + 90, 90):\rlon_new = convert(lon)\rprint(lon, '-\u0026gt;', lon_new)\r ç»“æœä¸º\n-270 -\u0026gt; 90\r-180 -\u0026gt; -180\r-90 -\u0026gt; -90\r0 -\u0026gt; 0\r90 -\u0026gt; 90\r180 -\u0026gt; -180\r270 -\u0026gt; -90\r360 -\u0026gt; 0\r450 -\u0026gt; 90\r æœ‰è¶£çš„æ˜¯ï¼Œå½“ç»åº¦è¶…å‡ºäº† [0Â°, 360Â°] èŒƒå›´æ—¶ä¸Šå¼ä¾æ—§æˆç«‹ï¼Œä¾‹å¦‚ 450Â° è¡¨ç¤ºä»å­åˆçº¿å‡ºå‘ç»•åœ°çƒä¸€åœˆåå†ç»• 90Â°ï¼Œä¸Šé¢çš„ç»“æœä¸­ä¹Ÿæ°å¥½æ¢ç®—ä¸º 90Â°ï¼ŒåŒç†å¸¦å…¥ -240Â° åæ¢ç®—æˆ 120Â°ã€‚æ³¨æ„è¾¹ç•Œå€¼ 180Â° è¢«æ¢ç®—æˆäº† -180Â°ï¼Œä¸è¿‡è€ƒè™‘åˆ°è¿™ä¸¤ä¸ªå€¼å¯¹åº”äºåŒä¸€æ¡ç»çº¿ï¼Œä¹Ÿè¿˜å¯ä»¥æ¥å—ã€‚æ‰€ä»¥åªè¦å€ŸåŠ©è¿™ä¸ªå…¬å¼ï¼Œä»»æ„æ•°å€¼çš„ç»åº¦éƒ½å¯ä»¥æ¢ç®—åˆ° [-180Â°, 180Â°] çš„èŒƒå›´å†…ã€‚\nCartopy æ­£å¥½éµå¾ªè¿™ä¸€ç‰¹æ€§ï¼Œä¼šè‡ªåŠ¨æ¢ç®—æˆ‘ä»¬ç»™å‡ºçš„ä»»æ„ç»åº¦å€¼ï¼ˆä¸è¿‡å…·ä½“å®ç°å¯èƒ½ä¸åŒäº convert_lon å‡½æ•°ï¼‰ã€‚ä¾‹å¦‚\nline_proj = ccrs.PlateCarree()\rax.plot([-60, 60], [0, 0], transform=line_proj)\rax.plot([300, 420], [0, 0], transform=line_proj)\r ä¸¤å¥ ax.plot çš„ç”»å‡ºæ¥çš„æ•ˆæœæ˜¯ç›¸åŒçš„ï¼Œéƒ½ç”»çš„æ˜¯ [-60Â°, 60Â°] ä¹‹é—´çš„è¿çº¿ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€åœ¨ Cartopy é‡Œç»åº¦åªè¦æ¢ç®—è¿‡æ¥åˆç†ï¼Œå°±å¯ä»¥éšä¾¿è®¾ç½®äº†ã€‚ä¾‹å¦‚å¯¹ç”»å›¾å‡½æ•°æ¥è¯´ç»åº¦çš„å¤§å°é¡ºåºéå¸¸é‡è¦ã€å¯¹åˆ»åº¦è®¾ç½®æ¥è¯´å› ä¸ºå­˜åœ¨ bugï¼Œæ•ˆæœä¹Ÿå¯èƒ½ä¸åŒäºé¢„æœŸã€‚åé¢çš„å°èŠ‚ä¼šä¸€ä¸€è§£è¯´è¿™äº›ä¾‹å¤–ã€‚\nç†è§£åæ ‡å˜æ¢ åœ°ç†åæ ‡ä¸æŠ•å½±åæ ‡ åœ°ç†åæ ‡å³ç»çº¬åº¦ï¼Œèƒ½å¤Ÿæè¿°åœ°çƒè¡¨é¢ä»»æ„ä¸€ç‚¹çš„ä½ç½®ï¼›è€ŒæŠ•å½±åæ ‡åˆ™æ˜¯å°†åœ°çƒçƒä½“æŠ•å½±åˆ°å¹³é¢ä¸Šå¾—åˆ°çš„åæ ‡ã€‚äºŒè€…çš„æ•°å€¼å’Œå•ä½ä¸€èˆ¬ä¸åŒï¼Œä½†å¯ä»¥æ ¹æ®æŠ•å½±æ—¶ç”¨åˆ°çš„æ•°å­¦å…¬å¼è¿›è¡Œæ¢ç®—ã€‚ç”»å›¾ç”¨çš„æºæ•°æ®ï¼ˆç«™ç‚¹ä½ç½®ã€å«æ˜Ÿåƒå…ƒç½‘æ ¼ã€å†åˆ†æç½‘æ ¼ç­‰ï¼‰ä¸€èˆ¬åŸºäºåœ°ç†åæ ‡ï¼Œè€Œ Cartopy åœ°å›¾ï¼ˆå³ GeoAxesï¼‰å› ä¸ºå¤„äºå±å¹•è¿™ä¸ªå¹³é¢ä¸Šï¼Œè‡ªç„¶æ˜¯åŸºäºæŠ•å½±åæ ‡çš„ã€‚\nCartopy å°†åæ ‡ç³»ç§°ä¸ºâ€œåæ ‡å‚è€ƒç³»ç»Ÿâ€ï¼ˆcoordinate reference systemï¼ŒCRSï¼‰ï¼Œå¹¶åœ¨ cartopy.crs æ¨¡å—ä¸­å®šä¹‰äº†ä¸€ç³»åˆ—è¡¨ç¤º CRS çš„ç±»ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬å„ç§åœ°å›¾æŠ•å½±ï¼Œæ¯”å¦‚ PlateCarreeã€Mercatorã€Mollweideã€LambertConformal ç±»ç­‰ã€‚åœ¨åˆ›å»º Axes æ—¶å°† CRS å¯¹è±¡ä¼ ç»™ projection å‚æ•°ï¼Œå³å¯å°† Axes è½¬ä¸ºè¿™ä¸ª CRS ä»£è¡¨çš„æŠ•å½±çš„ GeoAxesã€‚ä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç åˆ†åˆ«åˆ›å»ºäº†ç­‰ç»çº¬åº¦æŠ•å½±å’Œéº¦å¡æ‰˜æŠ•å½±çš„åœ°å›¾\nimport matplotlib.pyplot as plt\rimport cartopy.crs as ccrs\rproj1 = ccrs.PlateCarree()\rproj2 = ccrs.Mercator()\rfig = plt.figure()\rax1 = fig.add_subplot(211, projection=proj1)\rax2 = fig.add_subplot(212, projection=proj2)\r ä¸‹é¢ä»¥æœ€å¸¸ç”¨çš„ PlateCarree ç±»ä¸ºä¾‹è®²è§£åœ°ç†åæ ‡å’ŒæŠ•å½±åæ ‡çš„å…³ç³»ã€‚PlateCarree ç±»æœ‰ä¸€ä¸ªåˆå§‹åŒ–å‚æ•° central_longitudeï¼Œèƒ½å¤ŸæŒ‡å®šç”»å…¨çƒåœ°å›¾ï¼ˆé€šè¿‡ ax.set_global æ–¹æ³•ï¼‰æ—¶æ­£ä¸­é—´çš„ç»åº¦ï¼Œé»˜è®¤å€¼ä¸º 0ï¼Œå³å…¨çƒåœ°å›¾é»˜è®¤ä¼šæŠŠæœ¬åˆå­åˆçº¿æ”¾åœ¨ç”»é¢ä¸­å¿ƒã€‚è‹¥æŒ‡å®š central_longitude=180ï¼Œåˆ™å…¨çƒåœ°å›¾ä¼šä»¥å¯¹å‘å­åˆçº¿ä¸ºä¸­å¿ƒï¼Œå›¾è¿™é‡Œå°±ä¸æ”¾äº†ã€‚é™¤è¿™ä¸ªåŠŸèƒ½ä»¥å¤–ï¼Œcentral_longitude è¿˜ä¼šå½±å“åˆ° PlateCarree åæ ‡ä¸åœ°ç†åæ ‡é—´çš„å…³ç³»ã€‚PlateCarree æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ç¬›å¡å°”åæ ‡ç³»ï¼Œå…¶æ¨ªåæ ‡ x ä¸ç»åº¦ lon æ»¡è¶³å…³ç³»\nx = convert_lon(lon - central_longitude)\r å³ç»åº¦å‡å» central_longitude åå†æ¢ç®—åˆ° [-180Â°, 180Â°] èŒƒå›´å³å¯ï¼Œæ˜¾ç„¶ x å¯ä»¥è§†ä½œå…³äºä¸­å¤®ç»åº¦çš„ç›¸å¯¹ç»åº¦ã€‚ç»§ç»­æ²¿ç”¨ä¸Šä¸€èŠ‚çš„è¡¨ç›˜æ¯”å–»ï¼Œå°†äºŒè€…çš„å…³ç³»å½¢è±¡åœ°è¡¨ç¤ºä¸ºä¸‹å›¾\nå›¾ä¸­é»‘è‰²è¡¨ç›˜ä¸ºç»åº¦ lonï¼Œå°†å…¶é€†æ—¶é’ˆæ—‹è½¬ central_longitude åº¦åå³å¾—åˆ°ä»£è¡¨ x çš„è“è‰²è¡¨ç›˜ã€‚PlateCarree çš„çºµåæ ‡ y åˆ™ä¸çº¬åº¦ lat ç›´æ¥å¯¹åº”ï¼Œçº¬åº¦æ˜¯å¤šå°‘çºµåæ ‡å°±æ˜¯å¤šå°‘ã€‚å¾ˆå®¹æ˜“æ³¨æ„åˆ°ï¼Œå½“ central_longitude=0 æ—¶ï¼Œæ¨ªåæ ‡ä¸ç»åº¦ç›´æ¥å¯¹åº”ï¼Œçºµåæ ‡ä¸ç»åº¦ç›´æ¥å¯¹åº”ï¼Œå³ PlateCarree åæ ‡æ­£å¥½ç­‰ä»·äºåœ°ç†åæ ‡ã€‚æˆ‘ä»¬åé¢è¿˜ä¼šé¢‘ç¹ç”¨åˆ°è¿™ä¸€ç‚¹ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œå¯¹æŠ•å½± proj=ccrs.PlateCarree(central_longitude=180) æ¥è¯´ï¼Œåœ°ç†åæ ‡ (-160, 30) å¯¹åº”äºæŠ•å½±åæ ‡ (20, 30)ã€‚è¿™å¯ä»¥é€šè¿‡ Matplotlib çš„ plt.show å‡½æ•°åˆ›å»ºçš„äº¤äº’å¼ç•Œé¢å¾—åˆ°ç›´è§‚éªŒè¯\nMatplotlib é‡Œè‹¥æŠŠé¼ æ ‡æŒ‡é’ˆæ”¾åœ¨ Axes çš„å›¾åƒä¸Šï¼Œçª—å£å³ä¸Šè§’å°±ä¼šæ˜¾ç¤ºæŒ‡é’ˆä½ç½®çš„åæ ‡ã€‚Cartopy çš„ GeoAxes å¢å¼ºäº†è¿™ä¸€åŠŸèƒ½ï¼Œè¿˜ä¼šåœ¨åæ ‡åé¢çš„æ‹¬å·é‡Œæ˜¾ç¤ºå¯¹åº”çš„åœ°ç†åæ ‡ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒæŠ•å½±åæ ‡ (20.32, 30.05) å¯¹åº”çš„åœ°ç†åæ ‡ä¸º (159.677419, 30.048387)ã€‚æ³¨æ„å›¾ä¸­æ˜¯çº¬åº¦åœ¨å‰ç»åº¦åœ¨åï¼Œä¸”ä¸¤ç§åæ ‡å¯¹å°æ•°éƒ¨åˆ†çš„æ˜¾ç¤ºæœ‰æ‰€ä¸åŒï¼Œæ‰€ä»¥çœ‹èµ·æ¥åƒæ˜¯æœ‰è¯¯å·®ã€‚æ¢ç´¢ä¸€ç•ªè¿˜èƒ½å‘ç°ï¼Œå…¨çƒåœ°å›¾é‡Œ x çš„èŒƒå›´ä¸º [-180Â°, 180Â°]ï¼Œy çš„èŒƒå›´ä¸º [-90Â°, 90Â°]ï¼Œåœ°å›¾ä¸­å¤®ï¼Œä¹Ÿå°±æ˜¯ central_longitude æ‰€åœ¨ä½ç½®çš„ x æ€»ä¸º 0Â°ã€‚Matplotlib çš„è¿™ä¸€åŠŸèƒ½å¯¹æ—¥å¸¸ debug æ¥è¯´éå¸¸å®ç”¨ã€‚\næ­¤å¤– CRS å¯¹è±¡çš„ transform_points æ–¹æ³•èƒ½ç›´æ¥è¿›è¡Œä¸åŒåæ ‡ç³»ç»Ÿé—´çš„åæ ‡æ¢ç®—ã€‚ä¾‹å¦‚\nimport numpy as np\rproj1 = ccrs.PlateCarree(central_longitude=0)\rproj2 = ccrs.PlateCarree(central_longitude=180)\rnpt = 5\rlon1 = np.linspace(-180, 180, npt)\rlat1 = np.linspace(-90, 90, npt)\rpos2 = proj2.transform_points(proj1, lon1, lat1)\rlon2 = pos2[:, 0]\rlat2 = pos2[:, 1]\rfor i in range(npt):\rprint(f'({lon1[i]}, {lat1[i]})', '-\u0026gt;', f'({lon2[i]}, {lat2[i]})')\r å…¶ä¸­ proj1 çš„ä¸­å¤®ç»åº¦ä¸º 0ï¼Œå¦‚å‰æ‰€è¿°ï¼Œå…¶æŠ•å½±åæ ‡ lon1 å’Œ lat1 æ­£å¥½ä»£è¡¨ç»çº¬åº¦ã€‚åˆ©ç”¨ proj1.transform_points æ–¹æ³•å³å¯å°† lon1 å’Œ lat1 æ¢ç®—ä¸º proj2 é‡Œçš„åæ ‡ lon2 å’Œ lat2ã€‚ç»“æœä¸º\n(-180.0, -90.0) -\u0026gt; (0.0, -90.0)\r(-90.0, -45.0) -\u0026gt; (90.0, -45.0)\r(0.0, 0.0) -\u0026gt; (-180.0, 0.0)\r(90.0, 45.0) -\u0026gt; (-90.0, 45.0)\r(180.0, 90.0) -\u0026gt; (0.0, 90.0)\r æ˜æ˜¾ lon2 ç›¸å½“äº lon1 å‡å»äº† 180Â°ï¼Œè€Œ lat2 å’Œ lat1 å®Œå…¨ä¸€è‡´ã€‚åœ¨éœ€è¦æ‰‹åŠ¨å˜æ¢åæ ‡çš„åœºåˆè¿™ä¸ªæ–¹æ³•ä¼šæ´¾ä¸Šç”¨åœºã€‚\næ€»ç»“ä¸€ä¸‹ï¼šPlateCarree æŠ•å½±å°†åœ°çƒæŠ•å½±åˆ°äº†å¹³é¢ç¬›å¡å°”åæ ‡ç³»é‡Œï¼Œæ¨ªåæ ‡ç›¸å½“äºç»åº¦å‘å³ä½ç§»ï¼ˆé€†æ—¶é’ˆæ—‹è½¬ï¼‰äº† central_longitude åº¦ï¼Œçºµåæ ‡ä¾ç„¶å¯¹åº”äºçº¬åº¦ã€‚PlateCarree åæ ‡ä¸åœ°ç†åæ ‡çš„å…³ç³»éå¸¸ç®€å•ï¼Œä½†å¦‚æœå¯¹äºå…°ä¼¯ç‰¹ã€UTM é‚£ç§å¤æ‚çš„æŠ•å½±ï¼Œåæ ‡é—´çš„å…³ç³»å°±ä¸ä¼šè¿™ä¹ˆç›´è§‚äº†ï¼Œç”šè‡³ x å’Œ y çš„å•ä½éƒ½ä¸ä¼šæ˜¯åº¦ï¼Œè¯»è€…å¯ä»¥ç”¨å‰é¢æåˆ°çš„ Matplotlib çš„äº¤äº’å¼ç•Œé¢è‡ªè¡Œæ¢ç´¢ã€‚\ncrs å’Œ transform å‚æ•° ç”±ä¸Šä¸€èŠ‚çš„è§£è¯´ï¼ŒCartopy å®˜æ–¹æ–‡æ¡£é‡Œç€é‡å¼ºè°ƒçš„ crs å’Œ transform å‚æ•°å°±å¾ˆå¥½ç†è§£äº†ã€‚\nGeoAxes ä¸ä»…å·¥ä½œåœ¨æŠ•å½±åæ ‡ç³»ï¼Œå…¶è®¾ç½®åˆ»åº¦çš„ set_xticks å’Œ set_yticks æ–¹æ³•ã€æˆªå–åŒºåŸŸçš„ set_extent æ–¹æ³•ï¼Œä¹ƒè‡³å„ç§ç»˜å›¾çš„ plotã€contourfã€pcolormesh ç­‰æ–¹æ³•ç­‰ï¼Œéƒ½é»˜è®¤æˆ‘ä»¬ç»™å‡ºçš„æ•°æ®ä¹Ÿæ˜¯åŸºäºæŠ•å½±åæ ‡ç³»çš„ã€‚æ‰€ä»¥éœ€è¦æå‰æŠŠæ•°æ®çš„åœ°ç†åæ ‡æ¢ç®—ä¸ºåœ°å›¾çš„æŠ•å½±åæ ‡ï¼Œå†æŠŠæ•°æ®æ·»åŠ åˆ°åœ°å›¾ä¸Šã€‚ä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç \nmap_proj = ccrs.PlateCarree(central_longitude=180)\rfig = plt.figure()\rax = fig.add_subplot(111, projection=map_proj)\rax.set_xticks([0, 90])\r set_xticks æ–¹æ³•ä¼šåœ¨åœ°å›¾ x=0 å’Œ x=90 çš„ä½ç½®ç”»å‡ºåˆ»åº¦â€”â€”æ³¨æ„æ˜¯ x è€Œä¸æ˜¯ç»åº¦ï¼å¦‚æœæˆ‘ä»¬éœ€è¦çš„æ˜¯ lon=0 å’Œ lon=90 å¤„çš„åˆ»åº¦ï¼Œå°±éœ€è¦æ‰‹åŠ¨æ¢ç®—ä¸€ä¸‹ï¼ˆæ ¹æ®ä¸Šä¸€èŠ‚ x å’Œ lon çš„å…³ç³»å¼ï¼‰\nax.set_xticks([-180, -90])\r PlateCarree è¿™æ ·ç®€å•çš„æŠ•å½±è¿˜æ¯”è¾ƒå®¹æ˜“æ‰‹åŠ¨æ¢ç®—ï¼Œå¦‚æœæ˜¯æ›´å¤æ‚çš„å…°ä¼¯ç‰¹æŠ•å½±ä¹‹ç±»çš„ï¼Œå°±éœ€è¦åˆ©ç”¨ CRS å¯¹è±¡çš„ transform_points æ–¹æ³•äº†ã€‚ä½† Cartopy èƒ½å¤Ÿé€šè¿‡ crs å’Œ transform å‚æ•°çœç•¥æ‰è¿™ä¸€æ¢ç®—è¿‡ç¨‹ï¼šé€šè¿‡å°† CRS å¯¹è±¡ä¼ ç»™è®¾ç½®åˆ»åº¦æ—¶çš„ crs å‚æ•°ï¼Œæˆ–ç»˜åˆ¶å›¾åƒæ—¶çš„ transform å‚æ•°ï¼Œèƒ½å¤Ÿå‘ŠçŸ¥ Cartopy ä½ çš„æ•°æ®åŸºäºè¿™ä¸ª CRS åæ ‡ç³»ï¼Œä¹‹å Cartopy åœ¨å†…éƒ¨ä¼šæ ¹æ®è¿™ä¸€ä¿¡æ¯å°†ä½ çš„æ•°æ®æ¢ç®—åˆ° GeoAxes æ‰€å¤„çš„åæ ‡ç³»ä¸­ã€‚å› ä¸ºæˆ‘ä»¬çš„æ•°æ®ä¸€èˆ¬éƒ½åŸºäºåœ°ç†åæ ‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸¸æŠŠç­‰ä»·äºåœ°ç†åæ ‡ç³»çš„ ccrs.PlateCarree() å¯¹è±¡ä¼ ç»™ crs å’Œ transform å‚æ•°ã€‚ä¾‹å¦‚ä¸Šé¢åœ¨ lon=0 å¤„å’Œ lon=90 å¤„æ ‡å‡ºåˆ»åº¦çš„å†™æ³•å¯ä»¥æ”¹ä¸º\ntick_proj = ccrs.PlateCarree()\rax.set_xticks([0, 90], crs=tick_proj)\r ç±»ä¼¼åœ°ï¼Œç”»å‡ºåœ°ç†åæ ‡ (0, 30) å’Œ (90, 30) é—´çš„è¿çº¿\nline_proj = ccrs.PlateCarree()\rax.plot([0, 90], [30, 30], transform=line_proj)\r æ‰€ä»¥åªè¦ç”¨å¥½ crs å‚æ•°å’Œ transform å‚æ•°ï¼Œå°±å¯ä»¥å¿½ç•¥åæ ‡è½¬æ¢çš„ç»†èŠ‚ï¼Œç»Ÿä¸€ä½¿ç”¨åœ°ç†åæ ‡æ¥æè¿°å’Œæ“ä½œåœ°å›¾äº†ã€‚å¯èƒ½æœ‰äººä¼šæŒ‡å‡ºï¼Œå½“åœ°å›¾æŠ•å½± map_proj=ccrs.PlateCarree() æ—¶ crs å’Œ transform å‚æ•°éƒ½å¯ä»¥çœå»ï¼Œè¿™ç¡®å®æ²¡é”™ï¼Œä¸è¿‡æ­£å¦‚ Python ä¹‹ç¦…è¯´çš„ï¼Œâ€œæ˜¾å¼èƒœäºéšå¼â€ï¼Œæ˜¾å¼åœ°æŒ‡å®šè¿™äº›å‚æ•°æœ‰åŠ©äºæ˜ç¡®åæ ‡é—´çš„å…³ç³»ã€‚\nGeodetic åæ ‡ å‰é¢è¯´ ccrs.PlateCarree() ç­‰ä»·äºåœ°ç†åæ ‡ç³»æ˜¯ä¸ä¸¥è°¨çš„ï¼Œå› ä¸ºçœŸæ­£çš„åœ°ç†åæ ‡ç³»å®šä¹‰åœ¨çƒé¢ä¸Šï¼Œä¸¤ç‚¹é—´çš„æœ€çŸ­è¿çº¿ï¼ˆæµ‹åœ°çº¿ï¼‰æ˜¯è¿‡è¿™ä¸¤ç‚¹çš„å¤§åœ†çš„åŠ£å¼§ï¼›è€Œ PlateCarree åæ ‡ç³»å®šä¹‰åœ¨å¹³é¢ä¸Šï¼Œä¸¤ç‚¹é—´çš„æœ€çŸ­è¿çº¿æ˜¯è¿‡ä¸¤ç‚¹çš„ç›´çº¿ã€‚cartopy.crs æ¨¡å—é‡Œçš„ Geodetic ç±»ä¾¿èƒ½è¡¨ç¤ºçœŸæ­£çš„åœ°ç†åæ ‡ç³»ï¼Œç”¨äºæŒ‡å®šå•ç‚¹ä½ç½®æ—¶å…¶æ•ˆæœä¸ PlateCarree æ— å¼‚ï¼Œä½†åœ¨ç”»ä¸¤ç‚¹é—´è¿çº¿æ—¶å°† Geodetic å¯¹è±¡ä¼ ç»™ transform å‚æ•°ï¼Œä¾¿èƒ½è®©è¿çº¿å˜æˆçƒé¢ä¸Šçš„æµ‹åœ°çº¿ã€‚ä¾‹å¦‚\nx = [116, 286]\ry = [39, 40]\rax.plot(x, y, 'o-', transform=ccrs.PlateCarree(), label='PlateCarree')\rax.plot(x, y, 'o-', transform=ccrs.Geodetic(), label='Geodetic')\rax.legend()\r è™½ç„¶ä¹ä¸€çœ‹æ©™çº¿æ¯”è“çº¿é•¿ï¼Œä½†æŠ•å½±å›çƒé¢åï¼Œæ©™çº¿æ‰æ˜¯ä¸¤ç‚¹é—´çš„æœ€çŸ­è¿çº¿ã€‚Geodetic æ˜¯ä¸€ç§ CRSï¼Œä½†ä¸å±äºåœ°å›¾æŠ•å½±ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨äº GeoAxes çš„åˆ›å»ºã€‚å¹³æ—¶ç”»å›¾æ—¶é™¤éå¯¹æµ‹åœ°çº¿æˆ–å¤§åœ†æœ‰éœ€æ±‚ï¼Œä¸€èˆ¬ä½¿ç”¨ PlateCarree åæ ‡å³å¯ï¼Œå®é™…ä¸Šï¼Œç›®å‰ Geodetic å¯¹è±¡è¿˜ä¸èƒ½ç”¨ä½œ contourfã€pcolormesh ç­‰ç”»å›¾å‡½æ•°çš„ transform å‚æ•°ï¼Œå¯èƒ½æ˜¯ Matplotlib è¿˜æ— æ³•å®ç°æ›²çº¿ç½‘æ ¼çš„å¡«è‰²å§ã€‚\nå…³äºåˆ»åº¦è®¾ç½® LongitudeFormatter å’Œ LatitudeFormatter å•çº¯ä½¿ç”¨ set_xticks è®¾ç½®åˆ»åº¦åï¼Œåˆ»åº¦ä¼šä»¥ x çš„å€¼ä½œä¸ºåˆ»åº¦æ ‡ç­¾ï¼ˆticklabelï¼‰ï¼Œè€Œ x çš„å€¼å¾ˆå¯èƒ½ä¸ç»åº¦ä¸ç›¸ç­‰ã€‚è¿™æ—¶å°±éœ€è¦ä½¿ç”¨ Cartopy æä¾›çš„ç»çº¬åº¦ä¸“ç”¨çš„ Formatterï¼Œå°†åˆ»åº¦æ ‡ç­¾è¡¨ç°ä¸ºæ­£ç¡®çš„åœ°ç†åæ ‡çš„å½¢å¼ã€‚ä¾‹å¦‚\nimport cartopy.feature as cfeature\rfrom cartopy.mpl.ticker import LongitudeFormatter, LatitudeFormatter\r# åˆ†åˆ«æŒ‡å®šGeoAxesæ‰€å¤„çš„æŠ•å½±å’Œåˆ»åº¦æ‰€å¤„çš„æŠ•å½±.\rmap_proj = ccrs.PlateCarree(central_longitude=180)\rtick_proj = ccrs.PlateCarree(central_longitude=0)\rfig, axes = plt.subplots(\rnrows=2, ncols=1, figsize=(6, 8),\rsubplot_kw={'projection': map_proj}\r)\r# ä¸¤ä¸ªaxè®¾ç½®ç›¸åŒçš„åˆ»åº¦.\rfor ax in axes:\rax.set_global()\rax.add_feature(cfeature.LAND)\rax.add_feature(cfeature.OCEAN)\rax.set_xticks(np.linspace(-180, 180, 7), crs=tick_proj)\rax.set_yticks(np.linspace(-90, 90, 5), crs=tick_proj)\raxes[0].set_title('Ticks Added')\raxes[1].set_title('Formatter Added')\r# ä¸ºç¬¬äºŒä¸ªaxä½¿ç”¨Formatter.\raxes[1].xaxis.set_major_formatter(LongitudeFormatter())\raxes[1].yaxis.set_major_formatter(LatitudeFormatter())\rplt.show()\r å¯ä»¥çœ‹åˆ°ä¸Šå›¾ä¸­çš„åˆ»åº¦æ ‡ç­¾æ˜¾ç¤ºçš„æ˜¯ x çš„å€¼ï¼Œä¸‹å›¾ä¸­ Formatter é€šè¿‡è¯»å– GeoAxes çš„æŠ•å½±ä¿¡æ¯ï¼Œå°†åˆ»åº¦å€¼æ¢ç®—ä¸ºç»çº¬åº¦ï¼Œå¹¶è¿½åŠ äº†åº¦æ•°å’Œæ–¹å‘çš„ç¬¦å·ã€‚LongitudeFormatter å’Œ LatitudeFormatter è¿˜æä¾›ä¸°å¯Œçš„å‚æ•°æ¥ä¿®æ”¹åˆ»åº¦çš„æ˜¾ç¤ºæ•ˆæœï¼Œä¸è¿‡ä¸€èˆ¬æ¥è¯´é»˜è®¤è®¾ç½®å°±å¤Ÿç”¨äº†ã€‚å¦å¤–è¿™ä¸¤ä¸ª Formatter è¿˜å¯ä»¥ç”¨äºæ™®é€šçš„ Axesï¼Œä¼šå°† Axes çš„åæ ‡è§†ä¸ºåœ°ç†åæ ‡ã€‚\nset_xticks å’Œ gridlines çš„ bug set_xticks æ–¹æ³•å­˜åœ¨ bugï¼šå½“çœç•¥ crs å‚æ•°ï¼Œæˆ–æä¾›çš„ CRS å¯¹è±¡ä¸ GeoAxes çš„æŠ•å½±ç­‰ä»·ï¼ˆæºç é‡Œé€šè¿‡ == åˆ¤æ–­ï¼‰æ—¶ï¼Œä¼šè·³è¿‡åæ ‡å˜æ¢çš„ç¯èŠ‚ï¼Œç›´æ¥ä½¿ç”¨ä½ æä¾›çš„åˆ»åº¦ã€‚ä¾‹å¦‚\nmap_proj = ccrs.PlateCarree()\rfig = plt.figure()\rax = fig.add_subplot(111, projection=map_proj)\rax.set_global()\rax.set_xticks(np.linspace(0, 360, 7), crs=map_proj)\rax.set_yticks(np.linspace(-90, 90, 5), crs=map_proj)\rax.xaxis.set_major_formatter(LongitudeFormatter())\rax.yaxis.set_major_formatter(LatitudeFormatter())\r æœ¬æ¥ set_xticks é‡Œå¤§äº 180Â° çš„åˆ»åº¦éœ€è¦å…ˆæ¢ç®—åˆ° [-180Â°, 180Â°] èŒƒå›´å†…ï¼Œç°åœ¨è¿™ä¸€ç¯èŠ‚è¢«è·³è¿‡äº†ï¼Œå¤§äº 180Â° çš„åˆ»åº¦ç›´æ¥æ ‡åœ¨äº†åœ°å›¾å¤–é¢ã€‚å¼¥è¡¥æ–¹æ³•æ˜¯ï¼Œåˆ»åº¦æ”¹ç”¨ np.linspace(-180, 180, 7) å³å¯ï¼Œæˆ–è€…å½“ crs å‚æ•°ä¸ map_proj ä¸åŒæ—¶ï¼Œé”™è¯¯ä¹Ÿä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚\nç”»ç½‘æ ¼çš„ gridlines æ–¹æ³•å­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ï¼šè¶…å‡º [-180Â°, 180Â°] èŒƒå›´çš„ç»åº¦åˆ»åº¦ç›´æ¥ç”»ä¸å‡ºæ¥ï¼Œå°±ç®— crs å‚æ•°ä¸åŒäº map_proj ä¹Ÿæ²¡ç”¨ã€‚ä¾‹å¦‚\nmap_proj = ccrs.PlateCarree(central_longitude=180)\rtick_proj = ccrs.PlateCarree()\rfig = plt.figure()\rax = fig.add_subplot(111, projection=map_proj)\rax.set_global()\rax.gridlines(\rcrs=tick_proj, draw_labels=True,\rxlocs=np.linspace(0, 360, 7),\rylocs=np.linspace(-90, 90, 5),\rcolor='k', linestyle='--'\r)\r å¯ä»¥çœ‹åˆ°è¥¿åŠçƒçš„ç»åº¦ç½‘æ ¼çº¿æ²¡ç”»å‡ºæ¥ï¼Œå¹¶ä¸”è°ƒç”¨ fig.savefig ä¿å­˜å›¾ç‰‡æ—¶è‹¥ dpi ä¸ä¸ºé»˜è®¤çš„ 150ï¼Œè¿çº¬åº¦çš„æ ‡ç­¾ä¹Ÿä¼šè«åå…¶å¦™æ¶ˆå¤±ï¼ˆå¦è§ issues 1794ï¼‰ã€‚Bug å…·ä½“åŸå› æˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªå·±æ¢ç©¶ä¸€ä¸‹ã€‚å¼¥è¡¥æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œxlocs æ”¹ç”¨ np.linspace(-180, 180, 7) å³å¯ã€‚\nè·¨è¶Šè¾¹ç•Œçš„ plot æœ¬èŠ‚æ¢è®¨é€šè¿‡ plot æ–¹æ³•ç»˜åˆ¶ä¸¤ç‚¹é—´è¿çº¿æ—¶ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè·¨è¶Šè¾¹ç•Œç›¸è¿ã€‚æµ‹è¯•ç¨‹åºå¦‚ä¸‹\nmap_proj = ccrs.PlateCarree()\rtick_proj = ccrs.PlateCarree()\rfig, axes = plt.subplots(\rnrows=2, ncols=2, figsize=(10, 6),\rsubplot_kw={'projection': map_proj}\r)\rfig.subplots_adjust(wspace=0.3)\r# å¡«è‰²å’Œè®¾ç½®åˆ»åº¦.\rfor ax in axes.flat:\rax.set_global()\rax.add_feature(cfeature.LAND)\rax.add_feature(cfeature.OCEAN)\rax.set_xticks(np.linspace(-180, 180, 7), crs=tick_proj)\rax.set_yticks(np.linspace(-90, 90, 5), crs=tick_proj)\rax.xaxis.set_major_formatter(LongitudeFormatter())\rax.yaxis.set_major_formatter(LatitudeFormatter())\rdef draw_line(ax, p1, p2):\r'''ç”»å‡ºç‚¹p1å’Œp2ä¹‹é—´çš„è¿çº¿,å¹¶æ ‡æ³¨åœ¨æ ‡é¢˜ä¸Š.'''\rx0, y0 = p1\rx1, y1 = p2\rline_proj = ccrs.PlateCarree()\rax.plot([x0, x1], [y0, y1], 'o-', c='C3', transform=line_proj)\rax.text(\rx0, y0 + 15, 'start', ha='center', va='center',\rtransform=line_proj\r)\rax.text(\rx1, y1 + 15, 'end', ha='center', va='center',\rtransform=line_proj\r)\rax.set_title(f'From {p1} to {p2}')\rdraw_line(axes[0, 0], (120, 60), (240, -60))\rdraw_line(axes[0, 1], (240, -60), (120, 60))\rdraw_line(axes[1, 0], (120, 60), (-120, -60))\rdraw_line(axes[1, 1], (-120, -60), (120, 60))\rplt.show()\r ä»æµ‹è¯•ç»“æœå¯ä»¥å½’çº³å‡ºï¼šè®¾èµ·ç‚¹çš„åæ ‡ä¸º (x0, y0)ï¼Œç»ˆç‚¹çš„åæ ‡ä¸º (x1, y1)ï¼Œæ¥ç€æ¯”è¾ƒ x0 å’Œ x1 çš„ç»å¯¹å¤§å°ï¼Œå½“ x0 \u0026lt; x1 æ—¶ï¼Œä¼šä»èµ·ç‚¹å‡ºå‘è‡ªè¥¿å‘ä¸œç»˜åˆ¶ï¼›å½“ x0 \u0026gt; x1 æ—¶ï¼Œä¼šä»èµ·ç‚¹å‡ºå‘è‡ªä¸œå‘è¥¿ç»˜åˆ¶ã€‚ä¾‹å¦‚å·¦ä¸Šè§’çš„å›¾ä¸­ï¼Œèµ·ç‚¹çš„ç»åº¦æ•°å€¼å°äºç»ˆç‚¹ï¼Œæ‰€ä»¥å‘ä¸œç»˜åˆ¶ï¼Œä¸”ä¸­é€”ç©¿è¶Šäº†åœ°å›¾è¾¹ç•Œï¼›å³ä¸Šè§’çš„å›¾å°†èµ·ç‚¹å’Œç»ˆç‚¹é¢ å€’åï¼Œå˜ä¸ºä»èµ·ç‚¹å‡ºå‘å‘è¥¿ç»˜åˆ¶ï¼›å·¦ä¸‹è§’å’Œå³ä¸‹è§’çš„å›¾åŒç†ï¼Œä½†ä¸ç©¿è¶Šåœ°å›¾è¾¹ç•Œã€‚å€ŸåŠ©è¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é¢„æµ‹å¹¶æ§åˆ¶ä¸¤ç‚¹é—´çš„è¿çº¿æ˜¯èµ°â€œå†…åœˆâ€ï¼ˆä¸ç©¿è¶Šè¾¹ç•Œï¼‰ï¼Œè¿˜æ˜¯èµ°â€œå¤–åœˆâ€ï¼ˆç©¿è¶Šè¾¹ç•Œï¼‰ã€‚\nè¿™ç‚¹ä¸ä»…é™äº plot æ–¹æ³•ï¼Œcontourfã€pcolormeshã€imshow ç­‰å…¶å®ƒç»˜å›¾æ–¹æ³•ï¼Œä¹ƒè‡³æˆªå–åŒºåŸŸç”¨çš„ set_extent æ–¹æ³•å‡éµå¾ªè¿™ä¸€ç‰¹æ€§ã€‚\nè·¨è¶Šè¾¹ç•Œçš„ set_extent ä¸Šä¸€èŠ‚æåˆ° set_extent æ–¹æ³•ä¼šæ ¹æ® x0 å’Œ x1 çš„å¤§å°å…³ç³»å†³å®šç»•åœˆæ–¹å‘ï¼Œä½†å®é™…ä¸Šæƒ³è¦æˆåŠŸæˆªå–è¿˜éœ€è¦èŒƒå›´ä¸èƒ½è·¨è¿‡è¾¹ç•Œã€‚ä¾‹å¦‚\nfrom matplotlib.patches import Rectangle\rclon1 = 0\rclon2 = 180\rmap_proj1 = ccrs.PlateCarree(central_longitude=clon1)\rmap_proj2 = ccrs.PlateCarree(central_longitude=clon2)\rdata_proj = ccrs.PlateCarree()\rextent = [120, 240, 20, 80]\rlonmin, lonmax, latmin, latmax = extent\r# ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œå­å›¾çš„central_longitudeä¸åŒ.\rfig = plt.figure(figsize=(12, 8))\rax1 = fig.add_subplot(221, projection=map_proj1)\rax2 = fig.add_subplot(222, projection=map_proj1)\rax3 = fig.add_subplot(223, projection=map_proj2)\rax4 = fig.add_subplot(224, projection=map_proj2)\rfig.subplots_adjust(hspace=-0.1)\rfor ax in [ax1, ax3]:\rax.set_global()\rax.set_xticks(np.linspace(-180, 180, 7), crs=data_proj)\rax.set_yticks(np.linspace(-90, 90, 5), crs=data_proj)\r# ç”¨patchæ ‡å‡ºextentèŒƒå›´.\rpatch = Rectangle(\r(lonmin, latmin), lonmax - lonmin, latmax - latmin,\rfc='C3', alpha=0.4, transform=data_proj\r)\rax.add_patch(patch)\rfor ax in [ax2, ax4]:\rax.set_xticks(np.linspace(lonmin, lonmax, 7), crs=data_proj)\rax.set_yticks(np.linspace(latmin, latmax, 4), crs=data_proj)\r# æˆªå–åŒºåŸŸ\rax.set_extent(extent, crs=data_proj)\r# å¡«è‰²å’Œæ·»åŠ formatter.\rfor ax in [ax1, ax2, ax3, ax4]:\rax.add_feature(cfeature.LAND)\rax.add_feature(cfeature.OCEAN)\rax.xaxis.set_major_formatter(LongitudeFormatter())\rax.yaxis.set_major_formatter(LatitudeFormatter())\r# è®¾ç½®æ ‡é¢˜.\rax1.set_title(f'central_longitude={clon1}Â°')\rax3.set_title(f'central_longitude={clon2}Â°')\rax2.set_title('set_extent failed')\rax4.set_title('set_extent success')\rplt.show()\r æˆªå–èŒƒå›´ä¸ºç»åº¦ [120Â°, 240Â°]ï¼Œçº¬åº¦ [20Â°, 80Â°]ã€‚ç¬¬ä¸€æ’å›¾ç‰‡ central_longitude=0ï¼Œçº¢è‰²æ–¹å—æ ‡è¯†å‡ºäº†æˆªå–èŒƒå›´ï¼Œå¯ä»¥çœ‹åˆ°è¿™å¼ å›¾ä¸­æˆªå–èŒƒå›´è·¨è¶Šäº†åœ°å›¾è¾¹ç•Œï¼ˆ180Â°ï¼‰ï¼Œç„¶åå³è¾¹å¯¹çº¬åº¦çš„æˆªå–æˆåŠŸäº†ï¼Œä½†å¯¹ç»åº¦çš„æˆªå–å¤±è´¥äº†â€”â€”ç»åº¦èŒƒå›´ä»ç„¶æ˜¯ [-180Â°, 180Â°]ï¼Œæ‰€ä»¥åœ°å›¾å˜æˆäº†é•¿æ¡çŠ¶ã€‚ç¬¬äºŒæ’å›¾ç‰‡ central_longitude=180ï¼Œæ­¤æ—¶åœ°å›¾è¾¹ç•Œå˜ä¸º 0Â°ï¼Œæˆªå–èŒƒå›´å› æ­¤æ²¡æœ‰è·¨è¶Šè¾¹ç•Œï¼Œç„¶åå³è¾¹å¾—åˆ°äº†æ­£ç¡®çš„æˆªå–ç»“æœã€‚\nç”±æ­¤å¼•å‡ºäº† central_longitude çš„åˆä¸€ä½œç”¨ï¼šæ§åˆ¶åœ°å›¾è¾¹ç•Œï¼Œä»¥ä¿è¯ set_extent ç”Ÿæ•ˆã€‚é¢å¤–å†æä¸€ç‚¹ï¼Œä½¿ç”¨ set_extent æˆªå–å®Œåï¼Œè‹¥å†è°ƒç”¨ set_xticks å’Œ set_yticks ç”»è¶…å‡ºæˆªå–èŒƒå›´çš„åˆ»åº¦æ—¶ï¼Œä¼šå¼ºåˆ¶æ‹“å®½å½“å‰åœ°å›¾çš„èŒƒå›´ã€‚æ‰€ä»¥å»ºè®®å…ˆè®¾ç½®åˆ»åº¦ï¼Œå†è¿›è¡Œæˆªå–ï¼ˆè¿™ç‚¹å¯¹ set_global ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼‰ã€‚\nGeoAxes çš„ä½ç½® Matplotlib ä¸­å¯ä»¥é€šè¿‡ set_aspect æ–¹æ³•è°ƒæ•´ Axes æ¨ªçºµåæ ‡å•ä½çš„æ¯”ä¾‹ï¼Œä¾‹å¦‚ ax.set_aspect(1) ä½¿æ¨ªçºµåæ ‡å•ä½æ¯”ä¾‹ä¸º 1:1ï¼Œå› è€Œå›¾ç‰‡ä¸Šä¸€ä¸ªå•ä½çš„ x å’Œä¸€ä¸ªå•ä½çš„ y ä»£è¡¨çš„ç‰©ç†é•¿åº¦ï¼ˆè‹±å¯¸ï¼‰ç›¸ç­‰ã€‚\nä¹‹æ‰€ä»¥è¦æè¿™ä¸€ç‚¹ï¼Œæ˜¯å› ä¸º GeoAxesï¼ˆå³åœ°å›¾ï¼‰çš„æ¨ªçºµåæ ‡å•ä½æ¯”ä¾‹å¿…é¡»ä¿æŒä¸å˜ï¼Œä¸ç„¶éšä¾¿è°ƒæ•´ä¸€ä¸‹ figsizeã€rectã€xlimã€ylim ç­‰å‚æ•°ï¼Œåœ°å›¾å°±ä¼šå˜å½¢ï¼Œç›¸å½“äºåœ°å›¾çš„æŠ•å½±è¢«æ”¹å˜äº†ã€‚ä¾‹å¦‚ç­‰ç»çº¬åº¦æŠ•å½±çš„åœ°å›¾å•ä½ç»åº¦å’Œå•ä½çº¬åº¦å¿…é¡»ç­‰é•¿ï¼Œå¦åˆ™å°±åä¸å‰¯å…¶å®äº†ã€‚ç”¨ PlateCarree å¯¹è±¡åˆ›å»º GeoAxes æ—¶ï¼ŒCartopy ä¼šè‡ªåŠ¨è¿›è¡Œç±»ä¼¼äº ax.set_aspect(1) çš„æ“ä½œï¼Œä»¥æ»¡è¶³è¿™ä¸€æ¡ä»¶ã€‚\nä¸è¿‡ç”±æ­¤ä¹Ÿä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šä½ æ— æ³•åœ¨æ”¹å˜æ¯”ä¾‹çš„åŒæ—¶ç»´æŒ Axes çš„å½¢çŠ¶ä¸å˜ï¼ˆç‰¹æŒ‡ adjustable='box' æ—¶ï¼Œè¯¦è§ matplotlib.axes.Axes.set_adjustableï¼‰ã€‚ä¾‹å¦‚ç”¨ fig.add_axes åˆ›å»º PlateCarree æŠ•å½±çš„ GeoAxes æ—¶ï¼Œå¯ä»¥ç”¨ rect å‚æ•°æŒ‡å®š GeoAxes æ–¹æ¡†çš„å¤§å°å’Œä½ç½®ï¼Œä½†å¦‚å‰æ‰€è¿°ï¼ŒGeoAxes ä¼šè‡ªåŠ¨è®¾ç½®æ¯”ä¾‹ä¸º 1ï¼Œæ‰€ä»¥æœ€åç”»å‡ºæ¥çš„åœ°å›¾æ–¹æ¡†å¾ˆå¯èƒ½å¹¶ä¸ç¬¦åˆ rectã€‚ä¸‹é¢ç”¨ä»£ç è¿›è¡Œæ¼”ç¤º\nfrom matplotlib.transforms import Bbox\rproj = ccrs.PlateCarree()\rfig = plt.figure()\rrect = [0.2, 0.2, 0.6, 0.6]\raxpos1 = Bbox.from_bounds(*rect)\rax = fig.add_axes(rect, projection=proj)\rax.set_global()\rax.add_feature(cfeature.LAND)\rax.add_feature(cfeature.OCEAN)\raxpos2 = ax.get_position()\r# ç”»å‡ºrectçš„æ–¹æ¡†.\rpatch = mpatch.Rectangle(\r(axpos1.x0, axpos1.y0), axpos1.width, axpos1.height,\rec='C3', fc='none', transform=fig.transFigure\r)\rfig.patches.append(patch)\rfig.text(\raxpos1.x0, axpos1.y0 + axpos1.height, 'Expected Box',\rc='C3', va='bottom'\r)\r# ç”»å‡ºåœ°å›¾çš„æ–¹æ¡†.\rpatch = mpatch.Rectangle(\r(axpos2.x0, axpos2.y0), axpos2.width, axpos2.height,\rec='C0', fc='none', transform=fig.transFigure\r)\rfig.patches.append(patch)\rfig.text(\raxpos2.x0 + axpos2.width, axpos2.y0 + axpos2.height,\r'Actual Box', c='C0', ha='right', va='bottom'\r)\rprint('Expected Box:', axpos1)\rprint('Actual Box:', axpos2)\rplt.show()\r æ‰“å°ç»“æœä¸º\nExpected Box: Bbox(x0=0.2, y0=0.2, x1=0.8, y1=0.8)\rActual Box: Bbox(x0=0.2, y0=0.30000000000000004, x1=0.8, y1=0.7000000000000002)\r å¯ä»¥çœ‹åˆ°åœ°å›¾çš„å®é™…æ–¹æ¡†ç»´æŒä¸­å¿ƒä½ç½®å’Œå®½åº¦ä¸å˜ï¼Œä½†å¯¹æ’å®šæ¯”ä¾‹çš„è¦æ±‚ä½¿å…¶é«˜åº¦ç¼©çŸ­äº†ã€‚å®é™…ä¸Šï¼Œè‹¥é€šè¿‡ set_extent æ–¹æ³•æˆªå–åŒºåŸŸï¼Œè¿˜å¯èƒ½å‡ºç°å®é™…æ–¹æ¡†é«˜åº¦ä¸å˜ã€å®½åº¦ç¼©çŸ­çš„æƒ…å†µï¼Œè¿™é‡Œå°±ä¸æ”¾å›¾ç‰‡äº†ã€‚æ€»ä¹‹æ˜¯æƒ³è¯´æ˜ï¼ŒPlateCarree æŠ•å½±çš„ GeoAxes å¸¸å¸¸å‡ºç°ä¼šå‡ºç°é«˜åº¦æˆ–å®½åº¦çŸ­äºé¢„æœŸçš„æƒ…å†µã€‚å…¶å®é™…å¤§å°ä½ç½®å¯ä»¥é€šè¿‡ get_position æ–¹æ³•è·å–ï¼Œä¹‹åå¯ä»¥ç”¨äºç»˜åˆ¶ç­‰é«˜æˆ–ç­‰å®½çš„ colorbar ç­‰ï¼ˆä¾‹å­å¯è§ Matplotlib ç³»åˆ—ï¼šcolorbar çš„è®¾ç½®ï¼‰ã€‚\nå¼ºè¡ŒæŠŠåœ°å›¾å¡«åˆ° rect æŒ‡ç¤ºçš„ç©ºé—´é‡Œä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œåªéœ€è¦è®¾ç½®\nax.set_aspect('auto')\r ä¸è¿‡è¿™æ ·ä¸€æ¥æŠ•å½±å°±ç§°ä¸ä¸Šç­‰ç»çº¬åº¦æŠ•å½±äº†ã€‚\nç»“è¯­ æ–‡ä¸­å¾ˆå¤šç»éªŒéƒ½æ˜¯ç¬”è€…è¯•å‡ºæ¥çš„ï¼ŒCartopy çš„å®˜æ–¹æ–‡æ¡£å¹¶æ²¡æœ‰è¯¦ç»†è§£è¯´ï¼Œæ‰€ä»¥è¿™äº›ç»éªŒå¯èƒ½å­˜åœ¨ä¸ä¸¥è°¨æˆ–é”™è¯¯çš„åœ°æ–¹ï¼Œè¿˜è¯·è¯»è€…åœ¨è¯„è®ºåŒºæŒ‡å‡ºã€‚\nå‚è€ƒé“¾æ¥ Cartopy API reference\nLongitude conversion 0~360 to -180~180\npreventing spurious horizontal lines for ungridded pcolor(mesh) data\nForce aspect ratio for a map\n","date":"2021-11-06","permalink":"https://zhajiman.github.io/post/cartopy_appendix/","tags":["cartopy","matplotlib"],"title":"Cartopy ç³»åˆ—ï¼šå¯¹å…¥é—¨æ•™ç¨‹çš„è¡¥å……"},{"content":"å®šä¹‰ å‘½åç©ºé—´ å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ï¼šå®˜æ–¹è¯´æ³•æ˜¯ä»åç§°åˆ°å¯¹è±¡çš„æ˜ å°„ï¼Œå®é™…ä¸Šå°±æ˜¯ä¿å­˜å˜é‡åä¸å˜é‡å€¼ç»‘å®šå…³ç³»çš„ä¸€ä¸ªç©ºé—´ã€‚èµ‹å€¼è¯­å¥ä¼šå°†ç»‘å®šå…³ç³»å†™å…¥å‘½åç©ºé—´ï¼Œè€Œå¼•ç”¨å˜é‡æ—¶åˆ™ä¼šæ ¹æ®å˜é‡ååœ¨å‘½åç©ºé—´ä¸­æŸ¥è¯¢å‡ºå¯¹åº”çš„å€¼ã€‚å¹¶ä¸”å¤§éƒ¨åˆ†çš„å‘½åç©ºé—´éƒ½æ˜¯åˆ©ç”¨ Python çš„å­—å…¸æ¥å®ç°çš„ï¼ˆä¾‹å¤–å¦‚ç±»çš„ __slots__ å±æ€§ï¼‰ã€‚ç¨‹åºä¸­å‡ºç°åœ¨å…¨å±€çš„å˜é‡æ„æˆä¸€ä¸ªå‘½åç©ºé—´ï¼ŒPython å†…ç½®çš„å‡½æ•°å’Œå¼‚å¸¸ç±»ä¹Ÿæœ‰å®ƒä»¬è‡ªå·±çš„å‘½åç©ºé—´ï¼Œæ¯æ¬¡å®šä¹‰å‡½æ•°æˆ–ç±»æ—¶ä¹Ÿä¼šåˆ›å»ºä¸“å±äºå®ƒä»¬çš„å‘½åç©ºé—´ã€‚å‘½åç©ºé—´ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼ŒåŒåçš„å˜é‡å¯ä»¥å­˜åœ¨äºä¸åŒçš„å‘½åç©ºé—´ä¸­ï¼Œä¾‹å¦‚ä¸¤ä¸ªå‡½æ•°å†…éƒ¨å¯ä»¥ä½¿ç”¨åŒåçš„å±€éƒ¨å˜é‡ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬åœ¨ä¸å¼•å‘å†²çªçš„åŒæ—¶åˆç†å¤ç”¨å˜é‡åã€‚\nä½œç”¨åŸŸ ä½œç”¨åŸŸï¼ˆscopeï¼‰ï¼šå®˜æ–¹è¯´æ³•æ˜¯ Python ç¨‹åºä¸­èƒ½ç›´æ¥è®¿é—®ä¸€ä¸ªå‘½åç©ºé—´çš„æ–‡æœ¬åŒºåŸŸã€‚å¬èµ·æ¥æœ‰ç‚¹æŠ½è±¡ï¼Œå®é™…ä¸Šå°±æ˜¯æŒ‡å‡ºç¨‹åºä¸­å“ªäº›åŒºåŸŸçš„æ–‡æœ¬å½’å“ªä¸ªå‘½åç©ºé—´ç®¡ç†ï¼Œä¾‹å¦‚å‡½æ•°çš„ä½œç”¨åŸŸæ˜¾ç„¶å°±æ˜¯å‡½æ•°ä½“ï¼ˆå®šä¹‰å‡½æ•°çš„æ‰€æœ‰è¯­å¥ï¼‰ï¼Œå…¨å±€ä½œç”¨åŸŸå°±æ˜¯ä»å¤´åˆ°å°¾æ•´ä¸ªç¨‹åºã€‚ä½†å¹¶ä¸æ˜¯è¯´å‡ºç°åœ¨ä¸€ä¸ªä½œç”¨åŸŸä¸­çš„å˜é‡å°±ä¸€å®šå±äºè¯¥ä½œç”¨åŸŸï¼ˆçš„å‘½åç©ºé—´ï¼‰ï¼šè‹¥åœ¨è¯¥åŒºåŸŸå†…é€šè¿‡èµ‹å€¼è¯­å¥ç­‰æ“ä½œåˆ›å»ºï¼ˆæˆ–ä¿®æ”¹ï¼‰äº†è¯¥å˜é‡çš„ç»‘å®šå…³ç³»åï¼Œé‚£å®ƒå°±å±äºè¯¥ä½œç”¨åŸŸï¼›å¦åˆ™å®ƒå°±å±äºå…¶å®ƒä½œç”¨åŸŸï¼Œåœ¨å½“å‰åŒºåŸŸå¼•ç”¨å®ƒéœ€è¦æ ¹æ®ç‰¹å®šçš„è§„åˆ™å‘å…¶å®ƒä½œç”¨åŸŸè¿›è¡ŒæŸ¥è¯¢ã€‚ä¾‹å¦‚å¸¸è§çš„åœ¨å‡½æ•°ä¸­å¼•ç”¨å…¨å±€å˜é‡ã€‚æœ¬æ–‡çš„ä¸€ä¸ªé‡ç‚¹å°±æ˜¯è¦æ¥ä»”ç»†è¯´è¯´è¿™ä¸€è§„åˆ™ã€‚\nLEGB è§„åˆ™ å¼•ç”¨å˜é‡æ—¶ï¼ŒæŒ‰ L -\u0026gt; E -\u0026gt; G -\u0026gt; B çš„é¡ºåºåœ¨ä¸åŒä½œç”¨åŸŸä¸­æŸ¥è¯¢ï¼š\n Lï¼ˆLocalï¼‰ï¼šå±€éƒ¨ä½œç”¨åŸŸï¼Œæ¯”å¦‚å‡½æ•°æˆ–æ–¹æ³•å†…éƒ¨ã€‚ Eï¼ˆEnclosingï¼‰ï¼šå¤–å±‚ä½œç”¨åŸŸï¼Œæ¯”å¦‚ä¸€ä¸ªé—­åŒ…å‡½æ•°çš„å¤–å±‚å‡½æ•°éƒ¨åˆ†ã€‚ Gï¼ˆGlobalï¼‰ï¼šå…¨å±€ä½œç”¨åŸŸï¼Œæ¯”å¦‚å½“å‰è¿è¡Œçš„æ–‡ä»¶æˆ–å¯¼å…¥çš„æ¨¡å—çš„å†…éƒ¨ã€‚ Bï¼ˆBuilt-inï¼‰ï¼šPython çš„å†…ç½®å‡½æ•°ç­‰å­˜åœ¨çš„ä½œç”¨åŸŸã€‚  ä¸¾ä¸ªä¾‹å­ï¼Œè‹¥åœ¨å‡½æ•°ä¸­å¼•ç”¨æŸå˜é‡ï¼Œé¦–å…ˆä¼šåœ¨å‡½æ•°çš„å±€éƒ¨ä½œç”¨åŸŸä¸­æŸ¥è¯¢è¯¥å˜é‡æ˜¯å¦å­˜åœ¨ï¼ŒæŸ¥ä¸åˆ°å°±åˆ°å¤–å±‚å‡½æ•°ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰çš„ä½œç”¨åŸŸé‡Œå»æŸ¥ï¼Œå†æŸ¥ä¸åˆ°å°±æ¥ç€å»å…¨å±€å’Œå†…ç½®ä½œç”¨åŸŸï¼Œå¦‚æœéƒ½æŸ¥ä¸åˆ°å°±ä¼šæŠ›å‡º NameError å¼‚å¸¸äº†ã€‚ä¸‹é¢å†ä»¥ä¸€å¼ å›¾ä¸ºä¾‹ä¸€æ­¥æ­¥è¿›è¡Œè§£è¯´ã€‚\nè¿™æ®µç¨‹åºçš„è¿è¡Œç»“æœæ˜¯\nfunc_arg in global: 1\rfunc_arg in func: 2\rinner_var in inner_func: 2\router_var in inner_func: 1\r é¦–å…ˆï¼Œç¨‹åºåœ¨å¯åŠ¨æ—¶å°±å·²ç»å…¨éƒ¨å¤„äºå†…ç½®ä½œç”¨åŸŸä¸­ï¼ˆå›¾ä¸­è‚‰è‰²éƒ¨åˆ†ï¼‰ã€‚ç„¶åç¨‹åºçš„æ¯ä¸€å¥è¢«è§£é‡Šå™¨æ‰§è¡Œï¼šå‡½æ•°å func å’Œ outer_func é€šè¿‡ def è¯­å¥åˆ†åˆ«ç»‘å®šç»™äº†ä¸¤ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå…¶ç»‘å®šå…³ç³»å†™å…¥äº†å…¨å±€ä½œç”¨åŸŸçš„å‘½åç©ºé—´ä¸­ï¼ˆå›¾ä¸­ç»¿è‰²éƒ¨åˆ†ï¼‰ã€‚__main__ æ˜¯å…¨å±€ä½œç”¨åŸŸä¸­é¢„å®šä¹‰çš„å˜é‡ï¼Œåœ¨æœ¬ä¾‹ä¸­å€¼ä¸º 'main'ï¼Œå˜é‡å func_arg é€šè¿‡èµ‹å€¼è¯­å¥ç»‘å®šç»™äº†æ•´æ•° 1ã€‚å› ä¸ºå…¨å±€ä½œç”¨åŸŸä¸­å¹¶ä¸å­˜åœ¨åä¸º print çš„å‡½æ•°ï¼Œæ‰€ä»¥ä¼šåˆ°å†…ç½®ä½œç”¨åŸŸä¸­æŸ¥è¯¢ï¼Œå› ä¸º print æ­£å¥½æ˜¯å†…ç½®å‡½æ•°æ‰€ä»¥é¡ºåˆ©åœ°æ‰¾åˆ°äº†â€”â€”å³ G -\u0026gt; B çš„æŸ¥è¯¢é¡ºåºã€‚print å‡½æ•°çš„å‚æ•°ä¸­å‡ºç°äº† func_argï¼Œå…¨å±€ä½œç”¨åŸŸä¸­å°±æœ‰ï¼Œæ‰€ä»¥æ‰“å°å‡ºäº†æ•´æ•° 1ã€‚\næ¥ç€åˆ°äº†è°ƒç”¨å‡½æ•°çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå‡½æ•°è¢«è°ƒç”¨æ—¶ä¼šæŠŠå½¢å¼å‚æ•°ï¼ˆfunc_argï¼‰ç»‘å®šç»™ä¼ å…¥çš„å®é™…å‚æ•°ï¼ˆå³æ•´æ•° 2ï¼‰ï¼Œæ‰€ä»¥ func çš„å‘½åç©ºé—´ä¸­å‡ºç°äº† func_argï¼ˆå›¾ä¸­ç¬¬ä¸€ä¸ªè“è‰²éƒ¨åˆ†ï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ª func_arg ä¸å…¨å±€ä½œç”¨åŸŸä¸­çš„ func_arg æ¯«æ— å¹²ç³»ã€‚ç„¶ååˆæ˜¯æŒ‰ L -\u0026gt; G -\u0026gt; B çš„é¡ºåºåœ¨å†…ç½®ä½œç”¨åŸŸä¸­æ‰¾åˆ° print å‡½æ•°ï¼Œæ‰“å°å‡ºæ•´æ•° 2ã€‚\nä¸»ç¨‹åºçš„æœ€åä¸€å¥æ˜¯è°ƒç”¨å­˜åœ¨åµŒå¥—çš„å‡½æ•° outer_funcã€‚outer_func çš„å‡½æ•°ä½“è¢«æ‰§è¡Œï¼Œå…¶ä¸­å˜é‡å outer_var è¢«ç»‘å®šç»™æ•´æ•° 1ï¼Œå‡½æ•°å inner_func è¢«ç»‘å®šç»™åµŒå¥—å®šä¹‰çš„å‡½æ•°å¯¹è±¡ï¼Œä¹‹åå®ƒä»¬å‡ºç°åœ¨ outer_func çš„å‘½åç©ºé—´ä¸­ï¼ˆå›¾ä¸­ç¬¬äºŒä¸ªè“è‰²éƒ¨åˆ†ï¼‰ã€‚outer_func å‡½æ•°ä½“çš„æœ€åä¸€å¥æ˜¯è°ƒç”¨åˆšåˆšå®šä¹‰å¥½çš„ inner_func å‡½æ•°ï¼Œinner_func çš„å‡½æ•°ä½“åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªå±€éƒ¨ä½œç”¨åŸŸï¼ˆå›¾ä¸­é»„è‰²éƒ¨åˆ†ï¼‰ï¼Œä½†å› ä¸ºè¢«å®šä¹‰åœ¨ outer_func å†…ï¼Œæ‰€ä»¥ outer_func çš„å±€éƒ¨ä½œç”¨åŸŸåŒæ—¶ä¹Ÿæ˜¯ inner_func çš„å¤–éƒ¨ä½œç”¨åŸŸã€‚å› æ­¤ inner_func ä¸­è°ƒç”¨ print æ—¶å‘ç”Ÿäº† L -\u0026gt; E -\u0026gt; G -\u0026gt; B çš„æœç´¢è¿‡ç¨‹ã€‚åœ¨ inner_func ä¸­è°ƒç”¨ outer_var ä¹Ÿå‘ç”Ÿäº† L -\u0026gt; E çš„æŸ¥è¯¢è¿‡ç¨‹ã€‚\nç®€å•æ€»ç»“ä¸€ä¸‹ï¼šä½œç”¨åŸŸå°±å¥½æ¯”èŠ±èŠ±ç»¿ç»¿çš„ä¾¿åˆ©è´´ï¼Œæœ€åº•ä¸‹ä¸¤å¼ å¤§çš„ä¾¿åˆ©è´´åˆ†åˆ«æ˜¯å†…ç½®ä½œç”¨åŸŸå’Œå…¨å±€ä½œç”¨åŸŸã€‚å®šä¹‰æ–°å‡½æ•°æ—¶ä¼šåœ¨è¿™ä¸¤å¼ çº¸çš„åŸºç¡€ä¸Šä¸€å±‚ä¸€å±‚å¾€ä¸Šç›–å°ä¾¿åˆ©è´´ï¼Œå› è€Œä¸åŒå‡½æ•°æ ˆä¼šæ‘æˆä¸€ä¸ªä¸ªçº¸å †ã€‚å¼•ç”¨å˜é‡æ—¶åˆ™ä¼šä»å½“å‰ä¾¿åˆ©è´´å‡ºå‘ï¼Œä¸€å±‚ä¸€å±‚å¾€ä¸‹æŸ¥è¯¢ï¼Œæœ€è¿œæŸ¥åˆ°åº•å±‚çš„å†…ç½®ä½œç”¨åŸŸï¼›ä¸è¿‡å¾€ä¸ŠæŸ¥è¯¢æ˜¯ä¸å…è®¸çš„ï¼Œæ‰€ä»¥å¤–å±‚å‡½æ•°æ— æ³•å¼•ç”¨å†…å±‚å‡½æ•°çš„å˜é‡ã€‚æ ¹æ®è¿™ä¸€è§„åˆ™ï¼Œä¸åŒå‡½æ•°æ ˆä¹‹é—´ä¹Ÿæ˜¯äº’ä¸ç›¸é€šçš„ã€‚ä¸‹å›¾æ˜¯å¯¹è¿™ä¸€æ¯”å–»çš„ç«‹ä½“åŒ–å±•ç¤º\nnonlocal å’Œ global è¯­å¥ è€ƒè™‘ä¸‹é¢è¿™ä¸ªå‡½æ•°\ndef outer_func():\router_var = 1\rdef inner_func():\router_var = 2\rprint('outer_var before inner_func:', outer_var)\rinner_func()\rprint('outer_var after inner_func:', outer_var)\r è¿è¡Œç»“æœä¸º\nouter_var before inner_func: 1\router_var after inner_func: 1\r æ˜æ˜å‡½æ•° inner_func å¯¹å˜é‡ outer_var è¿›è¡Œäº†ä¿®æ”¹ï¼Œä½†ä¿®æ”¹æ•ˆæœä¼¼ä¹æ²¡æœ‰ä½“ç°åœ¨å¤–å±‚ã€‚è¿™æ˜¯å› ä¸º outer_var = 2 è¿™ä¸ªèµ‹å€¼è¯­å¥åªæ˜¯åœ¨ inner_func çš„ä½œç”¨åŸŸä¸­æ–°å®šä¹‰äº†ä¸€ä¸ªç»‘å®šå…³ç³»ï¼Œè¿™é‡Œçš„ outer_var å’Œå¤–å±‚çš„ outer_var å®é™…ä¸Šåˆ†åˆ«å±äºä¸åŒçš„ä¸¤ä¸ªå‘½åç©ºé—´ï¼Œé™¤äº†å˜é‡åæ°å¥½ç›¸åŒä»¥å¤–å¹¶æ²¡æœ‰ä»»ä½•è”ç³»ã€‚è¿™ä¸€è¡Œä¸ºè¿˜å¯ä»¥è§£è¯»æˆï¼Œä½œç”¨åŸŸå¤–å±‚çš„å˜é‡æ€»æ˜¯â€œåªè¯»â€çš„â€”â€”ä½ å¯ä»¥æ ¹æ® LEGB è§„åˆ™å¼•ç”¨å¤–å±‚å˜é‡çš„å€¼ï¼Œä½†è‹¥æƒ³é€šè¿‡èµ‹å€¼è¯­å¥ç­‰æ“ä½œæ”¹å˜å…¶ç»‘å®šå…³ç³»ï¼Œåˆ™åªä¼šåœ¨å½“å‰ä½œç”¨åŸŸé‡Œåˆ›å»ºåŒåå˜é‡è€Œå·²ã€‚\nè‹¥æŠŠ inner_func ä¸­çš„èµ‹å€¼è¯­å¥æ”¹ä¸ºè‡ªå¢\ndef inner_func():\router_var += 1\r è¿è¡Œå´å‘ç°ä¼šæŠ›å‡º UnboundLocalError å¼‚å¸¸ã€‚è¿™é‡Œè‡ªå¢è¯­å¥ outer_var += 1 ç­‰ä»·äºèµ‹å€¼è¯­å¥ outer_var = outer_var + 1ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè®¤ä¸ºï¼Œç­‰å·å³è¾¹ä¼šé€šè¿‡å¼•ç”¨å¤–å±‚ outer_var çš„å€¼è®¡ç®—å‡ºæ•´æ•° 2ï¼Œç„¶åå†åœ¨å½“å‰ä½œç”¨åŸŸä¸­åˆ›å»ºåŒåçš„ç»‘å®šå…³ç³»ï¼Œç¨‹åºåº”è¯¥èƒ½æ­£å¸¸è¿è¡Œæ‰å¯¹ã€‚ä½†å®é™…æƒ…å†µæ˜¯ï¼Œå‡½æ•°åœ¨è¢«å®šä¹‰æ—¶ï¼Œè‹¥å‡½æ•°ä½“å†…å­˜åœ¨å…³äºæŸå˜é‡çš„ç»‘å®šè¯­å¥ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡å°±ä¸€å®šä¼šè¢«è§£æåˆ°å‡½æ•°è‡ªå·±çš„ä½œç”¨åŸŸä¸­ï¼Œä¸ä¼šå†å‘å¤–æŸ¥è¯¢â€”â€”å“ªæ€•å‡½æ•°è¿˜æ²¡è¢«è°ƒç”¨ã€è¯¥è¯­å¥è¿˜æ²¡è¢«æ‰§è¡Œã€‚æ‰€ä»¥å½“ inner_func çœ‹åˆ°è‡ªå·±çš„è¯­å¥å—ä¸­å‡ºç°äº†è‡ªå¢è¯­å¥æ—¶ï¼Œå°±è®¤å®š outer_var è‚¯å®šæ˜¯è‡ªå·±çš„å±€éƒ¨å˜é‡ï¼ˆlocalï¼‰ï¼Œä½†çœŸå½“è¿è¡Œåˆ° outer_var + 1 çš„è¡¨è¾¾å¼æ—¶ï¼Œå´å‘ç°å±€éƒ¨ä½œç”¨åŸŸä¸­æŸ¥ä¸åˆ°å®ƒï¼Œæ‰€ä»¥è‡ªç„¶äº§ç”Ÿäº† UnboundLocalError å¼‚å¸¸ï¼šè¯¥å±€éƒ¨å˜é‡è¿˜æ²¡æœ‰ç»‘å®šå…³ç³»å°±è¢«å¼•ç”¨äº†ï¼Œå‘½åç©ºé—´é‡ŒæŸ¥ä¸åˆ°å®ƒå•Šã€‚\nå¦‚æœçœŸæƒ³ä¿®æ”¹å¤–éƒ¨ä½œç”¨åŸŸé‡Œçš„ç»‘å®šå…³ç³»ï¼Œå°±éœ€è¦ç”¨ nonlocal å’Œ global è¯­å¥æ˜¾å¼å£°æ˜æŸå˜é‡æ‰€å¤„çš„ä½œç”¨åŸŸï¼ŒåŒæ—¶è·å¾—ä¿®æ”¹å…¶ç»‘å®šå…³ç³»çš„æƒé™ã€‚nonlocal ä¼šæŠŠå˜é‡åè§£æåˆ°ç¦»å½“å‰å±€éƒ¨ä½œç”¨åŸŸæœ€è¿‘çš„éå…¨å±€çš„å¤–å±‚ä½œç”¨åŸŸä¸­ï¼Œä¾‹å¦‚ä¸Šé¢çš„ inner_func å¯ä»¥ä¿®æ”¹ä¸º\ndef inner_func():\rnonlocal outer_var\router_var = 'abc'\r è¿è¡Œç»“æœä¸º\nouter_var before inner_func: 1\router_var after inner_func: abc\r å¯ä»¥çœ‹åˆ°é€šè¿‡ nonlocal å£°æ˜ inner_func é‡Œçš„ outer_var å°±æ˜¯å¤–å±‚é‚£ä¸ª outer_varï¼Œä¾¿å¯ä»¥åœ¨ inner_var é‡Œä¿®æ”¹ outer_var çš„ç»‘å®šå…³ç³»ã€‚global åŒç†ï¼Œä¸è¿‡é¡¾åæ€ä¹‰ä¼šæŠŠå˜é‡åè§£æåˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä¾‹å¦‚\nN = 10\rdef func():\rglobal N\rN += 10\rif __name__ == '__main__':\rprint('N before func:', N)\rfunc()\rprint('N after func:', N)\r è¿è¡Œç»“æœä¸º\nN before func: 10\rN after func: 20\r å¦‚æœå»æ‰ global çš„è¯­å¥çš„è¯ï¼ŒåŒæ ·ä¼šæŠ›å‡º UnboundLocalError å¼‚å¸¸ã€‚\néœ€è¦æ³¨æ„ï¼Œè¿™ä¸€èŠ‚é’ˆå¯¹çš„éƒ½æ˜¯ä¸å¯å˜ï¼ˆimmutableï¼‰å¯¹è±¡ï¼Œè‹¥å¤–å±‚ä½œç”¨åŸŸçš„å˜é‡æ˜¯å¯å˜ï¼ˆmutableï¼‰å¯¹è±¡ï¼Œä¾‹å¦‚åˆ—è¡¨ã€å­—å…¸ç­‰ï¼Œé‚£ä¹ˆå³ä¾¿ä¸ç”¨ nonlocal å’Œ global è¯­å¥ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ç”¨èµ‹å€¼è¯­å¥ç›´æ¥ä¿®æ”¹å…¶å…ƒç´ ï¼Œåˆ©ç”¨è‡ªå¢è¯­å¥è¿›è¡ŒåŸåœ°çš„è¿æ¥æ“ä½œã€‚\næ¨¡å—çš„ä½œç”¨åŸŸ æ¯ä¸ªæ¨¡å—éƒ½æœ‰å…¶ä¸“å±çš„å‘½åç©ºé—´å’Œå…¨å±€ä½œç”¨åŸŸï¼Œæ¨¡å—å†…å˜é‡çš„å¼•ç”¨åŒæ ·æœä» LEGB è§„åˆ™ã€‚äº‹å®ä¸Šï¼Œä¸»ç¨‹åºä¹Ÿä¸è¿‡æ˜¯ç‰¹æ®Šçš„ __main__ æ¨¡å—çš„ä¸€éƒ¨åˆ†è€Œå·²ã€‚é€šè¿‡ import è¯­å¥å¯ä»¥æŠŠä¸»ç¨‹åºé‡Œçš„å˜é‡åç»‘å®šç»™å…¶å®ƒæ¨¡å—é‡Œçš„å¯¹è±¡ï¼Œä»¥å®ç°è·¨æ¨¡å—çš„å¼•ç”¨ã€‚ä¾‹å¦‚\nimport math\rfrom math import sqrt\r ç¬¬ä¸€å¥ä¼šå°† math æ¨¡å—ä½œä¸ºä¸€ä¸ªå¯¹è±¡ç»‘å®šåˆ°ä¸»ç¨‹åºé‡Œçš„ math å˜é‡åä¸Šï¼Œæ¥ç€ä»¥ math.func çš„å½¢å¼è°ƒç”¨æ¨¡å—é‡Œçš„å‡½æ•°å³å¯ã€‚è€Œç¬¬äºŒå¥ç­‰ä»·äº\nimport math as _\rsqrt = _.sqrt\rdel(_)\r ç›¸å½“äºæŠŠ math.sqrt å‡½æ•°ç›´æ¥ç»‘å®šåˆ°ä¸»ç¨‹åºé‡Œçš„ sqrt å˜é‡åä¸Šã€‚å› æ­¤å¯ä»¥æƒ³åˆ°ï¼Œç›´æ¥ä¿®æ”¹ sqrt çš„ç»‘å®šå…³ç³»å¹¶ä¸ä¼šå½±å“åˆ° math.sqrtã€‚ä¸‹é¢è¿˜æ˜¯å†ä»¥å›¾ç‰‡ä¸ºä¾‹\nå†…ç½®ä½œç”¨åŸŸä¸Šæœ‰ä¸¤ä¸ªå…¨å±€ä½œç”¨åŸŸï¼ˆå›¾ä¸­ç»¿è‰²éƒ¨åˆ†ï¼‰ï¼Œå·¦è¾¹æ˜¯ä¸»ç¨‹åºçš„ï¼Œè€Œå³è¾¹æ˜¯è‡ªå®šä¹‰çš„ mod æ¨¡å—çš„ã€‚æœ¬æ¥è¿™ä¸¤ä¸ªä½œç”¨åŸŸäº’ç›¸ç‹¬ç«‹ï¼Œä½†é€šè¿‡ from mod import exp è¯­å¥å°†å³è¾¹çš„ exp å‡½æ•°å¯¼å…¥åˆ°äº†å·¦è¾¹ï¼Œæ‰€ä»¥ç°åœ¨å·¦è¾¹ä¹Ÿèƒ½è°ƒç”¨ expã€‚æ³¨æ„ï¼Œè™½ç„¶ç°åœ¨ exp å±äºä¸»ç¨‹åºçš„å…¨å±€ä½œç”¨åŸŸï¼Œä½† exp æŒ‡å‘çš„å‡½æ•°å¯¹è±¡ç›´æ¥å®šä¹‰åœ¨ mod.py æ–‡ä»¶ä¸­ï¼Œå…¶å†…éƒ¨çš„å˜é‡ä¾ç„¶å·¥ä½œåœ¨ mod æ¨¡å—çš„å…¨å±€ä½œç”¨åŸŸé‡Œï¼ˆä¾‹å¦‚å‡½æ•°ä¸­ç”¨åˆ°äº†å®šä¹‰åœ¨ mod é‡Œçš„å…¨å±€å˜é‡ eï¼Œä¸ä¼šè¯´å¯¼å…¥åˆ°ä¸»ç¨‹åºä¸­å°±æ‰¾ä¸åˆ° e äº†ï¼‰ã€‚\nç±»çš„ä½œç”¨åŸŸ ç±»çš„è¯´æ˜è¦ç¨å¾®éº»çƒ¦äº›ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥é€šè¿‡ä¾‹å­æ¥å±•ç¤º\nè¿è¡Œç»“æœä¸º\nKate : meow\r é¦–å…ˆï¼Œç±»åªæœ‰å½“å…¶å®šä¹‰é‡Œçš„è¯­å¥è¢«å…¨éƒ¨æ‰§è¡Œåæ‰èƒ½ç”Ÿæ•ˆï¼ˆæ˜¾ç„¶å‡½æ•°ä¸æ˜¯è¿™æ ·ï¼‰ã€‚å½“ç¨‹åºåˆšè¿›å…¥ç±»å®šä¹‰æ—¶ä¼šåˆ›å»ºç±»ä¸“å±çš„å‘½åç©ºé—´ï¼Œä¹‹åå®šä¹‰é‡Œçš„ç»‘å®šå…³ç³»å°†ä¼šè¢«è®°å½•åˆ°è¿™ä¸ªå‘½åç©ºé—´ä¸­ã€‚å¦‚å›¾ä¸­è“è‰²éƒ¨åˆ†æ‰€ç¤ºï¼Œç»‘å®šäº†ä¸€ä¸ªç±»å˜é‡ sound å’Œä¸¤ä¸ªç±»å‡½æ•° __init__ å’Œ callï¼ŒåŒæ—¶è¿™ä¸¤ä¸ªå‡½æ•°å› ä¸ºç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ selfï¼Œæ‰€ä»¥ä¹‹åè¿˜èƒ½ä½œä¸ºå®ä¾‹çš„æ–¹æ³•è¢«è°ƒç”¨ã€‚å®šä¹‰æ‰§è¡Œå®Œæ¯•åä¼šåˆ›å»ºä¸€ä¸ªç±»å¯¹è±¡ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°ä¸ç±»ååŒåçš„åç§°ä¸Šå»ï¼ˆæ­¤å¤„æ˜¯ Catï¼‰ã€‚\nç›´æ¥è°ƒç”¨ç±»å¯¹è±¡å¯ä»¥åˆ›å»ºä¸€ä¸ªç©ºçš„å®ä¾‹å¯¹è±¡ cï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±ç‹¬ç«‹çš„å‘½åç©ºé—´ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ c.attr çš„å½¢å¼å¼•ç”¨ç±»ç›¸å…³çš„å˜é‡ã€‚è‹¥å¼•ç”¨çš„æ˜¯å®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆä¼šç›´æ¥æŸ¥è¯¢å®ä¾‹è‡ªå·±çš„å‘½åç©ºé—´ï¼›è‹¥å¼•ç”¨çš„æ˜¯ç±»å˜é‡ï¼Œé‚£ä¹ˆä¼šè·³åˆ°å®ä¾‹æ‰€å±çš„ç±»çš„å‘½åç©ºé—´ä¸­å»æŸ¥æ‰¾ï¼›è‹¥å¼•ç”¨çš„æ˜¯æ–¹æ³•ï¼Œåˆ™ä¼šè·³åˆ°å®ä¾‹æ‰€å±çš„ç±»çš„å‘½åç©ºé—´ä¸­æŸ¥æ‰¾åŒåçš„å‡½æ•°ï¼Œå¹¶å°†å®ä¾‹å¯¹è±¡è‡ªèº«ä½œä¸º self å‚æ•°ä¼ å…¥ã€‚\nå†å›è¿‡å¤´æ¥çœ‹å…·ä½“çš„ç¨‹åºï¼ŒCat ç±»åœ¨è¢«ç›´æ¥è°ƒç”¨æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ __init__ æ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ï¼ŒåŒæ—¶å°† c å’Œæ¥æ”¶çš„å…¶å®ƒå‚æ•°ä¸€å¹¶ä¼ ç»™ __init__ã€‚__init__ çš„ä½œç”¨æ˜¯ç»™å®ä¾‹ä¸€ä¸ªåˆå§‹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°å‡½æ•°å®šä¹‰é‡Œä»¥ self.name = name ç­‰èµ‹å€¼è¯­å¥å‘ c çš„å‘½åç©ºé—´ä¸­å†™å…¥äº†å®ä¾‹å˜é‡çš„ç»‘å®šå…³ç³»ã€‚ä¹‹åä¸»ç¨‹åºä¸­è°ƒç”¨ c.call()ï¼Œç­‰ä»·äº Cat.call(c)ï¼Œcall çš„å‡½æ•°å®šä¹‰ä¸­ self.sound åˆç­‰ä»·äº Cat.soundã€‚\nç±»ä¸å‡½æ•°çš„ä¸€ä¸ªé‡è¦å·®åˆ«æ˜¯ï¼Œå‡½æ•°é‡ŒåµŒå¥—å®šä¹‰çš„å‡½æ•°å¯ä»¥æŒ‰ L -\u0026gt; E çš„é¡ºåºå¼•ç”¨å¤–å±‚å‡½æ•°çš„å˜é‡ï¼Œä½†ç±»é‡Œå®šä¹‰çš„å‡½æ•°å¹¶ä¸èƒ½å¼•ç”¨ç±»å˜é‡ï¼Œä¾‹å¦‚æœ¬ä¾‹ä¸­ call å‡½æ•°é‡Œç›´æ¥å¼•ç”¨ sound ä¼šæŠ›å‡º NameError å¼‚å¸¸ã€‚è™½ç„¶ç±»ä¹Ÿæœ‰å‘½åç©ºé—´å’Œä½œç”¨åŸŸï¼Œä½†å†…å±‚å‡½æ•°åœ¨å‘å¤–å±‚æŸ¥è¯¢æ—¶ä¼šè·³è¿‡ç±»çš„ä½œç”¨åŸŸï¼Œç”¨å›¾ä¸Šçš„å†…å®¹æ¥è¯´ï¼Œå°±æ˜¯è“è‰²å±‚å¯¹äºé»„è‰²å±‚æ˜¯â€œé€æ˜â€çš„ã€‚ä¸è¿‡ï¼Œå› ä¸ºç»¿è‰²å±‚é‡Œæœ‰ç±»å¯¹è±¡çš„ç»‘å®šå…³ç³»ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ Cat.attr çš„å½¢å¼è¿‚å›å¼•ç”¨ç±»å±æ€§ã€‚\næ€»ç»“ä¸€ä¸‹ï¼šç±»çš„ä½œç”¨åŸŸä¸åŒäºä¸€èˆ¬å‡½æ•°çš„ä½œç”¨åŸŸï¼Œç±»é‡Œçš„å‡½æ•°ä¸èƒ½ç›´æ¥è®¿é—®ç±»å±æ€§ï¼Œä½†å¯ä»¥å§”æ‰˜å®ä¾‹å¯¹è±¡ï¼ˆselfï¼‰å»è®¿é—®ç±»å˜é‡å’Œç±»æ–¹æ³•ï¼Œæˆ–ç›´æ¥ç”¨ç±»åè®¿é—®æ‰€æœ‰ç±»å±æ€§ã€‚å¦‚æœå­˜åœ¨ç»§æ‰¿ï¼Œé‚£ä¹ˆä¸Šé¢æåˆ°çš„å§”æ‰˜æ“ä½œä¼šé€’å½’åœ°å‘çˆ¶ç±»è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™é‡Œç¯‡å¹…æœ‰é™å°±ä¸å†è¯¦è°ˆäº†ã€‚\nPSï¼šå¦‚æœä½ å°è¯•ä»¥ä¸‹ä»£ç \nN = 10\rprint('N before class:', N)\rclass A:\rN += 10\rprint('N in class:', N)\rprint('N after class:', N)\r è¿è¡Œç»“æœä¸º\nN before class: 10\rN in class: 20\rN after class: 10\r Emmmâ€¦â€¦å¯¹äºå‡½æ•°ä¼šæŠ¥ UnboundLocalError é”™è¯¯ï¼Œä½†å¯¹ç±»å°±æˆåŠŸè¿è¡Œäº†ã€‚æ‰€ä»¥ä¹Ÿæœ‰äººè¯´å…¶å®ç±»åªæœ‰å‘½åç©ºé—´è€Œæ²¡æœ‰ä½œç”¨åŸŸï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒæœ€åä¸€ä¸ªå‚è€ƒé“¾æ¥ã€‚\nå‚è€ƒé“¾æ¥ The Python Tutorial: 9. Classes\nPython3 å‘½åç©ºé—´å’Œä½œç”¨åŸŸ\nPythonæ˜¯ä¸€ç§çº¯ç²¹çš„è¯­è¨€\nPythonçš„ç±»å®šä¹‰æœ‰æ²¡æœ‰å»ºç«‹æ–°çš„ä½œç”¨åŸŸï¼Ÿ\n","date":"2021-10-23","permalink":"https://zhajiman.github.io/post/python_namespace_scope/","tags":["python"],"title":"Python ç³»åˆ—ï¼šå‘½åç©ºé—´å’Œä½œç”¨åŸŸ"},{"content":"åœ¨ Python 3 ä¸­å…³äºé™¤æ³•çš„è¿ç®—ç¬¦æœ‰ä¸‰ç§ï¼š\n /ï¼šè¡¨ç¤ºç²¾ç¡®çš„çœŸé™¤æ³•ã€‚é­”æ³•æ–¹æ³•ä¸º __truediv__ã€‚ //ï¼šè¡¨ç¤ºåœ°æ¿é™¤ã€‚é­”æ³•æ–¹æ³•ä¸º __floordiv__ã€‚ %ï¼šè¡¨ç¤ºæ±‚æ¨¡ã€‚é­”æ³•æ–¹æ³•ä¸º __mod__ã€‚  / æ— éœ€ä»‹ç»ã€‚å…¶ä¸­ // è¢«ç§°ä¸ºåœ°æ¿é™¤æ˜¯å› ä¸ºå…¶ç»“æœç­‰ä»·äºå¯¹ / çš„ç»“æœå‘ä¸‹å–æ•´ã€‚è®¾æ“ä½œæ•° m å’Œ n æ˜¯æ•´æ•°ï¼Œäºæ˜¯æœ‰å…³ç³»\nm // n = floor(m / n)\r å³ä¾¿ m æˆ– n æ˜¯è´Ÿæ•°æ—¶ï¼Œè¿™ä¸€å…³ç³»ä¾ç„¶æˆç«‹ã€‚ä¾‹å¦‚\nIn : 5 // 2\rOut: 2\rIn: -5 // 2\rOut: -3\rIn: 5 // -2\rOut: -3\rIn: -5 // -2\rOut: 2\r % çš„ç»“æœä¸ // çš„ç»“æœå¯†åˆ‡ç›¸å…³ï¼Œå®ƒä»¬ä¸€å®šæ»¡è¶³\nq = m // n\rr = m % n\rq * n + r = m\r æ‰€ä»¥ % çš„ç»“æœå¯ä»¥é€šè¿‡ r = m - q * n è®¡ç®—å¾—åˆ°ã€‚ä¾‹å¦‚ -5 % 2 å°±ç­‰äº 1ã€‚Python ä¸­çš„ divmod å‡½æ•°èƒ½å¤ŸåŒæ—¶è¿”å› // å’Œ % çš„ç»“æœï¼Œæ–¹ä¾¿æˆ‘ä»¬è§‚å¯Ÿç»“æœã€‚ä¾‹å¦‚\nIn : divmod(-5, 2)\rOUt: (-3, 1)\r å†æ‰©å±•ä¸€ä¸‹ï¼Œå³ä¾¿ m æˆ– n æ˜¯æµ®ç‚¹æ•°ï¼Œç»“æœä¾ç„¶éµå¾ªä¸Šé¢çš„è®¡ç®—æµç¨‹ï¼Œä¸è¿‡æ­¤æ—¶ // å’Œ % çš„ç»“æœéƒ½ä¼šå˜æˆæµ®ç‚¹å‹ã€‚ä¾‹å¦‚\nIn : divmod(5.5, 2)\rOut: (2.0, 1.5)\rIn: divmod(-5.5, 2)\rOut: (-3.0, 0.5)\r æ­¤å¤–å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œåœ¨åœ°æ¿é™¤çš„å®šä¹‰ä¸‹ï¼Œé™¤æ•° n å’Œæ¨¡ r æ€»æ˜¯åŒå·çš„ã€‚\nå…¶å®ƒè¯­è¨€ä¸­ /ã€//ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å’Œ % è¡Œä¸ºå¯èƒ½è·Ÿ Python ä¸åŒï¼Œä½¿ç”¨æ—¶éœ€è¦å¤šåŠ å°å¿ƒã€‚\n","date":"2021-10-19","permalink":"https://zhajiman.github.io/post/python_divide/","tags":["python"],"title":"Python ç³»åˆ—ï¼šé™¤æ³•è¿ç®—ç¬¦"},{"content":"Vim æ˜¯ä¸€ä¸ªæ‹¥æœ‰é­”åŠ›çš„æ–‡æœ¬ç¼–è¾‘å™¨â€”â€”è¿™å¹¶ä¸æ˜¯æ¯”å–»ï¼Œè€Œæ˜¯è¯´ä½ åœ¨ Vim ä¸­çœŸçš„å¯ä»¥å¿µå’’è¯­æ¥æ“çºµæ–‡æœ¬ã€‚çœ‹çœ‹æˆ‘ä»¬çš„é”®ç›˜ï¼Œåœ¨ normal æ¨¡å¼ä¸‹å‡ ä¹æ¯ä¸ªé”®éƒ½æœ‰ç‰¹å®šçš„åŠŸèƒ½ï¼Œå°¤å…¶æ˜¯å…¶ä¸­çš„æ•°å­—å’Œ 26 ä¸ªå­—æ¯ã€‚å¦‚æœæŠŠæ¯ä¸ªé”®éƒ½çœ‹ä½œ Vim è¿™é—¨è¯­è¨€ä¸­çš„å•è¯ï¼Œé‚£ä¹ˆåªè¦ä¾æ®ç‰¹å®šçš„è¯­æ³•ï¼Œé€šè¿‡è¿ç»­å‡»é”®æ¥é£è¯é€ å¥ï¼Œå°±èƒ½æ–½å±•æ“ä½œæ–‡æœ¬çš„é­”æ³•ã€‚å¹¶ä¸” Vim è¯­è¨€çš„è¯­æ³•ç®€å•åˆ°ç”¨ä¸€å¥è¯å°±èƒ½æè¿°ï¼š\nverb + noun\r ä¸‹é¢å°±æ¥ç®€å•è®²è®²é­”æ³•çš„åŸºæœ¬æ³•ã€‚\nè¯­æ³•è§„åˆ™ Vim çš„è¯­æ³•ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼Œå¯¹ä»€ä¹ˆæ–‡æœ¬ï¼ˆåè¯ nounï¼‰åšä»€ä¹ˆæ“ä½œï¼ˆåŠ¨è¯ verbï¼‰ã€‚å…¶ä¸­åŠ¨è¯æŒ‡çš„æ˜¯ Vim ä¸­è¢«ç§°ä¸º operator çš„å‘½ä»¤ï¼Œä¾‹å¦‚å°å†™çš„ d é”®å°±æ˜¯è¡¨ç¤ºåˆ é™¤çš„ operatorã€‚ä½†æ˜¯å•ç‹¬æŒ‰ä¸‹ d å¹¶ä¸ä¼šèµ·æ•ˆï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŒ‡å®šåŠ¨è¯çš„ä½œç”¨å¯¹è±¡ã€‚Vim ä¸­å…³äºå…‰æ ‡ç§»åŠ¨çš„å‘½ä»¤è¢«ç§°ä¸º motionï¼Œä¾‹å¦‚æˆ‘ä»¬ç†ŸçŸ¥çš„ hjkl å°±æ˜¯è¡¨ç¤ºä¸Šä¸‹å·¦å³çš„ motionï¼Œw æ˜¯è¡¨ç¤ºè·³åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´çš„ motionã€‚Motion ä½œä¸ºåè¯ä½¿ç”¨æ—¶æŒ‡ä»£å…‰æ ‡ç§»åŠ¨èŒƒå›´å†…çš„æ–‡æœ¬ï¼Œæ‰€ä»¥å¥å­\noperator + motion\r å°±è¡¨ç¤ºå¯¹ motion ç§»åŠ¨èŒƒå›´å†…çš„æ–‡æœ¬æ‰§è¡Œ operator çš„æ“ä½œã€‚ä¾‹å¦‚ç»„åˆ dw å°±è¡¨ç¤ºåˆ é™¤å½“å‰å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´å‰çš„æ–‡æœ¬ã€‚ä¸åŒäºè‹±è¯­ï¼ŒVim è¯­æ³•ä¸­åŠ¨è¯å’Œåè¯å‰éƒ½å¯ä»¥åŠ ä¸Šæ•°å­—ï¼Œä»¥è¡¨ç¤ºé‡å¤åŠ¨è¯æˆ–åè¯ã€‚ä¾‹å¦‚ 2w è¡¨ç¤ºè·³è·ƒåˆ°ä¸‹ä¸‹ä¸ªå•è¯å¼€å¤´ï¼Œé‚£ä¹ˆ d2w å°±è¡¨ç¤ºä¸€æ¬¡æ€§åˆ é™¤ä¸¤ä¸ªæ¥ä¸‹æ¥çš„å•è¯ï¼›åŒæ—¶ 2dw è¡¨ç¤ºåˆ é™¤ä¸‹ä¸€ä¸ªå•è¯çš„æ“ä½œæ‰§è¡Œä¸¤æ¬¡ï¼›åŒç†ï¼Œ2d2w å°±è¡¨ç¤ºåˆ é™¤ 2 * 2 = 4 ä¸ªå•è¯ã€‚äºæ˜¯å¥å­å¯ä»¥è¡¥å……æˆ\n[count] operator + [count] motion\r å…¶ä¸­ count æ˜¯å¤§äº 0 çš„æ•´æ•°ï¼Œæ–¹æ‹¬å·è¡¨ç¤ºå¯æœ‰å¯æ— ã€‚\né™¤äº† motionï¼Œè¿˜æœ‰ä¸€ç±»è¢«ç§°ä½œ text object çš„å‘½ä»¤èƒ½ä½œä¸ºåè¯ã€‚é¡¾åæ€ä¹‰ï¼Œtext object è¡¨ç¤ºå…·æœ‰æŸç§ç»“æ„çš„ä¸€æ®µæ–‡æœ¬å¯¹è±¡ï¼Œå…·ä½“å½¢å¼ä¸º\ntext-object = modifier + object\r å…¶ä¸­ object æ˜¯å…·ä½“çš„æ–‡æœ¬å¯¹è±¡ï¼Œmodifier æ˜¯å¯¹å…¶èŒƒå›´çš„ä¸€ç‚¹è¡¥å……ä¿®é¥°ã€‚ä¾‹å¦‚ ap å°±æ˜¯ä¸€ä¸ª text objectï¼Œå…¶ä¸­å¯¹è±¡ p è¡¨ç¤ºæ®µè½ï¼Œä¿®é¥°è¯ a è¡¨ç¤ºåœ¨æ•´ä¸ªæ®µè½èŒƒå›´çš„åŸºç¡€ä¸Šï¼Œå†åŒ…å«æ®µè½å‰æˆ–æ®µè½åçš„ç©ºè¡Œã€‚ä¸åŒäº motionï¼Œtext object å¹¶ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œè€Œæ˜¯å¿…é¡»æ”¾åœ¨ operator ä¹‹åæ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚äºæ˜¯ç»„åˆ dap å°±è¡¨ç¤ºåˆ é™¤ä¸€æ•´ä¸ªæ®µè½åŠä¸ä¹‹ç›¸é‚»çš„ç©ºè¡Œã€‚åŒæ ·å¯ä»¥æ€»ç»“ä¸ºå¥å­\n[count] operator + [count] text-object\r ç›¸æ¯”äº motion çš„å¥å­ï¼Œè¿™ä¸ªå¥å­ä¸ç”¨å…³å¿ƒå…‰æ ‡çš„å…·ä½“ä½ç½®ï¼Œåªè¦æˆ‘ä»¬çš„å…‰æ ‡è½å…¥äº†æ–‡æœ¬å¯¹è±¡çš„èŒƒå›´å†…ï¼ŒVim ä¼šè‡ªåŠ¨æ‰¾å‡ºæ–‡æœ¬å¯¹è±¡çš„èµ·å§‹èŒƒå›´è¿›è¡Œæ“ä½œã€‚\nè‡³æ­¤ Vim çš„è¯­æ³•åŸºæœ¬ä¸Šå°±è®²å®Œäº†ï¼Œæ²¡é”™å°±è¿™ä¹ˆç‚¹å†…å®¹ï¼Œä½†å…¶ä¸­è•´å«çš„æ€æƒ³æ˜¯å¾ˆå€¼å¾—ç©å‘³çš„ã€‚ä¸€èˆ¬çš„æ–‡æœ¬ç¼–è¾‘å™¨åªèƒ½æä¾›éå¸¸åŸå­åŒ–çš„æ“ä½œï¼šå…‰æ ‡åªèƒ½ä¸Šä¸‹å·¦å³ç§»åŠ¨ï¼Œå­—ç¬¦åªèƒ½å•ä¸ªå•ä¸ªå¢åˆ ã€‚ä½† Vim å°†å…·ä½“çš„æ“ä½œã€å…‰æ ‡çš„ç§»åŠ¨æ¨¡å¼å’Œç»“æ„åŒ–çš„æ–‡æœ¬åˆ†åˆ«æŠ½è±¡ä¸º operatorã€motion å’Œ text objectï¼Œå†å°†å®ƒä»¬æ˜ å°„åˆ°å•ä¸ªæŒ‰é”®ä¸Šï¼Œå¹¶æŒ‰è¯­æ³•èµ‹äºˆå…¶ç›¸äº’ç»„åˆçš„èƒ½åŠ›ï¼Œä½¿ç¼–è¾‘æ–‡æœ¬çš„é€»è¾‘èƒ½ç”¨ç®€å•çš„å‘½ä»¤åºåˆ—å…·è±¡åŒ–åœ°è¡¨è¾¾å‡ºæ¥ã€‚è¿™ç§æ“ä½œå“²å­¦æ˜¯ä¸€èˆ¬çš„æ–‡æœ¬ç¼–è¾‘å™¨æ‰€æ¬ ç¼ºçš„ã€‚\næ­£å¦‚å­¦è‹±è¯­ä¸èƒ½åªå­¦è¯­æ³•ä¸èƒŒå•è¯ï¼ŒVim é‡Œæˆ‘ä»¬ä¹Ÿéœ€è¦æŒæ¡åŠ¨è¯å’Œåè¯æ‰èƒ½æ­£å¸¸é€ å¥ï¼Œæ›´åˆ«è¯´å®è·µè¿‡ç¨‹ä¸­çš„è®¸å¤šè¿·æƒ‘ç‚¹éƒ½æ˜¯æºäºå¯¹è¯æ±‡æ€§è´¨çš„ä¸äº†è§£ã€‚æ‰€ä»¥ä¸‹é¢ç»§ç»­æ¥ä»‹ç»å¸¸ç”¨çš„è¯æ±‡ã€‚\nå¸¸ç”¨çš„ operator Vim å…±æœ‰ 16 ä¸ª operatorï¼Œä½†æœ€å¸¸ç”¨çš„æ— éä»¥ä¸‹å‡ ä¸ªï¼š\n dï¼šå–è‡ª deleteï¼Œè¡¨ç¤ºåˆ é™¤ã€‚ä¾‹å¦‚ dw è¡¨ç¤ºåˆ é™¤å½“å‰å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªè¯ä¹‹å‰çš„å†…å®¹ã€‚ cï¼šå–è‡ª changeï¼Œè¡¨ç¤ºæ›¿æ¢ï¼Œç›¸å½“äº d ä¹‹åè‡ªåŠ¨è¿›å…¥ insert æ¨¡å¼ã€‚ä¾‹å¦‚ cw æ•ˆæœåŒ dwï¼Œä½†åˆ é™¤å®Œæ¯•åä¼šè¿›å…¥ insert æ¨¡å¼ä»¥ä¾¿é©¬ä¸Šè¾“å…¥æ–°çš„æ›¿æ¢æ–‡æœ¬ã€‚ yï¼šå–è‡ª yankï¼Œè¡¨ç¤ºå¤åˆ¶åˆ°å¯„å­˜å™¨ä¸­ã€‚ä¾‹å¦‚ yw è¡¨ç¤ºå¤åˆ¶å½“å‰å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªè¯ä¹‹å‰çš„å†…å®¹ã€‚å› ä¸ºè¯ä¸è¯ä¹‹å‰å¯èƒ½æœ‰ç©ºæ ¼æˆ–æ ‡ç‚¹ï¼Œæ‰€ä»¥ yw ä¼šæŠŠè¿™äº›å¤šä½™çš„é—´éš”ä¹Ÿå¤åˆ¶è¿›å»ã€‚ guï¼šæŠŠæ–‡æœ¬å˜æˆå°å†™ï¼ˆlowercaseï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªä¸¤ä¸ªé”®ç»„æˆçš„ operatorï¼Œä¾‹å¦‚ guiw èƒ½æŠŠä¸€ä¸ªè¯å˜æˆå…¨å°å†™ï¼ˆå…¶ä¸­æ–‡æœ¬å¯¹è±¡ iw ä¼šåœ¨åé¢è®²è§£ï¼‰ã€‚ gUï¼šæŠŠæ–‡æœ¬å˜æˆå¤§å†™ï¼ˆuppercaseï¼‰ã€‚ä¾‹å¦‚ gUiw èƒ½æŠŠä¸€ä¸ªè¯å˜æˆå…¨å¤§å†™ã€‚ \u0026gt;ï¼šå‘å³ç¼©è¿›ä¸€ä¸ª tab çš„è·ç¦»ã€‚é»˜è®¤ä½œç”¨äºè¡Œï¼Œæ‰€ä»¥å³ä¾¿æ˜¯ \u0026gt;w ä¹Ÿä¼šä½¿æ•´è¡Œå‘å³ç¼©è¿›ã€‚ä¸€ä¸ªæ¯”è¾ƒæœ‰ç”¨çš„ä¾‹å­æ˜¯ \u0026gt;ip æˆ– \u0026gt;apï¼Œè¡¨ç¤ºä½¿æ•´ä¸ªæ®µè½å‘å³ç¼©è¿›ã€‚ \u0026lt;ï¼šå‘å·¦ç¼©è¿›ä¸€ä¸ª tab çš„è·ç¦»ã€‚ç”¨æ³•åŒ \u0026gt;ã€‚  å•ä¸ª operator åé¢å¿…é¡»æ¥ä¸€ä¸ªåè¯æ‰èƒ½èµ·ä½œç”¨ã€‚ä½†å½“ operator çš„æŒ‰é”®è¢«é‡å¤ä¸¤æ¬¡æ—¶ï¼Œå°±å¯ä»¥çœå»åè¯ï¼Œæ­¤æ—¶è¡¨ç¤ºä½œç”¨äºå…‰æ ‡æ‰€å¤„çš„è¿™ä¸€è¡Œã€‚ä¾‹å¦‚ dd è¡¨ç¤ºåˆ é™¤å½“å‰è¡Œï¼Œyy è¡¨ç¤ºå¤åˆ¶å½“å‰è¡Œï¼Œ\u0026gt;\u0026gt; è¡¨ç¤ºå½“å‰è¡Œå‘å³ç¼©è¿›ã€‚æ­¤å¤–ä¹Ÿå¯ä»¥åŠ ä¸Šé‡å¤æ¬¡æ•°ï¼Œä¾‹å¦‚ 3dd è¡¨ç¤ºåˆ é™¤ä»å½“å‰è¡Œå¼€å§‹å¾€ä¸‹å…± 3 è¡Œã€‚\nä½œä¸ºå¯¹ y çš„è¡¥å……ï¼Œæä¸€ä¸‹å¹¶é operator çš„ç²˜è´´å‘½ä»¤ pï¼šå°å†™çš„ p è¡¨ç¤ºåœ¨å½“å‰å…‰æ ‡å·¦è¾¹ï¼ˆå½“å‰è¡Œä¸Šé¢ï¼‰ç²˜è´´å­—ç¬¦ï¼ˆè¡Œï¼‰ï¼Œè€Œå¤§å†™çš„ P è¡¨ç¤ºåœ¨å½“å‰å…‰æ ‡å³è¾¹ï¼ˆå½“å‰è¡Œä¸‹é¢ï¼‰ç²˜è´´å†…å®¹ï¼ˆè¡Œï¼‰ã€‚\nå¸¸ç”¨çš„ motion Motion æœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„å±æ€§éœ€è¦é¢„å…ˆè¯´æ˜ä¸€ä¸‹ã€‚\né¦–å…ˆï¼Œè‹¥ motion çš„ç§»åŠ¨å‘ç”Ÿåœ¨è¡Œä¸è¡Œä¹‹é—´ï¼Œå°±ç§°å…¶æ˜¯ linewise çš„ï¼›è‹¥ç§»åŠ¨å‘ç”Ÿåœ¨å­—ç¬¦é—´ï¼Œå°±ç§°å…¶æ˜¯ characterwise çš„ã€‚ä¾‹å¦‚ j å’Œ k å°±æ˜¯ linewise çš„ï¼Œè€Œ w æ˜¾ç„¶æ˜¯ characterwise çš„ã€‚\nå…¶æ¬¡ï¼Œmotion è¿˜æ‹¥æœ‰ä¸€ä¸ªèƒ½å½±å“åˆ°å…¶ä½œç”¨èŒƒå›´çš„å¼€é—­æ€§ã€‚ä»¥ä¸€ä¸ª characterwise motion ä¸ºä¾‹ï¼Œè‹¥ operator + motion ç»„åˆçš„ä½œç”¨èŒƒå›´ä¸åŒ…å« motion ç§»åŠ¨èŒƒå›´çš„å³è¾¹ç•Œï¼Œåˆ™ç§°è¿™ä¸ª motion æ˜¯ exclusive çš„ï¼Œåä¹‹åˆ™ç§°ä¸º inclusive çš„ã€‚å¯¹ linewise motion åŒç†ï¼Œæ ¹æ®å¥å­çš„ä½œç”¨èŒƒå›´æ˜¯å¦åŒ…å« motion ç§»åŠ¨èŒƒå›´çš„ä¸‹è¾¹ç•Œï¼ˆå³æœ€åä¸€è¡Œï¼‰æ¥å†³å®šå¼€é—­æ€§ï¼Œä¸è¿‡ä¸€èˆ¬ linewise motion éƒ½æ˜¯ inclusive çš„ã€‚ä¾‹å¦‚å¸¸ç”¨çš„ w å°±æ˜¯ä¸€ä¸ª exclusive motionï¼Œå•ç‹¬ä½¿ç”¨å®ƒä¼šå°†å…‰æ ‡è·³åˆ°ä¸‹ä¸ªè¯çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¤„ï¼Œä½† dw å´ä¼šç‚¹åˆ°ä¸ºæ­¢ï¼Œåˆšåˆšå¥½åˆ é™¤åˆ°é‚£ä¸ªå­—ç¬¦ä¹‹å‰ã€‚å†æ¯”å¦‚ j å’Œ k éƒ½æ˜¯ linewise motionï¼Œdj ä¼šåˆ é™¤å½“å‰è¡Œå’Œä¸‹ä¸€è¡Œï¼Œdk ä¼šåˆ é™¤å½“å‰è¡Œå’Œä¸Šä¸€è¡Œã€‚\nè¿™é‡Œææ€•æœ‰ç‚¹ç»•ï¼Œæ‰€ä»¥ç”¨å›¾å±•ç¤ºä¸€ä¸‹\nå…¶ä¸­ç»¿è‰²æ–¹å—æ˜¯ block å½¢å¼çš„å…‰æ ‡ï¼Œå•å‘ç®­å¤´æ˜¯ motion çš„èµ·æ­¢ç‚¹ï¼ŒèŠ±æ‹¬å·æŒ‡ç¤ºå¥å­çš„ä½œç”¨èŒƒå›´ã€‚å¯è§å¯¹äº exclusive çš„ motion æ¥è¯´ï¼Œç§»åŠ¨çš„èµ·æ­¢ç‚¹å›´æˆçš„èŒƒå›´å’Œå¥å­çš„ä½œç”¨èŒƒå›´æ€»æ˜¯ç›¸å·®ä¸€ä¸ªå³è¾¹ç•Œå­—ç¬¦ï¼›è€Œå¯¹ inclusive çš„ motion æ¥è¯´ï¼Œä¸¤ç§èŒƒå›´æ˜¯ç›¸åŒçš„ã€‚\nVim ä¸­ motion ç›¸å½“å¤šï¼Œä¸ä¿¡å¯ä»¥çœ‹çœ‹æœ¬æ–‡å¤´å›¾ä¸­çš„ç»¿è‰²æŒ‰é”®æœ‰å¤šå°‘ã€‚è¿™é‡Œä»…ä»‹ç»å¸¸ç”¨çš„å‡ ä¸ªï¼š\n hjklï¼šä¸Šä¸‹å·¦å³ç§»åŠ¨ï¼Œå…¶ä¸­ j å’Œ k æ˜¯ linewise å’Œ inclusive çš„ï¼Œè€Œ h å’Œ l æ˜¯ characterwise å’Œ exclusive çš„ã€‚æ‰€ä»¥ dl åªä¼šåˆ é™¤å½“å‰å…‰æ ‡å¤„çš„å­—ç¬¦ï¼Œç­‰ä»·äº xï¼›è€Œ dh ä¼šåˆ é™¤å½“å‰å…‰æ ‡å·¦è¾¹çš„ä¸€ä¸ªå­—ç¬¦ã€‚ w å’Œ Wï¼šè·³åˆ°ä¸‹ä¸€ä¸ªè¯çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¤„ï¼Œæ˜¯ exclusive çš„ã€‚å¤§å°å†™çš„åŒºåˆ«åœ¨äºï¼Œå°å†™å½¢å¼ä½œç”¨äº wordï¼Œå¤§å†™å½¢å¼ä½œç”¨äº WORDï¼ˆå…¶ä¸­æ–‡æœ¬å¯¹è±¡ word å’Œ WORD ä¼šåœ¨åé¢è®²è§£ï¼‰ã€‚ b å’Œ Bï¼šè·³åˆ°ä¸Šä¸€ä¸ªè¯çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¤„ï¼Œæ˜¯ exclusive çš„ã€‚ e å’Œ Eï¼šè·³åˆ°ä¸‹ä¸€ä¸ªè¯çš„æœ€åä¸€ä¸ªå­—ç¬¦å¤„ï¼Œæ˜¯ inclusive çš„ã€‚ ge å’Œ gEï¼šè·³åˆ°ä¸Šä¸€ä¸ªè¯çš„æœ€åä¸€ä¸ªå­—ç¬¦å¤„ï¼Œæ˜¯ inclusive çš„ã€‚ 0ã€^ å’Œ $ï¼š0 è¡¨ç¤ºç§»åŠ¨åˆ°æœ¬è¡Œçš„ç¬¬ä¸€åˆ—ï¼Œ^ è¡¨ç¤ºç§»åŠ¨åˆ°æœ¬è¡Œç¬¬ä¸€ä¸ªéç©ºç™½å­—ç¬¦å¤„ï¼Œè€Œ $ è¡¨ç¤ºç§»åŠ¨åˆ°æœ¬è¡Œçš„æœ€åä¸€åˆ—ã€‚å…¶ä¸­ 0 å’Œ ^ æ˜¯ exclusive çš„ï¼Œè€Œ $ æ˜¯ inclusive çš„ã€‚ä¸”åªæœ‰ $ å‰å¯ä»¥åŠ æ•°å­—ï¼Œè¡¨ç¤ºç§»åŠ¨åˆ°ä»å½“å‰è¡Œå¼€å§‹ä¸‹é¢ç¬¬ n è¡Œçš„æœ«å°¾ã€‚ f å’Œ Fï¼šå–è‡ª findï¼Œåœ¨æœ¬è¡Œæœç´¢æŒ‡å®šçš„å­—ç¬¦å¹¶å°†å…‰æ ‡ç§»åŠ¨è¿‡å»ã€‚ä»¥å½“å‰å…‰æ ‡ä¸ºèµ·ç‚¹ï¼Œå°å†™çš„ f è¡¨ç¤ºå‘åæœç´¢ï¼Œå¤§å†™çš„ F è¡¨ç¤ºå‘å‰æœç´¢ï¼Œå‰è€…æ˜¯ inclusive çš„ï¼Œä½†åè€…å´æ˜¯ exclusive çš„ã€‚f åå¿…é¡»æ¥ç›®æ ‡å­—ç¬¦ï¼Œä¾‹å¦‚ fa ä¼šè·³åˆ°å½“å‰å…‰æ ‡åç¬¬ä¸€æ¬¡å‡ºç°å­—ç¬¦ a çš„ä½ç½®ï¼Œè€Œ 2fa åˆ™ä¼šè·³åˆ°ç¬¬äºŒæ¬¡å‡ºç°çš„ä½ç½®ã€‚è‹¥æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™å…‰æ ‡ä¸ä¼šå‘ç”Ÿç§»åŠ¨ã€‚ t å’Œ Tï¼šå–è‡ª tillï¼ŒåŸºæœ¬åŒ f å’Œ Fï¼Œä½†ä¼šæ°å¥½åœåœ¨æœç´¢ç»“æœå‰ã€‚ä¾‹å¦‚ ta ä¼šè·³åˆ° fa ç»ˆç‚¹çš„å‰é¢ä¸€æ ¼ï¼Œæ‰€ä»¥ä½•æ—¶ä½¿ç”¨ f æˆ– t å–å†³äºæˆ‘ä»¬å¯¹è¾¹ç•Œçš„å¤„ç†ã€‚ ;ï¼šé‡å¤ä¸Šä¸€ä¸ª fã€Fã€t æˆ– T çš„ç§»åŠ¨ã€‚ä¾‹å¦‚å½“æœ¬è¡Œæœ‰ä¸‰ä¸ª a å­—æ¯æ—¶ï¼Œfa ä¼šä½¿å…‰æ ‡è·³åˆ°ç¬¬ä¸€ä¸ª a ä¸Šï¼Œæ­¤æ—¶æŒ‰ä¸‹ ; ä¾¿ç›¸å½“äºé‡å¤äº† fa çš„æ“ä½œï¼Œè·³åˆ°ç¬¬äºŒä¸ª a ä¸Šï¼Œå†æŒ‰åˆä¼šè·³åˆ°æœ€åä¸€ä¸ª a ä¸Šã€‚ ,ï¼šç±»ä¼¼äº ;ï¼Œä¸è¿‡æ˜¯æŒ‰åæ–¹å‘ç§»åŠ¨ã€‚è¿˜æ˜¯ä¸‰ä¸ª a çš„ä¾‹å­ï¼ŒæŒ‰ , ä¼šè·³å›ä¸Šä¸€ä¸ª a çš„ä½ç½®ã€‚ { å’Œ }ï¼šè·³åˆ°ä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ªæ®µè½è¾¹ç•Œï¼ˆå³ç©ºè¡Œï¼‰ï¼Œæ˜¯ exclusive çš„ã€‚ Gï¼šè‹¥å‰é¢åŠ æ•°å­—ï¼Œè¡¨ç¤ºè·³åˆ°æŒ‡å®šè¡Œï¼›è‹¥ä¸åŠ æ•°å­—åˆ™è¡¨ç¤ºè·³åˆ°æœ€åä¸€è¡Œï¼Œä¸”æ˜¯ linewise å’Œ inclusive çš„ã€‚ä¾‹å¦‚ dG è¡¨ç¤ºåˆ é™¤å½“å‰è¡Œåˆ°æœ€åä¸€è¡Œçš„å…¨éƒ¨å†…å®¹ï¼Œd2G è¡¨ç¤ºåˆ é™¤å½“å‰è¡Œåˆ°ç¬¬äºŒè¡Œçš„å…¨éƒ¨å†…å®¹ã€‚ ggï¼šåŠ æ•°å­—æ—¶çš„è¡Œä¸ºåŒ Gï¼Œä½†ä¸åŠ æ•°å­—æ—¶åˆ™è¡¨ç¤ºè·³åˆ°ç¬¬ä¸€è¡Œã€‚ä¾‹å¦‚ dgg è¡¨ç¤ºåˆ é™¤å½“å‰è¡Œåˆ°ç¬¬ä¸€è¡Œçš„å…¨éƒ¨å†…å®¹ï¼Œç­‰ä»·äº d1G å’Œ d1ggã€‚  å¸¸ç”¨çš„ text object ç¬¬ä¸€èŠ‚æè¿‡\ntext-object = modifier + object\r å…¶ä¸­ä¿®é¥°è¯å®é™…ä¸Šåªæœ‰ä¸¤ä¸ªï¼ši å’Œ aï¼Œå­—é¢ä¹‰åˆ†åˆ«æ˜¯å•è¯ inner å’Œå† è¯ aï¼Œä½†å…·ä½“æ•ˆæœéœ€è¦ç»“åˆ object æ¥çœ‹ã€‚æ‰€ä»¥ç°åœ¨æ¥ä»‹ç»å¸¸ç”¨çš„ objectï¼š\n wordï¼šVim ä¸­æŠŠç”±å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿ç­‰éç©ºç™½å­—ç¬¦æ„æˆçš„å­—ç¬¦åºåˆ—ç§°ä¸º wordï¼Œword ä¹‹é—´ç”±ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨å’Œæ¢è¡Œï¼‰æˆ–æ ‡ç‚¹ç¬¦å·åˆ†éš”ã€‚åœ¨å‘½ä»¤ä¸­ç”¨ w è¡¨ç¤ºã€‚iw ä»…è¡¨ç¤ºä¸€ä¸ª word å«æœ‰çš„æ‰€æœ‰å­—ç¬¦ï¼Œè€Œ aw è¿˜ä¼šé¢å¤–åŒ…å«å‰åçš„ç©ºç™½å­—ç¬¦ï¼Œå¹¶ä¸”å½“å‰åéƒ½æœ‰ç©ºç™½æ—¶åˆ™åªåŒ…å«åé¢çš„ç©ºç™½ã€‚è‹¥å…‰æ ‡çš„èµ·å§‹ä½ç½®å°±æ˜¯åœ¨ word å‰åçš„ç©ºç™½ä¸Šï¼Œaw çš„èŒƒå›´åˆä¼šå‘ç”Ÿå˜åŒ–â€”â€”è¿™é‡Œå°±ä¸ç»†è®²äº†ï¼Œçƒ¦è¯·è¯»è€…è‡ªå·±å°è¯•ä¸€ä¸‹ã€‚ WORDï¼šæ¡ä»¶æ›´å®½æ¾çš„ wordï¼Œåªè¦æ˜¯éç©ºç™½å­—ç¬¦çš„åºåˆ—éƒ½èƒ½ç®—æ˜¯ä¸€ä¸ªè¯ã€‚ä¾‹å¦‚ apple,banana ç®—æ˜¯ä¸¤ä¸ª wordï¼Œä½†åªèƒ½ç®—ä¸€ä¸ª WORDã€‚åœ¨å‘½ä»¤ä¸­ç”¨å¤§å†™çš„ W è¡¨ç¤ºã€‚ paragraphï¼šå³è§†è§‰ä¸Šè¡Œä¸è¡Œç›¸è¿çš„æ•´æ®µæ–‡æœ¬ï¼Œæ®µè½ä¹‹é—´ä¸€èˆ¬é€šè¿‡ç©ºè¡Œï¼ˆå¯å«ç©ºç™½å­—ç¬¦ï¼‰åˆ†éš”ã€‚åœ¨å‘½ä»¤ä¸­ç”¨ p è¡¨ç¤ºã€‚ip è¡¨ç¤ºä»…ä½œç”¨äºæ®µè½çš„æ‰€æœ‰è¡Œï¼Œè€Œ ap ç±»ä¼¼äº awï¼Œä¼šé¢å¤–åŒ…å«å‰åçš„ç©ºè¡Œã€‚ æ‹¬å·ï¼šè¡¨ç¤ºæ‹¬å·åœˆèµ·æ¥çš„æ–‡æœ¬å—ï¼ˆå¯ä»¥åˆ†è¡Œï¼‰ï¼Œåœ†æ‹¬å·ã€æ–¹æ‹¬å·å’ŒèŠ±æ‹¬å·ç­‰çš†å¯ã€‚è¿™é‡Œä»¥åœ†æ‹¬å·ä¸ºä¾‹ï¼Œåœ¨å‘½ä»¤ä¸­ç”¨ ( æˆ– ) è¡¨ç¤ºã€‚i( ä»…è¡¨ç¤ºæ‹¬å·å†…çš„æ–‡æœ¬ï¼Œè€Œ a( åˆ™ä¼šåŒ…å«æ‹¬å·æœ¬èº«ã€‚ä¾‹å¦‚ di( å’Œ ci( å°±æ˜¯éå¸¸å®ç”¨çš„ä¸¤ä¸ªç»„åˆå‘½ä»¤ã€‚ å¼•å·ï¼šè¡¨ç¤ºå¼•å·åœˆèµ·æ¥çš„æ–‡æœ¬ï¼Œå•å¼•å·å’ŒåŒå¼•å·çš†å¯ï¼Œå¯æƒœåªé™äºæœ¬è¡Œã€‚ä»¥åŒå¼•å·ä¸ºä¾‹ï¼Œi\u0026quot; ä»…è¡¨ç¤ºå¼•å·å†…çš„æ–‡æœ¬ï¼Œè€Œ a\u0026quot; åˆ™ä¼šåŒ…å«å¼•å·æœ¬èº«ä»¥åŠå¼•å·å‰åçš„ç©ºç™½ã€‚åŒæ · di\u0026quot; å’Œ ci\u0026quot; éå¸¸ä¾¿äºä¿®æ”¹ç¨‹åºä¸­å­—ç¬¦ä¸²çš„å†…å®¹ã€‚  ç»“è¯­ çœ‹åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥èƒ½ä¸€çª¥ Vim çš„é­”åŠ›äº†å§â€”â€”èµ‹äºˆæ¨¡ç³Šä¸æ¸…çš„æ“ä½œä»¥åå­—ï¼Œå†æŒ‰éŸµå¾‹åŸå”±è¿™äº›åå­—ï¼Œé­”æ³•å°±ä¼šå‡ºç°ã€‚å¦‚æœå†åŠ ä¸Š . å‘½ä»¤å’Œå®çš„é…æ–¹ï¼Œæ›´æ˜¯èƒ½è®©é­”æ³•è‡ªåŠ¨ç”Ÿå‡ºæ›´å¤šé­”æ³•ï¼Œå¯æƒœæˆ‘ä¹Ÿåªæ˜¯åˆšå…¥é—¨çš„å­¦å¾’ï¼Œä»¥åæœ‰æœºä¼šå†æ¥ä»‹ç»æ›´å¤šã€‚æ–‡ä¸­å­˜åœ¨çš„ä¸å¦¥ä¹‹å¤„è¿˜è¯·è¯»è€…å¤šå¤šæŒ‡å‡ºã€‚\nå‚è€ƒé“¾æ¥ VIM ä¸­æ–‡å¸®åŠ©ï¼šæœ‰å…³ç§»åŠ¨çš„å‘½ä»¤\nVim Grammar\nLearn-Vim Ch04. Vim Grammar\nVimç»ˆææŒ‡å—ï¼šæ‰€æ€å³æ‰€å¾—\n","date":"2021-10-17","permalink":"https://zhajiman.github.io/post/vim_grammar/","tags":["vim"],"title":"Vim çš„è¯­æ³•"},{"content":"å‰è¨€ è¿™å‡ å¤©è¦ç”¨ NumPy ç”Ÿæˆéšæœºæ•°ï¼Œæ‰€ä»¥å»æŸ¥äº†ä¸€ä¸‹ np.random æ¨¡å—çš„å®˜æ–¹æ–‡æ¡£ï¼Œå´æƒŠè®¶åœ°å‘ç°é‡Œé¢ä»‹ç»çš„ç”¨æ³•è·Ÿæˆ‘çš„è®°å¿†æœ‰å¾ˆå¤§å‡ºå…¥ï¼šä¾‹å¦‚ä»¥å‰ç”¨ np.random.rand ä¾¿èƒ½ç”Ÿæˆ [0, 1) ä¹‹é—´å‡åŒ€åˆ†å¸ƒçš„éšæœºæ•°ï¼Œç°åœ¨æ–‡æ¡£é‡Œè®°è½½çš„å´æ˜¯é¢å‘å¯¹è±¡é£æ ¼çš„å†™æ³•ï¼ˆåˆ›å»ºéšæœºæ•°ç”Ÿæˆå™¨å†è°ƒç”¨æ–¹æ³•â€¦â€¦ï¼‰ã€‚è°ƒæŸ¥ä¸€ç•ªåå‘ç°åŸæ¥è¿™ä¸€æ”¹åŠ¨å‘ç”Ÿäº NumPy 1.17 ç‰ˆæœ¬ï¼ˆ2020 å¹´ 1 æœˆï¼‰ï¼Œå¹¶ä¸”ç½‘ä¸Šå¯¹æ­¤çš„ä¸­æ–‡ä»‹ç»ä¹Ÿæ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥ç°æ’°æ–‡ç®€å•ä»‹ç»ä¸€ä¸‹è¯¥æ¨¡å—åœ¨æ”¹åŠ¨å‰åçš„ä¸¤å¥—ç”¨æ³•ã€‚\nåŸç† å…ˆæ¦‚æ‹¬ä¸€ä¸‹è®¡ç®—æœºç”Ÿæˆéšæœºæ•°çš„åŸç†ï¼Œæ–¹ä¾¿åé¢ç†è§£ç¨‹åºçš„è¡Œä¸ºã€‚æˆ‘ä»¬å…ˆç»™å®šä¸€ä¸ªç”¨æ•´æ•°è¡¨ç¤ºçš„éšæœºç§å­ï¼ˆseedï¼‰ï¼Œç„¶åè®¡ç®—æœºä¼šæ ¹æ®ç‰¹å®šçš„ç®—æ³•ï¼ˆå¹³æ–¹å–ä¸­ã€çº¿æ€§åŒä½™ç­‰â€¦â€¦ï¼‰å¯¹è¿™ä¸ªç§å­ä¸æ–­è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°ä¸€ä¸²æ•°å­—åºåˆ—ã€‚ç”±äºè¾“å…¥æ˜¯ç¡®å®šçš„ï¼Œç®—æ³•çš„æ­¥éª¤ä¹Ÿæ˜¯å®Œå…¨å›ºå®šçš„ï¼Œæ‰€ä»¥ç»“æœä¹Ÿæ˜¯å”¯ä¸€ç¡®å®šçš„â€”â€”å³ä¸€ä¸ªç§å­å¯¹åº”ä¸€ä¸ªåºåˆ—ã€‚è¿™ä¸ªåºåˆ—è™½ç„¶æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œä½†å®ƒæœ¬èº«ä¸çœŸå®ä¸–ç•Œä¸­éšæœºè¿‡ç¨‹äº§ç”Ÿçš„åºåˆ—å¾ˆç›¸ä¼¼ï¼Œåºåˆ—ä¸­çš„æ¯ä¸ªæ•°å­—åƒæ˜¯éšæœºå‡ºç°çš„ï¼Œä¸”åˆ†å¸ƒæ¥è¿‘äºå‡åŒ€åˆ†å¸ƒã€‚äºæ˜¯æˆ‘ä»¬ä¾¿æŠŠè¿™ä¸ªç®—æ³•ç”Ÿæˆçš„â€œä¼ªéšæœºåºåˆ—â€å½“ä½œéšæœºåºåˆ—æ¥ç”¨ï¼Œå†æ ¹æ®éœ€æ±‚é€šè¿‡æ•°å­¦å˜æ¢æŠŠå‡åŒ€åˆ†å¸ƒçš„éšæœºåºåˆ—å˜æ¢ä¸ºå…¶å®ƒæ¦‚ç‡åˆ†å¸ƒçš„éšæœºåºåˆ—ã€‚\nä¸è¿‡è¿™ä¸€åšæ³•çš„ç¼ºé™·æ˜¯ï¼Œè‹¥ç§å­ä¸å˜ï¼Œé‚£ä¹ˆæ¯æ¬¡ç”Ÿæˆçš„éšæœºåºåˆ—æ€»æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œç”šè‡³è¿˜å¯ä»¥ä»åºåˆ—çš„æ’åˆ—è§„å¾‹ä¸­åæ¨å‡ºç§å­çš„å€¼ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ç”¨æ“ä½œç³»ç»Ÿçš„æ—¶é—´æˆ³æˆ–ç†µæ± ï¼ˆç³»ç»Ÿæ”¶é›†çš„å„ä¸ªè®¾å¤‡çš„ç¯å¢ƒå™ªéŸ³ï¼‰ä¿¡æ¯ä½œä¸ºç§å­ï¼Œä»¥ä¿è¯æ¯æ¬¡è¿è¡Œéƒ½äº§ç”Ÿä¸åŒçš„ç»“æœã€‚\næ›´è¯¦ç»†çš„è§£è¯´è¯·å‚è€ƒ æ··ä¹±ä¸­çš„ç§©åºâ€”â€”è®¡ç®—æœºä¸­çš„ä¼ªéšæœºæ•°åºåˆ— è¿™ç¯‡çŸ¥ä¹ä¸“æ ã€‚æˆ‘ä»¬å°†ä¼šçœ‹åˆ°ï¼Œæ— è®ºæ˜¯æ—§ç‰ˆè¿˜æ˜¯æ–°ç‰ˆï¼Œnumpy.random æ¨¡å—éƒ½æ˜¯æŒ‰ç…§è¿™ä¸€èŠ‚çš„æµç¨‹æ¥ç”Ÿæˆéšæœºæ•°çš„ã€‚\næ—§ç‰ˆæœ¬ RandomState è™½ç„¶æˆ‘ä»¬å¸¸ç”¨çš„æ˜¯ np.random.rand è¿™æ ·çš„å‡½æ•°å‘½ä»¤ï¼Œä½†è¦æŠŠç”¨æ³•è®²æ¸…æ¥šï¼Œè¿˜æ˜¯éœ€è¦ä» RandomState ç±»å¼€å§‹ã€‚RandomState æ˜¯ np.random æ¨¡å—ä¸­è¡¨ç¤ºéšæœºæ•°ç”Ÿæˆå™¨çš„ç±»ï¼Œå†…éƒ¨é‡‡ç”¨ Mersenne Twister ç®—æ³•çš„ MT19937 å®ç°æ¥ç”Ÿæˆä¼ªéšæœºåºåˆ—ï¼ˆç®—æ³•åŸç†åœ¨å‰é¢æåˆ°çš„ä¸“æ ä¸­æœ‰ä»‹ç»ï¼‰ã€‚åœ¨åˆ›å»ºå¯¹è±¡æ—¶éœ€è¦æŒ‡å®šéšæœºç§å­ï¼Œç„¶åé€šè¿‡è°ƒç”¨æ–¹æ³•æ¥ç”Ÿæˆå…¶å®ƒæ¦‚ç‡åˆ†å¸ƒçš„éšæœºæ•°ï¼Œä¾‹å¦‚\nimport numpy as np\rfrom numpy.random import RandomState\rseed = 0\rrs = RandomState(seed)\r# ç”Ÿæˆ3ä¸ª[0,1)èŒƒå›´å†…å‡åŒ€åˆ†å¸ƒçš„éšæœºæ•°\rprint(rs.rand(3))\r# ç”Ÿæˆ3ä¸ªæœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„éšæœºæ•°\rprint(rs.randn(3))\r ç§å­å¯ä»¥æ˜¯ä¸€ä¸ªå¤§äºç­‰äº 0 çš„æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿™æ ·çš„æ•´æ•°æ„æˆçš„ä¸€ç»´åºåˆ—ã€‚æ— è®ºç§å­æ˜¯å“ªç§å½¢å¼ï¼Œåªè¦æ¯æ¬¡ç»™å®šç›¸åŒçš„ç§å­ï¼Œé‚£ä¹ˆéšæœºæ•°ç”Ÿæˆå™¨éƒ½ä¼šç”Ÿæˆç›¸åŒçš„éšæœºåºåˆ—ï¼Œè°ƒç”¨æ–¹æ³•æ—¶ä¼šä¸æ–­ä»è¿™ä¸ªåºåˆ—ä¸­æŠ½å–æ•°å­—æ¥è¿›è¡Œå˜æ¢ï¼Œè¿›è€Œç”Ÿæˆç›¸åŒçš„éšæœºæ•°ã€‚ä¾‹å¦‚\n# ç”Ÿæˆä¸‰ä¸ª[0,10]èŒƒå›´å†…çš„éšæœºæ•´æ•°\rrs1 = RandomState(1)\rprint('seed=1:', rs1.randint(0, 11, 6))\rrs2 = RandomState(1)\rprint('seed=1:', rs2.randint(0, 11, 3), rs2.randint(0, 11, 3))\rrs3 = RandomState(2)\rprint('seed=2:', rs3.randint(0, 11, 6))\r ç»“æœä¸º\nseed=1: [5 8 9 5 0 0]\rseed=1: [5 8 9] [5 0 0]\rseed=2: [8 8 6 2 8 7]\r å¯ä»¥çœ‹åˆ°å½“ç§å­éƒ½ä¸º 1 æ—¶ï¼Œä¸¤ä¸ªä¸åŒçš„ RandomState å¯¹è±¡ç”Ÿæˆçš„éšæœºæ•°ç›¸åŒï¼ˆå°½ç®¡ rs2 è°ƒç”¨äº†ä¸¤æ¬¡æ–¹æ³•ï¼‰ï¼›ä½†å½“ç§å­ä¸º 2 æ—¶ï¼Œç»“æœä¾¿å‘ç”Ÿäº†å˜åŒ–ã€‚ä¸‹é¢å†ä¸¾ä¸€ä¸ªç”¨æ—¶é—´æˆ³ä½œä¸ºç§å­çš„ä¾‹å­\nimport time\rseed = int(time.time())\rrs = RandomState(seed)\rfor _ in range(3):\rprint(rs.randint(0, 11, 3))\r æ³¨æ„ä¸è¦æŠŠè®¾ç½®ç§å­çš„è¯­å¥å†™åœ¨å¾ªç¯é‡Œï¼Œå› ä¸ºå–æ•´åçš„æ—¶é—´æˆ³çš„é—´éš”åªæœ‰ 1 ç§’ï¼Œè€Œå¾ªç¯ä¸€æ¬¡çš„é€Ÿåº¦ä¸€èˆ¬è¿œå¿«äº 1 ç§’ï¼Œè¿™å°±å¯¼è‡´å¾ªç¯å†…ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ªç§å­ï¼Œæœ€åäº§ç”Ÿä¸‰ç»„ä¸€æ¨¡ä¸€æ ·çš„éšæœºæ•°ã€‚å…¶å®ï¼Œåœ¨åˆ›å»º RandomState å¯¹è±¡æ—¶å¦‚æœä¸ç»™å‡ºç§å­ï¼ˆå³é»˜è®¤çš„ seed=Noneï¼‰ï¼Œé‚£ä¹ˆç¨‹åºä¼šè‡ªåŠ¨åˆ©ç”¨ç†µæ± å’Œæ—¶é—´ä¿¡æ¯æ¥ç¡®å®šç§å­çš„å€¼ã€‚æ‰€ä»¥æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œå¦‚æœä½ éœ€è¦ç¨‹åºç»“æœæ˜¯å¯å¤ç°çš„ï¼ˆreproducibleï¼‰ï¼Œé‚£ä¹ˆä½¿ç”¨å›ºå®šç§å­å³å¯ï¼›å¦‚æœä½ éœ€è¦æ¯æ¬¡éƒ½ä½¿ç”¨ä¸åŒçš„éšæœºæ•°ï¼Œé‚£ä¹ˆå¤§èƒ†å†™ä¸Š rs = RandomState() å³å¯ã€‚\nä¸‹é¢ç”¨è¡¨æ ¼æ€»ç»“ä¸€ä¸‹ RandomState å¯¹è±¡å¸¸ç”¨çš„æ–¹æ³•\n   æ–¹æ³• æ•ˆæœ     rand ç”Ÿæˆ [0, 1) èŒƒå›´å†…å‡åŒ€åˆ†å¸ƒçš„æµ®ç‚¹éšæœºæ•°ã€‚æœ¬è´¨æ˜¯ random_sample åŒ…è£…åçš„ç‰ˆæœ¬ã€‚   randint ç”Ÿæˆ [low, high) èŒƒå›´å†…ç¦»æ•£å‡åŒ€åˆ†å¸ƒçš„æ•´å‹éšæœºæ•°ã€‚   randn ç”Ÿæˆæœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„éšæœºæ ·æœ¬ã€‚å¯¹äºæ›´ä¸€èˆ¬çš„æ­£æ€åˆ†å¸ƒå¯ä»¥ä½¿ç”¨ normal æ–¹æ³•ã€‚   choice å¯¹ç»™å®šçš„ä¸€ç»´æ•°ç»„è¿›è¡ŒéšæœºæŠ½æ ·ã€‚    è°ƒç”¨å‡½æ•° å¯¹æˆ‘ä»¬æ›´ä¸ºç†Ÿæ‚‰çš„å¯èƒ½æ˜¯ç›´æ¥è°ƒç”¨å‡½æ•°çš„ç”¨æ³•ï¼Œä¾‹å¦‚\nnp.random.seed(1)\rprint(np.random.rand(3))\rprint(np.random.randint(0, 11, 3))\rprint(np.random.randn(3))\r å¤§å®¶å¾ˆå®¹æ˜“çœ‹å‡ºå…¶ç”¨æ³•ä¸ä¸Šä¸€èŠ‚å¤§å·®ä¸å·®ï¼Œæ‰€ä»¥å°±ä¸è¯¦ç»†è§£è¯´äº†ã€‚è”ç³»åœ¨äºï¼Œé¦–æ¬¡è°ƒç”¨å‡½æ•°æ—¶ï¼ŒNumPy ä¼šå·å·åœ¨å…¨å±€åˆ›å»ºä¸€ä¸ª RandomState å¯¹è±¡ï¼Œç„¶åç”¨è¿™ä¸ªå¯¹è±¡æ¥ç”Ÿæˆéšæœºæ•°ï¼Œä½œä¸ºè¿™äº›å‡½æ•°çš„è¿”å›å€¼ã€‚æ‰€ä»¥è°ƒç”¨å‡½æ•°åªæ˜¯ä¸€ç§å·æ‡’ï¼ˆhandyï¼‰çš„ç”¨æ³•ç½¢äº†ã€‚è¿™ç§ç”¨æ³•çš„ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œå¦‚æœä»£ç ä¸­æœ‰åœ°æ–¹æ”¹åŠ¨äº†ç§å­ï¼Œä¼šå½±å“å…¨å±€çš„éšæœºæ•°ç»“æœï¼Œæ›´åˆ«è¯´åœ¨å¹¶è¡Œæ—¶è¿˜å¯èƒ½å‡ºç°åŒæ—¶ä¿®æ”¹ç§å­çš„æƒ…å†µã€‚å°½ç®¡æœ‰ç€æ˜æ˜¾çš„ç¼ºç‚¹ï¼Œä½†åœ¨ np.random æ¨¡å—å¤§æ”¹ä¹‹å‰ï¼Œå®˜æ–¹æ–‡æ¡£å’Œå„è·¯æ•™ç¨‹éƒ½ä¸»æ¨è¿™ä¸€ç”¨æ³•ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶éœ€è¦å¤šåŠ å°å¿ƒã€‚\næ–°ç‰ˆæœ¬ 1.17 ç‰ˆæœ¬å‰ np.random ä¸­å­˜åœ¨é¢å‘å¯¹è±¡å’Œè°ƒç”¨å‡½æ•°ä¸¤ç§ç”¨æ³•ï¼Œè€Œ 1.17 ç‰ˆæœ¬ååˆ™ç»Ÿä¸€ä½¿ç”¨æ–°çš„é¢å‘å¯¹è±¡å¼çš„ç”¨æ³•ï¼Œå¹¶åœ¨åŠŸèƒ½å’Œæ€§èƒ½æ–¹é¢ä½œå‡ºäº†å¾ˆå¤šæ”¹è¿›ï¼Œä¸‹é¢ä¾¿æ¥ä¸€ä¸€è§£è¯´ã€‚é¦–å…ˆæ–°ç‰ˆæœ¬ä¸ºäº†èƒ½æ”¯æŒä½¿ç”¨ä¸åŒçš„éšæœºæ•°ç”Ÿæˆç®—æ³•ï¼Œå°†åŸå…ˆçš„ RandomState ç»†åˆ†ä¸ºä¸¤ä¸ªç±»ï¼šBitGenerator å’Œ Generatorã€‚å‰è€…é€šè¿‡éšæœºæ•°ç”Ÿæˆç®—æ³•äº§ç”Ÿéšæœºåºåˆ—ï¼Œåè€…åˆ™å¯¹éšæœºåºåˆ—è¿›è¡Œå˜æ¢ã€‚ä¾‹å¦‚\n# MT19937å’ŒPCG64éƒ½æ˜¯å†…ç½®çš„BitGenerator\rfrom numpy.random import MT19937, PCG64, Generator\r# BitGeneratoræ¥æ”¶seedä¸ºå‚æ•°\rseed = 1\rrng1 = Generator(MT19937(seed))\rrng2 = Generator(PCG64(seed))\r# ç”Ÿæˆ3ä¸ª[0, 10]èŒƒå›´çš„æ•´æ•°\rprint(rng1.integers(0, 10, 3, endpoint=True))\rprint(rng2.integers(0, 10, 3, endpoint=True))\r ç»“æœä¸º\n[2 9 8]\r[5 5 8]\r æ–°ç”¨æ³•çš„æ¨¡å¼ä¸ RandomState éå¸¸ç±»ä¼¼ï¼Œä½† RandomState åªæ”¯æŒ Mersenne Twister ç®—æ³•ï¼Œè€Œæ–°ç”¨æ³•é€šè¿‡æ›´æ¢ BitGenerator å¯¹è±¡å¯ä»¥æ¢ç”¨ä¸åŒçš„éšæœºæ•°ç”Ÿæˆç®—æ³•ã€‚å¯ä»¥çœ‹åˆ°å°½ç®¡ç§å­ç›¸åŒï¼Œä½†ä¸åŒç®—æ³•çš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¸éœ€è¦è‡ªå·±é€‰å–ç®—æ³•ï¼Œä½¿ç”¨é»˜è®¤çš„éšæœºæ•°ç”Ÿæˆå™¨å³å¯ã€‚ä¾‹å¦‚\nfrom numpy.random import default_rng\r# ç­‰ä»·äº rng = Generator(PCG64())\r# ä¸ç»™å®šç§å­æ—¶,è‡ªåŠ¨æ ¹æ®ç†µæ± æˆ–æ—¶é—´æˆ³é€‰å–ç§å­\rrng = default_rng()\rprint(rng.integers(0, 11, 3, endpoint=True))\r é»˜è®¤ç”Ÿæˆå™¨ä½¿ç”¨ 2014 å¹´æå‡ºçš„ PCG ç®—æ³•ï¼Œå…¶æ€§èƒ½ä¸ç»Ÿè®¡ç‰¹æ€§è¦æ¯” 1997 å¹´æå‡ºçš„ Mersenne Twister ç®—æ³•æé«˜ä¸å°‘ã€‚ä¸‹é¢ç”¨è¡¨æ ¼æ€»ç»“ä¸€ä¸‹ Generator å¯¹è±¡å¸¸ç”¨çš„æ–¹æ³•\n   æ–¹æ³• æ•ˆæœ     random ç”Ÿæˆ [0, 1) èŒƒå›´å†…å‡åŒ€åˆ†å¸ƒçš„æµ®ç‚¹éšæœºæ•°ã€‚ç±»ä¼¼äºæ ‡å‡†åº“çš„ random.random ã€‚   integers ç”Ÿæˆ [low, high) èŒƒå›´å†…å†…ç¦»æ•£å‡åŒ€åˆ†å¸ƒçš„æ•´å‹éšæœºæ•°ã€‚ç›¸æ¯” randintï¼Œå¢åŠ äº†æŒ‡å®šåŒºé—´æ˜¯å¦é—­åˆçš„ endpoint å‚æ•°ã€‚   standard_normal ç”Ÿæˆæœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„éšæœºæ ·æœ¬ã€‚å¯¹äºæ›´ä¸€èˆ¬çš„æ­£æ€åˆ†å¸ƒå¯ä»¥ä½¿ç”¨ normal æ–¹æ³•ã€‚   choice å¯¹ç»™å®šçš„å¤šç»´æ•°ç»„è¿›è¡ŒéšæœºæŠ½æ ·ã€‚    å¯ä»¥çœ‹åˆ° Generator çš„æ–¹æ³•åç›¸æ¯” RandomState æ›´ç¬¦åˆç›´è§‰ï¼ŒåŠŸèƒ½ä¸Šä¹Ÿä½œå‡ºäº†æ”¹è¿›ã€‚è™½ç„¶ç°åœ¨å®˜æ–¹æ¨èæ–°ç‰ˆæœ¬çš„ç”¨æ³•ï¼Œä½†å‡ºäºå…¼å®¹æ€§çš„è€ƒè™‘ï¼Œæ—§ç‰ˆæœ¬çš„ç”¨æ³•ä¹Ÿä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå³ä¾¿ä½¿ç”¨ç›¸åŒçš„éšæœºæ•°ç”Ÿæˆç®—æ³•å’Œç›¸åŒçš„ç§å­ï¼Œæ–°ç‰ˆæœ¬ä¸æ—§ç‰ˆæœ¬äº§ç”Ÿçš„éšæœºæ•°ä¹Ÿä¸ä¼šç›¸åŒï¼Œä¾‹å¦‚\nimport numpy as np\rfrom numpy.random import RandomState, MT19937, Generator\rseed = 1\rrs = RandomState(seed)\rrng = Generator(MT19937(seed))\rdecimals = 2\rprint('RandomState:', np.around(rs.rand(3), decimals))\rprint('Generator:', np.around(rng.random(3), decimals))\r ç»“æœä¸º\nRandomState: [0.42 0.72 0. ]\rGenerator: [0.24 0.73 0.56]\r è¿™æ˜¯å› ä¸º Generator åœ¨æ¥å—ç§å­åè¿˜ä¼šåœ¨å†…éƒ¨è‡ªåŠ¨é€šè¿‡ SeedSequence ç±»å¯¹ç§å­è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œåˆ©ç”¨æ–°çš„æ•£åˆ—ç®—æ³•å°†ç”¨æˆ·ç»™å‡ºçš„ä½è´¨é‡ç§å­è½¬åŒ–æˆé«˜è´¨é‡ç§å­ï¼Œä»¥æé«˜ç”Ÿæˆçš„éšæœºæ•°çš„è´¨é‡ã€‚ä¾‹å¦‚å¯¹äº Mersenne Twister ç®—æ³•ï¼Œå¦‚æœç»™å‡ºç›¸é‚»çš„ä¸¤ä¸ªæ•´æ•°ç§å­ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ä¸¤ä¸²éšæœºåºåˆ—å°†ä¼šæœ‰å¾ˆå¤§çš„ç›¸ä¼¼æ€§â€”â€”å³ä¸¤ä¸²åºåˆ—ä¸å¤Ÿç‹¬ç«‹ã€‚è€Œæ–°å¼•å…¥çš„ SeedSequence ç±»å°±èƒ½è®©ç›¸é‚»çš„ç§å­å¯¹åº”äºè¿¥ç„¶çš„ä¸¤ä¸ªç”Ÿæˆå™¨çŠ¶æ€ã€‚åŒæ—¶ SeedSequence ç±»è¿˜æœ‰åŠ©äºåœ¨å¹¶è¡Œç”Ÿæˆéšæœºæ•°æ—¶ä¸ºæ¯ä¸ªå­è¿›ç¨‹è®¾ç½®ç›¸äº’ç‹¬ç«‹çš„çŠ¶æ€ï¼Œæœ‰éœ€æ±‚çš„è¯»è€…è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ Parallel Random Number Generationï¼Œè¿™é‡Œå°±ä¸å¤šåŠ ä»‹ç»äº†ã€‚å½“ç„¶ï¼Œå³ä¾¿ç§å­ç»è¿‡äº†æ›´å¤æ‚çš„å¤„ç†ï¼ŒåŸç†ä¸­æåˆ°çš„ç§å­èƒ½å†³å®šéšæœºæ•°ç»“æœçš„è§„åˆ™ä¾æ—§æ˜¯ä¸å˜çš„ã€‚\nåŸºæœ¬ç”¨æ³•çš„ä»‹ç»å°±è¿™äº›ï¼Œæ–°æ—§ç‰ˆæœ¬çš„å…¶å®ƒå·®åˆ«åœ¨å®˜ç½‘ä¹Ÿæœ‰æ€»ç»“ï¼ˆWhatâ€™s New or Differentï¼‰ï¼Œå¸Œæœ›æœ¬æ–‡èƒ½å¯¹è¯»è€…æœ‰æ‰€å¸®åŠ©ã€‚\nå‚è€ƒé“¾æ¥ NumPy: Random sampling\nNumPy: Legacy Random Generation\nnumpy-randomå‡½æ•°\nNumPy Random Seed, Explained\nnumpy.randomã®Generatorã‚’ãŸã‚ã—ã¦ã¿ã‚‹\nGood practices with numpy random number generators\néšæœºæ•°å¤§å®¶éƒ½ä¼šç”¨ï¼Œä½†æ˜¯ä½ çŸ¥é“ç”Ÿæˆéšæœºæ•°çš„ç®—æ³•å—ï¼Ÿ\nWhat numbers that I can put in numpy.random.seed()?\n","date":"2021-09-21","permalink":"https://zhajiman.github.io/post/numpy_random/","tags":["numpy"],"title":"Numpy ç³»åˆ—ï¼šrandom æ¨¡å—çš„å˜åŒ–"},{"content":"æœ€è¿‘è¶Šå‘è€å¹´ç—´å‘†ï¼Œè¿è‡ªå·±å†™çš„ Vim é…ç½®çš„ä½œç”¨éƒ½å¿˜å…‰äº†ï¼Œæ‰€ä»¥åœ¨æœ¬æ–‡è®°å½•å¹¶è§£è¯´ä¸€ä¸‹æˆ‘å¸¸ç”¨çš„é…ç½®ä»¥ä¾¿æŸ¥é˜…ã€‚è¿™é‡Œçš„é…ç½®éå¸¸ç®€å•ï¼Œä»…ç”¨ä»¥å¼ºåŒ–åŸºæœ¬çš„ä½¿ç”¨ä½“éªŒã€‚ç”±äºæˆ‘åŒæ—¶å·¥ä½œåœ¨èƒ½è”ç½‘çš„ PC å’Œå†…ç½‘çš„æœåŠ¡å™¨ä¸Šï¼Œæ‰€ä»¥ä¹Ÿä¼šåˆ†å¼€ä»‹ç»å¦‚ä½•åœ¨è¿™ä¸¤ç§ç¯å¢ƒä¸‹å®‰è£…æ’ä»¶ã€‚æ–‡ä¸­ Vim ç‰ˆæœ¬åˆ†åˆ«æ˜¯ 8.1ï¼ˆPCï¼‰å’Œ 7.4ï¼ˆæœåŠ¡å™¨ï¼‰ã€‚\nåŸºæœ¬é…ç½® é¦–å…ˆä»‹ç» Vim è‡ªå¸¦çš„åŸºæœ¬é…ç½®ï¼Œé…ç½®æ–‡ä»¶çš„è·¯å¾„æ˜¯ ~/.vim/vimrcã€‚å…³é—­å¯¹ vi çš„å…¼å®¹ï¼Œå¹¶ä¿è¯é€€æ ¼é”®èƒ½æ­£å¸¸ä½¿ç”¨\n\u0026quot; å…³é—­å¯¹viçš„å…¼å®¹\rset nocompatible\r\u0026quot; è®¾ç½®backspaceé”®åŠŸèƒ½\rset backspace=eol,start,indent\r è®¾ç½®è¡Œçš„æ˜¾ç¤º\n\u0026quot; æ˜¾ç¤ºè¡Œå·\rset number\r\u0026quot; é«˜äº®æ˜¾ç¤ºå½“å‰è¡Œ\rset cursorline\r\u0026quot; è®©ä¸€è¡Œçš„å†…å®¹ä¸æ¢è¡Œ\rset nowrap\r\u0026quot; è·çª—å£è¾¹ç¼˜è¿˜æœ‰å¤šå°‘è¡Œæ—¶æ»šåŠ¨çª—å£\rset scrolloff=8\r\u0026quot; æ˜¾ç¤ºæ ‡å°º,æç¤ºä¸€è¡Œä»£ç ä¸è¦è¶…è¿‡80ä¸ªå­—ç¬¦\rset ruler\rset colorcolumn=80\r è®¾ç½®ç¼©è¿›ã€‚Vim é»˜è®¤ä½¿ç”¨å®½åº¦ä¸º 8 çš„ tabï¼Œè€Œæˆ‘ä¸€èˆ¬å†™ Pythonï¼Œéœ€è¦ç”¨ 4 ä¸ªç©ºæ ¼æ›¿ä»£ tabã€‚è¿™é‡Œå‚è€ƒ Useful VIM Settings for working with Python çš„è®¾ç½®ã€‚å…³äºè¿™äº›é€‰é¡¹çš„æ„ä¹‰å¯ä»¥å‚è€ƒ Vim çš„å¸®åŠ©æ–‡æ¡£æˆ– Secrets of tabs in vim\n\u0026quot; tabè®¾ä¸º4ä¸ªç©ºæ ¼\rset tabstop=4\rset shiftwidth=4\rset softtabstop=4\rset expandtab\rset smarttab\r\u0026quot; æ–°ä¸€è¡Œä¸ä¸Šä¸€è¡Œçš„ç¼©è¿›ä¸€è‡´\rset autoindent\r æ˜¾ç¤ºç›¸åŒ¹é…çš„æ‹¬å·ï¼Œå¹¶å¢å¼ºæœç´¢åŠŸèƒ½ã€‚\n\u0026quot; æ˜¾ç¤ºæ‹¬å·åŒ¹é…\rset showmatch\r\u0026quot; é«˜äº®æŸ¥æ‰¾åŒ¹é…\rset hlsearch\r\u0026quot; å¢é‡å¼æœç´¢\rset incsearch\r\u0026quot; ä¸åŒºåˆ†å¤§å°å†™,é™¤éå«æœ‰å¤§å†™å­—æ¯\rset ignorecase\rset smartcase\r å¼€å¯è¯­æ³•é«˜äº®å¹¶è®¾ç½®é…è‰²ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯ onedark.vim é…è‰²æ–¹æ¡ˆï¼ˆåé¢ä¼šä»‹ç»å¦‚ä½•å®‰è£…ï¼‰\n\u0026quot; å¼€å¯è¯­æ³•é«˜äº®\rsyntax on\r\u0026quot; ä»£ç é¢œè‰²ä¸»é¢˜\rset t_Co=256\rcolorscheme onedark\r å¢å¼ºå‘½ä»¤éƒ¨åˆ†çš„æ˜¾ç¤ºå’Œè¡¥å…¨\n\u0026quot; åœ¨å³ä¸‹è§’æ˜¾ç¤ºéƒ¨åˆ†å‘½ä»¤\rset showcmd\r\u0026quot; å‘½ä»¤å¯ä»¥ç”¨tabè¡¥å…¨,å¹¶è®¾ç½®åŒ¹é…è§„åˆ™\rset wildmenu\rset wildmode=list:longest,full\r æ˜¾ç¤º tab å’Œè¡Œå°¾å¤šä½™çš„å­—ç¬¦\n\u0026quot; æ˜¾ç¤ºtabå’Œè¡Œå°¾å¤šä½™çš„ç©ºæ ¼\rset list\rset listchars=tab:\u0026gt;Â·,trail:Â·\r åˆ‡æ¢ buffer æ—¶ Vim æ€»ä¼šæé†’ä½ å°†å½“å‰ buffer çš„æ”¹åŠ¨å†™å…¥æ–‡ä»¶ã€‚æ‰“å¼€ hidden èƒ½å…è®¸æˆ‘ä»¬å°†æœªä¿å­˜çš„ buffer æ”¾åˆ°åå°ã€‚æ°´å¹³åˆ†å±å’Œå‚ç›´åˆ†å±æ“ä½œåˆ†åˆ«é»˜è®¤åœ¨ä¸Šè¾¹å’Œå·¦è¾¹æ‰“å¼€ä¸€ä¸ªæ–° windowï¼Œè¿™ä¸å¤ªç¬¦åˆæˆ‘çš„ä¹ æƒ¯ï¼Œæ‰€ä»¥æ”¹ä¸ºåœ¨ä¸‹è¾¹å’Œå³è¾¹åˆ›å»º\n\u0026quot; å…è®¸éšè—æœªä¿å­˜çš„buffer\rset hidden\r\u0026quot; è®¾ç½®åˆ†å±æ—¶çš„ä½ç½®\rset splitright\rset splitbelow\r æ£€æµ‹æ–‡ä»¶ç±»å‹ã€è®¾ç½® Vim å†…éƒ¨çš„å­—ç¬¦ç¼–ç ä¸º utf-8ï¼Œå¯¹æ–‡ä»¶çš„è§£ç å‚è€ƒ ç”¨vimæ‰“å¼€åä¸­æ–‡ä¹±ç æ€ä¹ˆåŠï¼Ÿ ä¸­é©¬å®è©çš„å›ç­”ï¼Œé˜²æ­¢ä¸­æ–‡å‡ºç°ä¹±ç \n\u0026quot; æ£€æµ‹æ–‡ä»¶ç±»å‹\rfiletype on\r\u0026quot; æ–‡ä»¶ç¼–ç \rset encoding=utf-8\rset fileencodings=ucs-bom,utf-8,utf-16,gbk,big5,gb18030,latin1\r\u0026quot; æ²¡æœ‰ä¿å­˜æˆ–æ–‡ä»¶åªè¯»æ—¶å¼¹å‡ºç¡®è®¤\rset confirm\r è®¾ç½®å†å²è®°å½•æ¡æ•°ï¼Œå¹¶ç¦ç”¨è‡ªåŠ¨å¤‡ä»½ï¼ˆç†ç”±æˆ‘å¿˜äº†â€¦â€¦ï¼‰\n\u0026quot; è®°å½•å†å²è®°å½•çš„æ¡æ•°\rset history=1000\rset undolevels=1000\r\u0026quot; ç¦ç”¨è‡ªåŠ¨å¤‡ä»½\rset nobackup\rset nowritebackup\rset noswapfile\r å¶å°”è¦ç”¨åˆ° NCL è¯­è¨€ï¼Œéœ€è¦ç›¸å…³çš„é«˜äº®æç¤ºï¼Œæ‰€ä»¥åœ¨ NCL: Editor enhancements for use with NCL scripts ç½‘å€ä¸‹è½½ ncl3.vim æ–‡ä»¶å¹¶é‡å‘½åä¸º ncl.vimï¼ŒæŠŠæ–‡ä»¶æ”¾å…¥ ~/.vim/syntax ç›®å½•ä¸­ï¼Œå†ä¿®æ”¹ .vimrc çš„é…ç½®ã€‚å…¶ä¸­è¿˜ä¸º commentary.vim æ’ä»¶è®¾ç½®äº† NCL çš„æ³¨é‡Š\n\u0026quot; NCLé«˜äº®è®¾ç½®\rau BufRead,BufNewFile *.ncl set filetype=ncl\rau! Syntax newlang source $VIM/ncl.vim\r\u0026quot; NCLæ³¨é‡Šè®¾ç½®\rautocmd FileType ncl setlocal commentstring=;%s\r æ’ä»¶é…ç½® PC PC ä¸Šä½¿ç”¨ vim-plug æ’ä»¶æ¥ç®¡ç†å…¶å®ƒæ’ä»¶ï¼Œåˆ©ç”¨å®ƒèƒ½éå¸¸ç®€å•åœ°å®‰è£…ã€æ›´æ–°å’Œç§»é™¤æ’ä»¶ï¼Œå…³äºå®ƒçš„å®‰è£…å’Œä½¿ç”¨æ–¹æ³•è¯¦è§å…¶ GitHub é¡µé¢ã€‚åœ¨ vimrc æ–‡ä»¶çš„å¼€å¤´æ·»åŠ \ncall plug#begin('~/.vim/plugged')\rPlug 'joshdick/onedark.vim'\rPlug 'vim-airline/vim-airline'\rPlug 'tpope/vim-commentary'\rPlug 'kshenoy/vim-signature'\rPlug 'mhinz/vim-startify'\rPlug 'junegunn/fzf'\rPlug 'junegunn/fzf.vim'\rcall plug#end()\r ä¿å­˜åå†æ‰§è¡Œå‘½ä»¤ PlugInstall å³å¯å°† call è¯­å¥å—ä¸­æåˆ°çš„æ’ä»¶ä¸‹è½½å¹¶å®‰è£…åˆ° ~/.vim/plugged ç›®å½•ä¸‹ã€‚è¿™é‡Œç”¨åˆ°çš„æ’ä»¶æœ‰ï¼š\n onedark.vimï¼šä¸€ä¸ªæš—é…è‰²æ–¹æ¡ˆã€‚ vim-airlineï¼šæ›´å¥½çœ‹çš„çŠ¶æ€æ ã€‚ commentary.vimï¼šå¼•å…¥æ³¨é‡Šå‘½ä»¤ã€‚ vim-signatureï¼šæ˜¾ç¤ºå‡º mark æ ‡è®°ã€‚ vim-startifyï¼šç»™ vim æ•´ä¸ªå¼€å±é¡µé¢ã€‚ fzf å’Œ fzf.vimï¼šå¼•å…¥æ¨¡ç³Šæœç´¢åŠŸèƒ½ã€‚  å¦‚æœæ€»æ˜¯ä¸‹è½½å¤±è´¥ï¼Œå¯ä»¥è€ƒè™‘ç»™ Git è®¾ç½®ä»£ç†ã€‚\næ¯ä¸ªæ’ä»¶éƒ½å¯ä»¥å†è¿›è¡Œå•ç‹¬é…ç½®ï¼Œè¿™é‡Œæˆ‘åªæ”¹åŠ¨äº† vim-startifyï¼šåœ¨ Vim çš„å¯åŠ¨ç•Œé¢æ˜¾ç¤ºæœ€è¿‘æ‰“å¼€è¿‡çš„ 15 ä¸ªæ–‡ä»¶ï¼Œå¹¶æ·»åŠ  ~/.bashrc å’Œ ~/.vim/vimrc ä¸¤ä¸ªæ–‡ä»¶åˆ°æ”¶è—å¤¹\n\u0026quot; vim-startifyçš„è®¾ç½®\rlet g:startify_files_number = 15\rlet g:startify_lists = [\r\\ {'type': 'files', 'header': [' Recent Files']},\r\\ {'type': 'bookmarks', 'header': [' Bookmarks']}\r\\ ]\rlet g:startify_bookmarks = [\r\\ {'b': '~/.bashrc'},\r\\ {'v': '~/.vim/vimrc'}\r\\ ]\r æœåŠ¡å™¨ å¯¹äºä¸èƒ½è”ç½‘çš„æœåŠ¡å™¨ï¼Œä¾æ® vim-plug ä½œè€…çš„å»ºè®®ï¼ˆissue #808ï¼‰ï¼Œç”¨ pathogen.vim æ’ä»¶ä»£æ›¿ vim-plugã€‚ä¸åŒäº vim-plugï¼Œpathogen.vim å¹¶ä¸èƒ½å¸®ä½ ä¸‹è½½æ’ä»¶ï¼Œå®ƒçš„åŠŸèƒ½åªæ˜¯å°†å…¶å®ƒæ’ä»¶çš„è·¯å¾„æ·»åŠ åˆ° Vim çš„ runtimepath ä¸­ï¼Œä½¿ Vim èƒ½åœ¨å·¥ä½œæ—¶æ‰¾åˆ°å…¶å®ƒæ’ä»¶ç½¢äº†ã€‚é¦–å…ˆåœ¨ GitHub ä¸Šä¸‹è½½ pathogen.vim æ–‡ä»¶å¹¶ç§»åŠ¨åˆ°æœåŠ¡å™¨çš„ ~/.vim/autoload ç›®å½•ä¸‹ï¼Œå†æ‰‹åŠ¨ä¸‹è½½å…¶å®ƒæ’ä»¶çš„ä»“åº“ï¼Œè§£å‹å¹¶é‡å‘½åï¼Œç§»åŠ¨åˆ°æœåŠ¡å™¨çš„ ~/.vim/bundle ç›®å½•ä¸‹ï¼Œæœ€ååœ¨ vimrc æ–‡ä»¶çš„å¼€å¤´æ·»åŠ \n\u0026quot; æŠŠæ’ä»¶åŠ å…¥runtimepath\rexecute pathogen#infect()\r æˆ‘ä»¬æ‰€éœ€çš„æ’ä»¶å³å¯ç”Ÿæ•ˆã€‚å¦‚æœä½ æœåŠ¡å™¨ä¸Šçš„ Vim ç‰ˆæœ¬æ˜¯ 8ï¼Œé‚£ä¹ˆè¿ pathogen.vim ä¹Ÿä¸éœ€è¦ï¼Œç›´æ¥ä½¿ç”¨åŸç”Ÿçš„ pack è¯­å¥å—å³å¯ï¼Œæˆ‘æ²¡ç”¨è¿‡æ‰€ä»¥å°±ä¸è§£è¯´äº†ã€‚\nå¿«æ·é”®é…ç½® ä¸ºäº†ä¸ä¸ normal æ¨¡å¼ä¸‹å·²æœ‰çš„å¤§é‡å¿«æ·é”®å‘ç”Ÿå†²çªï¼Œæ‰€ä»¥è¿™é‡Œç”¨ \u0026lt;Leader\u0026gt; é”®ä½œä¸ºè‡ªå®šä¹‰å¿«æ·é”®çš„èµ·æ‰‹å¼ã€‚å…³äº \u0026lt;Leader\u0026gt; é”®çš„è§£è¯´å¯è§ How to Use the Vim \u0026lt;leader\u0026gt; Keyï¼Œè¿™é‡Œä½¿ç”¨è¶æ‰‹çš„ç©ºæ ¼é”®ä½œä¸º \u0026lt;Leader\u0026gt; é”®ã€‚è‡ªå®šä¹‰å¿«æ·é”®å¯ä»¥è§£å†³ä»¥ä¸‹ç—›ç‚¹\n æ¯æ¬¡æœç´¢äº§ç”Ÿçš„é«˜äº®éœ€è¦é€šè¿‡ :nohlsearchï¼ˆæˆ–ç®€åŒ–çš„ :nohï¼‰å‘½ä»¤å–æ¶ˆï¼ŒåŒ…æ‹¬å›è½¦åœ¨å†…è‡³å°‘è¦æŒ‰ 5 ä¸ªé”®ã€‚æ”¹æˆå¿«æ·é”®åå°±åªéœ€è¦æŒ‰ 2 ä¸‹ã€‚ ç»å¸¸è¦ç”¨ fzf.vim æ’ä»¶çš„ :Files å’Œ :Buffers å‘½ä»¤æ‰“å¼€æ–‡ä»¶ï¼Œè®¾æˆå¿«æ·é”®æ›´æ–¹ä¾¿ã€‚ åœ¨åˆ†å±ä¸­ç§»åŠ¨å…‰æ ‡çš„çš„é»˜è®¤å¿«æ·é”®æ˜¯ \u0026lt;c-w\u0026gt; + hjklï¼Œéœ€è¦æ‰­æ›²å·¦æ‰‹æ‰èƒ½æŒ‰åˆ°ï¼Œéå¸¸è´¹åŠ²ã€‚ç”¨ç©ºæ ¼æ›¿ä»£ \u0026lt;c-w\u0026gt; åå°±èˆ’æœå¤šäº†ã€‚ åœ¨ä¸€ä¸ª window ä¸­æ¥å›åˆ‡æ¢ buffer éœ€è¦ç”¨åˆ°å‘½ä»¤ :bn å’Œ :bpï¼Œè¿™é‡Œç®€åŒ–åˆ° \u0026lt; å’Œ \u0026gt; æ‰€åœ¨çš„ä¸¤ä¸ªé”®ä¸Šã€‚  \u0026quot; leaderé”®æ”¹ä¸ºç©ºæ ¼\rnnoremap \u0026lt;space\u0026gt; \u0026lt;nop\u0026gt;\rlet mapleader = \u0026quot; \u0026quot;\r\u0026quot; å…³é—­é«˜äº®\rnnoremap \u0026lt;leader\u0026gt;n :nohlsearch\u0026lt;cr\u0026gt;\r\u0026quot; æœç´¢æ–‡ä»¶\rnnoremap \u0026lt;leader\u0026gt;f :Files\u0026lt;cr\u0026gt;\rnnoremap \u0026lt;leader\u0026gt;b :Buffers\u0026lt;cr\u0026gt;\r\u0026quot; è®¾ç½®åœ¨åˆ†å±é—´ç§»åŠ¨çš„å¿«æ·é”®\rnnoremap \u0026lt;leader\u0026gt;h \u0026lt;c-w\u0026gt;h\rnnoremap \u0026lt;leader\u0026gt;l \u0026lt;c-w\u0026gt;l\rnnoremap \u0026lt;leader\u0026gt;j \u0026lt;c-w\u0026gt;j\rnnoremap \u0026lt;leader\u0026gt;k \u0026lt;c-w\u0026gt;k\r\u0026quot; è®¾ç½®ç§»åŠ¨åˆ†å±çš„å¿«æ·é”®\rnnoremap \u0026lt;leader\u0026gt;H \u0026lt;c-w\u0026gt;H\rnnoremap \u0026lt;leader\u0026gt;L \u0026lt;c-w\u0026gt;L\rnnoremap \u0026lt;leader\u0026gt;J \u0026lt;c-w\u0026gt;J\rnnoremap \u0026lt;leader\u0026gt;K \u0026lt;c-w\u0026gt;K\r\u0026quot; è®¾ç½®ç§»åŠ¨bufferçš„å¿«æ·é”®\rnnoremap \u0026lt;leader\u0026gt;, :bprevious\u0026lt;cr\u0026gt;\rnnoremap \u0026lt;leader\u0026gt;. :bnext\u0026lt;cr\u0026gt;\r å…¶ä¸­æ˜ å°„æ–°æŒ‰é”®çš„è¯­å¥ nnoremap ä»…ä½œç”¨äº normal æ¨¡å¼ï¼Œä¸”ä¸ä¼šå‘ç”Ÿé€’å½’æ˜ å°„ã€‚å…³äºå„ç§ map çš„ä»‹ç»è¯·è§ [Vim]vimçš„å‡ ç§æ¨¡å¼å’ŒæŒ‰é”®æ˜ å°„ã€‚\nç»“è¯­ æˆ‘ç›®å‰ç”¨åˆ°çš„é…ç½®å°±ä»¥ä¸Šè¿™äº›ã€‚å¯ä»¥è¯´æ˜¯å¾ˆç®€é™‹äº†ï¼Œè‡ªåŠ¨è¡¥å…¨ã€ä¸€é”®è¿è¡Œä»£ç ä»€ä¹ˆçš„ç»Ÿç»Ÿæ²¡æœ‰ã€‚ä¸è¿‡æˆ‘è§‰å¾—ä½œä¸ºåŸºæœ¬çš„æ–‡æœ¬ç¼–è¾‘å™¨å·²ç»å¤Ÿç”¨äº†ï¼Œå¦‚æœè¯»è€…æœ‰å¿ƒå¾—ä¹Ÿå¯ä»¥ä¼ æˆæˆ‘ä¸€ä¸‹ã€‚\nå‚è€ƒé“¾æ¥ Vim é…ç½®å…¥é—¨\næœ‰å“ªäº›ç¼–ç¨‹å¿…å¤‡çš„ Vim é…ç½®ï¼Ÿ\nä¸Šå¤ç¥å™¨Vimï¼šä»æ¶è¨€ç›¸å‘åˆ°çˆ±ä¸é‡Šæ‰‹ - ç»ˆæVimæ•™ç¨‹01\niggredible/Learn-Vim\n","date":"2021-09-20","permalink":"https://zhajiman.github.io/post/vim_config/","tags":["vim"],"title":"ç®€å•çš„ Vim é…ç½®"},{"content":"ç®€ä»‹ è¿é€šåŸŸæ ‡è®°ï¼ˆconnected component labellingï¼‰å³æ‰¾å‡ºäºŒå€¼å›¾åƒä¸­äº’ç›¸ç‹¬ç«‹çš„å„ä¸ªè¿é€šåŸŸå¹¶åŠ ä»¥æ ‡è®°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆå¼•è‡ª MarcWang çš„ Gistï¼‰\nå¯ä»¥çœ‹åˆ°å›¾ä¸­æœ‰ä¸‰ä¸ªç‹¬ç«‹çš„åŒºåŸŸï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°å¹¶ç”¨æ•°å­—æ ‡è®°å®ƒä»¬ï¼Œä»¥ä¾¿äºè®¡ç®—å„ä¸ªåŒºåŸŸçš„è½®å»“ã€å¤–æ¥å½¢çŠ¶ã€è´¨å¿ƒç­‰å‚æ•°ã€‚è¿é€šåŸŸæ ‡è®°æœ€åŸºæœ¬çš„ä¸¤ä¸ªç®—æ³•æ˜¯ Seed-Filling ç®—æ³•å’Œ Two-Pass ç®—æ³•ï¼Œä¸‹é¢ä¾¿æ¥åˆ†åˆ«ä»‹ç»å®ƒä»¬ï¼Œå¹¶ç”¨ Python åŠ ä»¥å®ç°ã€‚\nSeed-Filling ç®—æ³• ç›´è¯‘å³ç§å­å¡«å……ï¼Œä»¥å›¾åƒä¸­çš„ç‰¹å¾åƒç´ ä¸ºç§å­ï¼Œç„¶åä¸æ–­å‘å…¶å®ƒè¿é€šåŒºåŸŸè”“å»¶ï¼Œç›´è‡³å°†ä¸€ä¸ªè¿é€šåŸŸå®Œå…¨å¡«æ»¡ã€‚ç¤ºæ„åŠ¨å›¾å¦‚ä¸‹ï¼ˆå¼•è‡ª icvpr çš„åšå®¢ï¼‰\nå…·ä½“æ€è·¯ä¸ºï¼šå¾ªç¯éå†å›¾åƒä¸­çš„æ¯ä¸€ä¸ªåƒç´ ï¼Œå¦‚æœæŸä¸ªåƒç´ æ˜¯æœªè¢«æ ‡è®°è¿‡çš„ç‰¹å¾åƒç´ ï¼Œé‚£ä¹ˆç”¨æ•°å­—å¯¹å…¶è¿›è¡Œæ ‡è®°ï¼Œå¹¶å¯»æ‰¾ä¸ä¹‹ç›¸é‚»çš„æœªè¢«æ ‡è®°è¿‡çš„ç‰¹å¾åƒç´ ï¼Œå†å¯¹è¿™äº›åƒç´ ä¹Ÿè¿›è¡Œæ ‡è®°ï¼Œç„¶åä»¥åŒæ ·çš„æ–¹æ³•ç»§ç»­å¯»æ‰¾é‚»å±…åƒç´ çš„é‚»å±…åƒç´ å¹¶åŠ ä»¥æ ‡è®°â€¦â€¦å¦‚æ­¤å¾ªç¯å¾€å¤ï¼Œç›´è‡³å°†è¿™äº›äº’ç›¸è¿é€šçš„åƒç´ éƒ½æ ‡è®°å®Œæ¯•ã€‚æ­¤å³è¿é€šåŸŸ 1ï¼Œæ¥ç€ç»§ç»­éå†å›¾åƒåƒç´ ï¼Œçœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ä¸‹ä¸€ä¸ªè¿é€šåŸŸã€‚ä¸‹é¢çš„å®ç°é‡‡ç”¨çš„æ˜¯æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰çš„ç­–ç•¥ï¼Œå°†æ‰¾åˆ°çš„é‚»å±…åƒç´ å‹å…¥æ ˆä¸­ï¼Œå¼¹å‡ºæ ˆé¡¶çš„åƒç´ ï¼Œå¯¹å…¶è¿›è¡Œæ ‡è®°ï¼Œå†æŠŠè¿™ä¸ªåƒç´ çš„é‚»å±…åƒç´ å‹å…¥æ ˆä¸­ï¼Œé‡å¤æ“ä½œç›´è‡³æ ˆå†…å†æ— æœªæ ‡è®°çš„åƒç´ ã€‚\nimport numpy as np\rdef get_neighbor_indices(labelled, row, col, connectivity):\r'''æ‰¾å‡ºä¸€ç‚¹é‚»åŸŸå†…labelå€¼ä¸º-1çš„ç‚¹çš„ä¸‹æ ‡.'''\rnrow, ncol = labelled.shape\rif connectivity == 4:\rindices = (\r(row - 1, col), # ä¸Š\r(row, col - 1), # å·¦\r(row, col + 1), # å³\r(row + 1, col) # ä¸‹\r)\relif connectivity == 8:\rindices = (\r(row - 1, col - 1), (row - 1, col), (row - 1, col + 1), # ä¸Š\r(row, col - 1), (row, col + 1), # ä¸­\r(row + 1, col - 1), (row + 1, col), (row + 1, col + 1) # ä¸‹\r)\rfor x, y in indices:\rif x \u0026gt;= 0 and x \u0026lt; nrow and y \u0026gt;= 0 and y \u0026lt; ncol:\rif labelled[x, y] == -1:\ryield x, y\rdef seed_filling(image, connectivity=4):\r'''\rç”¨Seed-Fillingç®—æ³•å¯»æ‰¾å›¾ç‰‡é‡Œçš„è¿é€šåŸŸ.\rParameters\r----------\rimage : ndarray, shape (nrow, ncol)\räºŒç»´æ•´å‹æ•°ç»„,é›¶å€¼ä»£è¡¨èƒŒæ™¯,éé›¶å€¼ä»£è¡¨ç‰¹å¾.\rconnectivity : int\ræŒ‡å®šé‚»åŸŸä¸º4æˆ–8ä¸ªåƒç´ .\rReturns\r-------\rlabelled : ndarray, shape (nrow, ncol)\räºŒç»´æ•´å‹æ•°ç»„,å…ƒç´ çš„æ•°å€¼è¡¨ç¤ºæ‰€å±è¿é€šåŸŸçš„æ ‡å·.\r0è¡¨ç¤ºèƒŒæ™¯,ä»1å¼€å§‹è¡¨ç¤ºä¸åŒçš„è¿é€šåŸŸ.\rnlabel : int\rå›¾åƒä¸­è¿é€šåŸŸçš„ä¸ªæ•°.\r'''\r# ç”¨-1è¡¨ç¤ºæœªè¢«æ ‡è®°è¿‡çš„ç‰¹å¾åƒç´ .\rlabelled = np.where(image != 0, -1, 0).astype(int)\rnrow, ncol = labelled.shape\rlabel = 1\rfor row in range(nrow):\rfor col in range(ncol):\r# è·³è¿‡èƒŒæ™¯åƒç´ å’Œå·²ç»è¢«æ ‡è®°è¿‡çš„ç‰¹å¾åƒç´ .\rif labelled[row, col] != -1:\rcontinue\rlabelled[row, col] = label\rneighbor_indices = list(\rget_neighbor_indices(labelled, row, col, connectivity)\r)\r# ä¸æ–­å¯»æ‰¾é‚»å±…åƒç´ çš„é‚»å±…å¹¶æ ‡è®°ä¹‹,ç›´è‡³å†æ‰¾ä¸åˆ°æœªè¢«æ ‡è®°çš„é‚»å±….\rwhile neighbor_indices:\rneighbor_index = neighbor_indices.pop()\rlabelled[neighbor_index] = label\rfor new_index in get_neighbor_indices(\rlabelled, *neighbor_index, connectivity\r):\rneighbor_indices.append(new_index)\rlabel += 1\rreturn labelled, label - 1\r Two-Pass ç®—æ³• é¡¾åæ€ä¹‰ï¼Œæ˜¯ä¼šå¯¹å›¾åƒè¿‡ä¸¤éå¾ªç¯çš„ç®—æ³•ã€‚ç¬¬ä¸€éå¾ªç¯å…ˆç²—ç•¥åœ°å¯¹ç‰¹å¾åƒç´ è¿›è¡Œæ ‡è®°ï¼Œç¬¬äºŒéå¾ªç¯ä¸­å†æ ¹æ®ä¸åŒæ ‡ç­¾ä¹‹é—´çš„å…³ç³»å¯¹ç¬¬ä¸€éçš„ç»“æœè¿›è¡Œä¿®æ­£ã€‚ç¤ºæ„åŠ¨å›¾å¦‚ä¸‹ï¼ˆå¼•è‡ª icvpr çš„åšå®¢ï¼‰\nå…·ä½“æ€è·¯ä¸º\n ç¬¬ä¸€éå¾ªç¯æ—¶ï¼Œè‹¥ä¸€ä¸ªç‰¹å¾åƒç´ å‘¨å›´å…¨æ˜¯èƒŒæ™¯åƒç´ ï¼Œé‚£å®ƒå°±å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªæ–°çš„è¿é€šåŸŸï¼Œéœ€è¦èµ‹äºˆå…¶ä¸€ä¸ªæ–°æ ‡ç­¾ã€‚å¦‚æœè¿™ä¸ªç‰¹å¾åƒç´ å‘¨å›´æœ‰å…¶å®ƒç‰¹å¾åƒç´ ï¼Œåˆ™è¯´æ˜å®ƒä»¬ä¹‹é—´äº’ç›¸è¿é€šï¼Œæ­¤æ—¶éšä¾¿ç”¨å®ƒä»¬ä¸­çš„ä¸€ä¸ªæ—§æ ‡ç­¾å€¼æ¥æ ‡è®°å½“å‰åƒç´ å³å¯ï¼ŒåŒæ—¶è¦ç”¨å¹¶æŸ¥é›†è®°å½•è¿™äº›åƒç´ æ ‡ç­¾é—´çš„å…³ç³»ã€‚ å› ä¸ºæˆ‘ä»¬æ€»æ˜¯åªåˆ©ç”¨äº†å½“å‰åƒç´ é‚»åŸŸçš„ä¿¡æ¯ï¼ˆè€ƒè™‘åˆ°å¾ªç¯æ–¹å‘æ˜¯ä»å·¦ä¸Šåˆ°å³ä¸‹ï¼Œå…¶å®å½“å‰åƒç´ å³ä¸‹æ–¹çš„ä¿¡æ¯ä¹Ÿæ˜¯åˆ©ç”¨ä¸åˆ°çš„ï¼‰ï¼Œæ‰€ä»¥ç¬¬ä¸€éå¾ªç¯ä¸­æ‰¾å‡ºçš„é‚£äº›è¿é€šåŸŸå¯èƒ½ä¼šåœ¨é‚»åŸŸä¹‹å¤–ç›¸è¿ï¼Œå¯¼è‡´åŒä¸€ä¸ªè¿é€šåŸŸå†…çš„åƒç´ å«æœ‰ä¸åŒçš„æ ‡ç­¾å€¼ã€‚ä¸è¿‡åˆ©ç”¨ç¬¬ä¸€éå¾ªç¯æ—¶è·å¾—çš„æ ‡ç­¾ä¹‹é—´çš„å…³ç³»ï¼ˆè®°å½•åœ¨å¹¶æŸ¥é›†ä¸­ï¼‰ï¼Œå¯ä»¥åœ¨ç¬¬äºŒéå¾ªç¯ä¸­å°†åŒå±ä¸€ä¸ªé›†åˆï¼ˆè¿é€šåŸŸï¼‰çš„ä¸åŒæ ‡ç­¾ä¿®æ­£ä¸ºåŒä¸€ä¸ªæ ‡ç­¾ã€‚ ç»è¿‡ç¬¬äºŒéå¾ªç¯çš„ä¿®æ­£åï¼Œè™½ç„¶å‡ç‹¬ç«‹åŒºåŸŸä¼šè¢«å½’å¹¶ï¼Œä½†å®ƒæ‰€æŒæœ‰çš„æ ‡ç­¾å€¼ä¾æ—§å­˜åœ¨ï¼Œè¿™å°±å¯¼è‡´æœ¬åº”è¿ç»­çš„æ ‡ç­¾å€¼åºåˆ—ä¸­æœ‰ç¼ºå£ï¼ˆgapï¼‰ã€‚æ‰€ä»¥ä¾æ®éœ€æ±‚å¯ä»¥è¿›è¡Œç¬¬ä¸‰éå¾ªç¯ï¼Œå»æ‰è¿™äº›ç¼ºå£ï¼Œå°†æ ‡ç­¾å€¼ä¿®æ­£ä¸ºè¿ç»­çš„æ•´æ•°åºåˆ—ã€‚  å…¶ä¸­æåˆ°çš„å¹¶æŸ¥é›†æ˜¯ä¸€ç§å¤„ç†ä¸ç›¸äº¤é›†åˆçš„æ•°æ®ç»“æ„ï¼Œæ”¯æŒæŸ¥è¯¢å…ƒç´ æ‰€å±ã€åˆå¹¶ä¸¤ä¸ªé›†åˆçš„æ“ä½œã€‚åˆ©ç”¨å®ƒå°±èƒ½å¤„ç†æ ‡ç­¾å’Œè¿é€šåŸŸä¹‹é—´çš„ä»å±å…³ç³»ã€‚æˆ‘æ˜¯çœ‹ ç®—æ³•å­¦ä¹ ç¬”è®°(1) : å¹¶æŸ¥é›† è¿™ç¯‡çŸ¥ä¹ä¸“æ å­¦çš„ã€‚ä¸‹é¢çš„å®ç°ä¸­ä»…é‡‡ç”¨è·¯å¾„å‹ç¼©çš„ä¼˜åŒ–ï¼Œåˆå¹¶ä¸¤ä¸ªå…ƒç´ æ—¶å§‹ç»ˆè®©å¤§çš„æ ¹èŠ‚ç‚¹è¢«åˆå¹¶åˆ°å°çš„æ ¹èŠ‚ç‚¹ä¸Šï¼Œä»¥ä¿è¯è¿é€šåŸŸæ ‡ç­¾å€¼çš„æ’åˆ—é¡ºåºè·Ÿæ•°ç»„çš„å¾ªç¯æ–¹å‘ä¸€è‡´ã€‚\nimport numpy as np\rfrom scipy.stats import rankdata\rclass UnionFind:\r'''ç”¨åˆ—è¡¨å®ç°ç®€å•çš„å¹¶æŸ¥é›†.'''\rdef __init__(self, n):\r'''åˆ›å»ºå«æœ‰nä¸ªèŠ‚ç‚¹çš„å¹¶æŸ¥é›†,æ¯ä¸ªå…ƒç´ æŒ‡å‘è‡ªå·±.'''\rself.parents = list(range(n))\rdef find(self, i):\r'''é€’å½’æŸ¥æ‰¾ç¬¬iä¸ªèŠ‚ç‚¹çš„æ ¹èŠ‚ç‚¹,åŒæ—¶å‹ç¼©è·¯å¾„.'''\rparent = self.parents[i]\rif parent == i:\rreturn i\relse:\rroot = self.find(parent)\rself.parents[i] = root\rreturn root\rdef union(self, i, j):\r'''åˆå¹¶èŠ‚ç‚¹iå’Œjæ‰€å±çš„ä¸¤ä¸ªé›†åˆ.ä¿è¯å¤§çš„æ ¹èŠ‚ç‚¹è¢«åˆå¹¶åˆ°å°çš„æ ¹èŠ‚ç‚¹ä¸Š.'''\rroot_i = self.find(i)\rroot_j = self.find(j)\rif root_i \u0026lt; root_j:\rself.parents[root_j] = root_i\relif root_i \u0026gt; root_j:\rself.parents[root_i] = root_j\relse:\rreturn None\rdef get_neighbor_labels(labelled, row, col, connectivity):\r'''æ‰¾å‡ºä¸€ç‚¹ä¸Šè¾¹å’Œå·¦è¾¹å¤§äºé›¶çš„label.'''\rnrow, ncol = labelled.shape\rif connectivity == 4:\rindices = (\r(row - 1, col), # ä¸Š\r(row, col - 1) # å·¦\r)\relif connectivity == 8:\rindices = (\r(row - 1, col - 1), # å·¦ä¸Š\r(row - 1, col), # ä¸Š\r(row - 1, col + 1), # å³ä¸Š\r(row, col - 1) # å·¦\r)\relse:\rraise ValueError('connectivity must be 4 or 8')\rfor x, y in indices:\rif x \u0026gt;= 0 and x \u0026lt; nrow and y \u0026gt;= 0 and y \u0026lt; ncol:\rneighbor_label = labelled[x, y]\rif neighbor_label \u0026gt; 0:\ryield neighbor_label\rdef two_pass(image, connectivity=4):\r'''\rç”¨Two-Passç®—æ³•å¯»æ‰¾å›¾ç‰‡é‡Œçš„è¿é€šåŸŸ.\rParameters\r----------\rimage : ndarray, shape (nrow, ncol)\räºŒç»´æ•´å‹æ•°ç»„,é›¶å€¼ä»£è¡¨èƒŒæ™¯,éé›¶å€¼ä»£è¡¨ç‰¹å¾.\rconnectivity : int\ræŒ‡å®šé‚»åŸŸä¸º4æˆ–8ä¸ªåƒç´ .\rReturns\r-------\rlabelled : ndarray, shape (nrow, ncol)\räºŒç»´æ•´å‹æ•°ç»„,å…ƒç´ çš„æ•°å€¼è¡¨ç¤ºæ‰€å±è¿é€šåŸŸçš„æ ‡å·.\r0è¡¨ç¤ºèƒŒæ™¯,ä»1å¼€å§‹è¡¨ç¤ºä¸åŒçš„è¿é€šåŸŸ.\rnlabel : int\rå›¾åƒä¸­è¿é€šåŸŸçš„ä¸ªæ•°.\r'''\rnrow, ncol = image.shape\rlabelled = np.zeros_like(image, dtype=int)\ruf = UnionFind(image.size // 2)\rlabel = 1\r# ç¬¬ä¸€éå¾ªç¯,ç”¨labelæ ‡è®°å‡ºè¿é€šçš„åŒºåŸŸ.\rfor row in range(nrow):\rfor col in range(ncol):\r# è·³è¿‡èƒŒæ™¯.\rif image[row, col] == 0:\rcontinue\r# è‹¥å½“å‰åƒç´ å‘¨å›´æ²¡æœ‰labelå¤§äºé›¶çš„åƒç´ ,åˆ™è¯¥åƒç´ è·å¾—æ–°label.\r# å¦åˆ™ç”¨å¹¶æŸ¥é›†è®°å½•ç›¸é‚»åƒç´ çš„labelé—´çš„å…³ç³».\rneighbor_labels = list(\rget_neighbor_labels(labelled, row, col, connectivity)\r)\rif len(neighbor_labels) == 0:\rlabelled[row, col] = label\rlabel += 1\relse:\rfirst_label = neighbor_labels[0]\rlabelled[row, col] = first_label\rfor neighbor_label in neighbor_labels[1:]:\ruf.union(first_label, neighbor_label)\r# è·å–ä»£è¡¨æ¯ä¸ªé›†åˆçš„label,å¹¶åˆ©ç”¨å¤§å°æ’åé‡æ–°èµ‹å€¼.\rroots = [uf.find(i) for i in range(label)]\rlabels = rankdata(roots, method='dense') - 1\r# ç¬¬äºŒéå¾ªç¯èµ‹å€¼åˆ©ç”¨ndarrayçš„advanced indexingå®ç°.\rlabelled = labels[labelled]\rreturn labelled, labelled.max()\r å…¶ä¸­å¯¹æ ‡ç­¾å€¼è¿›è¡Œé‡æ–°æ’åçš„éƒ¨åˆ†ç”¨åˆ°äº† scipy.stats.rankdata å‡½æ•°ï¼Œè‡ªå·±å†™å¾ªç¯æ¥å®ç°ä¹Ÿå¯ä»¥ï¼Œä½†å½“æ ‡ç­¾å€¼è¾ƒå¤šæ—¶æ•ˆç‡ä¼šè¿œä½äºè¿™ä¸ªå‡½æ•°ã€‚ä»ä»£ç æ¥çœ‹ï¼ŒTwo-Pass ç®—æ³•æ¯” Seed-Filling ç®—æ³•æ›´å¤æ‚ä¸€äº›ï¼Œä½†å› ä¸ºä¸éœ€è¦è¿›è¡Œé€’å½’å¼çš„å¡«å……ï¼Œæ‰€ä»¥ç†è®ºä¸Šè¦æ¯”åè€…æ›´å¿«ã€‚\nå…¶å®ƒæ–¹æ³• å®é™…åº”ç”¨ä¸­æ¨èä½¿ç”¨ scipy.ndimage.label æˆ– skimage.measure.label å‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬åº•å±‚éƒ½æ˜¯ç”¨ Cython å®ç°çš„ï¼Œæ‰€ä»¥é€Ÿåº¦ç§’æ€å‰é¢çš„æ‰‹å·¥å®ç°ã€‚å¦‚æœæ‡‚ OpenCV çš„è¯ï¼Œè¿˜å¯ä»¥è°ƒç”¨ cv2.connectedComponents å‡½æ•°ã€‚æˆ‘å®Œå…¨ä¸æ‡‚ OpenCVï¼Œå°±ä¸ä»‹ç»äº†ã€‚\nä¾‹å­ ä»¥ä¸€ä¸ªéšæœºç”Ÿæˆçš„ 50*50 çš„äºŒå€¼æ•°ç»„ä¸ºä¾‹ï¼Œæµ‹è¯• scipy.ndimage.labelã€Two-Pass å®ç°å’Œ Seed-Filling å®ç°çš„æ•ˆæœï¼Œé‡‡ç”¨ 8 é‚»åŸŸè¿é€šï¼Œæ•ˆæœå¦‚ä¸‹å›¾\nå¯ä»¥çœ‹åˆ°ä¸‰ç§æ–¹æ³•éƒ½æ‰¾å‡ºäº† 17 ä¸ªè¿é€šåŸŸï¼Œå¹¶ä¸”è¿æ ‡ç­¾é¡ºåºéƒ½ä¸€æ¨¡ä¸€æ ·ï¼ˆå¡«è‰²ç›¸åŒï¼‰ã€‚ä¸è¿‡è‹¥ Two-Pass æ³•ä¸­çš„å¹¶æŸ¥é›†é‡‡ç”¨å…¶å®ƒåˆå¹¶ç­–ç•¥ï¼Œæ ‡ç­¾é¡ºåºå°±å¾ˆå¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚ä¸‹é¢å†ä»¥ä¸€ä¸ªæ›´å¤æ‚çš„ 800*800 å¤§å°çš„ç©ºéœ²éœ²å›¾ç‰‡ä¸ºä¾‹\nå°†å›¾ç‰‡äºŒå€¼åŒ–åå†è¿›è¡Œè¿é€šåŸŸæ ‡è®°ï¼Œå¯ä»¥çœ‹åˆ°ãŠã¤ã‚‹ã‚‹çš„å­—æ ·è¢«åŒºåˆ†æˆå¤šä¸ªåŒºåŸŸï¼ŒçŒ«çŒ«å’Œéœ²éœ²ä¹Ÿéƒ½è¢«è¯†åˆ«äº†å‡ºæ¥ã€‚ä»£ç å¦‚ä¸‹\nimport numpy as np\rfrom PIL import Image\rfrom scipy import ndimage\rimport matplotlib as mpl\rimport matplotlib.pyplot as plt\rfrom connected_components import two_pass, seed_filling\rif __name__ == '__main__':\r# å°†æµ‹è¯•å›¾ç‰‡äºŒå€¼åŒ–.\rpicname = 'ruru.png'\rimage = Image.open(picname)\rimage = np.array(image.convert('L'))\rimage = ndimage.gaussian_filter(image, sigma=2)\rimage = np.where(image \u0026lt; 220, 1, 0)\r# è®¾ç½®äºŒå€¼å›¾åƒä¸åˆ†ç±»å›¾åƒæ‰€éœ€çš„cmap.\rcmap1 = mpl.colors.ListedColormap(['white', 'black'])\rwhite = np.array([1, 1, 1])\rcmap2 = mpl.colors.ListedColormap(\rnp.vstack([white, mpl.cm.tab20.colors])\r)\rfig, axes = plt.subplots(2, 2, figsize=(10, 10))\r# å…³é—­ticksçš„æ˜¾ç¤º.\rfor ax in axes.flat:\rax.xaxis.set_visible(False)\rax.yaxis.set_visible(False)\r# æ˜¾ç¤ºäºŒå€¼åŒ–çš„å›¾åƒ.\raxes[0, 0].imshow(image, cmap=cmap1, interpolation='nearest')\raxes[0, 0].set_title('Image', fontsize='large')\r# æ˜¾ç¤ºscipy.ndimage.labelçš„ç»“æœ.\r# æ³¨æ„imshowä¸­éœ€è¦æŒ‡å®šinterpolationä¸º'nearest'æˆ–'none',å¦åˆ™ç»“æœæœ‰ç´«è¾¹.\rs = np.ones((3, 3), dtype=int)\rlabelled, nlabel = ndimage.label(image, structure=s)\raxes[0, 1].imshow(labelled, cmap=cmap2, interpolation='nearest')\raxes[0, 1].set_title(\rf'scipy.ndimage.label ({nlabel} labels)', fontsize='large'\r)\r# æ˜¾ç¤ºTwo-Passç®—æ³•çš„ç»“æœ.\rlabelled, nlabel = two_pass(image, connectivity=8)\raxes[1, 0].imshow(labelled, cmap=cmap2, interpolation='nearest')\raxes[1, 0].set_title(f'Two-Pass ({nlabel} labels)', fontsize='large')\r# æ˜¾ç¤ºSeed-Fillingç®—æ³•çš„ç»“æœ.\rlabelled, nlabel = seed_filling(image, connectivity=8)\raxes[1, 1].imshow(labelled, cmap=cmap2, interpolation='nearest')\raxes[1, 1].set_title(f'Seed-Filling ({nlabel} labels)', fontsize='large')\rfig.savefig('image.png', dpi=200, bbox_inches='tight')\rplt.close(fig)\r æœ€åè¯´ä¸‹é€Ÿåº¦ï¼Œscipy.ndimage.label æ¯” Two-Pass å¿«å‡ ç™¾å€ï¼Œè€Œ Two-Pass åªæ¯” Seed-Filling å¿«ä¸€å€ã€‚å¤„ç†åˆ†è¾¨ç‡å¤§ä¸€ç‚¹çš„å›¾ç‰‡æ—¶ï¼Œåä¸¤è€…çš„é€Ÿåº¦æœ‰ç‚¹æ€¥äººã€‚å¯èƒ½æ˜¯å› ä¸ºçº¯ Python å®ç°ç¡®å®å¤ªæ…¢ï¼ˆæ¯•ç«Ÿå®Œå…¨æ²¡ç”¨ä¸Š NumPy çš„å‘é‡æ€§ï¼‰ï¼Œæˆ–è€…æˆ‘å‰é¢å†™çš„ä»£ç å¤ªçƒ‚ã€‚è¿˜è¯·æ‡‚è¡Œçš„è¯»è€…æŒ‡ç‚¹ä¸€ä¸‹ã€‚\nä¸åªæ˜¯é‚»æ¥ è™½ç„¶ SciPy å’Œ scikit-image ä¸­çš„å®ç°è¦å¿«ä¸Šå¾ˆå¤šï¼Œä½†å®ƒä»¬éƒ½åªæ”¯æŒ 4-é‚»åŸŸå’Œ 8-é‚»åŸŸçš„è¿é€šè§„åˆ™ã€‚è‹¥æ˜¯è‡ªå·±å†™çš„ Python å®ç°çš„è¯ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åˆ«çš„è¿é€šè§„åˆ™ã€‚ä¾‹å¦‚ï¼Œæ”¹åŠ¨ä¸€ä¸‹ Seed-Filling ç®—æ³•ä¸­çš„ get_neighbor_indices å‡½æ•°ï¼Œä½¿ä¹‹èƒ½å¤Ÿæœç´¢åŠå¾„ r ä»¥å†…çš„ç‰¹å¾åƒç´ \ndef get_neighbor_indices(labelled, row, col, r):\r'''æ‰¾å‡ºä¸€ç‚¹åœ¨åŠå¾„rèŒƒå›´å†…labelledå€¼ç­‰äº-1çš„ç‚¹çš„ä¸‹æ ‡.'''\rnrow, ncol = labelled.shape\rfor i in range(-r, r + 1):\rk = r - abs(i)\rfor j in range(-k, k + 1):\r# è·³è¿‡è¿™ä¸ªç‚¹æœ¬èº«.\rif i == 0 and j == 0:\rcontinue\r# å°†ä¸‹æ ‡åç§»å€¼åŠ ç»™rowå’Œcol.\rx = row + i\ry = col + j\r# é¿å…ä¸‹æ ‡å‡ºç•Œ.\rif x \u0026gt;= 0 and x \u0026lt; nrow and y \u0026gt;= 0 and y \u0026lt; ncol:\rif labelled[x, y] == -1:\ryield x, y\r åœ¨æŸäº›æƒ…å†µä¸‹ä¹Ÿè®¸èƒ½æ´¾ä¸Šç”¨åœºã€‚\nå‚è€ƒé“¾æ¥ ç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹æŠ„äº†è¿™ç¯‡ï¼Œä½†é‡Œé¢ Two-Pass ç®—æ³•çš„ä»£ç é‡Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡ç”¨å¹¶æŸ¥é›†ï¼Œå¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚\nOpenCV_è¿é€šåŒºåŸŸåˆ†æï¼ˆConnected Component Analysis-Labelingï¼‰\nä¸€ç¯‡è‹±æ–‡çš„å¯¹ Two-Pass ç®—æ³•çš„ä»‹ç»ï¼ŒGithub ä¸Šè¿˜å¸¦æœ‰ Python å®ç°ã€‚\nConnected Component Labelling\nä»£ç å‚è€ƒäº†\nä½ éƒ½ç”¨ Python æ¥åšä»€ä¹ˆï¼Ÿlaiyonghao çš„å›ç­”\nè¿é€šåŸŸçš„åŸç†ä¸Pythonå®ç°\n","date":"2021-07-19","permalink":"https://zhajiman.github.io/post/connected_component_labelling/","tags":["å›¾åƒå¤„ç†"],"title":"äºŒå€¼å›¾åƒçš„è¿é€šåŸŸæ ‡è®°"},{"content":"0. å‰è¨€ æ‰¿æ¥ Matplotlib ç³»åˆ—ï¼šcolormap çš„è®¾ç½® ä¸€æ–‡ï¼Œè¿™æ¬¡ä»‹ç» colorbarã€‚æ‰€è°“ colorbar å³ä¸»å›¾æ—ä¸€ä¸ªé•¿æ¡çŠ¶çš„å°å›¾ï¼Œèƒ½å¤Ÿè¾…åŠ©è¡¨ç¤ºä¸»å›¾ä¸­ colormap çš„é¢œè‰²ç»„æˆå’Œé¢œè‰²ä¸æ•°å€¼çš„å¯¹åº”å…³ç³»ã€‚æœ¬æ–‡å°†ä¼šä¾æ¬¡ä»‹ç» colorbar çš„åŸºæœ¬ç”¨æ³•ã€å¦‚ä½•è®¾ç½®åˆ»åº¦ï¼Œä»¥åŠæ€ä¹ˆä¸ºç»„å›¾æ·»åŠ  colorbarã€‚ä»£ç åŸºäº Matplotlib 3.3.4ã€‚\n1. colorbar çš„åŸºæœ¬ç”¨æ³• Colorbar ä¸»è¦é€šè¿‡ figure.colorbar æ–¹æ³•ç»˜åˆ¶ï¼Œå…ˆä»‹ç»å¸¸ç”¨çš„å‡ ä¸ªå‚æ•°\n mappableï¼šç›´è¯‘ä¸ºâ€œå¯æ˜ å°„çš„â€ï¼Œè¦æ±‚æ˜¯ matplotlib.cm.ScalarMappable å¯¹è±¡ï¼Œèƒ½å¤Ÿå‘ colorbar æä¾›æ•°æ®ä¸é¢œè‰²é—´çš„æ˜ å°„å…³ç³»ï¼ˆå³ colormap å’Œ normalization ä¿¡æ¯ï¼‰ã€‚ä¸»å›¾ä¸­ä½¿ç”¨ contourfã€pcolormesh å’Œ imshow ç­‰äºŒç»´ç»˜å›¾å‡½æ•°æ—¶è¿”å›çš„å¯¹è±¡éƒ½å±äº ScalarMappableã€‚ caxï¼šcolorbar æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„ axesï¼Œæˆ‘ä»¬ä¸ºäº†åœ¨ç”»å¸ƒä¸Šå†³å®šå…¶ä½ç½®ã€å½¢çŠ¶å’Œå¤§å°ï¼Œå¯ä»¥äº‹å…ˆç”»å‡ºä¸€ä¸ªç©º axesï¼Œç„¶åå°†è¿™ä¸ª axes æä¾›ç»™ cax å‚æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªç©º axes å°±ä¼šå˜æˆ colorbarã€‚ axï¼šæœ‰æ—¶æˆ‘ä»¬æ‡’å¾—æ‰‹åŠ¨ä¸º colorbar å‡†å¤‡å¥½ä½ç½®ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ ax å‚æ•°æŒ‡å®š colorbar ä¾é™„äºå“ªä¸ª axesï¼Œæ¥ç€ colorbar ä¼šè‡ªåŠ¨ä»è¿™ä¸ª axes é‡Œâ€œå·â€ä¸€éƒ¨åˆ†ç©ºé—´æ¥ä½œä¸ºè‡ªå·±çš„ç©ºé—´ã€‚ orientationï¼šæŒ‡å®š colorbar çš„æœå‘ï¼Œé»˜è®¤ä¸ºå‚ç›´æ–¹å‘ã€‚ç±»ä¼¼çš„å‚æ•°è¿˜æœ‰ locationã€‚ extendï¼šè®¾ç½®æ˜¯å¦åœ¨ colorbar ä¸¤ç«¯é¢å¤–æ ‡å‡º normalization èŒƒå›´å¤–çš„é¢œè‰²ã€‚å¦‚æœ colormap æœ‰è®¾ç½®è¿‡ set_under å’Œ set_overï¼Œé‚£ä¹ˆä½¿ç”¨è¿™ä¸¤ä¸ªé¢œè‰²ã€‚ ticksï¼šæŒ‡å®š colorbar çš„åˆ»åº¦ä½ç½®ï¼Œå¯ä»¥æ¥å— ticks çš„åºåˆ—æˆ– Locator å¯¹è±¡ã€‚ formatï¼šæŒ‡å®š colorbar çš„åˆ»åº¦æ ‡ç­¾çš„æ ¼å¼ï¼Œå¯ä»¥æ¥å—æ ¼å¼å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ '%.3f'ï¼Œæˆ– Formatter å¯¹è±¡ã€‚ labelï¼šæ•´ä¸ª colorbar çš„æ ‡ç­¾ï¼Œç±»ä¼¼äº axes çš„ xlabel æˆ– ylabelã€‚  æ­¤å¤– colorbar è¿˜æœ‰äº›è®¾ç½®ä¸èƒ½åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¸€æ¬¡æ€§æå®šï¼Œéœ€è¦æ¥ç€è°ƒç”¨æ–¹æ³•æ‰èƒ½å®Œæˆã€‚\n1.1 å•ç‹¬ç»˜åˆ¶ colorbar è™½ç„¶ colorbar ä¸€èˆ¬ä¾é™„äºä¸€å¼ å¡«è‰²çš„ä¸»å›¾ï¼Œä½†å…¶å®åªè¦ç»™å‡º colormap å’Œ normalization å°±èƒ½å†³å®š colorbar äº†ã€‚ä¸‹é¢ç»™å‡ºå•ç‹¬ç»˜åˆ¶ colorbar çš„ä¾‹å­\nimport copy\rimport numpy as np\rimport matplotlib as mpl\rimport matplotlib.pyplot as plt\rfig, axes = plt.subplots(4, 1, figsize=(10, 5))\rfig.subplots_adjust(hspace=4)\r# ç¬¬ä¸€ä¸ªcolorbarä½¿ç”¨çº¿æ€§çš„Normalize.\rcmap1 = copy.copy(mpl.cm.viridis)\rnorm1 = mpl.colors.Normalize(vmin=0, vmax=100)\rim1 = mpl.cm.ScalarMappable(norm=norm1, cmap=cmap1)\rcbar1 = fig.colorbar(\rim1, cax=axes[0], orientation='horizontal',\rticks=np.linspace(0, 100, 11),\rlabel='colorbar with Normalize'\r)\r# ç¬¬äºŒä¸ªcolorbarå¼€å¯extendå‚æ•°.\rcmap2 = copy.copy(mpl.cm.viridis)\rcmap2.set_under('black')\rcmap2.set_over('red')\rnorm2 = mpl.colors.Normalize(vmin=0, vmax=100)\rim2 = mpl.cm.ScalarMappable(norm=norm2, cmap=cmap2)\rcbar2 = fig.colorbar(\rim2, cax=axes[1], orientation='horizontal',\rextend='both', ticks=np.linspace(0, 100, 11),\rlabel='extended colorbar with Normalize'\r)\r# ç¬¬ä¸‰ä¸ªcolorbarä½¿ç”¨å¯¹æ•°çš„LogNorm.\rcmap3 = copy.copy(mpl.cm.viridis)\rnorm3 = mpl.colors.LogNorm(vmin=1E0, vmax=1E3)\rim3 = mpl.cm.ScalarMappable(norm=norm3, cmap=cmap3)\r# ä½¿ç”¨LogNormæ—¶,colorbarä¼šè‡ªåŠ¨é€‰å–åˆé€‚çš„Locatorå’ŒFormatter.\rcbar3 = fig.colorbar(\rim3, cax=axes[2], orientation='horizontal',\rlabel='colorbar with LogNorm',\r)\r# ç¬¬å››ä¸ªcolorbarä½¿ç”¨BoundaryNorm.\rbins = [0, 1, 10, 20, 50, 100]\rnbin = len(bins) - 1\rcmap4 = mpl.cm.get_cmap('viridis', nbin)\rnorm4 = mpl.colors.BoundaryNorm(bins, nbin)\rim4 = mpl.cm.ScalarMappable(norm=norm4, cmap=cmap4)\r# ä½¿ç”¨BoundaryNormæ—¶,colorbarä¼šè‡ªåŠ¨æŒ‰binsæ ‡å‡ºåˆ»åº¦.\rcbar4 = fig.colorbar(\rim4, cax=axes[3], orientation='horizontal',\rlabel='colorbar with BoundaryNorm'\r)\rplt.show()\r colorbar ä½¿ç”¨çš„ colormap å’Œ normalization çš„ä¿¡æ¯å¯ä»¥é€šè¿‡ cbar.cmap å’Œ cbar.norm å±æ€§æ¥è·å–ã€‚\n1.2 å‘ä¸»å›¾æ·»åŠ  colorbar æ—¥å¸¸ä½¿ç”¨ä¸­ä¸€èˆ¬ä¸ä¼šå•ç‹¬ç”»å‡º colorbarï¼Œè€Œæ˜¯å°† colorbar æ·»åŠ ç»™ä¸€å¼ ä¸»å›¾ã€‚æ­¤æ—¶éœ€è¦å°†ä¸»å›¾ä¸­ç”»å¡«è‰²å›¾æ—¶è¿”å›çš„ ScalarMappable å¯¹è±¡ä¼ ç»™ colorbarï¼Œå¹¶åˆ©ç”¨ cax æˆ– ax å‚æ•°æŒ‡å®š colorbar çš„ä½ç½®ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­\ndef add_box(ax):\r'''ç”¨çº¢æ¡†æ ‡å‡ºä¸€ä¸ªaxçš„èŒƒå›´.'''\raxpos = ax.get_position()\rrect = mpl.patches.Rectangle(\r(axpos.x0, axpos.y0), axpos.width, axpos.height,\rlw=3, ls='--', ec='r', fc='none', alpha=0.5,\rtransform=ax.figure.transFigure\r)\rax.patches.append(rect)\rdef add_right_cax(ax, pad, width):\r'''\råœ¨ä¸€ä¸ªaxå³è¾¹è¿½åŠ ä¸ä¹‹ç­‰é«˜çš„cax.\rpadæ˜¯caxä¸axçš„é—´è·.\rwidthæ˜¯caxçš„å®½åº¦.\r'''\raxpos = ax.get_position()\rcaxpos = mpl.transforms.Bbox.from_extents(\raxpos.x1 + pad,\raxpos.y0,\raxpos.x1 + pad + width,\raxpos.y1\r)\rcax = ax.figure.add_axes(caxpos)\rreturn cax\rdef test_data():\r'''ç”Ÿæˆæµ‹è¯•æ•°æ®.'''\rx = np.linspace(-3, 3, 200)\ry = np.linspace(-3, 3, 200)\rX, Y = np.meshgrid(x, y)\rZ = np.exp(-X**2) + np.exp(-Y**2)\r# å°†Zç¼©æ”¾è‡³[0, 100].\rZ = (Z - Z.min()) / (Z.max() - Z.min()) * 100\rreturn X, Y, Z\rX, Y, Z = test_data()\rcmap = mpl.cm.viridis\rfig, axes = plt.subplots(2, 2, figsize=(10, 10))\rfig.subplots_adjust(hspace=0.2, wspace=0.2)\r# æå‰ç”¨çº¢æ¡†åœˆå‡ºæ¯ä¸ªaxçš„èŒƒå›´,å¹¶å…³é—­åˆ»åº¦æ˜¾ç¤º.\rfor ax in axes.flat:\radd_box(ax)\rax.axis('off')\r# ç¬¬ä¸€ä¸ªå­å›¾ä¸­ä¸ç”»å‡ºcolorbar.\rim = axes[0, 0].pcolormesh(X, Y, Z, cmap=cmap, shading='nearest')\raxes[0, 0].set_title('without colorbar')\r# ç¬¬äºŒä¸ªå­å›¾ä¸­ç”»å‡ºä¾é™„äºaxçš„å‚ç›´çš„colorbar.\rim = axes[0, 1].pcolormesh(X, Y, Z, cmap=cmap, shading='nearest')\rcbar = fig.colorbar(im, ax=axes[0, 1], orientation='vertical')\raxes[0, 1].set_title('add vertical colorbar to ax')\r# ç¬¬ä¸‰ä¸ªå­å›¾ä¸­ç”»å‡ºä¾é™„äºaxçš„æ°´å¹³çš„colorbar.\rim = axes[1, 0].pcolormesh(X, Y, Z, cmap=cmap, shading='nearest')\rcbar = fig.colorbar(im, ax=axes[1, 0], orientation='horizontal')\raxes[1, 0].set_title('add horizontal colorbar to ax')\r# ç¬¬ä¸‰ä¸ªå­å›¾ä¸­å°†å‚ç›´çš„colorbarç”»åœ¨caxä¸Š.\rim = axes[1, 1].pcolormesh(X, Y, Z, cmap=cmap, shading='nearest')\rcax = add_right_cax(axes[1, 1], pad=0.02, width=0.02)\rcbar = fig.colorbar(im, cax=cax)\raxes[1, 1].set_title('add vertical colorbar to cax')\rplt.show()\r ç»„å›¾é€šè¿‡ plt.subplots å‡½æ•°åˆ›å»ºï¼Œè¿™é‡Œç”¨çº¢è‰²è™šçº¿æ–¹æ¡†åœˆå‡ºæ¯ä¸ªå­å›¾å¼€å§‹æ—¶çš„èŒƒå›´ã€‚ç„¶åç¬¬ä¸€ä¸ªå­å›¾å†…ç”»å›¾ä½†ä¸æ·»åŠ  colorbarï¼Œå¯ä»¥çœ‹åˆ°å…¶èŒƒå›´ä¸çº¢æ¡†é‡åˆï¼›ç¬¬äºŒä¸ªå­å›¾å†…ç”¨ ax å‚æ•°æŒ‡å®š colorbar ä¾é™„äºè¯¥å­å›¾ï¼Œå¯ä»¥çœ‹åˆ°å­å›¾çš„æ°´å¹³èŒƒå›´è¢« colorbar å·èµ°äº†ä¸€éƒ¨åˆ†ï¼ŒåŒç†ç¬¬ä¸‰ä¸ªå­å›¾çš„å‚ç›´èŒƒå›´è¢«å·èµ°äº†ä¸€éƒ¨åˆ†ï¼›è€Œç¬¬å››ä¸ªå­å›¾ä¸­å› ä¸ºæ‰‹åŠ¨åœ¨å­å›¾å³è¾¹åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ axes å¹¶æŒ‡å®šä¸º caxï¼Œæ‰€ä»¥ colorbar å¹¶æ²¡æœ‰æŒ¤å å­å›¾åŸæœ‰çš„ç©ºé—´ã€‚\næ€»ä¹‹ï¼Œå‘ä¸»å›¾æ·»åŠ  colorbar æ—¶ï¼Œax å‚æ•°ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼Œä½†ä¼šæ”¹å˜ä¸»å›¾çš„èŒƒå›´ï¼›cax å‚æ•°éœ€è¦æå‰ä¸º colorbar å‡†å¤‡ä¸€ä¸ª axesï¼Œä½† colorbar çš„æ‘†æ”¾ä½ç½®æ›´ä¸ºçµæ´»ã€‚\n2. è®¾ç½®åˆ»åº¦ ç¬¬ 1 èŠ‚ä¸­æåˆ°è¿‡ï¼Œåœ¨åˆå§‹åŒ– colorbar æ—¶é€šè¿‡ ticks å’Œ format å‚æ•°å³å¯è®¾ç½®åˆ»åº¦ã€‚å®é™…ä¸Šï¼Œcolorbar åœ¨æ¥å—åˆ»åº¦çš„è®¾ç½®åï¼Œä¼šå°†å®ƒä»¬ä¼ ç»™åº•å±‚çš„ axes å¯¹è±¡ï¼Œåˆ©ç”¨ axes çš„æ–¹æ³•æ¥å®ç°åˆ»åº¦çš„æ ‡æ³¨ã€‚æ‰€ä»¥ä¸º colorbar è®¾ç½®åˆ»åº¦æœ‰ä¸¤ç§æ€è·¯\n åˆ©ç”¨ colorbar æä¾›çš„æ¥å£è®¾ç½®åˆ»åº¦ï¼Œä¼˜ç‚¹æ˜¯ç®€å•ç›´æ¥ï¼Œç¼ºç‚¹æ˜¯å¯¹äºå°åˆ»åº¦ç­‰å‚æ•°æ— æ³•è¿›è¡Œç»†è‡´çš„è®¾å®šã€‚ ç›´æ¥æ“ä½œ colorbar åº•å±‚çš„ axesï¼Œä¼˜ç‚¹æ˜¯è®¾ç½®æ›´ç»†è‡´ï¼Œç¼ºç‚¹æ˜¯å¯èƒ½ä¼šå— cbar.update_ticks æ–¹æ³•çš„å¹²æ‰°ã€‚  æ­£å› ä¸ºè¿™ä¸¤ç§æ€è·¯éƒ½è¡Œå¾—é€šï¼Œæ‰€ä»¥ä½ ä¸Šç½‘æœå¦‚ä½•è®¾ç½®åˆ»åº¦æ—¶èƒ½æ‰¾åˆ°äº”èŠ±å…«é—¨çš„æ–¹æ³•ï¼Œä¸‹é¢ä¾¿æ¥ä¸€ä¸€è¾¨æè¿™äº›æ–¹æ³•ã€‚\nå¦å¤–éœ€è¦æå‰è¯´æ˜ä¸€ä¸‹ï¼Œcolorbar ä¸åŒäºæ™®é€šçš„ axesï¼Œåªä¼šæ˜¾ç¤ºè½å…¥ cbar.vmin å’Œ cbar.vmax è¿™ä¸¤ä¸ªå€¼èŒƒå›´å†…çš„ ticksï¼Œè€Œè¿™ä¸¤ä¸ªå€¼ç”± colorbar å«æœ‰çš„ normalization çš„ä¿¡æ¯å†³å®šï¼ˆä¾‹å¤–ä¼šåœ¨åé¢æåˆ°ï¼‰ã€‚\n2.1 ticks å’Œ format å‚æ•° cmap = mpl.cm.viridis\rnorm = mpl.colors.Normalize(vmin=0, vmax=100)\rim = mpl.cm.ScalarMappable(norm=norm, cmap=cmap)\rlocator = mpl.ticker.MultipleLocator(10)\rformatter = mpl.ticker.StrMethodFormatter('{x:.1f}')\rcbar = fig.colorbar(\rim, cax=ax, orientation='horizontal',\rticks=locator, format=formatter\r)\rcbar.minorticks_on()\r ç›´æ¥åœ¨åˆå§‹åŒ– colorbar çš„æ—¶å€™ç»™å‡ºæŒ‡å®š ticks å’Œ format å‚æ•°å³å¯ã€‚\nå°åˆ»åº¦åˆ™é€šè¿‡ minorticks_on æ–¹æ³•å¼€å¯ï¼Œå¯æƒœè¿™ä¸ªæ–¹æ³•ä¸æä¾›ä»»å¯æ§è°ƒèŠ‚çš„å‚æ•°ï¼ŒæŸ¥çœ‹æºç ä¼šå‘ç°ï¼Œcolorbar æ˜¯å€ŸåŠ© matplotlib.ticker.AutoMinorLocator å®ç°å°åˆ»åº¦çš„ï¼Œå…¶ä¸­å°åˆ»åº¦çš„é—´éš”æ•° n è¢«ç¡¬ç¼–ç ä¸ºé»˜è®¤å€¼ Noneï¼Œæ‰€ä»¥å°åˆ»åº¦çš„æ•°ç›®ä¼šæ ¹æ®å¤§åˆ»åº¦çš„æ•°å€¼è®¾ä¸º 3 ä¸ªæˆ– 4 ä¸ªï¼Œä¾‹å¦‚å›¾ä¸­ä¸¤ä¸ªå¤§åˆ»åº¦é—´å°±æ˜¯ 4 ä¸ªå°åˆ»åº¦ã€‚\n2.2 locator å’Œ formatter å±æ€§ cbar = fig.colorbar(im, cax=ax, orientation='horizontal')\rcbar.locator = locator\rcbar.formatter = formatter\rcbar.minorticks_on()\rcbar.update_ticks()\r å›¾è·Ÿ 2.1 èŠ‚çš„ä¸€æ ·ã€‚ç›´æ¥ä¿®æ”¹ locator å’Œ formatter å±æ€§ï¼Œæ¥ç€è°ƒç”¨ update_ticks æ–¹æ³•åˆ·æ–°åˆ»åº¦ï¼Œå°†è¿™ä¸¤ä¸ªå±æ€§ä¼ ç»™åº•å±‚çš„ axesï¼Œä»è€Œä½¿åˆ»åº¦ç”Ÿæ•ˆã€‚2.1 èŠ‚ä¸­ä¸éœ€è¦åˆ·æ–°æ˜¯å› ä¸ºåˆå§‹åŒ–çš„æœ€åä¼šè‡ªåŠ¨åˆ·æ–°ã€‚\n2.3 set_ticks å’Œ set_ticklabels æ–¹æ³• ticks = np.linspace(0, 100, 11)\rticklabels = [formatter(tick) for tick in ticks]\rcbar = fig.colorbar(im, cax=ax, orientation='horizontal')\rcbar.set_ticks(ticks)\rcbar.set_ticklabels(ticklabels)\rcbar.minorticks_on()\r å›¾è·Ÿ 2.1 èŠ‚çš„ä¸€æ ·ã€‚è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºæ‰‹åŠ¨ç»™å‡º ticks å’Œä¸ä¹‹åŒ¹é…çš„ ticklabels çš„æƒ…å†µã€‚åŒæ—¶ set_ticks å’Œ set_ticklabels éƒ½æœ‰ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„ update_ticks å‚æ•°ï¼Œæ•ˆæœåŒ 2.2 èŠ‚æ‰€è¿°ï¼Œå› ä¸ºé»˜è®¤ä¸º Trueï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨ç®¡å®ƒã€‚å¥‡æ€ªçš„æ˜¯ï¼Œset_ticks æ–¹æ³•è¿˜å¯ä»¥æ¥å— Locator å¯¹è±¡ï¼Œä¸è¿‡å½“ Locator ä¸ ticklabels å¯¹ä¸ä¸Šæ—¶å°±ä¼šå‘å‡ºè­¦å‘Šå¹¶äº§ç”Ÿé”™è¯¯çš„ç»“æœã€‚\nä¹Ÿè®¸ä½ ä¼šè”æƒ³åˆ° axes è®¾ç½®åˆ»åº¦çš„æ–¹æ³•ï¼Œå¹¶è¿›è¡Œè¿™æ ·çš„å°è¯•\ncbar.ax.set_xticks(ticks)\rcbar.ax.set_xticklabels(ticklabels)\r å¯æƒœè¿™ç§æ–¹æ³•è¡Œä¸é€šï¼Œä¹Ÿæ˜¯ä¼šæŠ¥è­¦åŠ å‡ºé”™ã€‚\n2.4 set_major_locator å’Œ set_major_formatter æ–¹æ³• cbar = fig.colorbar(im, cax=ax, orientation='horizontal')\rcbar.ax.xaxis.set_major_locator(locator)\rcbar.ax.xaxis.set_minor_locator(mpl.ticker.AutoMinorLocator(2))\rcbar.ax.xaxis.set_major_formatter(formatter)\r# cbar.update_ticks()\r å›¾è·Ÿ 2.1 èŠ‚çš„ä¸€æ ·ã€‚è™½ç„¶ 2.3 ä¸­ç›´æ¥è°ƒç”¨ set_xticks å’Œ set_xticklabels çš„æ–¹æ³•å¤±è´¥äº†ï¼Œä½†ç¥ç§˜çš„æ˜¯ç›´æ¥è°ƒç”¨ set_major_locator å’Œ set_major_formatter å´å¯ä»¥ï¼Œä½ ç”šè‡³å¯ä»¥ç”¨ set_minor_locator æ¥å®ç°æ›´ç»†è‡´çš„å°åˆ»åº¦ã€‚è¿™é‡Œå› ä¸º colorbar æ˜¯æ°´å¹³æ”¾ç½®çš„ï¼Œæ‰€ä»¥æ“ä½œçš„æ˜¯ xaxisï¼Œå‚ç›´æ–¹å‘æ¢æˆ yaxis å³å¯ã€‚\nè¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼Œcolorbar çš„ locator å±æ€§ä¸ xaxis çš„å¹¶ä¸ä¸€è‡´\nIn : print(cbar.locator)\rOut: \u0026lt;matplotlib.colorbar._ColorbarAutoLocator object at 0x000001B424E36AF0\u0026gt;\rIn : print(cbar.ax.xaxis.get_major_locator())\rOut: \u0026lt;matplotlib.ticker.MultipleLocator object at 0x000001B424E366A0\u0026gt;\r å°½ç®¡ç”»å‡ºæ¥çš„å›¾æ˜¯ MultipleLocator çš„æ•ˆæœï¼Œä½† cbar.locator ä¾æ—§ä¿ç•™åˆå§‹åŒ–æ—¶çš„é»˜è®¤å€¼ï¼Œcbar.formatter åŒç†ã€‚å¦‚æœæ­¤æ—¶æ‰§è¡Œ cbar.update_ticks()ï¼Œå°±ä¼šå°† cbar.ax.xaxis çš„ locator å’Œ formatter æ›´æ–°æˆ cbar.locator å’Œ cbar.formatter çš„å€¼â€”â€”å³å˜å›é»˜è®¤æ•ˆæœã€‚å¥‡æ€ªçš„æ˜¯ minor locator å¹¶ä¸å— update_ticks çš„å½±å“ï¼Œå°åˆ»åº¦ä¾ç„¶å¾—åˆ°ä¿ç•™ã€‚\n2.5 å¯¹æ•°åˆ»åº¦ 1.1 èŠ‚ä¸­å±•ç¤ºè¿‡ï¼Œå½“ä¼ å…¥çš„ mappable çš„ norm æ˜¯ LogNorm æ—¶ï¼Œcolorbar ä¼šè‡ªåŠ¨é‡‡å–å¯¹æ•°åˆ»åº¦å’Œç§‘å­¦è®¡æ•°æ³•çš„æ ‡ç­¾ï¼Œå¹¶å¼€å¯å°åˆ»åº¦ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¸ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼Œå¹¶å…³æ‰å°åˆ»åº¦çš„ä¾‹å­\nnorm = mpl.colors.LogNorm(vmin=1E0, vmax=1E3)\rim = mpl.cm.ScalarMappable(norm=norm, cmap=cmap)\rcbar = fig.colorbar(\rim, cax=ax, orientation='horizontal',\rformat=mpl.ticker.ScalarFormatter()\r)\rcbar.minorticks_off()\r 2.6 æ›´å¤šè®¾ç½® å¦‚æœæƒ³è¿›ä¸€æ­¥è®¾ç½®åˆ»åº¦çš„å‚æ•°ï¼ˆåˆ»åº¦é•¿åº¦ã€æ ‡ç­¾å­—ä½“ç­‰ï¼‰ï¼Œéœ€è¦é€šè¿‡åº•å±‚çš„ cbar.ax.tick_params æ–¹æ³•æ¥å®ç°ã€‚ä¾‹å¦‚\ncbar.ax.tick_params(length=2, labelsize='x-small')\r æ€»ç»“ä¸€ä¸‹çš„è¯ï¼Œcolorbar æä¾›äº†è®¾ç½®åˆ»åº¦çš„æ¥å£ï¼Œä½†åšå¾—è¿˜ä¸å¤Ÿå®Œå–„ï¼Œä»¥è‡³äºæˆ‘ä»¬éœ€è¦ç›´æ¥æ“ä½œåº•å±‚çš„ axesã€‚å¸Œæœ›ä»¥å Matplotlib èƒ½å¯¹æ­¤åŠ ä»¥æ”¹å–„ã€‚\n3. Contourf ä¸­çš„ colorbar æŠŠ pcolorã€imshow ç­‰å‡½æ•°çš„è¿”å›å€¼ä¼ ç»™ colorbar æ—¶ï¼Œcolorbar ä¸­ä¼šæ˜¾ç¤ºè¿ç»­å®Œæ•´çš„ colormapï¼›ä½†è‹¥æŠŠ contourf å‡½æ•°çš„è¿”å›å€¼ä¼ ç»™ colorbar æ—¶ï¼Œæ˜¾ç¤ºçš„å°±ä¸å†æ˜¯å®Œæ•´çš„ colormapï¼Œè€Œæ˜¯ç­‰é«˜çº¿ä¹‹é—´çš„å¡«è‰²ï¼ˆå¡«è‰²è§„åˆ™è¯·è§ Matplotlib ç³»åˆ—ï¼šcolormap çš„è®¾ç½® ç¬¬ 3.1 èŠ‚ï¼‰ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª pcolormesh ä¸ contourf ç›¸å¯¹æ¯”çš„ä¾‹å­\nX, Y, Z = test_data()\rcmap = mpl.cm.viridis\rnorm = mpl.colors.Normalize(vmin=0, vmax=100)\rlevels = [10, 20, 40, 80]\rfig, axes = plt.subplots(1, 2, figsize=(10, 5))\rfor ax in axes:\rax.axis('off')\r# ç¬¬ä¸€å¼ å›¾ç”»pcolormesh.\rim = axes[0].pcolormesh(X, Y, Z, cmap=cmap, norm=norm, shading='nearest')\rcbar = fig.colorbar(im, ax=axes[0], extend='both')\raxes[0].set_title('pcolormesh')\r# ç¬¬äºŒå¼ å›¾ç”»contourf.\rim = axes[1].contourf(X, Y, Z, levels=levels, cmap=cmap, norm=norm, extend='both')\rcbar = fig.colorbar(im, ax=axes[1])\raxes[1].set_title('contourf')\rplt.show()\r å¯ä»¥çœ‹åˆ°æ•ˆæœä¸ä¸Šé¢æè¿°çš„ä¸€è‡´ï¼Œcolorbar ä¸Šé¢œè‰²é—´çš„åˆ†ç•Œä½ç½®ä¹Ÿä¸ levels çš„æ•°å€¼å¤§å°ç›¸å¯¹åº”ã€‚ç¬¬ 2 èŠ‚ä¸­æåˆ°è¿‡ï¼Œcolorbar çš„æ˜¾ç¤ºèŒƒå›´ç”± cbar.vmin å’Œ cbar.vmax å†³å®šï¼Œä¸”è¿™ä¸¤ä¸ªå€¼ä¸ cbar.norm.vmin å’Œ cbar.norm.vmax ç›¸åŒâ€”â€”ä¸è¿‡ä½¿ç”¨ contourf çš„è¿”å›å€¼ä½œä¸º mappable æ—¶åˆ™æ˜¯ä¾‹å¤–ï¼Œè¿™é‡Œ cbar.vmin å’Œ cbar.vmax ç”± levels çš„è¾¹ç•Œå†³å®šã€‚æ‰€ä»¥ä¸Šå›¾ä¸­ colorbar çš„èŒƒå›´ä¸º [10, 80]ã€‚\nå¦å¤–è‹¥ contourf ä¸­æŒ‡å®šè¿‡ extend å‚æ•°ï¼Œé‚£ä¹ˆå…¶è¿”å›å€¼ä¼šå¸¦æœ‰ extend çš„ä¿¡æ¯ï¼Œåˆå§‹åŒ– colorbar æ—¶å°±ä¸åº”è¯¥å†è®¾å®š extend å‚æ•°äº†ã€‚Matplotlib 3.3 ä»¥ååŒæ—¶ä½¿ç”¨ extend å‚æ•°çš„è¡Œä¸ºè¢«åºŸå¼ƒã€‚\n4. ä¸ºç»„å›¾æ·»åŠ  colorbar 4.1 ä¸ºæ¯ä¸ªå­å›¾æ·»åŠ  æœ€ç®€å•çš„æ–¹æ³•æ˜¯åœ¨ç»˜åˆ¶æ¯ä¸ªå­å›¾çš„ colorbar æ—¶ï¼Œå°† ax å‚æ•°æŒ‡å®šä¸ºå­å›¾çš„ axesï¼Œç¼ºç‚¹æ˜¯ä¼šæ”¹å˜å­å›¾å½¢çŠ¶ï¼Œä¸è¿‡å¯ä»¥ä¹‹åç”¨ ax.set_aspect ç­‰æ–¹æ³•è¿›è¡Œè°ƒæ•´ã€‚ä¸‹é¢åˆ©ç”¨ 1.2 èŠ‚ä¸­çš„ add_right_cax å‡½æ•°å®ç° cax çš„ç‰ˆæœ¬\nX, Y, Z = test_data()\rcmap = mpl.cm.viridis\rnorm = mpl.colors.Normalize(vmin=0, vmax=100)\rfig, axes = plt.subplots(2, 2, figsize=(8, 8))\r# è°ƒèŠ‚å­å›¾é—´çš„å®½åº¦,ä»¥ç•™å‡ºæ”¾colorbarçš„ç©ºé—´.\rfig.subplots_adjust(wspace=0.4)\rfor ax in axes.flat:\rax.axis('off')\rcax = add_right_cax(ax, pad=0.01, width=0.02)\rim = ax.pcolormesh(X, Y, Z, cmap=cmap, norm=norm, shading='nearest')\rcbar = fig.colorbar(im, cax=cax)\rplt.show()\r æ›´é«˜çº§çš„æ–¹æ³•æ˜¯ä½¿ç”¨ mpl_toolkits.axes_grid1.ImageGrid ç±»ï¼Œä¾‹å¦‚\nfrom mpl_toolkits.axes_grid1 import ImageGrid\rfig = plt.figure(figsize=(8, 8))\rgrid = ImageGrid(\rfig, 111, nrows_ncols=(2, 2), axes_pad=0.5,\rcbar_mode='each', cbar_location='right', cbar_pad=0.1\r)\r# è¿™é‡Œaxæ˜¯mpl_toolkits.axes_grid1.mpl_axes.Axes\rfor ax in grid:\rax.axis('off')\rim = ax.pcolormesh(X, Y, Z, cmap=cmap, norm=norm, shading='nearest')\r# å®˜ç½‘ä¾‹å­ä¸­çš„cax.colorbar(im)ç”¨æ³•è‡ªMatplotlib 3.2èµ·åºŸå¼ƒ.\rcbar = fig.colorbar(im, cax=ax.cax)\rplt.show()\r ç»“æœè·Ÿä¸Šé¢ä¸€å¼ å›¾å·®ä¸å¤šã€‚ImageGrid é€‚åˆåˆ›å»ºå­å›¾å®½é«˜æ¯”å›ºå®šçš„ç»„å›¾ï¼ˆä¾‹å¦‚ imshow çš„å›¾åƒæˆ–ç­‰ç»çº¬åº¦æŠ•å½±çš„åœ°å›¾ï¼‰ï¼Œå¹¶ä¸”å¯¹äº colorbar ä½ç½®å’Œé—´è·çš„è®¾ç½®éå¸¸ä¾¿åˆ©ã€‚æ­¤å¤–è¿˜æœ‰åˆ©ç”¨ matplotlib.gridspec.GridSpec å’Œ mpl_toolkits.axes_grid1.axes_divider çš„æ–¹æ³•ï¼Œè¿™é‡Œå°±ä¸ç»†è®²äº†ã€‚\n4.2 ä¸ºæ•´ä¸ªç»„å›¾æ·»åŠ  å…¶å® colorbar çš„ ax å‚æ•°è¿˜å¯ä»¥æ¥å— axes ç»„æˆçš„åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰ï¼Œä»è€Œå®ç°ä¸ºåˆ—è¡¨ä¸­çš„æ‰€æœ‰ axes åªæ·»åŠ ä¸€ä¸ª colorbarã€‚ä¾‹å¦‚\nfig, axes = plt.subplots(2, 2, figsize=(8, 8))\rfor ax in axes.flat:\rax.axis('off')\rim = ax.pcolormesh(X, Y, Z, cmap=cmap, norm=norm, shading='nearest')\rcbar = fig.colorbar(im, ax=axes)\rplt.show()\r å†ä¸¾ä¸ª ImageGrid çš„ä¾‹å­\nfig = plt.figure(figsize=(8, 8))\rgrid = ImageGrid(\rfig, 111, nrows_ncols=(2, 2), axes_pad=0.5,\rcbar_mode='single', cbar_location='right', cbar_pad=0.2,\r)\rfor ax in grid:\rax.axis('off')\rim = ax.pcolormesh(X, Y, Z, cmap=cmap, norm=norm, shading='nearest')\rcbar = fig.colorbar(im, cax=ax.cax)\rplt.show()\r ç»“æœåŒä¸Šä¸€å¼ å›¾ã€‚å¦‚æœæœ‰æ›´å¤æ‚çš„éœ€æ±‚ï¼Œä¾‹å¦‚åœ¨ä¸æ”¹å˜å­å›¾å½¢çŠ¶çš„å‰æä¸‹ï¼Œç»„å›¾ä¸­ä¸åŒåŒºåŸŸçš„å­å›¾å…±ç”¨ä¸åŒçš„ colorbarï¼Œé‚£ä¹ˆå»ºè®®ä½¿ç”¨ add_axes çš„æ–¹æ³•ï¼ˆå‚è€ƒ 1.2 èŠ‚çš„ add_right_cax å‡½æ•°ï¼‰ï¼Œæˆ–åˆ©ç”¨ matplotlib.gridspec.GridSpec å°† cax ç©¿æ’åœ¨ç»„å›¾é—´ã€‚æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è¯»è¯»å‚è€ƒé“¾æ¥ä¸­æœ€åé‚£ç¯‡ã€‚\n5. å‚è€ƒé“¾æ¥ å®˜æ–¹æ•™ç¨‹\nCustomized Colorbars Tutorial\nOverview of axes_grid1 toolkit\nCartopy çš„ä¾‹å­\nUsing Cartopy and AxesGrid toolkit\nå¯èƒ½æ˜¯å…¨ç½‘æœ€è¯¦ç»†çš„ colorbar è°ƒæ•´æ•™ç¨‹\nmatplotlibã®colorbarã‚’è§£å‰–ã—ã¦ã‚ã‹ã£ãŸã“ã¨ã€ã‚ã‚‹ã„ã¯ã‚‚ã†colorbarèª¿æ•´ã«è‹¦åŠ´ã—ãŸããªã„äººã«æ§ã’ã‚‹è©±\n","date":"2021-07-10","permalink":"https://zhajiman.github.io/post/matplotlib_colorbar/","tags":["matplotlib"],"title":"Matplotlib ç³»åˆ—ï¼šcolorbar çš„è®¾ç½®"},{"content":"0. å‰è¨€ æ‰€è°“ colormapï¼ˆé¢œè‰²è¡¨ï¼‰ï¼Œå°±æ˜¯å°†ä¸€ç³»åˆ—é¢œè‰²æŒ‰ç»™å®šçš„é¡ºåºæ’åˆ—åœ¨ä¸€èµ·ã€‚å…¶ç”¨å¤„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸç§æ˜ å°„å…³ç³»ï¼Œå°†ä¸€ç³»åˆ—æ•°å€¼æ˜ å°„åˆ°ä¸€å¼  colormap ä¸Šå»ï¼Œä½¿ä¸åŒå¤§å°çš„æ•°å€¼å¯¹åº”ä¸åŒçš„é¢œè‰²ã€‚è¿™æ ·ä¸€æ¥ï¼Œåœ¨ç»˜åˆ¶å¡«è‰²å›¾æ—¶ä¾¿èƒ½ç›´è§‚åœ°ç”¨é¢œè‰²æ¥åæ˜ æ•°å€¼çš„åˆ†å¸ƒã€‚\nåœ¨ Matplotlib ä¸­ï¼Œæ•°å€¼åˆ°é¢œè‰²çš„æ˜ å°„å…³ç³»å¯ä»¥ç”¨ä¸‹é¢è¿™å¼ å›¾æ¥è¡¨ç¤º\nå›¾ä¸­åˆ†ä¸ºå‰åä¸¤éƒ¨åˆ†\n é¦–å…ˆå°†æ•°ç»„çš„æ•°å€¼å½’ä¸€åŒ–ï¼ˆNormalizationï¼‰åˆ°æµ®ç‚¹å‹çš„ [0.0, 1.0] èŒƒå›´æˆ–æ•´å‹çš„ [0, N - 1] èŒƒå›´ä¸Šå»ã€‚ å†æŠŠå½’ä¸€åŒ–çš„æ•°æ®è¾“å…¥ç»™ colormapï¼Œè¾“å‡ºæ•°ç»„æ•°å€¼å¯¹åº”çš„é¢œè‰²ï¼ˆRGBA å€¼ï¼‰ã€‚  ç¬¬äºŒéƒ¨åˆ†çš„æ˜ å°„å…³ç³»åŸºæœ¬ä¸Šæ˜¯å›ºå®šä¸å˜çš„ï¼Œä½†ç¬¬ä¸€éƒ¨åˆ†çš„æ˜ å°„å…³ç³»å¯ä»¥é€šè¿‡ Matplotlib çš„è®¸å¤šç±»æ¥åŠ ä»¥æ”¹å˜ï¼Œè¿›è€Œå®ç°å¯¹æ•°è‰²æ ‡ã€å¯¹ç§°è‰²æ ‡ã€ç¦»æ•£è‰²æ ‡ç­‰ä¸€ç³»åˆ—å¯è§†åŒ–æ•ˆæœã€‚\næœ¬æ–‡å°†ä¼šä¾æ¬¡ä»‹ç» Colormap ç±»ã€å½’ä¸€åŒ–ä¼šç”¨åˆ°çš„ç±»ï¼Œä»¥åŠå®é™…åº”ç”¨çš„ä¾‹å­ã€‚ä»£ç åŸºäº Matplotlib 3.3.4ã€‚\n1. Colormap å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œä¸€ç³»åˆ—é¢œè‰²å¯ä»¥ç”¨ N * 4 å¤§å°çš„ RGBA æ•°ç»„è¡¨ç¤ºã€‚ä½†æ˜¯ matplotlib ä¸­çš„ colormap å¹¶éç®€å•çš„æ•°ç»„ï¼Œè€Œæ˜¯ä¸“é—¨ç”¨ä¸€ä¸ª Colormap ç±»å®ç°çš„ï¼Œæœ‰ç€æ›´åŠ æ–¹ä¾¿çš„é‡é‡‡æ ·åŠŸèƒ½ã€‚å†…ç½®çš„æ‰€æœ‰ colormap å­˜æ”¾åœ¨ matplotlib.cm æ¨¡å—ä¸‹ï¼Œå®ƒä»¬çš„åå­—åœ¨å®˜ç½‘çš„ Choosing Colormaps in Matplotlib é¡µé¢ä¸­å¯ä»¥æ‰¾åˆ°ã€‚\nColormap æœ‰ä¸¤ä¸ªå­ç±»ï¼šListedColormap å’Œ LinearSegmentedColormapï¼Œå®ƒä»¬è¢«å­˜æ”¾åœ¨ matplotlib.colors æ¨¡å—ä¸‹ã€‚ä¸‹é¢æ¥åˆ†åˆ«ä»‹ç»å®ƒä»¬ã€‚\n1.1 ListedColormap é¡¾åæ€ä¹‰ï¼Œå°†æ‰€æœ‰é¢œè‰²åˆ—ä¸¾åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œä¾¿èƒ½ç”Ÿæˆè¿™ä¸€ç±»çš„ colormapã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­å¦‚ä¸‹\nimport matplotlib as mpl\rimport matplotlib.pyplot as plt\rcmap = mpl.colors.ListedColormap(\r[\u0026quot;darkorange\u0026quot;, \u0026quot;gold\u0026quot;, \u0026quot;lawngreen\u0026quot;, \u0026quot;lightseagreen\u0026quot;]\r)\r åˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯ RGBA å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯é¢œè‰²çš„åå­—ã€‚è¿™ä¸ª colormap çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„\næ­£å¥½æ˜¯æˆ‘ä»¬æ”¾å…¥åˆ—è¡¨ä¸­çš„å››ç§é¢œè‰²ã€‚\ncmap.colors æ˜¯è¿™ä¸ª colormap çš„æ‰€æœ‰é¢œè‰²çš„ RGBA å€¼ç»„æˆçš„å…ƒç»„ï¼Œè€Œ cmap.N æ˜¯é¢œè‰²çš„æ€»æ•°ï¼Œæ˜¾ç„¶è¿™é‡Œ N = 4ã€‚cmap å¯¹è±¡å¯ä»¥ç”¨æ•°å€¼å‚æ•°è°ƒç”¨ï¼Œè¿”å›æ•°å€¼å¯¹åº”çš„é¢œè‰² RGBA å€¼ï¼Œæ ¹æ®æ•°å€¼æ˜¯æ•´å‹è¿˜æ˜¯æµ®ç‚¹å‹ï¼Œå¯¹åº”å…³ç³»ä¹Ÿä¼šæœ‰æ‰€ä¸åŒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\nå½“å‚æ•° x ä¸ºæ•´æ•°æ—¶ï¼Œå¯¹åº”äºç¬¬ x - 1 ä¸ªé¢œè‰²ï¼›å½“å‚æ•° x ä¸ºæµ®ç‚¹æ•°æ—¶ï¼Œè¿”å›å®ƒè½å…¥çš„åŒºé—´å¯¹åº”çš„é¢œè‰²ã€‚å½“å‚æ•° x è¶…å‡º [0, N-1] æˆ– [0.0, 1.0] çš„èŒƒå›´æ—¶ï¼Œå¯¹åº”äºç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªé¢œè‰²ã€‚è¿™ä¸€ç‰¹æ€§èƒ½è®©æˆ‘ä»¬å¾ˆç®€å•åœ°ç´¢å¼• colormap ä¸­çš„é¢œè‰²ï¼Œä¾‹å¦‚\nå¯ä»¥çœ‹åˆ°ç”¨ä¸åŒç±»å‹çš„å‚æ•°ç´¢å¼•å‡ºçš„ RGBA æ•°ç»„æ˜¯ä¸€è‡´çš„ã€‚å†ä¸¾ä¸ªåˆ©ç”¨ç´¢å¼•ç»“æœåˆ›å»ºæ–° colormap çš„ä¾‹å­\ncmap_new = mpl.colors.ListedColormap(\rcmap(np.linspace(0, 1, 5))\r)\r cmap_new çœ‹èµ·æ¥ä¼šæ˜¯è¿™ä¸ªæ ·å­\nå› ä¸ºç»™å‡ºçš„å‚æ•°ä¸­ï¼Œæœ€åä¸¤ä¸ªæ•°è½è¿›äº†åŒä¸€ä¸ªåŒºé—´ï¼Œæ‰€ä»¥å¯¹åº”çš„é¢œè‰²ç›¸åŒã€‚\n1.2 LinearSegmentedColormap é¡¾åæ€ä¹‰ï¼Œæ˜¯é€šè¿‡çº¿æ€§åˆ†æ®µæ„å»ºçš„ colormapã€‚é¦–å…ˆç»™å®šå‡ ä¸ªé¢œè‰²çš„é”šç‚¹ï¼Œç„¶åé”šç‚¹ä¹‹é—´çš„é¢œè‰²ä¼šé€šè¿‡çº¿æ€§æ’å€¼å¾—å‡ºã€‚ç›´æ¥åˆå§‹åŒ–è¯¥ç±»çš„æ–¹æ³•æ¯”è¾ƒéš¾ä»¥ç†è§£ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šç”¨ LinearSegmentedColormap.from_list å‡½æ•°æ¥åˆ›å»ºå¯¹è±¡ï¼Œæœ‰éœ€æ±‚çš„è¯»è€…å¯ä»¥å‚é˜…æ–‡æ¡£ã€‚\nMatplotlib ä¸­å¤§éƒ¨åˆ† colormap éƒ½å±äº LinearSegmentedColormapï¼Œä¾‹å¦‚å¸¸ç”¨çš„ jet\ncmap = mpl.cm.jet\r çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„\nä¸ ListedColormap ç›¸æ¯”ï¼ŒLinearSegmentedColormap ä¾æ—§æœ‰ cmap.N å±æ€§ï¼Œé»˜è®¤æ•°å€¼ä¸º 256ã€‚ä½†æ˜¯æ²¡æœ‰äº† cmap.colorsï¼Œä¸èƒ½ç›´æ¥åˆ—å‡ºè¿™ N ä¸ªé¢œè‰²çš„ RGBA å€¼ã€‚\ncmap ä¾æ—§å¯ä»¥è¢«ç›´æ¥è°ƒç”¨ï¼šå½“å‚æ•° x ä¸ºæ•´æ•°æ—¶ï¼Œå¯¹åº”äºç¬¬ x + 1 ä¸ªé¢œè‰²ï¼›è€Œå½“å‚æ•° x ä¸ºæµ®ç‚¹æ•°æ—¶ï¼Œåˆ™ä¼šé€šè¿‡çº¿æ€§æ’å€¼è·å–ç›¸é‚»ä¸¤ä¸ªé¢œè‰²ä¸­é—´çš„é¢œè‰²ã€‚å› æ­¤ï¼ŒLinearSegmentedColormap çš„é‡é‡‡æ ·ä¸ä»…ä¸ä¼šå‡ºç°é‡å¤çš„é¢œè‰²ï¼Œè¿˜èƒ½å¾—åˆ°æ›´ä¸ºè¿ç»­æ¸å˜çš„é¢œè‰²ã€‚\n1.3 get_cmap å‡½æ•° æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›é€šè¿‡é‡é‡‡æ ·ç›´æ¥å¾—åˆ°ä¸€ä¸ªæ–°çš„ colormapï¼Œè€Œä¸æ˜¯å¾—åˆ°ä¸€ç»„ RGBA å€¼ï¼Œè¿™ä¸ªéœ€æ±‚å¯ä»¥ç”¨ mpl.cm.get_cmap å‡½æ•°å®ç°ï¼Œä¾‹å¦‚å¯¹ jet é‡‡æ · 8 ä¸ªé¢œè‰²\n# ç­‰ä»·äºç”¨mpl.cm.jet(np.linspace(0, 1, 8))çš„ç»“æœåˆ›å»ºLinearSegmentedColormap.\rcmap = mpl.cm.get_cmap('jet', 8)\r æ•ˆæœå¦‚ä¸‹å›¾ã€‚å¹¶ä¸”é‡‡æ ·å¾—åˆ°çš„ colormap ç±»å‹ä¸è¢«é‡‡æ ·çš„ä¿æŒä¸€è‡´ã€‚\n1.4 set_underã€set_over ä¸ set_bad 1.1 èŠ‚ä¸­æåˆ°è¿‡ï¼Œç›´æ¥è°ƒç”¨ cmap æ—¶ï¼Œè‹¥å‚æ•° x è¶…å‡ºèŒƒå›´ï¼Œé‚£ä¹ˆä¼šæ˜ å°„ç»™ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªé¢œè‰²ã€‚è€Œ cmap.set_under æ–¹æ³•èƒ½å¤Ÿæ”¹å˜ x \u0026lt; 0 æˆ– x \u0026lt; 0.0 æ—¶å¯¹åº”çš„é¢œè‰²ï¼Œcmap.set_over æ–¹æ³•èƒ½å¤Ÿæ”¹å˜ x \u0026gt; N - 1 æˆ– x \u0026gt; 1.0 æ—¶å¯¹åº”çš„é¢œè‰²ã€‚cmap.set_bad åˆ™èƒ½æ”¹å˜ç¼ºæµ‹å€¼ï¼ˆnan æˆ– maskedï¼‰å¯¹åº”çš„é¢œè‰²ï¼ˆç¼ºæµ‹å€¼çš„ç»˜å›¾è§„åˆ™è¯·å‚è€ƒä¹‹å‰çš„åšæ–‡ NumPy ç³»åˆ—ï¼šç¼ºæµ‹å€¼å¤„ç†ï¼‰ã€‚\nä½¿ç”¨ fig.colorbar æ–¹æ³•ç”» colorbar æ—¶ï¼Œé€šè¿‡ extend å‚æ•°å¯ä»¥æŒ‡å®šæ˜¯å¦åœ¨ colorbar ä¸¤ç«¯æ˜¾ç¤ºå‡º under ä¸ over æ—¶çš„é¢œè‰²ã€‚ä¸‹é¢ä¸ºä¸€ä¸ªä¾‹å­\ncmap = mpl.cm.get_cmap('jet', 8)\rcmap.set_under('black')\rcmap.set_over('white')\r 2. Normalization ä¸Šä¸€èŠ‚çš„é‡ç‚¹æ˜¯ï¼Œcolormap èƒ½æŠŠ [0.0, 1.0] æˆ– [0, N - 1] èŒƒå›´å†…çš„å€¼æ˜ å°„åˆ°é¢œè‰²ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸€èŠ‚å°±è¦æ¥å™è¿°å¦‚ä½•é€šè¿‡å½’ä¸€åŒ–ï¼ˆNormalizationï¼‰æŠŠåŸå§‹æ•°æ®æ˜ å°„åˆ° [0.0, 1.0] æˆ– [0, N - 1] ä¸Šã€‚ç”¨äºå½’ä¸€åŒ–çš„ç±»éƒ½å­˜æ”¾åœ¨ mpl.colors æ¨¡å—ä¸­ã€‚\n2.1 Normalize å„ç§äºŒç»´ç»˜å›¾å‡½æ•°åœ¨è¿›è¡Œå½’ä¸€åŒ–æ—¶éƒ½é»˜è®¤ä½¿ç”¨ Normalize ç±»ã€‚ç»™å®šå‚æ•° vmin å’Œ vmaxï¼Œå®ƒä¼šæŒ‰ç…§çº¿æ€§å…³ç³»\n$$ y=\\frac{x-vmin}{vmax-vmin} $$\nå°†åŸå§‹æ•°æ® x æ˜ å°„ä¸º yã€‚è™½ç„¶è¿™ä¸€æ“ä½œå«åšâ€œå½’ä¸€åŒ–â€ï¼Œä½†æ˜¾ç„¶åªæœ‰ [vmin, vmax] èŒƒå›´å†…çš„ x ä¼šè¢«æ˜ å°„åˆ° [0.0, 1.0] ä¸Šï¼Œå…¶å®ƒ x æ˜ å°„å‡ºæ¥çš„ y ä¼šå°äº 0.0 æˆ–å¤§äº 1.0ã€‚ä¸è¿‡è‹¥æ˜¯ä¸ç»™å®š vmin å’Œ vmaxï¼Œåˆ™é»˜è®¤ç”¨ x çš„æœ€å°å€¼å’Œæœ€å¤§å€¼æ¥ä»£æ›¿ï¼Œæ­¤æ—¶æ‰€æœ‰ x éƒ½ä¼šè¢«æ˜ å°„åˆ° [0.0, 1.0] ä¸Šã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå½’ä¸€åŒ–åçš„ç»“æœéƒ½åœ¨ [0.0, 1.0] èŒƒå›´å†…çš„ä¾‹å­\nå½’ä¸€åŒ–åçš„å€¼å¯ä»¥ç›´æ¥ä¼ ç»™ colormapï¼Œä»¥å¾—åˆ°ç”»å›¾ç”¨çš„é¢œè‰²ã€‚å³ä¾¿å½’ä¸€åŒ–åçš„ç»“æœè¶…å‡ºäº† [0.0, 1.0] çš„èŒƒå›´ï¼Œæ ¹æ®ç¬¬ 1 èŠ‚ä¸­çš„è¯´æ˜ï¼Œè¿™äº›è¶…å‡ºçš„å€¼ä¼šè¢«æ˜ å°„ç»™ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªé¢œè‰²ï¼ˆæˆ–è€… set_under å’Œ set_over æŒ‡å®šçš„é¢œè‰²ï¼‰ï¼Œæ¢å¥è¯è¯´ï¼Œ[vmin, vmax] èŒƒå›´å¤–çš„ x è‡ªç„¶å¯¹åº”äº colormap ä¸¤ç«¯çš„é¢œè‰²ã€‚\næ­¤å¤–ï¼ŒNormalize è¿˜æœ‰ä¸€ä¸ª clip å‚æ•°ï¼Œå½“å®ƒä¸º True æ—¶ï¼Œèƒ½æŠŠ [vmin, vmax] èŒƒå›´å¤–çš„ x æ˜ å°„ä¸º 0.0 æˆ– 1.0ï¼Œä¸è¿‡è¿™æ ·ä¸€æ¥ï¼Œcolormap çš„ under ä¸ over çš„è®¾ç½®ä¾¿ä¼šå¤±å»ä½œç”¨ã€‚æ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬ä¸ç”¨å…³å¿ƒ clip å‚æ•°ï¼Œè®©å®ƒé»˜è®¤ä¸º False å°±å¥½äº†ã€‚\n2.2 LogNorm ç±»ä¼¼äº Normalizeï¼ŒLogNorm èƒ½å°† [vmin, vmax] èŒƒå›´å†…çš„ x çš„å¯¹æ•°çº¿æ€§æ˜ å°„åˆ° [0.0, 1.0] ä¸Šï¼Œå…¬å¼è¡¨ç¤ºä¸º $$ y = \\frac{\\log_{10}(x) - \\log_{10}(vmin)}{\\log_{10}(vmax) - \\log_{10}(vmin)} $$ å…¶ä¸­ vmin å’Œ vmax å¿…é¡»ä¸ºæ­£æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼›x å¯ä»¥å°äºç­‰äº 0ï¼Œä¸è¿‡ç»“æœä¼šç¼ºæµ‹ï¼ˆmaskedï¼‰ã€‚ä¾‹å¦‚\né™¤äº†å¯¹æ•°å…³ç³»å¤–ï¼ŒMatplotlib è¿˜æä¾›ä»»æ„å¹‚å¾‹å…³ç³»çš„ PowerNormï¼Œæ­¤å¤„ä¸å†è¯¦ç»†ä»‹ç»ã€‚\n2.3 BoundaryNorm é™¤äº†çº¿æ€§å’Œå¯¹æ•°çš„æ˜ å°„ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦çš„æ˜ å°„å…³ç³»åƒæ˜¯å¾€ä¸€ç»„æ‘†åœ¨ä¸€èµ·çš„æ¡†é‡ŒæŠ•çƒã€‚ä¾‹å¦‚ä¸‹å›¾è¿™ä¸ªä¾‹å­\nç»™å‡ºä¸€ç³»åˆ—è¾¹ç¼˜é åœ¨ä¸€èµ·çš„ binï¼ˆæ¡†å­ï¼‰ï¼ŒåŸå§‹æ•°æ®è½å…¥ç¬¬å‡ ä¸ªæ¡†ï¼ˆå·¦é—­å³å¼€åŒºé—´ï¼‰ï¼Œå°±å¯¹åº”äºç¬¬å‡ ä¸ªé¢œè‰²ã€‚å› ä¸ºè¿™äº›æ¡†è¾¹ç¼˜çš„æ•°å€¼å¯ä»¥ä»»æ„ç»™å®šï¼Œæ‰€ä»¥å¾ˆéš¾ç”¨ç®€å•çš„å‡½æ•°è¡¨ç¤ºã€‚ä¸ºäº†å®ç°è¿™ç§æ˜ å°„ï¼Œè¿™é‡Œå¼•å…¥ BoundaryNormã€‚\nå‚æ•° boundaries ä¸ºæˆ‘ä»¬ç»™å‡ºçš„è¿™äº› bin çš„è¾¹ç¼˜æ•°å€¼ï¼Œè¦æ±‚å•è°ƒé€’å¢ï¼›ncolors åˆ™æ˜¯æˆ‘ä»¬å¸Œæœ›ä¸ä¹‹å¯¹åº”çš„ colormap ä¸­é¢œè‰²çš„æ•°ç›®ï¼ˆå³ cmap.Nï¼‰ï¼Œå…¶æ•°å€¼å¤§äºç­‰äº nbin = len(boundaries) - 1ã€‚\nå½“ ncolors = nbin æ—¶ï¼Œæ˜ å°„å…³ç³»ä¸ºï¼š $$ y = \\begin{cases} i \u0026amp;\\text{if} \\quad boundaries[i] \\le x \u0026lt; boundaries[i+1] \\newline -1 \u0026amp;\\text{if} \\quad x \u0026lt; boundaries[0] \\newline nbin \u0026amp;\\text{if} \\quad x \\ge boundaries[-1] \\end{cases} $$ å¯ä»¥çœ‹åˆ°ï¼Œè½å…¥æ¡†ä¸­çš„ x ä¼šè¢«æ˜ å°„åˆ° [0, nbin - 1] ä¸Šï¼Œè€Œæ²¡æœ‰è½å…¥æ¡†ä¸­çš„ x ä¼šæ˜ å°„ä¸º -1 æˆ– nbinã€‚\nå½“ ncolors \u0026gt; nbin æ—¶ï¼Œè½å…¥æ¡†ä¸­çš„ x ä¼šè¢«æ˜ å°„åˆ° [0, ncolors - 1] ä¸Šã€‚æˆ‘è§‰å¾—è¿™ç§æƒ…å†µä¸‹çš„æ˜ å°„å…³ç³»ä¸æ˜¯å¾ˆç›´è§‚ï¼Œæ‰€ä»¥å…¬å¼å°±ä¸åˆ—äº†ï¼Œå¹³æ—¶æˆ‘ä¼šå…ˆæŠŠ colormap å–æ ·åˆ°åªæœ‰ nbin ä¸ªé¢œè‰²ã€‚æ­¤å¤– BoundaryNorm è¿˜æœ‰ä¸ª extend å‚æ•°ï¼Œä¹Ÿä¼šä½¿æ˜ å°„å…³ç³»å¤æ‚åŒ–ï¼Œå»ºè®®ä¸è¦å»è®¾ç½®å®ƒã€‚ä¸‹é¢ä¸¾ä¸ªä¾‹å­\n2.4 CenteredNorm è¿™æ˜¯ Matplotlib 3.4.0 æ–°å¼•å…¥çš„å½’ä¸€åŒ–æ–¹æ³•ï¼Œç»™å®šå¯¹ç§°ä¸­å¿ƒ vcenter å’Œä¸­å¿ƒå‘ä¸¤è¾¹çš„èŒƒå›´ halfrangeï¼Œæœ‰æ˜ å°„å…³ç³» $$ y = \\frac{x - (vcenter - halfrange)}{2 \\times halfrange} $$ æ„ä¹‰å¾ˆæ˜ç¡®ï¼Œå³ vcenter ä¸¤è¾¹çš„ x ä¼šè¢«çº¿æ€§æ˜ å°„åˆ° 0.5 ä¸¤è¾¹ã€‚ç”±äºè¿™ä¸ªç±»è¦æ±‚çš„ Matplotlib ç‰ˆæœ¬å¤ªé«˜ï¼Œä¼°è®¡å¾ˆå¤šäººè¿˜ç”¨ä¸äº†ï¼Œä¸è¿‡è¦ç”¨ Normalize æ¥å®ç°ç›¸åŒçš„ç»“æœä¹Ÿå¾ˆç®€å•ã€‚\n2.5 TwoSlopeNorm ç±»ä¼¼äº CenteredNormï¼Œä¹Ÿæ˜¯ä¼šæŠŠ vcenter ä¸¤è¾¹çš„ x çº¿æ€§æ˜ å°„åˆ° 0.5 ä¸¤è¾¹ï¼Œä½†æ˜¯ vcenter å‘ä¸¤è¾¹å»¶ä¼¸çš„èŒƒå›´å¯ä»¥ä¸ç­‰ã€‚æ˜ å°„å…³ç³»ä¸º $$ y = \\begin{cases} 0.0 \u0026amp;\\text{if} \\quad x \u0026lt; vmin \\newline (x - vmin) / (vcenter - vmin) \u0026amp;\\text{if} \\quad vmin \\le x \u0026lt; vcenter \\newline (x - vcenter) / (vmax - vcenter) \u0026amp;\\text{if} \\quad vcenter \\le x \u0026lt; vcenter \\newline 1.0 \u0026amp;\\text{if} \\quad x \\ge vmax \\end{cases} $$ å…¶å†…éƒ¨æ˜¯ç”¨ np.interp å‡½æ•°å®Œæˆè®¡ç®—çš„ï¼Œæ‰€ä»¥è¶…å‡º [vmin, vmax] èŒƒå›´çš„ x ä¼šè¢«æ˜ å°„ä¸º 0.0 æˆ– 1.0ã€‚\n3 å®é™…åº”ç”¨ 3.1 pcolor å’Œ contour çš„å¼‚åŒ å¯¹äºç”»é©¬èµ›å…‹å›¾çš„ pcolorã€pcolormesh å’Œ imshow å‡½æ•°ï¼Œå®é™…ä½¿ç”¨æ—¶æˆ‘ä»¬å¹¶ä¸éœ€è¦æ‰‹åŠ¨è¿›è¡Œæ•°æ®çš„å½’ä¸€åŒ–å’Œé¢œè‰²é‡‡æ ·ï¼Œåªéœ€åœ¨è°ƒç”¨å‡½æ•°æ—¶é€šè¿‡ cmap å’Œ norm å‚æ•°æŠŠ colormap å’Œå½’ä¸€åŒ–çš„ç±»ä¼ å…¥å³å¯ï¼Œç»˜å›¾å‡½æ•°ä¼šè‡ªåŠ¨è®¡ç®—æ•°æ®å’Œé¢œè‰²çš„å¯¹åº”å…³ç³»ã€‚å› ä¸ºçº¿æ€§çš„å½’ä¸€åŒ–æ–¹æ³•æœ€ä¸ºå¸¸ç”¨ï¼Œæ‰€ä»¥è¿™äº›å‡½æ•°éƒ½é»˜è®¤ä½¿ç”¨ Normalize ç±»ï¼Œå¹¶é»˜è®¤ç”¨æ•°æ®çš„æœ€å°æœ€å¤§å€¼ä½œä¸º vmin å’Œ vmaxã€‚ä¸‹é¢æ˜¯ä¾‹å­\n# ç”Ÿæˆæµ‹è¯•æ•°æ®.\rx = np.linspace(0, 10, 100)\ry = np.linspace(0, 10, 100)\rX, Y = np.meshgrid(x, y)\rZ = 1E3 * np.exp(-(np.abs(X - 5)**2 + np.abs(Y - 5)**2))\rfig, axes = plt.subplots(1, 2, figsize=(12, 5))\rcmap = mpl.cm.jet\r# ä½¿ç”¨é»˜è®¤çš„çº¿æ€§å½’ä¸€åŒ–,å¯ä»¥ç›´æ¥ç»™å‡ºvminå’Œvmax.\rim = axes[0].pcolormesh(\rX, Y, Z, cmap=cmap, vmin=Z.min(), vmax=Z.max(),\rshading='nearest'\r)\rcbar = fig.colorbar(im, ax=axes[0], extend='both')\raxes[0].set_title('Normalize')\r# è‹¥åœ¨pcolormeshä¸­ç»™å®šäº†norm,å°±ä¸èƒ½å†æŒ‡å®švminå’Œvmaxäº†.\rnorm = mpl.colors.LogNorm(vmin=1E-3, vmax=1E3)\rim = axes[1].pcolormesh(\rX, Y, Z, cmap=cmap, norm=norm,\rshading='nearest'\r)\r# ä½¿ç”¨LogNormæ—¶,colorbarä¼šè‡ªåŠ¨é€‰ç”¨_ColorbarLogLocatoræ¥è®¾å®šticks.\rcbar = fig.colorbar(im, ax=axes[1], extend='both')\raxes[1].set_title('LogNorm')\rplt.show()\r å¯ä»¥çœ‹åˆ° LogNorm èƒ½è®©æ•°æ®çš„é¢œè‰²åˆ†å¸ƒä¸é‚£ä¹ˆé›†ä¸­ã€‚\nè€Œç”»ç­‰é«˜çº¿çš„ contour å’Œ contourf åˆ™ä¸ pcolor æœ‰ä¸€äº›ç»†èŠ‚ä¸Šçš„å·®å¼‚ã€‚è¿™ä¸¤ä¸ªå‡½æ•°å¤šäº†ä¸ª levels å‚æ•°ï¼Œç”¨äºæŒ‡å®šæ¯æ¡ç­‰é«˜çº¿å¯¹åº”çš„æ•°å€¼ã€‚å®ƒä»¬é»˜è®¤ä½¿ç”¨ Normalize(vmin=min(levels), max(levels)) ä½œä¸ºå½’ä¸€åŒ–çš„æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬ç»™å‡ºäº† vmin å’Œ vmaxï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨æˆ‘ä»¬ç»™å‡ºçš„å€¼ã€‚å¯¹äº contourï¼Œæ¯æ¡ç­‰é«˜çº¿çš„é¢œè‰²å¯ä»¥è¡¨ç¤ºä¸º cmap(norm(levels))ï¼›å¯¹äº contourfï¼Œç­‰é«˜çº¿é—´å¡«å……çš„é¢œè‰²å¯ä»¥è¡¨ç¤ºä¸º\n# åœ¨normä¸æ˜¯LogNormçš„æƒ…å†µä¸‹,layersè®¡ç®—ä¸ºlevelsçš„ä¸­ç‚¹.è¯¦è¯·å‚è€ƒmatplotlib.contouræ¨¡å—.\rlevels = np.array(levels)\rlayers = 0.5 * (levels[1:] + levels[:-1])\rcolors = cmap(norm(layers))\r contourf é»˜è®¤ä¸ä¼šå¡«å…… levels èŒƒå›´ä»¥å¤–çš„é¢œè‰²ï¼Œå¦‚æœæœ‰è¿™æ–¹é¢çš„éœ€æ±‚ï¼Œå¯ä»¥ç”¨ extend å‚æ•°æŒ‡å®šæ˜¯å¦è®©è¶…å‡ºèŒƒå›´çš„æ•°æ®è¢«å¡«ä¸Š colormap ä¸¤ç«¯çš„é¢œè‰²ï¼ˆæˆ– set_under å’Œ set_over æŒ‡å®šçš„é¢œè‰²ï¼‰ã€‚\nä¸¾ä¸ªåŒæ—¶ç”»å‡ºç­‰é«˜çº¿å’Œå¡«è‰²å›¾çš„ä¾‹å­ï¼Œå¡«è‰²è®¾ä¸ºåŠé€æ˜\n# ç”Ÿæˆæµ‹è¯•æ•°æ®.\rx = np.linspace(0, 10, 100)\ry = np.linspace(0, 10, 100)\rX, Y = np.meshgrid(x, y)\rZ = (X - 5) ** 2 + (Y - 5) ** 2\r# å°†Zçš„å€¼ç¼©æ”¾åˆ°[0, 100]å†….\rZ = Z / Z.max() * 100\r# è®¾ç½®ä¸€ä¸ªç®€å•çš„colormap.\rcmap = mpl.colors.ListedColormap(['blue', 'orange', 'red', 'purple'])\rfig, ax = plt.subplots()\r# contourå’Œcontourfé»˜è®¤ä½¿ç”¨levelsçš„æœ€å°æœ€å¤§å€¼ä½œä¸ºvminå’Œvmax.\rlevels = np.linspace(10, 60, 6)\rim1 = ax.contourf(X, Y, Z, levels=levels, cmap=cmap, alpha=0.5)\rim2 = ax.contour(X, Y, Z, levels=levels, cmap=cmap, linewidths=2)\rcbar = fig.colorbar(im1, ax=ax)\r# ä¸ºç­‰é«˜çº¿æ·»åŠ æ ‡ç­¾.\rax.clabel(im2, colors='k')\rplt.show()\r å¯ä»¥çœ‹åˆ°ï¼Œlevels èŒƒå›´ä»¥å¤–çš„éƒ¨åˆ†ç›´æ¥éœ²å‡ºäº†ç™½è‰²èƒŒæ™¯ã€‚ç­‰é«˜çº¿çš„é¢œè‰²ä¸ç­‰é«˜çº¿ä¹‹é—´çš„å¡«è‰²å¹¶ä¸å®Œå…¨ä¸€è‡´ï¼Œè¿™æ˜¯ levels å’Œ layers ä¹‹é—´çš„å·®å¼‚å¯¼è‡´çš„ã€‚ä»¥ä¸Šæåˆ°çš„è¿™äº›å‚æ•°éƒ½å¯ä»¥åœ¨ contour å’Œ contourf å‡½æ•°è¿”å›çš„ QuadContourSet å¯¹è±¡çš„å±æ€§ä¸­æ‰¾åˆ°ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªå·±è°ƒè¯•çœ‹çœ‹ã€‚\n3.2 BoundaryNorm çš„åº”ç”¨ ç›´æ¥ä¸Šä¾‹å­\n# ç”Ÿæˆæµ‹è¯•æ•°æ®.\rx = np.linspace(0, 10, 100)\ry = np.linspace(0, 10, 100)\rX, Y = np.meshgrid(x, y)\rZ = X ** 2 + Y ** 2\r# å°†Zçš„å€¼ç¼©æ”¾åˆ°[0, 100]å†….\rZ = Z / Z.max() * 100\r# è®¾ç½®norm.\rbins = [1, 5, 10, 20, 40, 80]\rnbin = len(bins) - 1\rnorm = mpl.colors.BoundaryNorm(bins, nbin)\r# è®¾ç½®cmap.\rcmap = mpl.cm.get_cmap('jet', nbin)\rcmap.set_under('white')\rcmap.set_over('purple')\rfig, axes = plt.subplots(1, 2, figsize=(12, 5))\rim1 = axes[0].pcolormesh(X, Y, Z, cmap=cmap, norm=norm, shading='nearest')\rcbar = fig.colorbar(im1, ax=axes[0], extend='both')\raxes[0].set_title('pcolormesh')\r# æ³¨æ„contourfè®¾ç½®extendæ—¶,colorbarå°±ä¸è¦è®¾ç½®extendäº†.\rim2 = axes[1].contourf(X, Y, Z, levels=bins, cmap=cmap, norm=norm, extend='both')\rcbar = fig.colorbar(im2, ax=axes[1])\raxes[1].set_title('contourf')\rplt.show()\r åœ¨å¯¹ contourf åº”ç”¨ BoundaryNorm æ—¶ï¼Œå¾ˆå®¹æ˜“è”æƒ³åˆ°ï¼Œç­‰é«˜çº¿å°±ç›¸å½“äº bins çš„è¾¹ç¼˜ï¼Œç­‰é«˜çº¿ä¹‹é—´çš„å¡«è‰²æ­£å¥½å¯¹åº”äºæ¯ä¸ª bin ä¸­çš„é¢œè‰²ï¼Œæ‰€ä»¥æŒ‡å®š levels=bins æ˜¯éå¸¸è‡ªç„¶çš„ã€‚å¦‚æœä¸è¿™æ ·åšï¼Œcontourf é»˜è®¤ä¼šæ ¹æ®æ•°æ®çš„èŒƒå›´ï¼Œåˆ©ç”¨ MaxNLocator è‡ªåŠ¨ç”Ÿæˆ levelsï¼Œæ­¤æ—¶ç”±äº levels ä¸ bins ä¸åŒ¹é…ï¼Œå¡«è‰²å°±ä¼šä¹±å¥—ã€‚\n3.3 çº¢è“ colormap å½“æ•°æ®è¡¨ç¤ºç¬æ—¶å€¼ä¸é•¿æ—¶é—´å¹³å‡å€¼ä¹‹é—´çš„å·®å€¼æ—¶ï¼Œæˆ‘ä»¬å¸¸ç”¨ä¸¤ç«¯åˆ†åˆ«ä¸ºè“è‰²å’Œçº¢è‰²çš„ colormapï¼Œå¹¶å°†æ•°æ®çš„è´Ÿå€¼å’Œæ­£å€¼åˆ†åˆ«æ˜ å°„åˆ°è“è‰²å’Œçº¢è‰²ä¸Šï¼Œè¿™æ ·ç”»å‡ºæ¥çš„å›¾ä¸€çœ¼å°±èƒ½çœ‹å‡ºå“ªé‡Œåé«˜å“ªé‡Œåä½ã€‚ä¸‹é¢åˆ†åˆ«ç”¨ Normalize å’Œ TwoSlopeNorm æ¥å®ç°\n# ç”Ÿæˆæµ‹è¯•æ•°æ®.\rX, Y = np.meshgrid(np.linspace(-2, 2, 100), np.linspace(-2, 2, 100))\rZ1 = np.exp(-X**2 - Y**2)\rZ2 = np.exp(-(X - 1)**2 - (Y - 1)**2)\rZ = ((Z1 - Z2) * 2)\r# å°†Zçš„å€¼ç¼©æ”¾åˆ°[-5, 10]å†….\rZ = (Z - Z.min()) / (Z.max() - Z.min()) * 15 - 5\r# è®¾å®šçº¢è“colormapä¸ä¸¤ç§norm.\rcmap = mpl.cm.RdBu_r\rnorm_list = [\rmpl.colors.Normalize(vmin=-10, vmax=10),\rmpl.colors.TwoSlopeNorm(vmin=-5, vcenter=0, vmax=10)\r]\r# levelséœ€è¦ä¸normçš„èŒƒå›´ç›¸åŒ¹é….\rlevels_list = [\rnp.linspace(-10, 10, 21),\rnp.linspace(-5, 10, 16)\r]\r# å›¾ç‰‡éœ€è¦çš„æ ‡é¢˜.\rtitle_list = [\r'Normalize',\r'TwoSlopeNorm'\r]\rfig, axes = plt.subplots(1, 2, figsize=(12, 5))\rfor i in range(2):\rim = axes[i].contourf(\rX, Y, Z, levels=levels_list[i], cmap=cmap,\rnorm=norm_list[i], extend='both'\r)\rcbar = fig.colorbar(im, ax=axes[i])\raxes[i].set_title(title_list[i])\rplt.show()\r å¦‚æœä½ çš„ Matplotlib ç‰ˆæœ¬å¤Ÿé«˜çš„è¯ï¼Œè¿˜å¯ä»¥è¯•è¯• CenteredNormã€‚è¿™ä¸‰ç§å½’ä¸€åŒ–æ–¹æ³•éƒ½æ˜¯çº¿æ€§çš„ï¼Œéçº¿æ€§çš„æ–¹æ³•æœ‰ SymLogNormï¼Œæˆ–è€…ç”¨ BoundaryNorm ä¹Ÿå¯ä»¥å®ç°ã€‚\n3.4 è‡ªå®šä¹‰å½’ä¸€åŒ–æ–¹æ³• è¯·å‚è€ƒ Matplotlib å®˜ç½‘çš„ Colormap Normalization æ•™ç¨‹çš„æœ€åä¸€èŠ‚ã€‚\n4. ç»“è¯­ ä»¥ä¸Šä¾¿æ˜¯å¯¹ Matplotlib ä¸­ colormap çš„ç®€è¦ä»‹ç»ï¼Œæœ‰é”™è¯¯çš„è¯çƒ¦è¯·åœ¨è¯„è®ºåŒºæŒ‡å‡ºã€‚ä¸‹æœŸå°†ä¼šæ¥ç€ä»‹ç»ä¸ä¹‹å¯†ä¸å¯åˆ†çš„ colorbarã€‚\nå‚è€ƒé“¾æ¥ å‚è€ƒçš„å…¨æ˜¯ Matplotlib å®˜ç½‘çš„æ•™ç¨‹\nCustomized Colorbars Tutorial\nCreating Colormaps in Matplotlib\nColormap Normalization\nå¦‚æœæƒ³è‡ªå®šä¹‰ colormap çš„è¯ï¼Œå¯ä»¥å‚è€ƒ\nBeautiful custom colormaps with Matplotlib\n","date":"2021-07-05","permalink":"https://zhajiman.github.io/post/matplotlib_colormap/","tags":["matplotlib"],"title":"Matplotlib ç³»åˆ—ï¼šcolormap çš„è®¾ç½®"},{"content":"æœ¬åšå®¢ä¹‹å‰æ˜¯ç”¨è½¯ä»¶ Gridea åˆ¶ä½œçš„ï¼Œè¿™æ˜¯ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ï¼Œå¯ä»¥ä½œä¸º Markdown ç¼–è¾‘å™¨ï¼ŒåŒæ—¶ç®€å•è®¾ç½®ä¸‹å°±èƒ½ä¸€é”®ç”Ÿæˆé™æ€é¡µé¢å¹¶ä¸Šä¼ åˆ°ç½‘ä¸Šï¼Œéå¸¸é€‚åˆæˆ‘è¿™ç§ç”µè„‘å°ç™½ä½¿ç”¨ã€‚ä¸è¿‡å‰æ®µæ—¶é—´å‘ç°æ€ä¹ˆéƒ½æ²¡æ³•ä¸Šä¼ æœ¬åœ°å†™å¥½çš„å†…å®¹ï¼Œäºæ˜¯å†³å®šé‡æ–°ç”¨ç°åœ¨æµè¡Œçš„ Hugo æ¥æ­å»ºåšå®¢ã€‚æœ¬æ–‡ä½¿ç”¨çš„æ˜¯ 0.84.4 ç‰ˆæœ¬çš„ Hugo å’Œ 2.32.0 ç‰ˆæœ¬çš„ Gitã€‚\nHugo çš„å®‰è£… Hugo æ˜¯ä¸€ä¸ªç”± Go è¯­è¨€å®ç°çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œå› ä¸ºå¬è¯´ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”ä¸»é¢˜ä¹Ÿå¤šï¼Œæ‰€ä»¥é€‰äº†å®ƒã€‚äºŒè¿›åˆ¶å®‰è£…åŒ…å¯ä»¥ç›´æ¥åœ¨å…¶ Github Releases é¡µé¢ä¸­ä¸‹è½½åˆ°ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ hugo_extended_0.84.4_Windows-64bit.zipã€‚æ–°å»ºä¸€ä¸ªç›®å½• binï¼Œå°†å®‰è£…åŒ…é‡Œè§£å‹å‡ºæ¥çš„ä¸œè¥¿éƒ½ä¸¢è¿›å»ï¼Œç„¶åæŠŠ bin ç›®å½•çš„è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œå®‰è£…å°±å®Œäº‹äº†ã€‚ä»¥åç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è°ƒç”¨å‘½ä»¤å³å¯ã€‚\nHugo çš„åŸºæœ¬ç”¨æ³• æ–°å»ºç½‘ç«™ åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºç½‘ç«™\nhugo new site ./ZhaJiMan.github.io\r è¿™æ ·å½“å‰ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªåä¸º ZhaJiMan.github.io çš„ç½‘ç«™ç›®å½•ï¼Œå…¶ç»“æ„ä¸º\n.\râ”œâ”€â”€ archetypes # å­˜æ”¾æ–‡ç« æ¨¡æ¿\râ”œâ”€â”€ config.toml # ç®€å•çš„é…ç½®æ–‡ä»¶\râ”œâ”€â”€ content # å­˜æ”¾æ–‡ç« \râ”œâ”€â”€ data # å­˜æ”¾ç”Ÿæˆé™æ€é¡µé¢æ—¶çš„é…ç½®æ–‡ä»¶\râ”œâ”€â”€ layouts # å­˜æ”¾é¡µé¢å¸ƒå±€çš„æ¨¡æ¿\râ”œâ”€â”€ static # å­˜æ”¾å›¾ç‰‡ç­‰é™æ€å†…å®¹\râ””â”€â”€ themes # å­˜æ”¾ä¸‹è½½çš„ä¸»é¢˜\r ä¹‹åçš„æ‰€æœ‰æ“ä½œéœ€è¦ cd åˆ°è¿™ä¸ªç›®å½•ä¸‹è¿›è¡Œã€‚\næ·»åŠ ä¸»é¢˜ ä¸»é¢˜å¯ä»¥åœ¨ Hugo Themes ç½‘ç«™ä¸Šæ‰¾åˆ°ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯è‡ªå¸¦ TOC å’Œè¯„è®ºåŠŸèƒ½çš„ Fujiï¼Œé€šè¿‡ Git å‘½ä»¤å®‰è£…ã€‚\ngit init\rgit submodule add https://github.com/WingLim/hugo-tania themes/hugo-tania\r ç„¶åä¸»é¢˜å°±ä¼šä¸‹è½½åˆ° themes ç›®å½•ä¸­ã€‚ä¸€èˆ¬ä¸»é¢˜çš„ç›®å½•é‡Œéƒ½ä¼šå«æœ‰ä¸€ä¸ª exampleSite ç›®å½•ï¼Œé¡¾åæ€ä¹‰è¿™æ˜¯ä½œè€…åšå¥½çš„ç¤ºä¾‹ç½‘ç«™ï¼Œç›´æ¥æŠŠé‡Œé¢çš„å†…å®¹å¤åˆ¶åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹ï¼Œå°±èƒ½å®Œæˆè¯¥ä¸»é¢˜æœ€åŸºæœ¬çš„é…ç½®ï¼Œå¹¶å®ç°ç¤ºä¾‹ç½‘ç«™çš„æ•ˆæœã€‚ä¹‹åä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ config.toml æ–‡ä»¶æ¥è‡ªå®šä¹‰é…ç½®ã€‚\nåˆ›å»ºæ–‡ç«  Hugo ä¸­çš„æ–‡ç« éƒ½ä»¥ Markdown æ ¼å¼å†™ä½œã€‚åœ¨ content/post ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª Markdown æ–‡ä»¶\nhugo new post/rebuild_blog.md\r é»˜è®¤çš„æ–‡ç« æ¨¡æ¿ä¼šä½¿ Markdown æ–‡ä»¶å¸¦æœ‰è¿™æ ·çš„å¼€å¤´\n---\rtitle: \u0026quot;rebuild_blog\u0026quot;\rdate: 2021-07-03T16:47:34+08:00\rdraft: true\r---\r --- ä¹‹é—´çš„å†…å®¹æœä» YAML æˆ– TOML æ ¼å¼ã€‚title å³æ–‡ç« æ ‡é¢˜ï¼Œé»˜è®¤ä¸æ–‡ä»¶åç›¸åŒï¼›date å³æ—¥æœŸæ—¶é—´ï¼›draft è¡¨ç¤ºè¯¥æ–‡ç« æ˜¯å¦ä¸ºè‰ç¨¿ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆåé¢ç”Ÿæˆé™æ€é¡µé¢æ—¶å°†ä¸ä¼šå«æœ‰è¯¥æ–‡ç« ã€‚æ­¤å¤–è¿˜å­˜åœ¨åˆ«çš„å‚æ•°å¯ä¾›è®¾ç½®ã€‚--- ä¹‹åçš„å†…å®¹è‡ªç„¶å°±æ˜¯æ–‡ç« æ­£æ–‡äº†ã€‚\nFuji ä¸»é¢˜è¿˜é¢å¤–å¼ºè°ƒè¦åœ¨æ­£æ–‡ä¸­æ’å…¥ç®€ä»‹åˆ†å‰²çº¿ \u0026lt;!--more--\u0026gt;ï¼Œä»¥è®©æ–‡ç« åˆ—è¡¨çš„æ–‡ç« é¢„è§ˆéƒ¨åˆ†æ ·å¼æ­£ç¡®ã€‚\né¢„è§ˆç½‘ç«™ å»ºç«‹ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨\nhugo server\r ç„¶åå‘½ä»¤è¡Œä¼šå¡ä½ï¼Œåœ¨æµè§ˆå™¨å†…è¾“å…¥ http://localhost:1313/ é¢„è§ˆç½‘ç«™ï¼Œå‘½ä»¤è¡Œå†… Ctrl+C å…³é—­æœåŠ¡å™¨ã€‚Hugo çš„ä¸€ä¸ªç‰¹è‰²æ˜¯å¯ä»¥è¿›è¡ŒåŠ¨æ€é¢„è§ˆï¼Œå½“ä½ ä¿®æ”¹æœ¬åœ°å†…å®¹æ—¶ï¼Œå˜åŒ–ä¼šé©¬ä¸Šåæ˜ åœ¨æµè§ˆå™¨ä¸­çš„é¡µé¢ä¸Šã€‚\nç”Ÿæˆé™æ€é¡µé¢ ç›´æ¥åœ¨ç”Ÿæˆåœ¨é»˜è®¤çš„ public ç›®å½•ä¸‹\nhugo\r ç”¨ -d å‚æ•°å¯ä»¥æŒ‡å®šç›®å½•ï¼Œæˆ–è€…åœ¨é…ç½®æ–‡ä»¶é‡Œç”¨ publishDir å‚æ•°æŒ‡å®šé»˜è®¤çš„ç›®å½•ã€‚\nå‘å¸ƒåˆ° Github ä¸Š è¿™é‡Œç”¨ Github Pages æ¥éƒ¨ç½²åšå®¢ã€‚é¦–å…ˆåœ¨ config.yaml é‡ŒæŒ‡å®š\npublishDir: docs\r ç„¶åå†ä¸€ä¸ª hugo å‘½ä»¤ï¼Œè¿™æ ·å°±æŠŠé™æ€é¡µé¢è¾“å‡ºåˆ° docs ç›®å½•ä¸‹äº†ã€‚\næ¥ç€åœ¨ Github ä¸Šä»¥ ZhaJiMan.github.io çš„åå­—ï¼ˆæ ¹æ®è‡ªå·±çš„ç”¨æˆ·åè€Œå®šï¼‰æ–°å»ºä¸€ä¸ªç©ºä»“åº“ï¼Œè¿›è¡Œä¸‹é¢çš„ Git å‘½ä»¤\ngit add .\rgit commit -m \u0026quot;first commit\u0026quot;\rgit branch -M main\rgit remote add origin https://github.com/ZhaJiMan/ZhaJiMan.github.io.git\rgit push -u origin main\r è¿™æ®µæ”¹ç¼–è‡ªç©ºä»“åº“é¡µé¢å‡ºç°çš„æç¤ºï¼Œå¤§æ„æ˜¯\n å°†ç½‘ç«™ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹æš‚å­˜ã€‚ æŠŠæš‚å­˜çš„å†…å®¹æäº¤ç»™ç‰ˆæœ¬åº“ã€‚ æŠŠä¸»åˆ†æ”¯çš„åå­—ä» master æ”¹ä¸º mainã€‚ æ·»åŠ è¿œç¨‹ä»“åº“ã€‚ æŠŠæœ¬åœ°å†…å®¹æ¨é€åˆ°è¿œç¨‹ä»“åº“é‡Œã€‚  æ¨é€æˆåŠŸåï¼Œè¿›å…¥ä»“åº“çš„è®¾ç½®é¡µé¢ï¼Œç‚¹å‡»ä¾§æ çš„ Pagesï¼Œå†æŠŠ Source é€‰é¡¹æ”¹ä¸º main åˆ†æ”¯ä¸‹çš„ docs ç›®å½•ï¼Œè¿™æ · Github Pages å°±ä¼šæ ¹æ®æˆ‘ä»¬æ¨é€ä¸Šå»çš„ docs ç›®å½•é‡Œçš„é™æ€é¡µé¢æ¥æ˜¾ç¤ºç½‘ç«™ã€‚è¿™é‡ŒæŒ‡å®š docs çš„å¥½å¤„æ˜¯è¿˜å¯ä»¥æŠŠç½‘ç«™çš„æ‰€æœ‰æ–‡ä»¶éƒ½å¤‡ä»½åˆ°ä»“åº“é‡Œï¼ˆä¸åŒ…å«ä»¥ submodule å½¢å¼æ·»åŠ ä¸»é¢˜ï¼Œè¯¦è§å‚è€ƒé“¾æ¥ï¼‰ã€‚æœ€ååœ¨ä¸ä»“åº“åŒåçš„ç½‘ç«™ https://zhajiman.github.io/ ä¸Šçœ‹çœ‹è‡ªå·±çš„åšå®¢å§ï¼\nå·¥ä½œæµ æ€»ç»“ä¸€ä¸‹ä¸Šé¢çš„æµç¨‹\n ç”¨ Markdown å†™ä½œã€‚ ç”¨ hugo server æœ¬åœ°é¢„è§ˆã€‚ ç”¨ hugo ç”Ÿæˆé™æ€é¡µé¢ã€‚ ç”¨ Git çš„ addã€commit å’Œ push å‘½ä»¤æ¨é€åˆ°ç½‘ä¸Šã€‚  å…¶å®ƒåŠŸèƒ½ æ’å…¥å›¾ç‰‡ ä»¥åä¸º capslock.jpg çš„å›¾ç‰‡ä¸ºä¾‹ï¼Œå°†è¯¥å›¾ç‰‡æ”¾å…¥ static ç›®å½•ä¸‹ï¼Œå†åœ¨ Markdown æ–‡ä»¶ä¸­ä»¥ /capslock.jpg çš„è·¯å¾„å¼•ç”¨å³å¯ã€‚è·¯å¾„ä¹‹æ‰€ä»¥å†™æˆè¿™ä¸ªå½¢å¼ï¼Œæ˜¯å› ä¸º Hugo ä¼šè‡ªåŠ¨åœ¨å›¾ç‰‡è·¯å¾„å‰è¿½åŠ  static çš„è·¯å¾„ã€‚ä¸ºäº†åŒºåˆ†å¼€ä¸åŒæ–‡ç« çš„ç”¨å›¾ï¼Œè¿˜å¯ä»¥åœ¨ static ä¸‹æ–°å»ºå­ç›®å½•ï¼Œä¾‹å¦‚ä¸‹é¢çš„å†™æ³•\n![capslock](/rebuild_blog/capslock.jpg)\r å…¶å®è¿™ç§éšå¼çš„è·¯å¾„åœ¨ä¸Šä¸€èŠ‚ä¸­ä¹Ÿé¢‘ç¹å‡ºç°è¿‡ã€‚è™½ç„¶ Hugo å¯ä»¥è§£æè¿™ç§è·¯å¾„ï¼Œä½† Markdown ç¼–è¾‘å™¨ä¸èƒ½ï¼Œæ‰€ä»¥åœ¨ç¼–è¾‘å™¨çš„é¢„è§ˆä¸­ä¼šçœ‹ä¸åˆ°å›¾ç‰‡ã€‚\næ¸²æŸ“å…¬å¼ Fuji ä¸»é¢˜æ”¯æŒç”¨ KaTex æ¸²æŸ“å…¬å¼ï¼Œä½¿ç”¨æ–¹æ³•ä¸ºåœ¨æ–‡ç« å¼€å¤´æˆ–é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  math: true æˆ– katex: trueã€‚ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°ï¼ŒKaTex ä¸èƒ½æ­£å¸¸æ¸²æŸ“è¡Œå†…å…¬å¼ï¼Œå‚è€ƒ KaTex å®˜ç½‘ Auto-render Extension çš„ä¾‹å­ï¼Œå°† themes/fuji/layouts/partials/math.html ä¸­çš„ KaTex è°ƒç”¨æ¢æˆ\n\u0026lt;link rel=\u0026quot;stylesheet\u0026quot; href=\u0026quot;https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css\u0026quot; integrity=\u0026quot;sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc\u0026quot; crossorigin=\u0026quot;anonymous\u0026quot;\u0026gt;\r\u0026lt;script defer src=\u0026quot;https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js\u0026quot; integrity=\u0026quot;sha384-YNHdsYkH6gMx9y3mRkmcJ2mFUjTd0qNQQvY9VYZgQd7DcN7env35GzlmFaZ23JGp\u0026quot; crossorigin=\u0026quot;anonymous\u0026quot;\u0026gt;\u0026lt;/script\u0026gt;\r\u0026lt;script defer src=\u0026quot;https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js\u0026quot; integrity=\u0026quot;sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl\u0026quot; crossorigin=\u0026quot;anonymous\u0026quot;\u0026gt;\u0026lt;/script\u0026gt;\r\u0026lt;script\u0026gt;\rdocument.addEventListener(\u0026quot;DOMContentLoaded\u0026quot;, function() {\rrenderMathInElement(document.body, {\rdelimiters: [\r{left: '$$', right: '$$', display: true},\r{left: '$', right: '$', display: false},\r{left: '\\\\(', right: '\\\\)', display: false},\r{left: '\\\\[', right: '\\\\]', display: true}\r],\rthrowOnError : false\r});\r});\r\u0026lt;/script\u0026gt;\r è¿™æ ·è¡Œé—´å…¬å¼ä¸è¡Œå†…å…¬å¼å°±éƒ½å¯ä»¥æ­£å¸¸æ¸²æŸ“ã€‚åŸç†ä¼¼ä¹æ˜¯åœ¨å‡½æ•° renderMathInElement ä¸­æŒ‡å®šè¯†åˆ«å…¬å¼çš„åˆ†éš”ç¬¦ï¼Œä¸è¿‡å…·ä½“ç»†èŠ‚æˆ‘ä¹Ÿä¸æ‡‚ã€‚æœ¬æ–‡ä¾¿é‡‡ç”¨ KaTex è¿›è¡Œæ¸²æŸ“ï¼Œä¾‹å¦‚è¡Œå†…å…¬å¼ä¸º $e^{ix} = \\cos{x} + i\\sin{x}$ï¼Œè¡Œé—´å…¬å¼ä¸º $$ P_e(\\omega) = \\frac{\\hbar \\omega^3}{4\\pi^2 c^2} \\frac{1}{\\exp{(\\hbar \\omega / k_B T)} - 1} $$\nè¯„è®ºç³»ç»Ÿ Fuji ä¸»é¢˜æ”¯æŒ Disqusã€utterances å’Œ DisqusJS ä¸‰ç§è¯„è®ºç³»ç»Ÿï¼Œå¹¶ä¸”è®¾ç½®èµ·æ¥éå¸¸ç®€å•ã€‚è¿™é‡Œé‡‡ç”¨ä¾æ‰˜äº Github issues çš„ utterancesã€‚è¿›å…¥ https://utteranc.es/ï¼ŒæŒ‰æŒ‡ç¤ºæŠŠ utterances app å®‰è£…åˆ°å­˜å‚¨åšå®¢çš„ä»“åº“ï¼Œç„¶ååœ¨ config.toml ä¸­è®¾ç½®\nutterancesRepo = \u0026quot;ZhaJiMan/ZhaJiMan.github.io\u0026quot; # æ ¼å¼ä¸ºusername/username/github.io\rutterancesIssueTerm = \u0026quot;pathname\u0026quot; # ä»¥é¡µé¢çš„pathnameæ¥ç”Ÿæˆissues\r æ–‡ç« æœ€ä¸‹é¢å°±ä¼šå‡ºç°è¯„è®ºåŒºäº†ï¼Œç”¨ Github è´¦å·ç™»å½•å³å¯å‘é€è¯„è®ºã€‚\nè®¾ç½®ç½‘ç«™å›¾æ ‡ ä¾æ® Fuji ä¸»é¡µçš„è¯´æ˜ï¼ŒæŠŠè‡ªå·±å–œæ¬¢çš„å›¾ç‰‡ä¸Šä¼ åˆ° https://realfavicongenerator.net/ ä¸Šï¼Œå†æŠŠæ‰“åŒ…å¥½çš„å›¾æ ‡å‹ç¼©åŒ…ä¸‹è½½ä¸‹æ¥ï¼Œè§£å‹åˆ° static ç›®å½•ä¸­ï¼Œæ¥ç€æŠŠè¯¥ç½‘ç«™æä¾›çš„ HTML ä»£ç ç²˜è´´åˆ° layouts/partials/favicon.html æ–‡ä»¶ä¸­ï¼Œå¹¶ä¿®æ”¹ä¸€ä¸‹ href å±æ€§æŒ‡å‘çš„è·¯å¾„å³å¯ã€‚\næ˜¾ç¤ºç‚¹å‡»é‡ è¿™é‡Œä½¿ç”¨ ä¸è’œå­ å®ç°ç»Ÿè®¡ï¼Œéœ€è¦åœ¨ä¸»é¢˜çš„ HTML æ–‡ä»¶ä¸­æ·»åŠ è„šæœ¬ï¼Œå†ç”¨æ ‡ç­¾æ˜¾ç¤ºè®¡æ•°ï¼Œç”¨æ³•è¯·è§å…¶å®˜ç½‘ã€‚å…·ä½“åˆ° Fuji ä¸»é¢˜ï¼Œé¦–å…ˆåœ¨ themes/fuji/layouts/partials/head.html æ–‡ä»¶ä¸­æ·»åŠ ä¸è’œå­çš„è„šæœ¬\n\u0026lt;!-- ä¸è’œå­è„šæœ¬ --\u0026gt;\r\u0026lt;script async src=\u0026quot;//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt;\r æ¥ç€åœ¨ themes/fuji/layouts/_default/single.html æ–‡ä»¶çš„ç¬¬å…«è¡Œã€post-metaï¼ˆæ–‡ç« å…ƒæ•°æ®ï¼‰çš„å—ä¸­åŠ å…¥æ ‡ç­¾\n\u0026lt;!-- æ˜¾ç¤ºæ–‡ç« ç‚¹å‡»é‡ --\u0026gt;\r\u0026lt;span\u0026gt;\u0026lt;i class=\u0026quot;iconfont icon-time-sharp\u0026quot;\u0026gt;\u0026lt;/i\u0026gt;\u0026amp;nbsp;\u0026lt;span id=\u0026quot;busuanzi_value_page_pv\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\u0026amp;nbsp;views\u0026lt;/span\u0026gt;\r single.html æ§åˆ¶æ–‡ç« é¡µé¢çš„æ˜¾ç¤ºï¼ŒæŠŠæ ‡ç­¾åŠ åˆ° post-meta å—ä¸­èƒ½è®©è®¡æ•°æ˜¾ç¤ºåœ¨æ–‡ç« æ ‡é¢˜ä¸‹é¢ä¸€è¡Œå¤„ã€‚å…¶ä¸­ \u0026lt;i class=\u0026quot;iconfont icon-time-sharp\u0026quot;\u0026gt; æ˜¯æˆ‘åœ¨ä¸»é¢˜çš„ post_meta.html ä¸­æŠ„æ¥çš„ï¼Œèƒ½æŒ‡å®šå…ƒæ•°æ®çš„å›¾æ ‡å’Œå­—ä½“ã€‚ä¸è’œå­çš„æ ‡ç­¾é‡‡ç”¨äº†å®˜ç½‘æåˆ°çš„æç®€æ¨¡å¼ã€‚\næœ€åè€ƒè™‘åœ¨åšå®¢çš„é¡µè„šåŠ ä¸Šæ€»è®¿é—®é‡çš„è®¡æ•°ã€‚åœ¨ themes/fuji/layouts/partials/footer.html æ–‡ä»¶çš„ footer å—ä¸­åŠ å…¥\n\u0026lt;!-- æ˜¾ç¤ºç½‘ç«™è®¿é—®é‡ --\u0026gt;\rVisits: \u0026lt;span id=\u0026quot;busuanzi_value_site_pv\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\r æ‘†æ”¾æ ‡ç­¾çš„ä½ç½®éƒ½æ˜¯æˆ‘èƒ¡ä¹±è¯•å‡ºæ¥çš„ï¼Œåœ¨ä¸åŒä¸»é¢˜ä¸‹çš„åšæ³•å„ä¸ç›¸åŒã€‚\nä¿®æ”¹æ ·å¼ ä¾æ® Fuji ä¸»é¡µçš„è¯´æ˜ï¼Œåˆ©ç”¨ assets/scss/_custom_var.scss æ–‡ä»¶ä¿®æ”¹ SCSS å˜é‡ï¼ˆä¾‹å¦‚æ¢é¢œè‰²ã€æ¢å­—ä½“ï¼‰ï¼Œåˆ©ç”¨ assets/scss/_custom_rule.scss æ–‡ä»¶æ”¹å†™ SCSS è§„åˆ™ã€‚\nåˆ«äººçš„åšå®¢ æœ€åæ”¾ä¸¤ä¸ªåˆ«äººç”¨ Hugo + Fuji æ­çš„åšå®¢\nhttps://marcoscheel.de/post/2020/10/20201011-my-blog-has-moved/\nhttps://masatakashiwagi.github.io/portfolio/post/hugo-portfolio/\nå‚è€ƒé“¾æ¥ å¦‚ä½•ä½¿ç”¨Hugoåœ¨GitHub Pagesä¸Šæ­å»ºå…è´¹ä¸ªäººç½‘ç«™\nç”Ÿç‰©ä¿¡æ¯åŸºç¡€ï¼šå®ç”¨Gitå‘½ä»¤ï¼ŒæŒæ¡è¿™äº›å°±å¤Ÿäº†\nhugo å¯¼å…¥å›¾ç‰‡ï¼Œä¸¤ç§æ–¹å¼\nsingle or double dollar sign as formula delimiter\nGitä¸­submoduleçš„ä½¿ç”¨\nhugoå»ºç«™ | æˆ‘çš„ç¬¬ä¸€ä¸ªåšå®¢ç½‘ç«™\n","date":"2021-07-03","permalink":"https://zhajiman.github.io/post/rebuild_blog/","tags":["hugo","github"],"title":"ç”¨ Hugo é‡æ–°æ­å»ºåšå®¢"},{"content":"æœ€è¿‘åˆç¢°åˆ°äº†ç»™å‡ºåœ°çƒä¸Šä¸¤ç‚¹çš„ç»çº¬åº¦ï¼Œç„¶åè®¡ç®—å®ƒä»¬ä¹‹é—´è·ç¦»çš„é—®é¢˜ã€‚ä¹‹å‰æ›¾ç»é€šè¿‡æŸ¥ç»´åŸºå†™è¿‡ç®€å•çš„åšæ–‡ï¼Œä¸è¿‡ç°åœ¨å®è·µæ—¶å‘ç°åšæ–‡é‡Œé—®é¢˜è¾ƒå¤šï¼Œæ•…é‡æ’°å¦‚ä¸‹ã€‚\nåœ°çƒçš„å½¢çŠ¶ ä¸ºäº†è®¡ç®—åœ°çƒä¸Šä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œé¦–å…ˆéœ€è¦å¯¹åœ°çƒçš„å½¢çŠ¶æœ‰ä¸ªæ¦‚å¿µï¼Œä»¥å®šä¹‰è·ç¦»çš„å‡ ä½•è¡¨ç¤ºã€‚æˆ‘ä»¬çš„ä¸€èˆ¬å¸¸è¯†æ˜¯ï¼šåœ°çƒæ˜¯ä¸€ä¸ªèµ¤é“æ–¹å‘ç•¥é•¿ã€ä¸¤ææ–¹å‘ç•¥çŸ­çš„æ¤­çƒï¼Œä¸”è¡¨é¢æœ‰ç€ä¸è§„åˆ™èµ·ä¼çš„åœ°å½¢ã€‚è¿™ç§å½¢çŠ¶è‚¯å®šæ— æ³•ç›´æ¥è®¡ç®—ï¼Œæ‰€ä»¥å¸Œæœ›èƒ½ç®€åŒ–ä¸ºä¸€ä¸ªèƒ½ç”¨ç®€å•æ•°å­¦å¼å­æè¿°çš„å½¢çŠ¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•ä¸”å¤¸å¼ çš„å›¾ç¤º\né»‘çº¿è¡¨ç¤ºåœ°çƒçš„å›ºä½“è¡¨é¢ï¼Œå› ä¸ºåœ°å½¢èµ·ä¼è€Œæ˜¾å¾—ä¸è§„åˆ™ã€‚ä¸è¿‡è¿™é‡Œåªæ˜¯å¤¸å¼ çš„ç”»æ³•ï¼Œåœ°å½¢è½å·®ç›¸å¯¹äºåœ°çƒåŠå¾„è€Œè¨€å…¶å®å¾®ä¹å…¶å¾®ã€‚é»‘çº¿ä»¥ä¸Šçš„è“çº¿æ˜¯æµ·å¹³é¢ï¼Œå‡è®¾ä½œä¸ºé‡åŠ›ä½èƒ½ç­‰åŠ¿é¢çš„æµ·å¹³é¢èƒ½å»¶ä¼¸åˆ°å¤§é™†å†…éƒ¨ï¼Œé‚£ä¹ˆçœŸå®çš„æµ·å¹³é¢å¯ä»¥å’Œå‡æƒ³çš„æµ·å¹³é¢å…±åŒæ„æˆä¸€ä¸ªå°é—­æ›²é¢ï¼Œç§°ä¸ºå¤§åœ°æ°´å‡†é¢ï¼ˆgeoidï¼‰ã€‚ç”±äºåœ°çƒå†…éƒ¨è´¨é‡åˆ†å¸ƒä¸å‡ï¼Œä¸åŒæ–¹å‘ä¸Šé‡åŠ›æœ‰å·®å¼‚ï¼Œæ‰€ä»¥å¤§åœ°æ°´å‡†é¢ä¹Ÿä¼šæœ‰äº›ä¸è§„åˆ™ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–ï¼Œè€ƒè™‘ç”¨ä¸€ä¸ªæ—‹è½¬æ¤­çƒä½“å»æ‹Ÿåˆå¤§åœ°æ°´å‡†é¢ï¼Œæ‹Ÿåˆç»“æœå³ä¸ºåœ°çƒæ¤­çƒä½“ï¼ˆearth ellipsoidï¼‰ã€‚å› ä¸ºåœ°çƒæ¤­çƒä½“å¯ä»¥ç”¨ç®€å•çš„æ•°å­¦å¼å­æè¿°ï¼Œæ‰€ä»¥éå¸¸ä¾¿äºè®¡ç®—ç»çº¬åº¦å’Œæµ·æ‹”ã€‚å¯¹æ‹Ÿåˆæ•ˆæœçš„ä¸åŒå®šä¹‰èƒ½å¯¼è‡´ä¸åŒçš„åœ°çƒæ¤­çƒä½“ï¼Œä¾‹å¦‚è€ƒè™‘å…¨çƒçš„æ‹Ÿåˆæ•ˆæœï¼Œå¸¸ç”¨ WGS84 åæ ‡ç³»ï¼ˆå›¾ä¸­çº¢çº¿ï¼‰ï¼›è€Œè€ƒè™‘åŒºåŸŸçš„æ‹Ÿåˆæ•ˆæœæ—¶ï¼Œä¼šè®¾è®¡å±€åœ°çš„åæ ‡ç³»ï¼ˆå›¾ä¸­ç»¿çº¿ï¼‰ã€‚\nå¦‚æœè¿˜æƒ³å·æ‡’ï¼Œå¯ä»¥è¿›ä¸€æ­¥æŠŠæ—‹è½¬æ¤­çƒä½“ç®€åŒ–ä¸ºçƒä½“ã€‚ä¾‹å¦‚ï¼Œåœ¨ WGS84 åæ ‡ç³»ä¸­ï¼Œèµ¤é“æ–¹å‘åŠå¾„ $a = 6378.1370\\ \\rm{km}$ï¼Œä¸¤ææ–¹å‘åŠå¾„ $b = 6356.7523\\ \\rm{km}$ï¼Œæ¤­çƒæ‰ç‡ $f$ ä¸º $$ f = \\frac{a-b}{a} \\approx 0.003 $$ å› ä¸ºæ‰ç‡è¶³å¤Ÿä½ï¼Œæ‰€ä»¥å¯ä»¥è¿›ä¸€æ­¥è¿‘ä¼¼ä¸ºçƒä½“ã€‚å›¾ç¤ºå¦‚ä¸‹\nWGS æ ‡å‡†å®šä¹‰åœ°çƒçš„å¹³å‡åŠå¾„ $R$ ä¸º $$ R = \\frac{2a+b}{3} \\approx 6371\\ \\rm{km} $$ Wiki ä¸Šè¯´å½“çƒä½“å–è¿™ä¸€åŠå¾„æ—¶èƒ½å‡å°çƒä½“ä¸æ¤­çƒä½“åœ¨ä¼°è®¡ä¸¤ç‚¹é—´è·ç¦»æ—¶çš„è¯¯å·®ï¼Œå…·ä½“æ¥æºæœ‰å¾…æŸ¥è¯ã€‚æ€»ä¹‹ï¼Œåˆ©ç”¨ä¸Šè¿°ç®€åŒ–çš„å½¢çŠ¶æ¨¡å‹ï¼Œä¾¿èƒ½ç€æ‰‹è®¡ç®—åœ°çƒä¸Šä¸¤ç‚¹é—´çš„è·ç¦»ã€‚ä¸‹é¢å…ˆä»æœ€ç®€å•çš„çƒä½“å¼€å§‹ä»‹ç»ã€‚\nçƒä½“ä¸Šä¸¤ç‚¹é—´çš„è·ç¦» å‡è®¾åœ°çƒæ˜¯ä¸€ä¸ª $R = 6371\\ \\rm{km}$ çš„çƒä½“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\nçƒåæ ‡ç³»ä¸­ä»¥åŒ—ææ–¹å‘ä¸º $z$ è½´ï¼Œèµ¤é“å¹³é¢ä¸º $xy$ å¹³é¢ï¼Œçƒé¢ä¸Šä¸€ç‚¹ $P$ çš„ç»åº¦å’Œçº¬åº¦åˆ†åˆ«ä¸º $\\lambda$ å’Œ $\\phi$ï¼Œå–å€¼èŒƒå›´ä¸º $$ \\lambda \\in [-180^\\circ, 180^\\circ] \\quad \\text{or} \\quad [0^\\circ, 360^\\circ] $$\n$$ \\phi \\in [-90^\\circ,90^\\circ] $$\nçƒé¢ä¸Šä¸¤ç‚¹é—´çš„è·ç¦»æŒ‡çš„æ˜¯ä¸¤ç‚¹é—´é•¿åº¦æœ€çŸ­çš„å¼§çº¿ï¼Œç”±äºè¿™ä¸€å¼§çº¿è‚¯å®šä½äºä¸¤ç‚¹æ‰€åœ¨çš„å¤§åœ†ä¸Šï¼Œæ‰€ä»¥åˆç§°ä½œå¤§åœ†è·ç¦»ï¼ˆgreat-circle distanceï¼‰ã€‚é¦–å…ˆæ¥è®¨è®ºä¸€ä¸‹ç»çº¿å’Œçº¬çº¿ä¸Šä¸¤ç‚¹é—´çš„è·ç¦»ã€‚\nåŒä¸€ç»çº¿ä¸Šçš„ä¸¤ç‚¹ç»åº¦ç›¸åŒï¼Œçº¬åº¦ç›¸å·® $\\Delta \\phi$ã€‚ç”±äºç»çº¿éƒ½æ˜¯åŠä¸ªå¤§åœ†å¼§ï¼Œæ‰€ä»¥ä¸¤ç‚¹é—´çš„è·ç¦»ç›´æ¥ç”±å¼§é•¿å…¬å¼å¾—åˆ° $$ \\Delta d = R \\Delta \\phi $$ å®¹æ˜“çœ‹å‡ºï¼Œç»çº¿ä¸Šçº¬åº¦æ¯ç›¸å·® 1Â°ï¼Œè·ç¦»ç›¸å·®çº¦ 111 kmã€‚\nåŒä¸€çº¬çº¿ä¸Šçš„ä¸¤ç‚¹çº¬åº¦ç›¸åŒï¼Œç»åº¦ç›¸å·® $\\Delta \\lambda$ã€‚ä¸ç»çº¿ä¸åŒï¼Œçº¬çº¿ï¼ˆæˆ–è€…è¯´çº¬åœˆï¼‰æ˜¯çƒé¢ä¸Šçš„å°åœ†ï¼Œè®¡ç®—è·ç¦»å·®æ—¶ï¼Œé¦–å…ˆæŠŠçƒçš„åŠå¾„ $R$ ä¹˜ä¸Š $\\cos \\phi$ è½¬åŒ–ä¸ºå°åœ†åŠå¾„ï¼Œå†å¥—ç”¨å¼§é•¿å…¬å¼ $$ \\Delta d = R \\cos \\phi \\Delta \\lambda $$ å®¹æ˜“çœ‹å‡ºï¼Œèµ¤é“çº¬çº¿ä¸Šç»åº¦ç›¸å·® 1Â° æ—¶ï¼Œè·ç¦»å·®ä¾æ—§æ˜¯ 111 km ä½†çº¬åº¦è¶Šé«˜ï¼Œè¿™ä¸€è·ç¦»è¶Šå°ã€‚ä¾‹å¦‚å¯¹äºçº¬åº¦ 40Â°N çš„åŒ—äº¬ï¼Œçº¬çº¿ä¸Š 1Â° ä»…ç›¸å½“äº 85 kmã€‚è¶Šé è¿‘ä¸¤ä¸ªæç‚¹ï¼Œè·ç¦»å°±è¶Šæ¥è¿‘ 0ã€‚ç»çº¿å’Œçº¬çº¿ä¸Šçš„è·ç¦»å…¬å¼å¯ä»¥ç”¨ä¸‹é¢è¿™å¼ å›¾æ¥æ€»ç»“\néœ€è¦æ³¨æ„ï¼Œå…¬å¼ä¸­çš„ $\\Delta \\phi$ å’Œ $\\Delta \\lambda$ åœ¨è®¡ç®—æ—¶éœ€è¦è½¬æ¢ä¸ºå¼§åº¦å•ä½ã€‚é€šå¸¸è€Œè¨€ï¼Œåœ¨ä¸­ä½çº¬åº¦åœ°åŒºä¸ºäº†æ–¹ä¾¿ï¼Œå¯ä»¥è¯´ $1^\\circ \\approx 111\\ \\rm{km}$ã€‚\nè¯´å®Œç»çº¿å’Œçº¬çº¿ä¸Šçš„è·ç¦»ï¼Œæ¥ç€æ‹“å±•ä¸ºçƒä½“ä¸Šä»»æ„ä¸¤ç‚¹é—´çš„è·ç¦»ã€‚è®¾çƒé¢ä¸Šæœ‰ä¸¤ä¸ªç‚¹ $P(\\lambda_1, \\phi_1)$ å’Œ $Q(\\lambda_2, \\phi_2)$ï¼Œè¿™ä¸¤ç‚¹é—´çš„è·ç¦»å³è¿‡ $P$ ç‚¹å’Œ $Q$ ç‚¹çš„å¤§åœ†ä¸Šçš„å¼§ $PQ$ çš„é•¿åº¦ $\\Delta d$ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\næ˜¾ç„¶å¼§é•¿ $\\Delta d$ ä¸å¼§ $PQ$ çš„åœ†å¿ƒè§’ $\\Delta \\sigma$ æ»¡è¶³ $$ \\Delta d = R \\Delta \\sigma $$ æ‰€ä»¥è®¡ç®—è·ç¦»çš„é—®é¢˜è½¬åŒ–ä¸ºå¦‚ä½•è®¡ç®—åœ†å¿ƒè§’ $\\Delta \\sigma$ã€‚ç”±çƒé¢ä¸‰è§’å­¦ä¸­çš„çƒé¢ä½™å¼¦å®šç† $$ \\Delta \\sigma = \\arccos (\\sin \\phi_1 \\sin \\phi_2 + \\cos \\phi_1 \\cos \\phi_2 \\cos (\\Delta \\lambda)) $$ å…¶ä¸­ $\\Delta \\lambda$ çš„æ­£è´Ÿä¸å½±å“ç»“æœï¼ˆåé¢å°†ä¼šå‡ºç°çš„ $\\Delta \\phi$ ä¹Ÿæ˜¯ï¼‰ï¼Œæœ€åå¾—åˆ°çš„ $\\Delta \\sigma$ çš„èŒƒå›´æ˜¯ $[0,\\pi]$ã€‚ç„¶è€Œå½“ä¸¤ä¸ªç‚¹ç‰¹åˆ«é è¿‘æ—¶ï¼Œ$\\arccos$ æ‹¬å·å†…çš„å€¼æ¥è¿‘äº 1ï¼Œè€Œ $\\arccos$ å‡½æ•°åœ¨è¿™ä¸€ç‚¹é™„è¿‘çš„å˜åŒ–ç‡è¾ƒå¤§ï¼Œè®¡ç®—æ—¶çš„èˆå…¥è¯¯å·®ä¼šå› æ­¤å˜å¤§ã€‚æ‰€ä»¥å¦å¤–ä¼šä½¿ç”¨æ•°å€¼ä¸Šæ›´åŠ ç¨³å®šçš„ haversine å…¬å¼ã€‚é¦–å…ˆå®šä¹‰åŠæ­£çŸ¢å‡½æ•° $$ \\rm{hav}\\ \\theta = \\sin^2 \\frac{\\theta}{2} $$ å¸¦å…¥åˆ°çƒé¢ä½™å¼¦å®šç†çš„å…¬å¼ä¸­ï¼Œæ˜“å¾— $$ \\begin{align} \\Delta \\sigma \u0026amp;= \\rm{archav}(\\rm{hav}(\\Delta \\phi) + \\cos \\phi_1 \\cos \\phi_2 \\rm{hav}(\\Delta \\lambda)) \\newline \u0026amp;= 2 \\arcsin \\sqrt{\\sin^2(\\frac{\\Delta \\phi}{2}) + \\cos \\phi_1 \\cos \\phi_2 \\sin^2(\\frac{\\Delta \\lambda}{2})} \\end{align} $$ å½“ä¸¤ä¸ªç‚¹ç‰¹åˆ«é è¿‘æ—¶ï¼Œ$\\arcsin$ åé¢çš„å€¼æ¥è¿‘äº 0ï¼Œè€Œ $\\arcsin$ å‡½æ•°åœ¨è¿™ä¸€ç‚¹é™„è¿‘çš„å˜åŒ–ç‡è¾ƒå°ï¼Œæ‰€ä»¥ä¼šæ¯”ç›´æ¥ç”¨çƒé¢ä½™å¼¦å…¬å¼æ¥å¾—æ›´ç²¾ç¡®ã€‚ä¸è¿‡ä¹Ÿå¯ä»¥åè¿‡æ¥æ¨æµ‹ï¼Œhaversine å…¬å¼åœ¨ä¸¤ç‚¹ç›¸å¯¹çš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚å—åŒ—ä¸¤æï¼‰è¯¯å·®ä¼šå˜å¤§ã€‚ä¸‹é¢å°±æ­¤è¿›è¡Œæµ‹è¯•ï¼Œç»™å‡ºèµ¤é“ä¸Šä¸¤ç‚¹çš„ç»çº¬åº¦ï¼Œç”¨è¿™ä¸¤ä¸ªå…¬å¼åˆ†åˆ«è®¡ç®—åœ†å¿ƒè§’ï¼Œæ¯”è¾ƒå®ƒä»¬ä¸ç†è®ºå€¼ä¹‹é—´çš„å·®å¼‚ã€‚\nimport numpy as np\rimport matplotlib as mpl\rimport matplotlib.pyplot as plt\rfrom scipy.ndimage import gaussian_filter1d\rdef cosine(lon1, lat1, lon2, lat2):\r'''åˆ©ç”¨çƒé¢ä½™å¼¦å…¬å¼è®¡ç®—ä¸¤ç‚¹é—´çš„åœ†å¿ƒè§’.'''\rlon1, lat1, lon2, lat2 = map(np.deg2rad, [lon1, lat1, lon2, lat2])\rdlon = lon2 - lon1\ra = np.sin(lat1) * np.sin(lat2)\rb = np.cos(lat1) * np.cos(lat2) * np.cos(dlon)\rdtheta = np.arccos(a + b)\rreturn np.rad2deg(dtheta)\rdef hav(x):\r'''è®¡ç®—åŠæ­£çŸ¢å‡½æ•°.'''\rreturn np.sin(x / 2)**2\rdef haversine(lon1, lat1, lon2, lat2):\r'''åˆ©ç”¨haversineå…¬å¼è®¡ç®—ä¸¤ç‚¹é—´çš„åœ†å¿ƒè§’.'''\rlon1, lat1, lon2, lat2 = map(np.deg2rad, [lon1, lat1, lon2, lat2])\rdlon = lon2 - lon1\rdlat = lat2 - lat1\ra = hav(dlat)\rb = np.cos(lat1) * np.cos(lat2) * hav(dlon)\rdtheta = 2 * np.arcsin(np.sqrt(a + b))\rreturn np.rad2deg(dtheta)\rif __name__ == '__main__':\rnpt = 10000\r# ç‚¹1çš„ç»åº¦ä¸º-180Â°,ç‚¹2çš„ç»åº¦èŒƒå›´ä¸º[-180Â°, 180Â°].\rlon1 = np.full(npt, -180)\rlat1 = np.zeros(npt)\rlon2 = np.linspace(-180, 180, npt + 2)[1:-1] # é¿å¼€0Â°å¤¹è§’.\rlat2 = np.zeros(npt)\r# è®¡ç®—ç†è®ºçš„åœ†å¿ƒè§’,å’Œä¸¤ç§å…¬å¼å¯¼å‡ºçš„åœ†å¿ƒè§’.\rdlon = np.abs(lon2 - lon1)\rdeg_tru = np.where(dlon \u0026gt; 180, 360 - dlon, dlon)\rdeg_cos = cosine(lon1, lat1, lon2, lat2)\rdeg_hav = haversine(lon1, lat1, lon2, lat2)\r# è®¡ç®—ä¸ç†è®ºå€¼ä¹‹é—´çš„è¯¯å·®.\rerr_cos = np.abs(deg_cos - deg_tru) / deg_tru * 100\rerr_hav = np.abs(deg_hav - deg_tru) / deg_tru * 100\r# å¯¹ç»“æœè¿›è¡Œå¹³æ»‘.\rerr_cos = gaussian_filter1d(err_cos, sigma=3)\rerr_hav = gaussian_filter1d(err_hav, sigma=3)\r# ç”»å›¾.\rfig, ax = plt.subplots()\rax.plot(dlon, err_cos, lw=1, label='cosine')\rax.plot(dlon, err_hav, lw=1, label='haversine')\rleg = ax.legend(frameon=False)\rfor line in leg.get_lines():\rline.set_linewidth(2)\r# è®¾ç½®xè½´.\rax.set_xlabel('Longitude Difference (Â°)', fontsize='large')\rax.set_xlim(-10, 370)\rax.xaxis.set_major_locator(mpl.ticker.MultipleLocator(60))\rax.xaxis.set_minor_locator(mpl.ticker.AutoMinorLocator(2))\r# yè½´é‡‡ç”¨å¯¹æ•°åæ ‡.\rax.set_ylabel('Deviation (%)', fontsize='large')\rax.set_yscale('log')\rax.set_ylim(1E-13, None)\rax.grid(ls='--')\rplt.show()\r å½“ä¸¤ç‚¹é—´å¤¹è§’æ¥è¿‘äº 0Â° æ—¶ï¼Œå¦‚å›¾ä¸­æœ€å·¦è¾¹å’Œæœ€å³è¾¹æ‰€ç¤ºï¼Œçƒé¢ä½™å¼¦å…¬å¼çš„è¯¯å·®å¤§äº haversine å…¬å¼ï¼›å½“ä¸¤ç‚¹è¿‘ä¹ç›¸å¯¹æ—¶ï¼Œå¦‚å›¾æ­£ä¸­é—´æ‰€ç¤ºï¼Œhaversine å…¬å¼çš„è¯¯å·®å¤§äºçƒé¢ä½™å¼¦å…¬å¼ã€‚ä¸€ä¸ªå¥‡æ€ªçš„åœ°æ–¹æ˜¯ï¼Œhaversine å…¬å¼åœ¨ä¸¤ç‚¹é—´å¤¹è§’è¶‹äº 0Â° æ—¶çš„è¯¯å·®è¿˜è¦ç•¥å¤§äºä¸¤ç‚¹ç›¸å¯¹çš„æƒ…å†µï¼Œæˆ‘ä¹Ÿæƒ³ä¸å‡ºåŸå› ï¼Œä¹Ÿè®¸è·Ÿè®¡ç®— $\\Delta \\phi$ æ—¶äº§ç”Ÿçš„èˆå…¥è¯¯å·®æœ‰å…³ï¼Ÿä¸çŸ¥é“æœ‰æ²¡æœ‰è¯»è€…èƒ½äºˆä»¥è§£ç­”ã€‚ä½†æ€»åœ°çœ‹æ¥ï¼Œåœ¨ 64 ä½æµ®ç‚¹ç²¾åº¦ä¸‹è¿™ä¸¤ä¸ªå…¬å¼çš„è¯¯å·®å®Œå…¨å¯ä»¥å¿½ç•¥ï¼Œå®é™…ä½¿ç”¨æ—¶ä»»é€‰å…¶ä¸€å³å¯ã€‚å¦‚æœæƒ³è¦ç°æˆçš„ haversine å…¬å¼å®ç°ï¼Œå¯ä»¥è°ƒç”¨ scikit-learn åŒ…é‡Œçš„ sklearn.metrics.pairwise.haversine_distances å‡½æ•°ã€‚\næ­¤å¤–ç»´åŸºä¸Šè¿˜æåˆ°äº†ä¸€ä¸ªæ‰€è°“çƒä½“æƒ…å†µä¸‹çš„ Vincenty å…¬å¼ï¼Œå£°ç§°è¿™ä¸ªå…¬å¼å¯¹äºä»»æ„ä½ç½®çš„ä¸¤ç‚¹éƒ½ç²¾ç¡®ã€‚ä½†æˆ‘æµ‹è¯•åå‘ç°ç»“æœæ¯”è¾ƒç¦»è°±ï¼Œè®¡ç®—å‡ºäº†è´Ÿçš„åœ†å¿ƒè§’ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥é€šè¿‡æ•°å­¦è¯æ˜è¿™ä¸ªå…¬å¼æ˜¯é”™çš„ï¼Œæ‰€ä»¥è¯·è¯»è€…å°å¿ƒå¼•ç”¨ã€‚\næ¤­çƒä¸Šä¸¤ç‚¹é—´çš„è·ç¦» æ¯”çƒä½“è¿‘ä¼¼æ›´ç²¾ç¡®çš„æ˜¯æ¤­çƒè¿‘ä¼¼ï¼Œæ¤­çƒä¸Šä¸¤ç‚¹è·ç¦»çš„è®¡ç®—ä¸€èˆ¬é‡‡ç”¨ Vincenty å…¬å¼ï¼Œè¿™æ˜¯ä¸€ç§ç²¾åº¦å¾ˆé«˜çš„è¿­ä»£æ³•ï¼Œå…·ä½“åˆ†ä¸ºä¸¤ç§\n direct methodï¼šå·²çŸ¥ä¸€ç‚¹çš„åæ ‡ï¼Œç»™å‡ºæœå‘å¦ä¸€ç‚¹çš„è·ç¦»å’Œæ–¹ä½è§’ï¼Œç”¨å…¬å¼è®¡ç®—å‡ºå¦ä¸€ç‚¹çš„åæ ‡ã€‚ inverse methodï¼šå·²çŸ¥ä¸¤ç‚¹çš„åæ ‡ï¼Œç”¨å…¬å¼è®¡ç®—å‡ºä¸¤ç‚¹é—´çš„è·ç¦»å’Œæ–¹ä½è§’ã€‚  æ˜¾ç„¶æˆ‘ä»¬è¿™é‡Œéœ€è¦çš„æ˜¯ inverse methodï¼Œå³æ ¹æ®ä¸¤ç‚¹åæ ‡é€†å‘æ±‚è§£å®ƒä»¬ä¹‹é—´çš„è·ç¦»ã€‚ç»´åŸºä¸Šçš„ç›¸å…³å…¬å¼è¿˜æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘ä¹Ÿä¸æ‡‚å…·ä½“åŸç†ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç›´æ¥è°ƒåŒ…äº†ã€‚Python ä¸­çš„ pyproj åŒ…æä¾›å¯¹åœ°ç†åæ ‡çš„å˜æ¢æ“ä½œï¼Œå…¶ä¸­ Geod ç±»å¯ä»¥ç”Ÿæˆä¸€ä¸ªä»£è¡¨åœ°çƒæ¤­çƒä½“çš„å¯¹è±¡ï¼Œåˆ©ç”¨å…¶ inv æ–¹æ³•å³å¯å®ç° inverse method\nfrom pyproj import Geod\r# æµ·å£çš„ç»çº¬åº¦.\rlon1, lat1 = 110.33, 20.07\r# åŒ—äº¬çš„ç»çº¬åº¦.\rlon2, lat2 = 116.40, 39.91\r# ç”Ÿæˆä¸€ä¸ªçƒä½“,é»˜è®¤åŠå¾„R=6370997.0m\rg1 = Geod(ellps='sphere')\r# ç”Ÿæˆä¸€ä¸ªWGS84åæ ‡ç³»ä¸‹çš„æ¤­çƒ.\rg2 = Geod(ellps='WGS84')\r# è®¡ç®—WGS84æ¤­çƒä¸Šä¸¤ç‚¹ä¹‹é—´çš„æ–¹ä½è§’å’Œè·ç¦»,é»˜è®¤ç»çº¬åº¦å•ä½ä¸ºdegree.\raz12, az21, dist = g2.inv(lon1, lat1, lon2, lat2)\r ä¾‹å¦‚ä¸Šé¢è®¡ç®—å‡ºæµ·å£åˆ°åŒ—äº¬çš„è·ç¦»ä¸º 2274.54 kmï¼Œè€Œçƒé¢ä½™å¼¦å…¬å¼å’Œ haversine å…¬å¼å¯¹è¿™ä¸ªç»“æœçš„è¯¯å·®ä¸º 0.27 %ã€‚å…‰çœ‹æ•°å­—å¯èƒ½ä¸å¤ªå½¢è±¡ï¼Œé‚£å‡è®¾é«˜é“æ—¶é€Ÿä¸º 250 km/hï¼Œå†è€ƒè™‘é€”ä¸­æœ‰å¼¯å¼¯ç»•ç»•ï¼Œè¿™ä¸ªè·ç¦»éœ€è¦åä¸Šåå‡ ä¸ªå°æ—¶çš„é«˜é“ã€‚ä¸è¿‡å¦‚ç¬¬ä¸€èŠ‚æ‰€è¿°ï¼Œè®¡ç®—å‡ºçš„è·ç¦»ä¼šæ ¹æ®æˆ‘ä»¬é€‰å–çš„åœ°çƒæ¤­çƒä½“çš„å˜åŒ–è€Œå‘ç”Ÿå˜åŒ–ï¼Œå¹¶ä¸”å¾ˆéš¾è¯´å“ªä¸ªæ¤­çƒçš„ç»“æœå°±æ›´ç²¾ç¡®â€”â€”å®ƒä»¬éƒ½æ˜¯å¯¹å¤§åœ°æ°´å‡†é¢çš„æœ‰æ•ˆè¿‘ä¼¼ï¼Œåªä¸è¿‡åœ¨ä¸åŒåŒºåŸŸçš„è¡¨ç°ä¸åŒç½¢äº†ã€‚\nPython ä¸­çš„ GeoPy åŒ…ä¹Ÿæä¾›ç±»ä¼¼çš„è·ç¦»è®¡ç®—åŠŸèƒ½ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è¯•è¯•çœ‹ã€‚\nå‚è€ƒèµ„æ–™ Wikipedia: Great-circle distance\nçŸ¥ä¹ï¼šå¦‚ä½•åŒºåˆ†æµ‹é‡å­¦ä¸­çš„å¤§åœ°æ°´å‡†é¢ã€å¤§åœ°åŸºå‡†ã€ä¼¼å¤§åœ°æ°´å‡†é¢ã€åœ°çƒæ¤­çƒç­‰æ¦‚å¿µï¼Ÿ\npyproj.Geod\n","date":"2021-06-05","permalink":"https://zhajiman.github.io/post/distance_on_earth/","tags":["æµ‹åœ°å­¦"],"title":"åœ°çƒä¸Šä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼ˆæ”¹ï¼‰"},{"content":"å‰è¨€ æ˜¨å¤©ä¸€åŒå­¦é—®æˆ‘æ€ä¹ˆæŠŠå·²ç»ç”»å¥½çš„å›¾ç‰‡çš„ DPI æ”¹åˆ° 300ï¼Œä»¥æ»¡è¶³æœŸåˆŠå¯¹å›¾ç‰‡æ¸…æ™°åº¦çš„è¦æ±‚ã€‚ä¸Šç½‘æœç´¢ä¸€ç•ªåæ‰å‘ç°ï¼Œè™½ç„¶æˆ‘ç»å¸¸åœ¨ Matplotlib ä¸­ç”¨ dpi å‚æ•°æ¥è°ƒèŠ‚å›¾ç‰‡æ¸…æ™°åº¦ï¼Œä½†å®é™…ä¸Šæˆ‘å¯¹è¿™ä¸ªæ¦‚å¿µåŠæ‡‚ä¸æ‡‚ã€‚è¿™æ¬¡å€Ÿè¿™ä¸ªå¥‘æœºè°ƒç ”å’Œæ€»ç»“ä¸€ä¸‹ç›¸å…³çš„çŸ¥è¯†ã€‚æœ¬æ–‡å°†ä¼šä¾æ¬¡ä»‹ç»\n åˆ†è¾¨ç‡å’Œ DPI æ˜¯ä»€ä¹ˆã€‚ DPI å’Œæ¸…æ™°åº¦çš„å…³ç³»ã€‚ å¦‚ä½•å¯¼å‡ºæœŸåˆŠè¦æ±‚çš„é«˜ DPI å›¾ç‰‡ã€‚  åˆ†è¾¨ç‡ è¿™é‡Œçš„å›¾ç‰‡æŒ‡çš„æ˜¯ä½å›¾ï¼ˆbitmapï¼‰ï¼Œä¸€å¼ å›¾ç‰‡ç”±æ— æ•°ä¸ªå½©è‰²çš„å°åƒç´ ç‚¹ç»„æˆï¼ŒMatplotlib æ”¯æŒçš„ä½å›¾æ ¼å¼æœ‰ pngã€jpgã€jpegã€pngã€tiff ç­‰ã€‚æˆ‘ä»¬å¸¸ç”¨åˆ†è¾¨ç‡ï¼ˆresolutionï¼‰æ¥æè¿°å›¾ç‰‡çš„å¤§å°ï¼Œä¾‹å¦‚è¯´ä¸€å¼ å›¾ç‰‡çš„åˆ†è¾¨ç‡æ˜¯ 800 x 400ï¼Œå³æŒ‡è¿™å¼ å›¾ç‰‡å®½ 800 ä¸ªåƒç´ ï¼Œé«˜ 400 ä¸ªåƒç´ ã€‚Windows å¯¹ä¸€å¼  jpg å›¾ç‰‡æ‰“å¼€å³é”®èœå•ï¼Œåœ¨â€œå±æ€§â€é‡Œçš„â€œè¯¦ç»†ä¿¡æ¯â€é‡Œå°±èƒ½çœ‹åˆ°å›¾ç‰‡çš„åˆ†è¾¨ç‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\nåœ¨å…¶å®ƒé¢†åŸŸé‡Œåˆ†è¾¨ç‡ä¸€è¯é€šå¸¸æè¿°ä»ªå™¨åˆ†è¾¨ç»†èŠ‚çš„ç²¾ç»†ç¨‹åº¦ï¼Œè€Œå›¾ç‰‡çš„åˆ†è¾¨ç‡ä»…ä»…æ˜¯æŒ‡å›¾ç‰‡å¤§å°ï¼Œæ‰€ä»¥å¯¹äºå›¾ç‰‡å¤§å°æ¥è¯´ï¼Œä¸€ä¸ªæ›´å‡†ç¡®çš„æœ¯è¯­æ˜¯ pixel dimensionsã€‚ä¸è¿‡æ—¢ç„¶ Windows çš„èœå•é‡Œéƒ½è¿™ä¹ˆæ˜¾ç¤ºäº†ï¼Œé‚£åæ–‡å°†ç»§ç»­æ²¿ç”¨åˆ†è¾¨ç‡çš„è¯´æ³•ã€‚\nå°ºå¯¸ é™¤äº†ç”¨åƒç´ æ•°ï¼Œå›¾ç‰‡çš„å°ºå¯¸è¿˜å¯ä»¥ç”¨ç‰©ç†å•ä½æ¥æè¿°ï¼Œç”¨æ¥æŒ‡å®šæ‰“å°æ—¶å›¾ç‰‡åœ¨çº¸ä¸Šçš„å¤§å°ã€‚ä¾‹å¦‚å¯¹äºä¸€å¼ åˆ†è¾¨ç‡ä¸º 800 x 400 çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬å¸Œæœ›ç»´æŒåŸå®½é«˜æ¯”æ‰“å°å‡ºæ¥ï¼Œé‚£ä¹ˆå¯ä»¥è®¾å®šå…¶å°ºå¯¸ä¸ºå®½ 8 è‹±å¯¸ï¼Œé«˜ 4 è‹±å¯¸ï¼ˆ1 è‹±å¯¸çº¦ä¸º 2.54 å˜ç±³ï¼‰ã€‚è¿™ä¸ªå°ºå¯¸å¯ä»¥ä»»æ„è®¾å®šï¼Œæ¯•ç«Ÿæƒ³æ‰“å°å¤šå¤§å®Œå…¨ç”±ä½ å†³å®šã€‚\nDPI å’Œ PPI å¦‚æœè¯´åˆ†è¾¨ç‡å’Œå°ºå¯¸æ˜¯é•¿åº¦é‡çš„è¯ï¼Œé‚£ä¹ˆ DPI å’Œ PPI å°±æ˜¯å¯†åº¦é‡ã€‚å®ƒä»¬çš„å®šä¹‰å¦‚ä¸‹\n  DPIï¼ˆdots per inchï¼‰ï¼šæ¯è‹±å¯¸é•¿åº¦é‡Œå«æœ‰çš„æ‰“å°æœºå¢¨ç‚¹æ•°ã€‚\n  PPIï¼ˆpixels per inchï¼‰ï¼šæ¯è‹±å¯¸é•¿åº¦é‡Œå«æœ‰çš„åƒç´ æ•°ã€‚\n  DPI è¡¨ç°çš„æ˜¯æ‰“å°æœºçš„ç²¾ç»†ç¨‹åº¦ã€‚å¯¹äºåŒæ ·å¤§å°çš„çº¸å¼ ï¼Œæ‰“å°æœºçš„ DPI æ›´é«˜ï¼Œæ‰“å°æ—¶å°±ä¼šç”¨ä¸Šæ›´å¤šå¢¨ç‚¹ï¼Œé‚£ä¹ˆæ‰“å°æ•ˆæœè‡ªç„¶ä¹Ÿæ›´å¥½ã€‚\nç”µå­è®¾å¤‡å€Ÿé‰´äº†æ‰“å°è®¾å¤‡é‡Œ DPI çš„æ¦‚å¿µï¼Œç”¨ PPI æ¥è¡¡é‡åƒç´ ç‚¹çš„ç‰©ç†å°ºå¯¸ã€‚PPI å¯¹äºæ˜¾ç¤ºå™¨å’Œå›¾ç‰‡çš„æ„ä¹‰ç¨æœ‰ä¸åŒï¼Œä¸‹é¢æ¥åˆ†åˆ«ä»‹ç»ã€‚é¦–å…ˆï¼Œæ˜¾ç¤ºå™¨çš„ PPI è®¡ç®—å…¬å¼ä¸º\n$$ \\rm{PPI}=å¯¹è§’çº¿åƒç´ æ•°/å¯¹è§’çº¿ç‰©ç†é•¿åº¦ $$\nç»™å®šå±å¹•å¤§å°ï¼ŒPPI æ›´é«˜åˆ™å±å¹•å«æœ‰çš„åƒç´ æ•°æ›´å¤šï¼Œé‚£ä¹ˆæ˜¾ç¤ºæ•ˆæœä¼šæ›´å¥½ã€‚ä¾‹å¦‚è‹¹æœçš„ iPhone å°±å¼ºè°ƒå…¶ Retina å±å¹•çš„åƒç´ å¯†åº¦é«˜è¾¾ 326 PPIï¼Œæœ‰ç€è¶…å‡ºäººçœ¼è¯†åˆ«èƒ½åŠ›çš„ç»†è…»æ•ˆæœï¼ˆå¹¿å‘Šè¯­çœ‹çœ‹å°±å¾—äº†ï¼‰ã€‚\nå¯¹å›¾ç‰‡æ¥è¯´ï¼ŒPPI å’Œ DPI è¿™ä¸¤ä¸ªæœ¯è¯­ç»å¸¸æ··æ·†ä½¿ç”¨ï¼Œä¾‹å¦‚ Windows èœå•å°±ç§°å‘¼å›¾ç‰‡å•ä½è‹±å¯¸çš„åƒç´ æ•°ä¸º DPIï¼Œé‚£ä¹ˆåæ–‡ä¹Ÿä¼šæ²¿ç”¨è¿™ä¸€è¯´æ³•ã€‚å›¾ç‰‡ DPI çš„è®¡ç®—æ–¹æ³•æ˜¯\n$$ \\rm{æ°´å¹³DPI}=å®½åº¦åƒç´ æ•°/ç‰©ç†å®½åº¦ $$ $$ \\rm{å‚ç›´DPI}=é«˜åº¦åƒç´ æ•°/ç‰©ç†é«˜åº¦ $$\nå¯ä»¥çœ‹å‡ºï¼ŒDPI å°±æ˜¯å°†å›¾ç‰‡ä»åƒç´ å°ºå¯¸ç¼©æ”¾åˆ°ç‰©ç†å°ºå¯¸çš„æ¯”å€¼ã€‚å¦å¤–ï¼ŒDPI çš„å€’æ•°å³æ¯ä¸ªåƒç´ çš„å•ä½ç‰©ç†é•¿åº¦ï¼Œå› ä¸ºæˆ‘ä»¬æ€»æ˜¯å¸Œæœ›åƒç´ çš„ç‰©ç†å½¢çŠ¶æ˜¯æ­£æ–¹å½¢ï¼Œæ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹æ°´å¹³ DPI å°±ç­‰äºå‚ç›´ DPIï¼Œè¿™æ ·æ‰“å°å‡ºæ¥çš„å›¾ç‰‡ä¹Ÿèƒ½ç»´æŒåŸæœ‰çš„å®½é«˜æ¯”ã€‚\nä¸€äº›å›¾ç‰‡æ ¼å¼ä¼šè®°å½•å›¾ç‰‡çš„ DPI å€¼ï¼ŒWindows ä¸‹å›¾ç‰‡çš„å³é”®èœå•å±æ€§æ é‡Œä¾¿èƒ½çœ‹åˆ°ã€‚æˆ‘ä»¬åœ¨å¯¹å›¾ç‰‡è¿›è¡Œæ’ç‰ˆæˆ–æ‰“å°æ—¶ï¼Œè½¯ä»¶ä¼šæ ¹æ®å›¾ç‰‡çš„åˆ†è¾¨ç‡å’Œ DPI è‡ªåŠ¨è®¾å®šå›¾ç‰‡çš„çº¸ä¸Šå°ºå¯¸ã€‚ä¸è¿‡å¦‚æœä½ æƒ³æŠŠå›¾ç‰‡æ‰“å°å¤§ç‚¹ï¼Œé‚£ä¹ˆæ ¹æ®å®šä¹‰è®¡ç®—ï¼Œå›¾ç‰‡ DPI ä¼šå˜å°ï¼›æƒ³æ‰“å°å°ç‚¹ï¼Œå›¾ç‰‡ DPI å°±ä¼šå˜å¤§â€”â€”æ²¡é”™ï¼ŒDPI å¹¶ä¸æ˜¯å›¾ç‰‡çš„å›ºæœ‰å±æ€§ï¼ŒçœŸæ­£å†³å®š DPI çš„æ˜¯å›¾ç‰‡åˆ†è¾¨ç‡å’Œä½ æƒ³è¦çš„çº¸ä¸Šå°ºå¯¸ï¼Œå³é”®èœå•å±æ€§æ é‡Œçš„æ•°å€¼åªæ˜¯ä¸ªå‚è€ƒã€‚è¿™ä¸€ç‚¹è¿˜å¯ä»¥ä»ä¸¤ä¸ªä¾‹å­è¯´æ˜ï¼Œä¸€æ˜¯ png æ ¼å¼å‹æ ¹ä¸å« DPI å€¼ï¼Œä½ å¾—æ ¹æ®æ‰“å°éœ€æ±‚è‡ªå·±å»ç®—ï¼›äºŒæ˜¯å¯ä»¥ç”¨ Pillow åº“ç›´æ¥ä¿®æ”¹å›¾ç‰‡çš„ DPI å€¼\nfrom PIL import Image\r# test1.tifçš„åŸå§‹DPIä¸º50\rimg = Image.open('test1.tif')\rimg.save('test2.tif', dpi=(300, 300), compression=None)\r ç”¨ä¸Šé¢çš„ä»£ç å¯ä»¥æŠŠä¸€å¼ ç‰¹åˆ«ç³Šçš„å›¾ç‰‡æ”¹æˆ 300 DPI çš„â€œå‡ºç‰ˆçº§â€å›¾ç‰‡ï¼Œç„¶è€Œå›¾ç‰‡æ¸…æ™°åº¦å’Œä½“ç§¯ä¸€ç‚¹æ²¡å˜ï¼Œä¾æ—§è¯´æ˜å›¾ç‰‡å…ƒä¿¡æ¯ï¼ˆmetadataï¼‰é‡Œçš„ DPI å€¼åªæ˜¯ä¸ªæ‘†è®¾ã€‚\nDPI ä¸æ¸…æ™°åº¦ æˆ‘ä»¬å¯èƒ½å¬è¿‡ DPI è¶Šé«˜è¶Šæ¸…æ™°çš„è¯´æ³•ï¼Œè¿™é‡Œéœ€è¦æ˜ç¡®ï¼ŒDPI æ˜¯æ‰“å°æœºã€æ˜¾ç¤ºå™¨ï¼Œè¿˜æ˜¯å›¾ç‰‡çš„ DPIï¼Ÿæ¸…æ™°æ˜¯æŒ‡ä»€ä¹ˆä¸œè¥¿æ¸…æ™°ï¼Ÿ\nåŸåˆ™ä¸Šæ‰“å°æœºçš„ DPI è¶Šé«˜ï¼Œæ‰“å°å‡ºçš„çº¸è´¨å›¾ç‰‡è¶Šæ¸…æ™°ï¼›æ˜¾ç¤ºå™¨çš„ PPI è¶Šé«˜ï¼Œæ˜¾ç¤ºæ•ˆæœè¶Šå¥½ã€‚å¯¹å›¾ç‰‡åˆ™è¦åˆ†æƒ…å†µè®¨è®ºã€‚å¦‚æœç»™å®šå›¾ç‰‡åˆ†è¾¨ç‡ï¼ŒDPI è¶Šé«˜ï¼Œæ‰“å°å‡ºæ¥çš„çº¸è´¨å›¾ç‰‡è¶Šå°ï¼Œè™½ç„¶è¶Šå°è¶Šä¸å®¹æ˜“çœ‹å‡ºç‘•ç–µï¼Œä½†é‚£ä¹Ÿä¸èƒ½è¯´æˆæ˜¯æ‰“å°æ•ˆæœæ›´å¥½ã€‚å¦‚æœç»™å®šçº¸ä¸Šå°ºå¯¸ï¼ŒDPI è¶Šé«˜ï¼Œå›¾ç‰‡çš„åƒç´ æ•°è¶Šå¤šï¼Œäºæ˜¯é—®é¢˜è½¬åŒ–æˆäº†ï¼šå›¾ç‰‡åƒç´ è¶Šå¤šï¼Œå°±ä¼šè¶Šæ¸…æ™°å—ï¼Ÿ\nç­”æ¡ˆæ˜¯ä¸ä¸€å®šï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼ˆè½¬è‡ªçŸ¥ä¹ä¸“æ  å½±å“å›¾åƒç”»è´¨çš„å› ç´ ï¼šå›¾ç‰‡çš„åˆ†è¾¨ç‡å’Œåƒç´ æµ…è°ˆï¼‰\næ¯ä¸€æ’ä»å³å¾€å·¦ï¼Œé‡‡æ ·åˆ†è¾¨ç‡ä» 50 x 50 é™è‡³ 1 x 1ï¼Œæ¸…æ™°åº¦æ˜¾è‘—ä¸‹é™ï¼Œè¯´æ˜åƒç´ è¶Šå¤šè¶Šæ¸…æ™°ï¼›ä½†ç¬¬ä¸€æ’åˆ°ç¬¬äºŒæ’å°†åˆ†è¾¨ç‡ç”¨ PS æ”¾å¤§åˆ° 10 å€ï¼Œæ¸…æ™°åº¦å¹¶æ²¡æœ‰æ˜¾è‘—æé«˜ï¼Œåªæ˜¯åƒåŠ äº†æŸ”å’Œæ»¤é•œä¸€æ ·ã€‚å°±æˆ‘ä¸ªäººçš„ç†è§£ï¼Œåªæœ‰åœ¨ä»æºå¤´ç”Ÿæˆå›¾ç‰‡çš„è¿‡ç¨‹ä¸­æ‰æœ‰åƒç´ è¶Šå¤šè¶Šæ¸…æ™°çš„è§„å¾‹ï¼Œä¾‹å¦‚æ‹ç…§æ—¶é‡‡æ ·äº†æ›´å¤šåƒç´ ç‚¹ã€ç”»ç”»æ—¶ç”¨æ›´å¤šåƒç´ æç»˜ç»†èŠ‚ç­‰ï¼›å¦‚æœåªæ˜¯å¯¹å›¾ç‰‡è¿›è¡Œåå¤„ç†æ¥å¢å¤šåƒç´ çš„è¯å°±ä¸ä¸€å®šèƒ½æ›´æ¸…æ™°ï¼Œä¾‹å¦‚å„ç§æ’å€¼æ–¹æ³•ã€‚\nå›åˆ°å‰é¢çš„é—®é¢˜ï¼Œç»™å®šçº¸ä¸Šå°ºå¯¸æ—¶ï¼ŒDPI è¶Šé«˜å›¾ç‰‡åƒç´ æ•°è¶Šå¤šï¼Œè¯´æ˜å›¾ç‰‡æœ¬èº«å¾ˆå¯èƒ½ä¼šæ›´æ¸…æ™°ï¼Œé‚£ä¹ˆåœ¨ä¸è¶…å‡ºæ‰“å°æœº DPI æ°´å¹³çš„å‰æä¸‹ï¼Œæ‰“å°å‡ºæ¥çš„çº¸è´¨å›¾ç‰‡ä¹Ÿå¾ˆå¯èƒ½æ›´æ¸…æ™°ã€‚\næœŸåˆŠçš„ 300 DPI è¦æ±‚ ç”±ä¸Šä¸€èŠ‚çš„è®¨è®ºï¼Œæˆ‘ä»¬ä¾¿èƒ½ç†è§£æœŸåˆŠä¸ºä»€ä¹ˆå¯¹é…å›¾çš„ DPI æœ‰è¦æ±‚äº†ï¼Œå› ä¸ºé«˜ DPI é¢„ç¤ºç€é…å›¾åœ¨æ‚å¿—ä¸Šçš„æ˜¾ç¤ºæ•ˆæœåº”è¯¥ä¼šå¾ˆå¥½ï¼ˆæ— è®ºæ˜¯çº¸è´¨ç‰ˆè¿˜æ˜¯ç”µå­ç‰ˆï¼‰ã€‚ä¸‹é¢ä»¥ AGUï¼ˆç¾å›½åœ°çƒç‰©ç†å­¦ä¼šï¼‰å¯¹ä½å›¾çš„è¦æ±‚ä¸ºä¾‹ï¼Œç”¨ Matplotlib æ¼”ç¤ºå¯¼å‡ºé«˜ DPI å›¾ç‰‡çš„æ–¹æ³•ã€‚\nè¦æ±‚ tif å’Œ jpg æ ¼å¼çš„å›¾ç‰‡åœ¨æœŸåˆŠçš„çº¸é¢å°ºå¯¸ä¸Šæœ‰ 300 - 600 çš„ DPIï¼Œtif å›¾é‡‡ç”¨ LZW å‹ç¼©ï¼Œjpg å›¾é€‰æ‹©æœ€é«˜çš„ qualityã€‚1/4 ç‰ˆé¢å¤§å°çš„å›¾ç‰‡å°ºå¯¸æ˜¯ 95 x 115 mmã€‚ç¨‹åºå¦‚ä¸‹\nimport matplotlib.pyplot as plt\rw = 95 / 10 / 2.54\rh = 115 / 10 / 2.54\rfig = plt.figure(figsize=(w, h))\rfig.savefig('output.tif', dpi=600, pil_kwargs={'compression': 'tiff_lzw'})\rfig.savefig('output.jpg', dpi=600, pil_kwargs={'quality': 95})\r plt.figure å‡½æ•°çš„ figsize å‚æ•°è¦æ±‚å•ä½ä¸ºè‹±å¯¸ï¼Œæ‰€ä»¥è¦å…ˆæŠŠç‰ˆé¢å°ºå¯¸çš„å•ä½ä»æ¯«ç±³æ¢ç®—åˆ°è‹±å¯¸ã€‚fig.savefig æ–¹æ³•é‡Œå¯ä»¥ç›´æ¥æŒ‡å®š DPIï¼Œå‹ç¼©æ–¹æ³•è¿™ç§ä¸å›¾ç‰‡æ ¼å¼ç›¸å…³çš„å‚æ•°éœ€è¦ä¼ ç»™ PIL æ¥å®ç°ã€‚æœ€åèƒ½å¾—åˆ°ä¸¤å¼ åˆ†è¾¨ç‡ä¸º 2244 x 2716ï¼Œ600 DPI çš„å›¾ç‰‡ã€‚éœ€è¦æ³¨æ„å¦‚æœ dpi å‚æ•°çš„å€¼å¤ªé«˜ï¼Œç”Ÿæˆçš„å›¾ç‰‡çš„åˆ†è¾¨ç‡å’Œä½“ç§¯å¤ªå¤§ã€‚\nåœ¨ Matplotlib ä¸­ï¼Œç»™å®š figsizeï¼Œdpi è¶Šå¤§ï¼Œç»˜åˆ¶åŒä¸€ä¸ªå…ƒç´ æ—¶ä¼šç”¨åˆ°æ›´å¤šåƒç´ ï¼Œæ‰€ä»¥æœ€åå¯¼å‡ºçš„å›¾ç‰‡ä¼šæ›´æ¸…æ™°ã€‚æ­¤å³å‰é¢æè¿‡çš„ä»æºå¤´ä¸Šç”Ÿæˆæ¸…æ™°çš„å›¾ç‰‡ã€‚è€Œåå¤„ç†å¢åŠ  DPI çš„æ–¹æ³•ä¹Ÿæœ‰ï¼šå¯¼å…¥ PS ä¸­æ’å€¼æ”¾å¤§ï¼›ç²˜è´´åˆ° PPT ä¿®æ”¹ slide çš„åˆ†è¾¨ç‡å’Œ DPIï¼Œå†å¯¼å‡ºæ•´å¼  slideï¼›ç”¨ AI æŠŠä½å›¾è½¬æ¢æˆçŸ¢é‡å›¾ç­‰ã€‚åå¤„ç†æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼Œå¦‚æœå¤„ç†å‰å›¾ç‰‡å°±å¾ˆç³Šï¼Œé‚£ä¹ˆå¤„ç†ååªèƒ½å¾—åˆ°é«˜ DPI çš„å‡é«˜æ¸…å›¾ã€‚\nå½“ç„¶ï¼Œæœ€æœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼Œä»ä¸€å¼€å§‹å°±ä¸è¦ç”»ä½å›¾ï¼Œå…¨éƒ¨ä»¥çŸ¢é‡å›¾çš„æ ¼å¼å¯¼å‡ºï¼ˆepsã€pdf ç­‰ï¼‰ï¼Œè¿™æ ·å°±å®Œå…¨æ²¡æœ‰æœ¬æ–‡ä¸­çš„é—®é¢˜äº†ï¼Œæ‰€ä»¥æœ¬æ–‡ç™½å†™äº†ï¼ˆæ‚²ï¼‰ã€‚\né¢å¤–è¯´æ˜ é¢å¤–è¯´æ˜ä¸€ç‚¹æœåˆ°çš„å®ç”¨å°çŸ¥è¯†ã€‚\nMatplotlib ä¸­çš„çº¿å®½å’Œå­—ä½“å­—å·æ˜¯ä»¥ç£…ï¼ˆpointï¼‰ä¸ºå•ä½çš„ï¼Œæœ‰\n$$1\\ \\rm{pt}=1/72\\ \\rm{inch}$$\nä¾‹å¦‚ï¼Œlinewidth=72 æ—¶ï¼Œçº¿å®½æ°å¥½ä¸º 1 è‹±å¯¸ã€‚æ³¨æ„è¿™æ˜¯ä¸ªç‰©ç†å•ä½ï¼Œå¯¹åº”äºçº¸ä¸Šé•¿åº¦ã€‚æ‰€ä»¥å¢å¤§ figsize æ—¶å›¾ä¸­å…ƒç´ ä¼šæ˜¾å¾—æ›´å°æ›´ç»†ï¼Œè€Œå¢å¤§ dpi æ—¶å›¾ä¸­å…ƒç´ å¤§å°ä¸å˜ï¼Œä½†å›¾ç‰‡åƒç´ æ›´å¤šã€æ˜¾ç¤ºæ•ˆæœæ›´æ¸…æ™°ã€‚\nå‚è€ƒèµ„æ–™ Dots per inch - Wikipedia\nRelationship between dpi and figure size\nHow to ensure your images meet the minimum requirement for printing - DPI explained\nGRAPHIC REQUIREMENTS - AGU\nDPI å’Œ PPI çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ç…§ç‰‡çš„åˆ†è¾¨ç‡300dpié‚£ä¹ˆå®ƒçš„æ°´å¹³åˆ†è¾¨ç‡å’Œå‚ç›´åˆ†è¾¨ç‡åˆ†åˆ«æ˜¯å¤šå°‘ï¼Ÿ\n","date":"2021-04-08","permalink":"https://zhajiman.github.io/post/matplotlib_dpi/","tags":["matplotlib"],"title":"Matplotlib ç³»åˆ—ï¼šå¯¼å‡ºé«˜ DPI çš„å›¾ç‰‡"},{"content":"å‰è¨€ ä¹‹å‰åœ¨ Linux ä¸Šç”¨ Python å¤„ç†ç³»ç»Ÿçš„æ–‡ä»¶å’Œç›®å½•æ—¶ï¼Œæˆ‘éƒ½æ˜¯ç®€å•ç²—æš´åœ°ç”¨ os.system å‡½æ•°ç›´æ¥æ‰§è¡Œ shell å‘½ä»¤æ¥å®ç°çš„ã€‚ä¾‹å¦‚æ–°å»ºä¸€ä¸ªç›®å½•å¹¶æŠŠæ–‡ä»¶ç§»åŠ¨è¿›å»ï¼Œæˆ‘ä¼šè¿™ä¹ˆå†™\ndirpath = './result'\rfilepath = './data.txt'\ros.system(f'mkdir {dirpath}')\ros.system(f'mv {filepath} {dirpath}')\r å³æŠŠ shell å‘½ä»¤ç¡¬ç¼–ç åˆ°ç¨‹åºä¸­ã€‚ä½†æœ€è¿‘åœ¨ Windows ä¸Šè¿è¡Œè€ç¨‹åºæ—¶ï¼Œå› ä¸º os.system é»˜è®¤è°ƒç”¨ CMDï¼Œæ‰€ä»¥è¿™ç§å†™æ³•çš„è€ä»£ç å…¨éƒ¨æœ¨å¤§ã€‚\nå…¶å®å€ŸåŠ© Python æ ‡å‡†åº“ä¸­ç”¨äºç³»ç»Ÿäº¤äº’å’Œè·¯å¾„å¤„ç†çš„æ¨¡å—ï¼Œå°±èƒ½å°½å¯èƒ½é™ä½ä»£ç å¯¹å¹³å°çš„ä¾èµ–ï¼Œå¹¶ä¸”æ¨¡å—ä¸­ä¹Ÿæä¾›æœ‰è®¸å¤šæ–¹ä¾¿çš„å‡½æ•°ã€‚æœ¬æ–‡ä¼šè®°å½•é‚£äº›æœ€å¸¸ç”¨çš„åŠŸèƒ½ã€‚\nåŸºç¡€çŸ¥è¯† é¦–å…ˆæ˜ç¡®ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œä»¥å…åé¢å‘ç”Ÿæ··æ·†ã€‚ç›®å½•ï¼ˆdirectoryï¼‰å³æˆ‘ä»¬å¸¸è¯´çš„æ–‡ä»¶å¤¹ï¼Œèƒ½å¤Ÿå­˜æ”¾æ–‡ä»¶å’Œå…¶å®ƒç›®å½•ã€‚è€Œè·¯å¾„ï¼ˆpathï¼‰æ˜¯ç”¨äºæ ‡è¯†æ–‡ä»¶å’Œç›®å½•åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å…·ä½“ä½ç½®çš„å­—ç¬¦ä¸²ï¼Œè·¯å¾„çš„æœ«å°¾æ˜¯æ–‡ä»¶æˆ–è€…ç›®å½•çš„åå­—ï¼Œè€Œå‰é¢åˆ™æ˜¯ä¸€çº§ä¸€çº§çš„çˆ¶ç›®å½•ï¼Œæ¯ä¸€é¡¹é€šè¿‡è·¯å¾„åˆ†éš”ç¬¦éš”å¼€ã€‚\nLinux å’Œ Mac çš„è·¯å¾„åˆ†éš”ç¬¦æ˜¯æ­£æ–œæ  /ï¼Œè€Œ Windows ç”¨çš„æ˜¯åæ–œæ  \\ã€‚åœ¨ Python çš„å­—ç¬¦ä¸²ä¸­ï¼Œå› ä¸ºåæ–œæ è¿˜æœ‰è½¬ä¹‰çš„ä½œç”¨ï¼Œæ‰€ä»¥è¦ä¹ˆç”¨ \\\\ è¡¨ç¤ºä¸€ä¸ªåæ–œæ  ï¼Œè¦ä¹ˆä½¿ç”¨ raw å­—ç¬¦ä¸²ï¼ˆä¸è¿‡ä»¥åæ–œæ ç»“å°¾æ—¶ä¼šå¼•èµ·è¯­æ³•è§£æçš„é”™è¯¯ï¼‰ã€‚ä¾‹å¦‚\n# Linuxä¸‹çš„è·¯å¾„\rdirpath = './a/b/c'\r# Windowsä¸‹çš„è·¯å¾„\rdirpath1 = './/a//b//c'\rdirpath2 = r'./a/b/c'\r æ³¨æ„è™½ç„¶ç¨‹åºä¸­å­—é¢å€¼æ˜¯ \\\\ï¼Œä½†æ‰“å°æˆ–è¾“å‡ºæ—¶æ˜¯æ­£å¸¸çš„ \\ã€‚å…¶å®ç°åœ¨çš„ Windows å†…æ ¸å…¼å®¹æ­£æ–œæ çš„å†™æ³•ï¼Œåœ¨ Python ç¨‹åºä¸­æˆ‘ä»¬å®Œå…¨å¯ä»¥åªä½¿ç”¨æ­£æ–œæ ï¼ˆç”šè‡³æ··ç”¨éƒ½æ²¡é—®é¢˜ï¼‰ã€‚\nä¸‹é¢å†æ¥è°ˆä¸€è°ˆç›®å½•çš„è·¯å¾„ç»“å°¾æ˜¯å¦è¯¥åŠ ä¸Šæ–œæ çš„é—®é¢˜ã€‚æœ‰äº›äººä¹ æƒ¯åœ¨ç›®å½•çš„è·¯å¾„ç»“å°¾å†æ·»ä¸Šä¸€ä¸ªæ–œæ ï¼Œä»¥æ˜¾ç¤ºè¿™ä¸ªè·¯å¾„è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªç›®å½•è€Œä¸æ˜¯æ–‡ä»¶ï¼Œå¹¶ä¸”ä¹‹ååœ¨è¿›è¡Œå­—ç¬¦ä¸²è¿æ¥æ—¶ä¹Ÿä¸å¿…æ‰‹åŠ¨æ’å…¥æ–œæ ã€‚åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒåŠ æˆ–ä¸åŠ å¹¶ä¸ä¼šå½±å“åˆ°å‘½ä»¤è¡Œçš„è¡Œä¸ºã€‚\nè€ƒè™‘åˆ° Python ä¸­è®¸å¤šå‡½æ•°åœ¨å¤„ç†è·¯å¾„æ—¶ä¼šè‡ªåŠ¨å»æ‰ç»“å°¾çš„æ–œæ ï¼Œä»¥å…å½±å“è·¯å¾„çš„åˆ†å‰²ï¼ˆos.path.basenameã€os.path.dirname ç­‰å‡½æ•°ï¼‰ï¼Œæœ¬æ–‡ä¸­ä¸ä¼šåœ¨ç»“å°¾åŠ ä¸Šæ–œæ ã€‚\nos è¿™ä¸ªæ¨¡å—æä¾›ä¸€äº›ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’çš„å‡½æ•°ï¼Œä¾‹å¦‚åˆ›å»ºå’Œåˆ é™¤ç›®å½•ç­‰ã€‚\nos.sepï¼šå±æ€§ï¼Œå€¼æ˜¯ç³»ç»Ÿæ‰€ç”¨çš„è·¯å¾„åˆ†éš”ç¬¦çš„å­—ç¬¦ä¸²ã€‚\nos.getcwdï¼šè·å–å·¥ä½œç›®å½•çš„è·¯å¾„ã€‚\nos.chdirï¼šåˆ‡æ¢å·¥ä½œç›®å½•ï¼ŒåŠŸèƒ½åŒ shell ä¸­çš„ cd å‘½ä»¤ã€‚\nos.listdirï¼šè¿”å›æŒ‡å®šçš„ç›®å½•ï¼ˆé»˜è®¤æ˜¯å·¥ä½œç›®å½•ï¼‰ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•çš„åå­—ç»„æˆçš„åˆ—è¡¨ã€‚æ³¨æ„åˆ—è¡¨å…ƒç´ çš„é¡ºåºæ˜¯ä»»æ„çš„ï¼ˆå°½ç®¡æˆ‘ä»¬çš„è¿è¡Œç»“æœå¯èƒ½æ˜¯æœ‰åºçš„ï¼‰ã€‚\nos.walkï¼šè‡ªä¸Šè€Œä¸‹éå†ä¸€æ£µç›®å½•æ ‘ï¼Œæ¯åˆ°ä¸€ä¸ªç›®å½•æ—¶ yield ä¸€ä¸ª (dirpath, dirnames, filenames) çš„ä¸‰å…ƒç»„ã€‚å…¶ä¸­ dirpath æ˜¯è¯¥ç›®å½•çš„è·¯å¾„ï¼Œdirnames æ˜¯è¯¥ç›®å½•ä¸‹å­ç›®å½•åå­—ç»„æˆçš„åˆ—è¡¨ï¼Œfilenames æ˜¯è¯¥ç›®å½•ä¸‹æ–‡ä»¶åç»„æˆçš„åˆ—è¡¨ã€‚ä¸‹é¢ä¸¾ä¸ªæ‰¾å‡ºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„ä¾‹å­\ndef get_all_filepath(dirpath):\rfor dirpath, dirnames, filenames in os.walk(dirpath):\rfor filename in filenames:\ryield os.path.join(dirpath, filename)\r os.mkdirï¼šåˆ›å»ºä¸€ä¸ªç›®å½•ã€‚\nos.makedirsï¼šé€’å½’åœ°åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå³å°±ç®—æˆ‘ä»¬ç»™å‡ºçš„è·¯å¾„ä¸­å«æœ‰å°šä¸å­˜åœ¨çš„ç›®å½•ï¼Œç³»ç»Ÿä¹Ÿèƒ½é¡ºä¾¿ç»™åˆ›å»ºäº†ã€‚\nos.rmdirï¼šåˆ é™¤ä¸€ä¸ªç©ºç›®å½•ï¼Œå¦‚æœç›®å½•éç©ºåˆ™ä¼šæŠ¥é”™ã€‚\nos.removedirsï¼šé€’å½’åœ°åˆ é™¤ç©ºç›®å½•ã€‚å³æ ¹æ®è·¯å¾„ä»å³å¾€å·¦é€ä¸ªåˆ ï¼Œç¢°åˆ°éç©ºçš„ç›®å½•æ—¶å°±ä¼šåœä¸‹ï¼ˆä¸ç„¶é‚£ä¸å¾—æŠŠä½ æ ¹ç›®å½•ç»™ç«¯äº†ï¼‰ã€‚\nos.removeï¼šåˆ é™¤ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚æœè·¯å¾„æŒ‡å‘ç›®å½•çš„è¯ä¼šæŠ¥é”™ã€‚\nos.renameï¼šç»™æ–‡ä»¶æˆ–ç›®å½•é‡å‘½åã€‚å¦‚æœé‡å‘½ååˆ°å¦ä¸€ä¸ªç›®å½•ä¸‹é¢ï¼Œå°±ç›¸å½“äºå‰ªåˆ‡ã€‚å½“ç›®æ ‡è·¯å¾„å·²ç»å­˜åœ¨æ—¶ï¼Œä¼šæœ‰æ¯”è¾ƒå¤æ‚çš„è¡Œä¸ºï¼Œå»ºè®®ä¸è¦è¿™ä¹ˆåšã€‚\nos.replaceï¼šç›¸å½“äº os.renameï¼Œä½†å½“ç›®æ ‡è·¯å¾„æŒ‡å‘å·²ç»å­˜åœ¨çš„ç›®å½•æ—¶ä¼šæŠ¥é”™ï¼ŒæŒ‡å‘æ–‡ä»¶æ—¶åˆ™ä¼šç›´æ¥æ›¿æ¢ã€‚\nos æ¨¡å—ä¸­å…³äºæ–‡ä»¶å’Œç›®å½•çš„å¸¸ç”¨å‡½æ•°å·®ä¸å¤šå°±è¿™äº›ã€‚ä½ å¯èƒ½ä¼šé—®ï¼Œæ€ä¹ˆåˆ é™¤ç›®å½•çš„å‡½æ•°éƒ½åªèƒ½ä½œç”¨äºç©ºç›®å½•ï¼Œé‚£éç©ºçš„ç›®å½•æ€ä¹ˆåŠï¼Ÿè¿™å°±éœ€è¦ç”¨åˆ°æ›´é«˜çº§çš„æ–‡ä»¶æ“ä½œåº“â€”â€”shutilã€‚\nshutil è¿™ä¸ªæ¨¡å—æä¾›æ­£ç»çš„æ–‡ä»¶/ç›®å½•çš„å¤åˆ¶ã€å‰ªåˆ‡ã€åˆ é™¤æ“ä½œã€‚\nshutil.copyfileï¼šå¤åˆ¶æ–‡ä»¶ï¼Œè¦æ±‚ä¸¤ä¸ªå‚æ•°éƒ½ä¸ºæ–‡ä»¶è·¯å¾„ã€‚\nshutil.copyï¼šåŒæ ·æ˜¯å¤åˆ¶æ–‡ä»¶ï¼Œä½†ç›®æ ‡è·¯å¾„å¯ä»¥ä¸ºç›®å½•ï¼Œè¿™æ ·ç›¸å½“äºä¿æŒæ–‡ä»¶åä¸å˜å¤åˆ¶è¿‡å»ã€‚\nshutil.copytreeï¼šé¡¾åæ€ä¹‰ï¼Œç›´æ¥å¤åˆ¶ä¸€æ•´æ£µç›®å½•æ ‘ï¼Œå³å¤åˆ¶éç©ºçš„ç›®å½•ã€‚\nshutil.rmtreeï¼šåˆ é™¤ä¸€æ•´æ£µç›®å½•æ ‘ã€‚\nshutil.moveï¼šå°†æ–‡ä»¶æˆ–éç©ºç›®å½•ç§»åŠ¨åˆ°ç›®æ ‡ç›®å½•ä¸‹é¢ã€‚\nglob è¿™ä¸ªæ¨¡å—çš„åŠŸèƒ½éå¸¸å•çº¯ï¼šæä¾› Unix shell é£æ ¼çš„è·¯å¾„æœç´¢ã€‚å³å¯ä»¥ç”¨é€šé…ç¬¦å®ç°çµæ´»çš„åŒ¹é…ï¼Œåˆèƒ½ç›´æ¥æ‹¿åˆ°æ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„ï¼Œæ–¹ä¾¿æ“ä½œã€‚\nglob.globï¼šç»™å‡ºå«é€šé…ç¬¦çš„è·¯å¾„ï¼Œå°†ä¸ä¹‹åŒ¹é…çš„è·¯å¾„æ±‡é›†æˆåˆ—è¡¨è¿”å›ã€‚å› ä¸ºè¿™ä¸ªå‡½æ•°å†…éƒ¨æ˜¯ç”± os.listdir å®ç°çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½ä¿è¯ç»“æœçš„é¡ºåºã€‚Python 3.5 ä»¥åæä¾› recursive é€‰é¡¹ï¼ŒæŒ‡å®šæ˜¯å¦è¿›è¡Œé€’å½’æœç´¢ï¼Œç”¨ ** åŒ¹é…ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹ã€‚\nä¸€äº›ä¾‹å­å¦‚ä¸‹\n# å¾—åˆ°è·¯å¾„dirpathä¸‹çš„æ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„\rglob.glob(os.path.join(dirpath, '*'))\r# å¾—åˆ°è·¯å¾„dirpathä¸‹æ‰€æœ‰pyæ–‡ä»¶çš„è·¯å¾„\rglob.glob(os.path.join(dirpath, '**', '*.py'), recursive=True)\r å¦‚æœç»™å‡ºçš„è·¯å¾„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆç»“æœä¹Ÿä¼šæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œç»å¯¹è·¯å¾„åŒç†ã€‚\nå¦‚æœå¸Œæœ›æœç´¢çš„ç»“æœæœ‰åºæ’åˆ—ï¼Œå¯ä»¥ç”¨åˆ—è¡¨çš„ sort æ–¹æ³•æˆ– sorted å‡½æ•°è¿›è¡Œæ’åºã€‚ä¸‹é¢ä¸¾ä¸ªæœç´¢è·¯å¾„ä¸‹æ‰€æœ‰å›¾ç‰‡ï¼Œå¹¶æŒ‰æ–‡ä»¶åæ’åºçš„ä¾‹å­\ndirpath = './pics'\rfilepaths = glob.glob(os.path.join(dirpath, '*.png'))\rfilepaths.sort(key=lambda x: os.path.basename(x))\r å¦‚æœéœ€è¦èŠ‚çœå†…å­˜ï¼Œglob æ¨¡å—è¿˜æä¾›è¿”å›ç”Ÿæˆå™¨çš„ glob.iglob å‡½æ•°ã€‚\nos.path è¿™ä¸ªæ¨¡å—æä¾›è®¸å¤šå¤„ç†è·¯å¾„çš„å‡½æ•°ï¼Œå…¶å®åœ¨å‰é¢çš„ä¾‹å­ä¸­å·²ç»å‡ºç°è¿‡å¥½å‡ æ¬¡äº†ã€‚\nos.path.normpathï¼šå°†è·¯å¾„è§„èŒƒåŒ–ã€‚èƒ½å°†å¤šä½™çš„åˆ†éš”ç¬¦å»æ‰ï¼Œä¾‹å¦‚ A//B ã€A/B/ å’Œ A/./B éƒ½ä¼šå˜æˆ A/Bã€‚å¯ä»¥çœ‹å‡ºï¼Œç»“å°¾æœ‰æ–œæ å¯¹äº Python æ¥è¯´æ˜¯ä¸â€œè§„èŒƒâ€çš„ã€‚Windows ç³»ç»Ÿä¸‹è¿˜ä¼šå°†è·¯å¾„ä¸­çš„æ­£æ–œæ éƒ½æ›¿æ¢æˆåæ–œæ ã€‚\nos.path.abspathï¼šå°†è·¯å¾„è½¬æ¢ä¸ºè§„èŒƒçš„ç»å¯¹è·¯å¾„ã€‚\nos.path.relpathï¼šå°†è·¯å¾„è½¬æ¢ä¸ºè§„èŒƒçš„ç›¸å¯¹è·¯å¾„ã€‚\nos.path.basenameï¼šè¿”å›è·¯å¾„çš„åŸºåï¼ˆå³æ–‡ä»¶æˆ–ç›®å½•çš„åå­—ï¼‰ã€‚éœ€è¦æ³¨æ„ï¼Œå¦‚æœè·¯å¾„ç»“å°¾æœ‰æ–œæ ï¼Œé‚£ä¹ˆä¼šè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚\nos.path.dirnameï¼šè¿”å›è·¯å¾„çš„çˆ¶ç›®å½•ã€‚éœ€è¦æ³¨æ„ï¼Œå¦‚æœè·¯å¾„ç»“å°¾æœ‰æ–œæ ï¼Œé‚£ä¹ˆè¿”å›çš„å°±åªæ˜¯å»æ‰æœ«å°¾æ–œæ çš„è·¯å¾„ã€‚\nos.path.splitextï¼šè¾“å…¥ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œè¿”å›ä¸€ä¸ªäºŒå…ƒç»„ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯è¿™ä¸ªæ–‡ä»¶çš„æ‰©å±•åï¼ˆå« .ï¼‰ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯æ‰©å±•åå‰é¢çš„è·¯å¾„ã€‚å¦‚æœè·¯å¾„ä¸æŒ‡å‘æ–‡ä»¶ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå…ƒç´ ä¼šæ˜¯ç©ºå­—ç¬¦ä¸²ã€‚\nos.path.existsï¼šåˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨ã€‚\nos.path.isfileï¼šåˆ¤æ–­è·¯å¾„æ˜¯å¦æŒ‡å‘æ–‡ä»¶ã€‚\nos.path.isdirï¼šåˆ¤æ–­è·¯å¾„æ˜¯å¦æŒ‡å‘ç›®å½•ã€‚è·¯å¾„ç»“å°¾çš„æ–œæ ä¸ä¼šå½±å“ç»“æœã€‚\nos.path.joinï¼šæœ€å¸¸ç”¨çš„å‡½æ•°ä¹‹ä¸€ï¼Œèƒ½å°†å¤šä¸ªè·¯å¾„è¿æ¥åœ¨ä¸€èµ·ï¼Œè‡ªåŠ¨åœ¨æ¯ä¸ªè·¯å¾„ä¹‹é—´ä¾æ® os.sep çš„å€¼æ·»åŠ åˆ†éš”ç¬¦ã€‚\n# Linuxä¸‹\rIn : os.path.join('a', 'b', 'c')\rOut: 'a/b/c'\r# Windowsä¸‹\rIn : os.path.join('a', 'b', 'c')\rOut: 'a\\\\b\\\\c'\r è¿™ä¸ªå‡½æ•°çš„è¡Œä¸ºæœ‰ç‚¹å¤æ‚ï¼Œä¸‹é¢å†ä¸¾å‡ ä¸ªä¾‹å­\n# Windowsä¸‹\r# è·¯å¾„ä¸­çš„æ­£æ–œæ æ›¿æ¢æ‰äº†os.sep\rIn : os.path.join('a', 'b/', 'c')\rOut: 'a\\\\b/c'\r# ç»“å°¾çš„æ–œæ ä¼šè¢«ä¿ç•™\rIn : os.path.join('a', 'b', 'c/')\rOut: 'a\\\\b\\\\c/'\r# æœ€åä¸€ä¸ªè·¯å¾„ä¸ºç©ºå­—ç¬¦ä¸²æ—¶,ç›¸å½“äºåœ¨ç»“å°¾æ·»åŠ æ–œæ \rIn : os.path.join('a', 'b', '')\rOut: 'a\\\\b\\\\'\r Linux ä¸‹çš„è¡Œä¸ºæ˜¯ä¸€æ ·çš„ã€‚å¦å¤–è¿˜æœ‰ä»€ä¹ˆè·¯å¾„å¦‚æœåœ¨æ ¹ç›®å½•æˆ–ç›˜ç¬¦ä¸‹ï¼Œé‚£ä¹ˆè¿æ¥æ—¶å‰é¢çš„è·¯å¾„ä¼šè¢«å¿½ç•¥ä¹‹ç±»çš„è¡Œä¸ºï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†ã€‚\nos.expanduserï¼šå°†ä¸€ä¸ªè·¯å¾„ä¸­çš„ ~ ç¬¦å·æ›¿æ¢æˆ user ç›®å½•çš„è·¯å¾„ã€‚\nos.path æ¨¡å—æ˜¯å¤„ç†è·¯å¾„çš„ç»å…¸æ¨¡å—ï¼Œä½†æˆ‘åœ¨ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜æ˜¯ï¼Œåœ¨ Windows ä¸‹å¦‚æœæƒ³ä½¿ç”¨æ­£æ–œæ ï¼Œå› ä¸ºè¿™ä¸ªæ¨¡å—é»˜è®¤ç”¨åæ–œæ æ¥è¿›è¡Œè¿æ¥å’Œæ›¿æ¢æ“ä½œï¼Œä¼šå¯¼è‡´äº§ç”Ÿçš„å­—ç¬¦ä¸²ä¸­ä¸¤ç§æ–œæ ç›¸æ··æ‚ã€‚è™½ç„¶è¿™ç§è·¯å¾„å®Œå…¨åˆæ³•ï¼Œä½†ä½œä¸ºç»“æœè¾“å‡ºæ—¶å°±å¾ˆéš¾çœ‹ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨ os.path.normpath å‡½æ•°æ¥è§„èŒƒåŒ–ï¼Œæˆ–è€…è¯•è¯•ä¸‹ä¸€èŠ‚å°†ä¼šä»‹ç»çš„æ¨¡å—ã€‚\npathlib äº Python 3.4 å¼•å…¥çš„æ–°æ¨¡å—ï¼Œæä¾›äº†é¢å‘å¯¹è±¡é£æ ¼çš„è·¯å¾„æ“ä½œï¼Œèƒ½å¤Ÿå®Œå…¨æ›¿ä»£ os.path å’Œ glob æ¨¡å—ï¼Œå¹¶æ¶µç›–ä¸€éƒ¨åˆ† os æ¨¡å—çš„åŠŸèƒ½ã€‚è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹å…¶ç”¨æ³•ã€‚\npathlib ä¸­çš„ç±»ç”±ä¸Šé¢çš„å›¾ç‰‡è¡¨ç¤ºã€‚æœ€é¡¶å±‚çš„æ˜¯ PurePathï¼Œæä¾›ä¸æ¶‰åŠ I/O çš„è·¯å¾„è®¡ç®—ï¼›Path ç±»åˆç§° concrete pathï¼Œç»§æ‰¿ PurePath çš„åŒæ—¶æä¾› I/O çš„åŠŸèƒ½ï¼›å‰©ä¸‹çš„å‡ ä¸ªç±»ä»åå­—å¯ä»¥çœ‹å‡ºæ˜¯ä¸å¹³å°ç›¸å…³çš„ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸éœ€è¦å…³å¿ƒï¼Œè®©ç¨‹åºè‡ªåŠ¨å†³å®šå³å¯ã€‚\nå‰é¢æåˆ°çš„è·¯å¾„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä½† pathlib ä¼šæŠŠè·¯å¾„ä½œä¸ºä¸€ä¸ªå¯¹è±¡\nfrom pathlib import Path\rp = Path('a/b/c')\r# Linuxä¸‹\rIn : p\rOut: PosixPath('a/b/c')\r# è·å–å­—ç¬¦ä¸²\rIn : str(p)\rOut: 'a/b/c'\r# Windowsä¸‹\rIn : p\rOut: WindowsPath('a/b/c')\r# è·å–å­—ç¬¦ä¸²\rIn : str(p)\rOut: 'a\\\\b\\\\c'\r Path å¯¹è±¡å†…éƒ¨ä»¥æ­£æ–œæ çš„å½¢å¼è¡¨ç¤ºè·¯å¾„ï¼Œåœ¨è½¬æ¢æˆå­—ç¬¦ä¸²æ—¶ä¼šè‡ªåŠ¨æ ¹æ®ç³»ç»Ÿé€‰å–åˆ†éš”ç¬¦ï¼Œå¦å¤–è¿˜ä¼šè‡ªåŠ¨å»æ‰è·¯å¾„ç»“å°¾çš„æ–œæ ã€‚è¿™ä¸‹æˆ‘ä»¬å°±ä¸ç”¨æ“å¿ƒæ–œæ æ··ç”¨çš„é—®é¢˜ã€‚ä¸‹é¢ä¾¿æ¥ä»‹ç» Path å¯¹è±¡çš„æ–¹æ³•å’Œå±æ€§ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¾ˆå¤šæ–¹æ³•è¿”å›çš„ä¾ç„¶æ˜¯ Path å¯¹è±¡ã€‚\nPath.existsï¼šåˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨ã€‚\nPath.is_fileï¼šåˆ¤æ–­è·¯å¾„æ˜¯å¦æŒ‡å‘æ–‡ä»¶ã€‚\nPath.is_dirï¼šåˆ¤æ–­è·¯å¾„æ˜¯å¦æŒ‡å‘ç›®å½•ã€‚\nPath.cwdï¼šåŒ os.getcwdã€‚\nPath.iterdirï¼šåŒ os.listdirï¼Œä¸è¿‡è¿”å›çš„æ˜¯ç”Ÿæˆå™¨ã€‚\nPath.mkdirï¼šåˆ›å»ºè¯¥è·¯å¾„è¡¨ç¤ºçš„ç›®å½•ã€‚parent å‚æ•°æŒ‡å®šæ˜¯å¦é¡ºå¸¦ç€å°†ä¸å­˜åœ¨çš„çˆ¶ç›®å½•ä¹Ÿä¹Ÿä¸€å¹¶åˆ›å»ºäº†ï¼Œç­‰åŒäº os.makedirs çš„åŠŸèƒ½ã€‚\nPath.rmdirï¼šåˆ é™¤è¯¥è·¯å¾„è¡¨ç¤ºçš„ç©ºç›®å½•ã€‚\nPath.touchï¼šåˆ›å»ºè¯¥è·¯å¾„è¡¨ç¤ºçš„æ–‡ä»¶ã€‚\nPath.openï¼šç›¸å½“äºå¯¹è·¯å¾„æŒ‡å‘çš„æ–‡ä»¶è°ƒç”¨ open å‡½æ•°ã€‚\nPath.unlinkï¼šåˆ é™¤ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç¬¦å·é“¾æ¥ã€‚\nPath.renameï¼šåŒ os.renameã€‚\nPath.replaceï¼šåŒ os.replaceã€‚\nPath.resolveï¼šå¾—åˆ°ç»å¯¹è·¯å¾„ï¼Œæˆ–è§£æç¬¦å·é“¾æ¥ã€‚\nPurePath.nameï¼šå±æ€§ï¼ŒåŒ os.path.basenameã€‚\nPurePath.parentï¼šå±æ€§ï¼ŒåŒ os.path.dirnameã€‚å¯ä»¥å†™å‡º p.parent.parent è¿™æ ·çš„è¡¨è¾¾ã€‚\nPurePath.parentsï¼šå±æ€§ï¼Œç”±ä¸åŒå±‚çº§çš„çˆ¶ç›®å½•çš„è·¯å¾„ç»„æˆçš„åºåˆ—ã€‚ä¾‹å¦‚ p.parents[0] ç­‰äº p.parentï¼Œp.parents[1] ç­‰äº p.parent.parentã€‚\nPurePath.suffixï¼šå±æ€§ï¼Œè¿”å›æ–‡ä»¶çš„æ‰©å±•åï¼ˆå« .ï¼‰ï¼Œå¦‚æœæ˜¯ç›®å½•åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚\nPurePath.stemï¼šå±æ€§ï¼Œè¿”å›æ–‡ä»¶åä¸å«æ‰©å±•åçš„é‚£ä¸€éƒ¨åˆ†ï¼Œå¦‚æœæ˜¯ç›®å½•å°±ç›´æ¥è¿”å›ç›®å½•åã€‚\nPurePath.joinpathï¼šåŒ os.path.joinã€‚ä¸è¿‡ç°åœ¨é€šè¿‡é‡è½½è¿ç®—ç¬¦ /ï¼Œæœ‰äº†æ›´æ–¹ä¾¿çš„è¡¨è¾¾\nIn : Path('a') / 'b' / 'c'\rOut: WindowsPath('a/b/c')\r Path.expanduserï¼šåŒ os.path.expanduserã€‚\nPath.globï¼šåŒ glob.iglobï¼Œå³è¿”å›çš„æ˜¯ç”Ÿæˆå™¨ã€‚ä¸è¿‡ç°åœ¨ä¸éœ€è¦æŒ‡å®š recursive å‚æ•°ï¼Œå½“æ¨¡å¼ä¸­å«æœ‰ ** æ—¶å°±ä¼šè¿›è¡Œé€’å½’æœç´¢ã€‚\nPath.rglobï¼šç›¸å½“äºåœ¨ Path.glob çš„æ¨¡å¼é‡Œæå‰åŠ ä¸Šäº† **/ã€‚å³ Path.glob('**/*') ç­‰åŒäº Path.rglob('*')ã€‚\nå¯ä»¥çœ‹åˆ° pathlib æä¾›äº†ä¸°å¯Œçš„è·¯å¾„æ“ä½œï¼Œå†ç»“åˆ shutil å°±è¶³ä»¥åº”å¯¹æ—¥å¸¸ä½¿ç”¨ã€‚å¦å¤–åœ¨ Python 3.6 ä¹‹åï¼Œos ä¸ os.path ä¸­è®¸å¤šå‡½æ•°èƒ½å¤Ÿç›´æ¥æ¥å— Path å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œäºæ˜¯è¿™äº›æ¨¡å—å®Œå…¨å¯ä»¥äº’é€šã€‚pathlib çš„ç¼ºç‚¹ä¹Ÿä¸æ˜¯æ²¡æœ‰\n  Python 3.6 ä»¥åæ‰ç®—å¾—ä¸Šå®Œå–„ï¼Œå¹¶ä¸” API ä»¥åå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚\n  è¯»å–æ–‡ä»¶æ—¶å¤šä¸€é“å°† Path å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²çš„æ­¥éª¤ã€‚\n  å°ç»“ ä»¥ä¸Šè®°å½•äº†æœ€å¸¸ç”¨çš„åŠŸèƒ½ã€‚å›åˆ°æœ¬æ–‡å¼€å¤´çš„é—®é¢˜ï¼Œæˆ‘è§‰å¾— Windows å¹³å°ä¸‹å¯ä»¥é€‰æ‹©ä¸‹é¢çš„æ–¹æ¡ˆ\n  os + os.pathï¼Œè·¯å¾„åˆ†éš”ç¬¦å…¨éƒ¨é‡‡ç”¨åæ–œæ ã€‚\n  pathlibï¼Œè·¯å¾„åˆ†éš”ç¬¦å…¨éƒ¨é‡‡ç”¨æ­£æ–œæ ã€‚\n  åˆ°åº•é€‰å“ªç§ï¼Œä»¥åæ…¢æ…¢å®è·µå°±çŸ¥é“äº†ã€‚\nå‚è€ƒèµ„æ–™ What is the difference between path and directory?\nWindows çš„è·¯å¾„ä¸­è¡¨ç¤ºæ–‡ä»¶å±‚çº§ä¸ºä»€ä¹ˆä¼šç”¨åæ–œæ ï¼Œè€Œ UNIX ç³»ç»Ÿéƒ½ç”¨æ–œæ ï¼Ÿ\nShould a directory path variable end with a trailing slash?\nPython os æ¨¡å—è¯¦è§£\nHow is Pythons glob.glob ordered?\nä½ åº”è¯¥ä½¿ç”¨pathlibæ›¿ä»£os.path\n","date":"2021-03-26","permalink":"https://zhajiman.github.io/post/python_path/","tags":["python"],"title":"Python ç³»åˆ—ï¼šæ“ä½œæ–‡ä»¶å’Œç›®å½•çš„è·¯å¾„"},{"content":"å‰è¨€ Cartopy ä¸­çš„ Plate CarrÃ©e æŠ•å½±ä½¿ç”¨æ–¹ä¾¿ï¼Œä½†åœ¨å±•ç¤ºä¸­å›½åœ°å›¾æ—¶ä¼šä½¿ä¸­å›½çš„å½¢çŠ¶æ˜¾å¾—å¾ˆç˜ªï¼Œä¸ä¹‹ç›¸æ¯”ï¼ŒLambert æŠ•å½±çš„æ•ˆæœä¼šæ›´åŠ ç¾è§‚ï¼Œä¸‹å›¾æ˜¾ç¤ºäº†ä¸¤ç§æŠ•å½±çš„å·®å¼‚\næ‰€ä»¥æœ¬æ–‡å°†ä¼šä»‹ç»å¦‚ä½•åœ¨ Cartopy ä¸­å®ç° Lambert æŠ•å½±ï¼Œå¹¶ä¸ºåœ°å›¾æ·»ä¸Šåˆé€‚çš„åˆ»åº¦ã€‚æ–‡ä¸­ Cartopy çš„ç‰ˆæœ¬æ˜¯ 0.18.0ã€‚\nLambert æŠ•å½±çš„ç®€å•ä»‹ç» è¿™é‡Œçš„ Lambert æŠ•å½±æŒ‡çš„æ˜¯ Lambert conformal conic æŠ•å½±ï¼ˆå…°å‹ƒç‰¹ç­‰è§’åœ†é”¥æŠ•å½±ï¼‰ï¼Œæ˜¯é€šè¿‡è®©åœ†é”¥é¢ä¸åœ°çƒç›¸åˆ‡ï¼ˆå‰²ï¼‰ï¼Œç„¶åå°†åœ°çƒè¡¨é¢æŠ•å½±åˆ°åœ†é”¥é¢ä¸Šæ¥å®ç°çš„ã€‚ä½œä¸ºä¸€ç§ç­‰è§’åœ°å›¾æŠ•å½±ï¼ŒLambert æŠ•å½±èƒ½å¤Ÿè¾ƒå¥½åœ°ä¿ç•™åŒºåŸŸçš„è§’åº¦å’Œå½¢çŠ¶ï¼Œé€‚åˆç”¨äºå¯¹ä¸­çº¬åº¦ä¸œè¥¿æ–¹å‘åˆ†å¸ƒçš„å¤§é™†æ¿å—è¿›è¡Œåˆ¶å›¾ã€‚è¯¦ç»†çš„æè¿°è¯·è§ç»´åŸºå’Œ ArcMap ä¸Šçš„ä»‹ç»ã€‚\nåœ¨ Cartopy ä¸­ï¼Œè¿™ä¸€æŠ•å½±é€šè¿‡ LambertConformal ç±»æ¥å®ç°\nimport cartopy.crs as ccrs\rmap_proj = ccrs.LambertConformal(\rcentral_longitude=105, standard_parallels=(25, 47)\r)\r è¿™ä¸ªç±»çš„å‚æ•°æœ‰å¾ˆå¤šï¼Œè¿™é‡Œä¸ºäº†ç”»å‡ºä¸­å›½åœ°å›¾ï¼Œåªéœ€è¦æŒ‡å®šä¸­å¤®ç»çº¿ central_longitude=105ï¼Œä¸¤æ¡æ ‡å‡†çº¬çº¿ standard_parallels=(25, 47)ï¼Œå‚æ•°æ¥æºæ˜¯ ä¸­å›½åŒºåŸŸLambert\u0026amp;AlbersæŠ•å½±å‚æ•° è¿™ç¯‡åšæ–‡ã€‚å…¶å®ç¬”è€…å¯¹è¿™äº›å‚æ•°ä¹Ÿæ²¡ä»€ä¹ˆæ¦‚å¿µï¼Œå¦‚æœæœ‰é”™è¯¯è¿˜è¯·è¯»è€…æŒ‡å‡ºã€‚\næŒ‰ç…§è¿™ä¸ªè®¾ç½®ä¾¿å¯ä»¥ç”»å‡ºå…¨çƒçš„åœ°å›¾äº†ï¼Œå¹¶ä¸”ä¸­å›½ä½äºåœ°å›¾ä¸­å¿ƒ\nç”¨ set_extent æ–¹æ³•æˆªå–åŒºåŸŸ æˆ‘ä»¬ä¸€èˆ¬éœ€è¦é€šè¿‡ GeoAxes çš„ set_extent æ–¹æ³•æˆªå–æˆ‘ä»¬å…³å¿ƒçš„åŒºåŸŸï¼Œä¸‹é¢æˆªå– 80Â°E-130Â°Eï¼Œ15Â°N-55Â°N çš„èŒƒå›´\nextent = [80, 130, 15, 55]\rax.set_extent(extent, crs=ccrs.PlateCarree())\r ç»“æœå¦‚ä¸‹å›¾ï¼ŒåŸæœ¬æ‰‡å½¢çš„å…¨çƒåœ°å›¾ä¼šè¢«æˆªå–æˆçŸ©å½¢\né“ç†ä¸Šæ¥è¯´ç»™å‡ºç»çº¬åº¦çš„è¾¹ç•Œï¼Œæˆªå–å‡ºæ¥çš„åº”è¯¥æ˜¯ä¸€ä¸ªæ›´å°çš„æ‰‡å½¢ï¼Œä½†æŒ‰ issue #697 çš„è¯´æ³•ï¼Œset_extent ä¼šé€‰å‡ºä¸€ä¸ªåˆšå¥½åŒ…ä½è¿™ä¸ªå°æ‰‡å½¢çš„çŸ©å½¢ä½œä¸ºè¾¹ç•Œã€‚è¿™é‡Œæ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªè¯´æ³•\nimport matplotlib as mpl\rrect = mpl.path.Path([\r[extent[0], extent[2]],\r[extent[0], extent[3]],\r[extent[1], extent[3]],\r[extent[1], extent[2]],\r[extent[0], extent[2]]\r]).interpolated(20)\rline = rect.vertices\rax.plot(line[:, 0], line[:, 1], lw=1, c='r', transform=ccrs.Geodetic())\r è¿™æ®µä»£ç æ˜¯å°† extent æ‰€æè¿°çš„å°æ‰‡å½¢ç”»åœ¨åœ°å›¾ä¸Šï¼Œç»“æœåœ¨ä¸Šä¸€å¼ å›¾é‡Œæœ‰ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªå°æ‰‡å½¢ç¡®å®åˆšå¥½è¢«çŸ©å½¢è¾¹ç•Œç»™åŒ…ä½ã€‚\nå¦‚æœç¡®å®éœ€è¦æˆªå–å‡ºæ‰‡å½¢çš„åŒºåŸŸï¼Œå¯ä»¥ç”¨ set_boundary æ–¹æ³•ï¼Œæ•ˆæœå¦‚ä¸‹å›¾\nax.set_boundary(rect, transform=ccrs.Geodetic())\r æˆªå–ååè€Œä¸­å›½æ˜¾ç¤ºä¸å…¨äº†ï¼Œéœ€è¦é‡æ–°è°ƒæ•´ extent çš„å€¼ã€‚\nä¸ºåœ°å›¾æ·»åŠ åˆ»åº¦â€”â€”é»˜è®¤æ–¹æ³• Cartopy çš„ç‰ˆæœ¬åœ¨ 0.17 åŠä»¥ä¸‹æ—¶ï¼Œåªæ”¯æŒç»™ Plate CarrÃ©e å’Œ Mercator æŠ•å½±çš„åœ°å›¾æ·»åŠ åˆ»åº¦ã€‚ä¸€ä¸ªå˜é€šçš„æ–¹æ³•æ˜¯ç”¨ ax.text æ–¹æ³•æ‰‹åŠ¨æ·»åŠ åˆ»åº¦æ ‡ç­¾ï¼Œä¾‹å­è§ Pythonæ°”è±¡ç»˜å›¾æ•™ç¨‹ çš„ç¬¬ 18 æœŸã€‚\nç­‰åˆ°äº†æœ€æ–°çš„ 0.18 ç‰ˆæœ¬ï¼Œgridlines æ–¹æ³•æœ‰äº†ç»™æ‰€æœ‰æŠ•å½±æ·»åŠ åˆ»åº¦æ ‡ç­¾çš„èƒ½åŠ›ã€‚ä¸‹é¢æ¥æµ‹è¯•ä¸€ä¸‹\nax.gridlines(\rxlocs=np.arange(-180, 180 + 1, 10), ylocs=np.arange(-90, 90 + 1, 10),\rdraw_labels=True, x_inline=False, y_inline=False,\rlinewidth=0.5, linestyle='--', color='gray'\r)\r xlocs ä¸ ylocs æŒ‡å®šç½‘æ ¼çº¿çš„ç»çº¬åº¦ä½ç½®ï¼Œå®é™…ä¸Šè¶…å‡ºåœ°å›¾è¾¹ç•Œçš„ç½‘æ ¼å¹¶ä¸ä¼šè¢«ç”»å‡ºï¼Œæ‰€ä»¥è¿™é‡Œç»™å‡ºçš„èŒƒå›´æ¯”è¾ƒå®½ã€‚draw_labels æŒ‡ç¤ºæ˜¯å¦ç”»å‡ºåˆ»åº¦æ ‡ç­¾ï¼Œè€Œ x_inline ä¸ y_inline æŒ‡ç¤ºè¿™äº›æ ‡ç­¾æ˜¯å¦ç”»åœ¨åœ°å›¾é‡Œé¢ã€‚inline çš„é€‰é¡¹å¼€å¯åæ•ˆæœæ¯”è¾ƒä¹±ï¼Œæ‰€ä»¥è¿™é‡Œéƒ½å…³é—­ã€‚ç»“æœå¦‚ä¸‹å›¾\né»˜è®¤çš„æ•ˆæœååˆ†æ‹‰èƒ¯ï¼Œå››ä¸ªæ–¹å‘ä¸Šéƒ½æœ‰æ ‡ç­¾ï¼Œå¹¶ä¸”æœ‰ç€å¤šä½™çš„æ—‹è½¬æ•ˆæœã€‚é‚£ä¹ˆå†ä¿®æ”¹ glçš„å±æ€§ çœ‹çœ‹\n# å…³é—­é¡¶éƒ¨å’Œå³è¾¹çš„æ ‡ç­¾,åŒæ—¶ç¦ç”¨æ—‹è½¬.\rgl.top_labels = False\rgl.right_labels = False\rgl.rotate_labels = False\r ç»“æœæ”¹å–„äº†å¾ˆå¤šï¼Œä½†ä»ç„¶æœ‰å¾ˆå¥‡æ€ªçš„åœ°æ–¹ï¼šè™½ç„¶å…³é—­äº†å³è¾¹çš„çº¬åº¦æ ‡ç­¾ï¼Œä½†ç»åº¦çš„æ ‡ç­¾å‡ºç°åœ¨äº†ä¸¤è¾¹çš„ y è½´ä¸Šã€‚æ ¹æ® issue #1530ï¼Œä¸€ä¸ªå¾ˆä¸ä¼˜é›…çš„è§£å†³æ–¹æ³•æ˜¯å°†ç½‘æ ¼çº¿åˆ†ä¸¤æ¬¡æ¥ç”»\n  ç¬¬ä¸€æ¬¡ç”»å‡ºçº¬çº¿å’Œ 90Â°E-120Â°E çš„ç»çº¿ï¼Œå¹¶ä¸” draw_label=Trueã€‚\n  ç¬¬äºŒæ¬¡å•ç‹¬ç”»å‡º 70Â°Eã€80Â°Eã€130Â°Eã€140Â°E çš„ç»çº¿ï¼Œå¹¶ä¸” draw_label=Falseã€‚\n  ç»“æœè¿™é‡Œå°±ä¸å±•ç¤ºäº†ï¼Œè‚¯å®šèƒ½å»æ‰ y è½´ä¸Šçš„ç»åº¦æ ‡ç­¾ï¼Œä½†æ˜¾ç„¶è¿™ä¸ªæ–¹æ³•æœ‰ç‚¹â€œäº‹åæ“¦å±è‚¡â€çš„æ„æ€ã€‚\nä¸ºåœ°å›¾æ·»åŠ åˆ»åº¦â€”â€”è‡ªåˆ¶æ–¹æ³• è¿™é‡Œå°è¯•è‡ªå·±å†™ä¸€ä¸ªæ·»åŠ åˆ»åº¦çš„å‡½æ•°ã€‚æ€è·¯æ¥è‡ª Cartopy çš„ Gridliner ç±»çš„æºç å’Œ Labelling grid lines on a Lambert Conformal projection è¿™ç¯‡ noteã€‚\nåŸç†æ˜¯æƒ³åŠæ³•åœ¨ Lambert æŠ•å½±åæ ‡ç³»ï¼ˆè¿™é‡Œäº¦å³ Matplotlib çš„ data åæ ‡ç³»ï¼‰ä¸‹è¡¨ç¤ºå‡º xy è½´å’Œç½‘æ ¼çº¿çš„ç©ºé—´ä½ç½®ï¼Œè‹¥ä¸€æ¡ç½‘æ ¼çº¿ä¸ä¸€ä¸ªè½´çº¿ç›¸äº¤ï¼Œé‚£ä¹ˆè¿™ä¸ªäº¤ç‚¹çš„ä½ç½®å³åˆ»åº¦çš„ä½ç½®ã€‚æœ€åç›´æ¥å°†è¿™äº›ä½ç½®ç”¨äº set_xticks å’Œ set_yticks æ–¹æ³•ã€‚åˆ¤æ–­ä¸¤çº¿ç›¸äº¤ç”¨åˆ°äº† Shapley åº“ã€‚ä»£ç å’Œæ•ˆæœå¦‚ä¸‹\nimport numpy as np\rimport shapely.geometry as sgeom\rimport matplotlib.pyplot as plt\rimport cartopy.crs as ccrs\rfrom cartopy.mpl.ticker import LongitudeFormatter, LatitudeFormatter\rdef find_x_intersections(ax, xticks):\r'''æ‰¾å‡ºxtickså¯¹åº”çš„ç»çº¿ä¸ä¸‹xè½´çš„äº¤ç‚¹åœ¨dataåæ ‡ä¸‹çš„ä½ç½®å’Œå¯¹åº”çš„ticklabel.'''\r# è·å–åœ°å›¾çš„çŸ©å½¢è¾¹ç•Œå’Œæœ€å¤§çš„ç»çº¬åº¦èŒƒå›´.\rx0, x1, y0, y1 = ax.get_extent()\rlon0, lon1, lat0, lat1 = ax.get_extent(ccrs.PlateCarree())\rxaxis = sgeom.LineString([(x0, y0), (x1, y0)])\r# ä»…é€‰å–èƒ½è½å…¥åœ°å›¾èŒƒå›´å†…çš„ticks.\rlon_ticks = [tick for tick in xticks if tick \u0026gt;= lon0 and tick \u0026lt;= lon1]\r# æ¯æ¡ç»çº¿æœ‰nstepä¸ªç‚¹.\rnstep = 50\rxlocs = []\rxticklabels = []\rfor tick in lon_ticks:\rlon_line = sgeom.LineString(\rax.projection.transform_points(\rccrs.Geodetic(),\rnp.full(nstep, tick),\rnp.linspace(lat0, lat1, nstep)\r)[:, :2]\r)\r# å¦‚æœç»çº¿ä¸xè½´æœ‰äº¤ç‚¹,è·å–å…¶ä½ç½®.\rif xaxis.intersects(lon_line):\rpoint = xaxis.intersection(lon_line)\rxlocs.append(point.x)\rxticklabels.append(tick)\relse:\rcontinue\r# ç”¨formatteræ·»ä¸Šåº¦æ•°å’Œä¸œè¥¿æ ‡è¯†.\rformatter = LongitudeFormatter()\rxticklabels = [formatter(label) for label in xticklabels]\rreturn xlocs, xticklabels\rdef find_y_intersections(ax, yticks):\r'''æ‰¾å‡ºytickså¯¹åº”çš„çº¬çº¿ä¸å·¦yè½´çš„äº¤ç‚¹åœ¨dataåæ ‡ä¸‹çš„ä½ç½®å’Œå¯¹åº”çš„ticklabel.'''\rx0, x1, y0, y1 = ax.get_extent()\rlon0, lon1, lat0, lat1 = ax.get_extent(ccrs.PlateCarree())\ryaxis = sgeom.LineString([(x0, y0), (x0, y1)])\rlat_ticks = [tick for tick in yticks if tick \u0026gt;= lat0 and tick \u0026lt;= lat1]\rnstep = 50\rylocs = []\ryticklabels = []\rfor tick in lat_ticks:\r# æ³¨æ„è¿™é‡Œä¸find_x_intersectionsçš„ä¸åŒ.\rlat_line = sgeom.LineString(\rax.projection.transform_points(\rccrs.Geodetic(),\rnp.linspace(lon0, lon1, nstep),\rnp.full(nstep, tick)\r)[:, :2]\r)\rif yaxis.intersects(lat_line):\rpoint = yaxis.intersection(lat_line)\rylocs.append(point.y)\ryticklabels.append(tick)\relse:\rcontinue\rformatter = LatitudeFormatter()\ryticklabels = [formatter(label) for label in yticklabels]\rreturn ylocs, yticklabels\rdef set_lambert_ticks(ax, xticks, yticks):\r'''\rç»™ä¸€ä¸ªLambertConformalæŠ•å½±çš„GeoAxesåœ¨ä¸‹xè½´ä¸å·¦yè½´ä¸Šæ·»åŠ ticks.\rè¦æ±‚åœ°å›¾è¾¹ç•Œæ˜¯çŸ©å½¢çš„,å³axéœ€è¦æå‰è¢«set_extentæ–¹æ³•æˆªå–æˆçŸ©å½¢.\rå¦åˆ™å¯èƒ½ä¼šå‡ºç°é”™è¯¯.\rParameters\r----------\rax : GeoAxes\ræŠ•å½±ä¸ºLambertConformalçš„Axes.\rxticks : list of floats\rxè½´ä¸Štickçš„ä½ç½®.\ryticks : list of floats\ryè½´ä¸Štickçš„ä½ç½®.\rReturns\r-------\rNone\r'''\r# è®¾ç½®xè½´.\rxlocs, xticklabels = find_x_intersections(ax, xticks)\rax.set_xticks(xlocs)\rax.set_xticklabels(xticklabels)\r# è®¾ç½®yè½´.\rylocs, yticklabels = find_y_intersections(ax, yticks)\rax.set_yticks(ylocs)\rax.set_yticklabels(yticklabels)\r è¿™æ¬¡çš„æ•ˆæœå°±å¥½å¾ˆå¤šäº†ï¼Œå¹¶ä¸”ç›¸æ¯”äºé»˜è®¤æ–¹æ³•ï¼Œåæ ‡è½´ä¸Šä¹Ÿæœ‰äº†åˆ»åº¦çš„å‡¸èµ·ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•è¦æ±‚åœ¨è®¾ç½®åˆ»åº¦ä¹‹å‰å°±é€šè¿‡ set_extent æ–¹æ³•æˆªå–å‡ºçŸ©å½¢çš„è¾¹ç•Œï¼Œå¦åˆ™å¯èƒ½æœ‰å¥‡æ€ªçš„ç»“æœã€‚å¦å¤–ç»æµ‹è¯•å¯¹ Albers æŠ•å½±ä¹Ÿé€‚ç”¨ã€‚\nä¹Ÿè®¸ä¸‹æ¬¡æ›´æ–°å Cartopy çš„åˆ»åº¦æ ‡æ³¨åŠŸèƒ½èƒ½å¾—åˆ°æ”¹å–„ï¼Œå°±ç®—æ²¡æœ‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®ä¸Šé¢æè¿°çš„æ€è·¯æ¥è‡ªåˆ¶åˆ»åº¦ã€‚\n","date":"2021-03-24","permalink":"https://zhajiman.github.io/post/cartopy_lambert/","tags":["cartopy","matplotlib"],"title":"Cartopy ç³»åˆ—ï¼šä¸º Lambert æŠ•å½±åœ°å›¾æ·»åŠ åˆ»åº¦"},{"content":"ç®€ä»‹ å¸¸ç”¨çš„åœ°å›¾å¯è§†åŒ–çš„ç¼–ç¨‹å·¥å…·æœ‰ MATLABã€IDLã€GrADSã€GMTã€NCL ç­‰ã€‚æˆ‘ä¹‹å‰ä¸€ç›´ä½¿ç”¨çš„æ˜¯è„šæœ¬è¯­è¨€ NCLï¼Œæ˜“ç”¨æ€§ä¸é”™ï¼Œç”»åœ°å›¾çš„æ•ˆæœä¹Ÿå¾ˆå¥½ã€‚ç„¶è€Œ 2019 å¹´åˆï¼ŒNCAR å®£å¸ƒ NCL å°†åœæ­¢æ›´æ–°ï¼Œå¹¶ä¼šåœ¨æ—¥åè½¬ä¸º Python çš„ç»˜å›¾åŒ…ã€‚äºæ˜¯æˆ‘å¼€å§‹è€ƒè™‘è½¬æŠ• Pythonï¼ŒåŒæ—¶è§‰å¾—åœ¨ Python ç¯å¢ƒä¸‹å¦‚æœè¿˜æ˜¯ç”¨ PyNGL é‚£ä¸€å¥—è¯­æ³•çš„è¯ï¼Œæœªå…æœ‰äº›æ¢æ±¤ä¸æ¢è¯ã€‚å› æ­¤æˆ‘é€‰æ‹©ç”¨ Python ç¯å¢ƒä¸‹ä¸“æœ‰çš„ Cartopy åŒ…æ¥ç”»åœ°å›¾ã€‚\næ­¤å‰ Python æœ€å¸¸ç”¨çš„åœ°å›¾åŒ…æ˜¯ Basemapï¼Œç„¶è€Œå®ƒå°†äº 2020 å¹´è¢«å¼ƒç”¨ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Cartopy åŒ…ä½œä¸ºæ›¿ä»£ã€‚Cartopy æ˜¯è‹±å›½æ°”è±¡å±€å¼€å‘çš„åœ°å›¾ç»˜å›¾åŒ…ï¼Œå®ç°äº† Basemap çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè¿˜å¯ä»¥é€šè¿‡ Matplotlib çš„ API å®ç°ä¸°å¯Œçš„è‡ªå®šä¹‰æ•ˆæœã€‚\næœ¬æ–‡å°†ä¼šä»ä¸€ä¸ª NCL è½¬ Python çš„å…¥é—¨è€…çš„è§’åº¦ï¼Œä»‹ç»å¦‚ä½•å®‰è£… Cartopyï¼Œå¦‚ä½•ç»˜åˆ¶åœ°å›¾ï¼Œå¹¶å®ç°ä¸€äº›å¸¸ç”¨çš„æ•ˆæœã€‚ä»£ç åŸºäº 0.18.0 ç‰ˆæœ¬çš„ Cartopyã€‚\næç¤º æœ¬æ–‡å…¶å®æ›´æ–°è¿‡æ•°æ¬¡ï¼Œæ¯æ¬¡éƒ½ä¿®æ­£äº†ä¸€äº›è¡¨è¿°æˆ– bugï¼Œå¦‚æœè¿˜å­˜åœ¨é—®é¢˜çš„è¯è¯·è¯»è€…åœ¨è¯„è®ºåŒºæŒ‡å‡ºã€‚å¦å¤–å¼ºçƒˆå»ºè®®è¯»å®Œæœ¬æ–‡åç»§ç»­é˜…è¯» Cartopy ç³»åˆ—ï¼šå¯¹å…¥é—¨æ•™ç¨‹çš„è¡¥å……ï¼Œè§£ç­”äº†æ›´å¤šå¸¸è§çš„é—®é¢˜ã€‚\nå®‰è£… Cartopy å’Œç›¸å…³çš„åº“ é€šè¿‡ Conda æ¥å®‰è£… Cartopy æ˜¯æœ€ä¸ºç®€å•æ–¹ä¾¿çš„ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸‹è½½æœ€æ–°çš„ Python 3 çš„ Conda ç¯å¢ƒï¼ˆAnaconda æˆ– Miniconda çš†å¯ï¼‰ï¼Œè®¾ç½®å›½å†…é•œåƒæºï¼Œå»ºç«‹å¥½è™šæ‹Ÿç¯å¢ƒï¼Œç„¶åå‚ç…§ Cartopy å®˜ç½‘çš„ installation guideï¼Œæ‰§è¡Œæ“ä½œï¼š\nconda install -c conda-forge cartopy\r æ¥ç€ä¾¿ä¼šå¼€å§‹å®‰è£… Cartopyï¼Œä»¥åŠ Numpyã€Matplotlib ç­‰ä¸€ç³»åˆ—ç›¸å…³åŒ…ã€‚Cartopy çš„å®‰è£…å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚ä¹‹åè¿˜å¯ä»¥è€ƒè™‘å»å®‰è£… netCDF4ã€h5pyã€pyhdf ç­‰æ”¯æŒç‰¹å®šæ•°æ®æ ¼å¼è¯»å†™çš„åŒ…ã€‚\nç”»åœ°å›¾çš„åŸºæœ¬æµç¨‹ ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼š\n# å¯¼å…¥æ‰€éœ€çš„åº“\rimport matplotlib as mpl\rimport matplotlib.pyplot as plt\rimport cartopy.crs as ccrs\r# åˆ›å»ºç”»å¸ƒä»¥åŠax\rfig = plt.figure()\rax = fig.add_subplot(111, projection=ccrs.PlateCarree())\r# è°ƒç”¨axçš„æ–¹æ³•ç”»æµ·å²¸çº¿\rax.coastlines()\rplt.show()\r Cartopy æ˜¯åˆ©ç”¨ Matplotlib æ¥ç”»å›¾çš„ï¼Œå› æ­¤é¦–å…ˆè¦å¯¼å…¥ pyplot æ¨¡å—ã€‚åœ¨ Cartopy ä¸­ï¼Œæ¯ç§æŠ•å½±éƒ½æ˜¯ä¸€ä¸ªç±»ï¼Œè¢«å­˜æ”¾åœ¨ cartopy.crs æ¨¡å—ä¸­ï¼Œcrs å³åæ ‡å‚è€ƒç³»ç»Ÿï¼ˆCoordinate Reference Systemsï¼‰ä¹‹æ„ã€‚æ‰€ä»¥æ¥ç€è¦å¯¼å…¥è¿™ä¸ªæ¨¡å—ã€‚è¿™é‡Œé€‰å–æœ€å¸¸ç”¨çš„ç­‰è·åœ†æŸ±æŠ•å½± ccrs.PlateCarree ä½œä¸ºåœ°å›¾æŠ•å½±ã€‚\næˆ‘ä»¬çŸ¥é“ï¼ŒMatplotlib ç”»å›¾æ˜¯é€šè¿‡è°ƒç”¨ Axes ç±»çš„æ–¹æ³•æ¥å®Œæˆçš„ã€‚Cartopy åˆ›é€ äº†ä¸€ä¸ª Axes çš„å­ç±»ï¼ŒGeoAxesï¼Œå®ƒç»§æ‰¿äº†å‰è€…çš„åŸºæœ¬åŠŸèƒ½ï¼Œè¿˜æ·»åŠ äº†ä¸€ç³»åˆ—ç»˜åˆ¶åœ°å›¾å…ƒç´ çš„æ–¹æ³•ã€‚åˆ›å»ºä¸€ä¸ª GeoAxes å¯¹è±¡çš„åŠæ³•æ˜¯ï¼Œåœ¨åˆ›å»º axesï¼ˆæˆ– subplotï¼‰æ—¶ï¼Œé€šè¿‡å‚æ•° projection æŒ‡å®šä¸€ä¸ª ccrs ä¸­çš„æŠ•å½±ã€‚è¿™é‡Œä¾¿åˆ©ç”¨è¿™ä¸€æ–¹æ³•ç”Ÿæˆäº†ä¸€ä¸ªç­‰è·åœ†æŸ±æŠ•å½±ä¸‹çš„ axã€‚\næœ€åè°ƒç”¨ ax çš„æ–¹æ³• coastlines ç”»å‡ºæµ·å²¸çº¿ï¼Œé»˜è®¤ä»¥æœ¬åˆå­åˆçº¿ä¸ºä¸­å¿ƒï¼Œæ¯”ä¾‹å°ºä¸º 1:110mï¼ˆm è¡¨ç¤º millionï¼‰ã€‚\nå› æ­¤ç”¨ Cartopy ç”»åœ°å›¾çš„åŸºæœ¬æµç¨‹å¹¶ä¸å¤æ‚ï¼š\n åˆ›å»ºç”»å¸ƒã€‚ é€šè¿‡æŒ‡å®š projection å‚æ•°ï¼Œåˆ›å»º GeoAxes å¯¹è±¡ã€‚ è°ƒç”¨ GeoAxes çš„æ–¹æ³•ç”»å›¾ã€‚  GeoAxes çš„ä¸€äº›æœ‰ç”¨çš„æ–¹æ³• GeoAxes æœ‰ä¸å°‘æœ‰ç”¨çš„æ–¹æ³•ï¼Œè¿™é‡Œåˆ—ä¸¾å¦‚ä¸‹ï¼š\n set_globalï¼šè®©åœ°å›¾çš„æ˜¾ç¤ºèŒƒå›´æ‰©å±•è‡³æŠ•å½±çš„æœ€å¤§èŒƒå›´ã€‚ä¾‹å¦‚ï¼Œå¯¹ PlateCarree æŠ•å½±çš„ ax ä½¿ç”¨åï¼Œåœ°å›¾ä¼šå˜æˆå…¨çƒçš„ã€‚ set_extentï¼šç»™å‡ºå…ƒç»„ (x0, x1, y0, y1) ä»¥é™åˆ¶åœ°å›¾çš„æ˜¾ç¤ºèŒƒå›´ã€‚ set_xticksï¼šè®¾ç½® x è½´çš„åˆ»åº¦ã€‚ set_yticksï¼šè®¾ç½® y è½´çš„åˆ»åº¦ã€‚ gridlinesï¼šç»™åœ°å›¾æ·»åŠ ç½‘æ ¼çº¿ã€‚ coastlinesï¼šåœ¨åœ°å›¾ä¸Šç»˜åˆ¶æµ·å²¸çº¿ã€‚ stock_imgï¼šç»™åœ°å›¾æ·»åŠ ä½åˆ†è¾¨ç‡çš„åœ°å½¢å›¾èƒŒæ™¯ã€‚ add_featureï¼šç»™åœ°å›¾æ·»åŠ ç‰¹å¾ï¼ˆä¾‹å¦‚é™†åœ°æˆ–æµ·æ´‹çš„å¡«å……ã€æ²³æµç­‰ï¼‰ã€‚  åæ–‡ä¸­å…·ä½“çš„ä¾‹å­ä¸­å°†ä¼šç»å¸¸ç”¨åˆ°è¿™äº›æ–¹æ³•ã€‚\nä½¿ç”¨ä¸åŒçš„æŠ•å½± # é€‰å–å¤šç§æŠ•å½±\rprojections = [\rccrs.PlateCarree(),\rccrs.Robinson(),\rccrs.Mercator(),\rccrs.Orthographic()\r]\r# ç”»å‡ºå¤šå­å›¾\rfig = plt.figure()\rfor i, proj in enumerate(projections, 1):\rax = fig.add_subplot(2, 2, i, projection=proj)\rax.stock_img() # æ·»åŠ ä½åˆ†è¾¨ç‡çš„åœ°å½¢å›¾\rax.coastlines()\rax.set_title(f'{type(proj)}', fontsize='small')\rplt.show()\r è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å…¶å®ƒæŠ•å½±å’Œç”»å‡ºå¤šå­å›¾ã€‚å…¶ä¸­ stock_img æ–¹æ³•å¯ä»¥ç»™åœ°å›¾æ·»åŠ ä½åˆ†è¾¨ç‡çš„åœ°å½¢èƒŒæ™¯å›¾ï¼Œè®©åœ°å›¾æ˜¾å¾—ä¸é‚£ä¹ˆå¯’ç¢œã€‚\nåœ¨åˆå§‹åŒ–æŠ•å½±æ—¶å¯ä»¥æŒ‡å®šä¸€äº›å‚æ•°ï¼Œä¾‹å¦‚ ccrs.PlateCarree(central_longitude=180) å¯ä»¥è®©ç­‰è·åœ†æŸ±æŠ•å½±çš„å…¨çƒå›¾åƒçš„ä¸­å¤®ä½äºå¤ªå¹³æ´‹çš„ 180 åº¦ç»çº¿å¤„ã€‚\nç”»å¤šå­å›¾è¿˜å¯ä»¥ç”¨ plt.subplots å‡½æ•°ï¼Œä½†æ˜¯æŠ•å½±å°±åªèƒ½é€šè¿‡ subplot_kw å‚æ•°ç»™å‡ºï¼Œå¹¶ä¸”æ¯å¼ å­å›¾çš„æŠ•å½±è¦æ±‚ä¸€è‡´ã€‚\nåœ¨åœ°å›¾ä¸Šæ·»åŠ ç‰¹å¾ï¼ˆFeaturesï¼‰ é™¤äº†ç”»å‡ºæµ·å²¸çº¿å¤–ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦åœ¨åœ°å›¾ä¸Šç”»å‡ºæ›´å¤šç‰¹å¾ï¼Œä¾‹å¦‚é™†åœ°æµ·æ´‹ã€æ²³æµæ¹–æ³Šç­‰ã€‚cartopy.feature ä¸­ä¾¿å‡†å¤‡äº†è®¸å¤šå¸¸ç”¨çš„ç‰¹å¾å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›å¯¹è±¡çš„é»˜è®¤æ¯”ä¾‹æ˜¯ 1:110mã€‚\nimport cartopy.feature as cfeature\rfig = plt.figure()\rproj = ccrs.PlateCarree()\rax = fig.add_subplot(111, projection=proj)\r# è®¾ç½®ç»çº¬åº¦èŒƒå›´,é™å®šä¸ºä¸­å›½\r# æ³¨æ„æŒ‡å®šcrså…³é”®å­—,å¦åˆ™èŒƒå›´ä¸ä¸€å®šå®Œå…¨å‡†ç¡®\rextent = [75, 150, 15, 60]\rax.set_extent(extent, crs=proj)\r# æ·»åŠ å„ç§ç‰¹å¾\rax.add_feature(cfeature.OCEAN)\rax.add_feature(cfeature.LAND, edgecolor='black')\rax.add_feature(cfeature.LAKES, edgecolor='black')\rax.add_feature(cfeature.RIVERS)\rax.add_feature(cfeature.BORDERS)\r# æ·»åŠ ç½‘æ ¼çº¿\rax.gridlines(linestyle='--')\rplt.show()\r add_feature æ–¹æ³•èƒ½å¤ŸæŠŠ cfeature é‡Œçš„ç‰¹å¾å¯¹è±¡æ·»åŠ åˆ°åœ°å›¾ä¸Šã€‚ä¸Šé¢çš„ä¾‹å­ä¸­å°±ä¾æ¬¡æ·»åŠ äº†æµ·æ´‹ã€é™†åœ°ã€æ¹–æ³Šã€æ²³æµï¼Œè¿˜æœ‰å›½ç•Œçº¿çš„ç‰¹å¾ã€‚ç”±äºæ¸²æŸ“å®é™…ä¸Šé‡‡ç”¨çš„æ˜¯ Matplotlib é‡Œ annotations çš„æ–¹æ³•ï¼Œæ‰€ä»¥æ·»åŠ çš„ç‰¹å¾æœ¬è´¨ä¸Šå°±æ˜¯ä¸€äº›çº¿æˆ–è€…å¤šè¾¹å½¢ï¼Œedgecolorã€facecolor ç­‰å¸¸ç”¨å…³é”®å­—éƒ½å¯ä»¥ç”¨æ¥æŒ‡å®šè¿™äº›ç‰¹å¾çš„æ•ˆæœã€‚\nCartopy æœ¬èº«è‡ªå¸¦ä¸€äº›å¸¸ç”¨çš„åœ°å›¾æ•°æ®ï¼Œä¸è¿‡æœ‰äº›ç‰¹å¾å¹¶æ²¡æœ‰å†…ç½®ï¼Œè€Œæ˜¯ä¼šåœ¨è„šæœ¬è¿è¡Œæ—¶è‡ªåŠ¨ä» Natural Earth ç½‘ç«™ä¸Šä¸‹è½½ä¸‹æ¥ï¼Œæ­¤æ—¶å‘½ä»¤è¡Œå¯èƒ½ä¼šæç¤ºä¸€äº›è­¦å‘Šä¿¡æ¯ã€‚ä¸‹è½½å®Œæˆåï¼Œä»¥åä½¿ç”¨è¿™ä¸ªç‰¹å¾éƒ½ä¸ä¼šå†å‡ºç°è­¦å‘Šã€‚\nå¦å¤–å­˜åœ¨ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ï¼ŒCartopyè‡ªå¸¦çš„ä¸­å›½åœ°å›¾æ•°æ®ä¸ç¬¦åˆæˆ‘å›½çš„åœ°å›¾æ ‡å‡†ï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­ç¼ºå°‘å°æ¹¾åœ°åŒºï¼Œè—å—åŒºåŸŸè¾¹ç•Œæœ‰è¯¯ã€‚åé¢çš„å°èŠ‚è¿˜ä¼šå†æåˆ°å¦‚ä½•ç”»å‡ºæ­£ç¡®çš„ä¸­å›½åœ°å›¾ã€‚\nè®¾ç½®åœ°å›¾åˆ†è¾¨ç‡ Cartopy è‡ªå¸¦çš„ Natural Earth çš„åœ°å›¾æœ‰ä¸‰æ¡£åˆ†è¾¨ç‡ï¼š1:10mã€1:50mã€1:110mã€‚é»˜è®¤åˆ†è¾¨ç‡ä¸º 1:110mï¼Œè¿™åœ¨å¾ˆå¤šåœºåˆä¸‹æ˜¾å¾—å¾ˆç²—ç³™ã€‚è®¾ç½®åˆ†è¾¨ç‡çš„æ–¹æ³•å¦‚ä¸‹ï¼š\n# coastlinesæ–¹æ³•ä½¿ç”¨resolutionå…³é”®å­—\rax.coastlines(resolution='50m')\r# add_featureæ–¹æ³•ä¸­,åˆ™è¦è°ƒç”¨cfeatureå¯¹è±¡çš„with_scaleæ–¹æ³•\rax.add_feature(cfeature.OCEAN.with_scale('50m'))\r æ¥ç€æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\nfig = plt.figure()\rres = ['110m', '50m', '10m']\rextent = [75, 150, 15, 60]\rproj = ccrs.PlateCarree()\rfor i, res in enumerate(['110m', '50m', '10m']):\rax = fig.add_subplot(1, 3, i+1, projection=proj)\rax.set_extent(extent, crs=proj)\rax.add_feature(cfeature.OCEAN.with_scale(res))\rax.add_feature(cfeature.LAND.with_scale(res), edgecolor='black')\rax.add_feature(cfeature.LAKES.with_scale(res), edgecolor='black')\rax.add_feature(cfeature.RIVERS.with_scale(res))\rax.add_feature(cfeature.BORDERS.with_scale(res))\rax.gridlines(linestyle='--')\rax.set_title('resolution=' + res)\rplt.show()\r å¯ä»¥çœ‹åˆ°ç»˜åˆ¶æ•ˆæœæœ‰å¾ˆå¤§åŒºåˆ«ï¼Œä¸è¿‡ç›¸åº”åœ°ï¼Œåˆ†è¾¨ç‡è¶Šé«˜ç”»å›¾é€Ÿåº¦è¶Šæ…¢ã€‚\nä¸‹è½½åœ°å›¾ Cartopy è‡ªå¸¦çš„åœ°å›¾æ•°æ®ä¿å­˜åœ¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤æ˜¾ç¤ºçš„ç›®å½•ä¸­\nimport cartopy\rprint(cartopy.config['data_dir'])\r ä¸€èˆ¬æ¥è¯´è‡ªå¸¦çš„åœ°å›¾è¶³ä»¥æ»¡è¶³æ—¥å¸¸éœ€æ±‚ï¼Œå¦‚æœæƒ³æ‰‹åŠ¨ä¸‹è½½åœ°å›¾ï¼Œå¯ä»¥åˆ° Natural Earth ç½‘ç«™ä¸Šä¸‹è½½æ‰€éœ€çš„åœ°å›¾æ•°æ®ã€‚è¯¥ç½‘é¡µæä¾›ä¸‰ç±»åœ°å›¾æ•°æ®ï¼š\n Culturalï¼šå›½ç•Œçº¿ã€é“è·¯ã€é“è·¯ç­‰æ–‡åŒ–ä¿¡æ¯ã€‚ Physicalï¼šé™†åœ°ã€æµ·æ´‹ã€æµ·å²¸çº¿ã€æ¹–æ³Šã€å†°å·ç­‰åœ°è´¨ä¿¡æ¯ã€‚ Rasterï¼šå„ç§åˆ†è¾¨ç‡çš„åœ°å½¢èµ·ä¼æ …æ ¼æ–‡ä»¶ã€‚  å…¶ä¸­ Cultural å’Œ Physical æ•°æ®å¯ä»¥ä½œä¸ºå¸¸ç”¨çš„ç‰¹å¾æ¥è¿›è¡Œæ·»åŠ ï¼Œè€Œ Raster æ•°æ®åˆ™éœ€è¦ç”¨ imshow æ–¹æ³•æ¥ä½œä¸ºå›¾ç‰‡æ˜¾ç¤ºã€‚æŠŠä¸‹è½½å¥½çš„æ–‡ä»¶è§£å‹åˆ° data_dir ä¸‹å¯¹åº”çš„å­ç›®å½•ä¸­å³å¯ã€‚\nåœ¨åœ°å›¾ä¸Šæ·»åŠ æ•°æ® åœ¨ç›´æ¥è°ƒç”¨ ax.plotã€ax.contourf ç­‰æ–¹æ³•åœ¨åœ°å›¾ä¸Šæ·»åŠ æ•°æ®ä¹‹å‰ï¼Œéœ€è¦äº†è§£ Cartopy çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼šåœ¨åˆ›å»ºä¸€ä¸ª GeoAxes å¯¹è±¡æ—¶ï¼Œé€šè¿‡ projection å…³é”®å­—æŒ‡å®šäº†è¿™ä¸ªåœ°å›¾æ‰€å¤„çš„æŠ•å½±åæ ‡ç³»ï¼Œè¿™ä¸ªåæ ‡ç³»çš„æŠ•å½±æ–¹å¼å’ŒåŸç‚¹ä½ç½®éƒ½å¯ä»¥è¢«æŒ‡å®šã€‚ä½†æ˜¯æˆ‘ä»¬æ‰‹ä¸Šçš„æ•°æ®å¾ˆå¯èƒ½å¹¶ä¸æ˜¯å®šä¹‰åœ¨è¿™ä¸ªåæ ‡ç³»ä¸‹çš„ï¼ˆä¾‹å¦‚é‚£äº›è§„æ•´çš„ç»çº¬åº¦ç½‘æ ¼æ•°æ®ï¼‰ï¼Œå› æ­¤åœ¨è°ƒç”¨ç”»å›¾æ–¹æ³•å¾€åœ°å›¾ä¸Šæ·»åŠ æ•°æ®æ—¶ï¼Œéœ€è¦é€šè¿‡ transform å…³é”®å­—æŒ‡å®šæˆ‘ä»¬çš„æ•°æ®æ‰€å¤„çš„åæ ‡ç³»ã€‚ç”»å›¾è¿‡ç¨‹ä¸­ï¼ŒCartopy ä¼šè‡ªåŠ¨è¿›è¡Œè¿™ä¸¤ä¸ªåæ ‡ç³»ä¹‹é—´çš„æ¢ç®—ï¼ŒæŠŠæˆ‘ä»¬çš„æ•°æ®æ­£ç¡®æŠ•å½±åˆ°åœ°å›¾çš„åæ ‡ç³»ä¸Šã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­ï¼š\n# å®šä¹‰ä¸€ä¸ªåœ¨PlateCarreeæŠ•å½±ä¸­çš„æ–¹æ¡†\rx = [-100.0, -100.0, 100.0, 100.0, -100.0]\ry = [-60.0, 60.0, 60.0, -60.0, -60.0]\r# é€‰å–ä¸¤ç§åœ°å›¾æŠ•å½±\rmap_proj = [ccrs.PlateCarree(), ccrs.Mollweide()]\rdata_proj = ccrs.PlateCarree()\rfig = plt.figure()\rax1 = fig.add_subplot(211, projection=map_proj[0])\rax1.stock_img()\rax1.plot(x, y, marker='o', transform=data_proj)\rax1.fill(x, y, color='coral', transform=data_proj, alpha=0.4)\rax1.set_title('PlateCarree')\rax2 = fig.add_subplot(212, projection=map_proj[1])\rax2.stock_img()\rax2.plot(x, y, marker='o', transform=data_proj)\rax2.fill(x, y, color='coral', transform=data_proj, alpha=0.4)\rax2.set_title('Mollweide')\rplt.show()\r å¯ä»¥çœ‹åˆ°ï¼Œç­‰è·åœ†æŸ±æŠ•å½±åœ°å›¾ä¸Šçš„ä¸€ä¸ªæ–¹æ¡†ï¼Œåœ¨æ‘©å°”å¨æŠ•å½±çš„åœ°å›¾ä¸Šä¼šå‘ä¸¤è¾¹â€œé•¿èƒ–â€â€”â€”å°½ç®¡è¿™ä¸¤ä¸ªå½¢çŠ¶ä»£è¡¨åŒä¸€ä¸ªå‡ ä½•ä½“ã€‚å¦‚æœä¸ç»™å‡º transform å…³é”®å­—ï¼Œé‚£ä¹ˆ Cartopy ä¼šé»˜è®¤æ•°æ®æ‰€åœ¨çš„åæ ‡ç³»æ˜¯ PlateCarree()ã€‚ä¸ºäº†ä¸¥è°¨èµ·è§ï¼Œå»ºè®®åœ¨ä½¿ç”¨ä»»ä½•ç”»å›¾æ–¹æ³•ï¼ˆplotã€contourfã€pcolormesh ç­‰ï¼‰æ—¶éƒ½ç»™å‡º transform å…³é”®å­—ã€‚\nä¸ºåœ°å›¾æ·»åŠ ç»çº¬åº¦åˆ»åº¦ åœ¨ 0.17 åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒCartopy ä»…æ”¯æŒä¸ºç›´è§’åæ ‡ç³»ç»Ÿï¼ˆç­‰è·åœ†æŸ±æŠ•å½±å’Œéº¦å¡æ‰˜æŠ•å½±ï¼‰æ·»åŠ åˆ»åº¦ï¼Œè€Œå¯¹å…°å‹ƒç‰¹æŠ•å½±è¿™æ ·çš„åˆ™æ— èƒ½ä¸ºåŠ›ã€‚0.18 ç‰ˆæœ¬å¼€å§‹ï¼Œè™½ç„¶å®˜ç½‘è¯´å·²ç»å®ç°äº†å¯¹æ‰€æœ‰æŠ•å½±æ·»åŠ åˆ»åº¦çš„åŠŸèƒ½ï¼ˆPR #1117ï¼‰ï¼Œä½†å®é™…æ•ˆæœè¿˜æ˜¯æŒºå¥‡æ€ªã€‚å› æ­¤è¿™é‡Œå°±åªä»¥ç­‰è·åœ†æŸ±æŠ•å½±ä¸ºä¾‹\n# å¯¼å…¥Cartopyä¸“é—¨æä¾›çš„ç»çº¬åº¦çš„Formatter\rfrom cartopy.mpl.ticker import LongitudeFormatter, LatitudeFormatter\rmap_proj = ccrs.PlateCarree()\rfig = plt.figure()\rax = fig.add_subplot(111, projection=map_proj)\rax.set_global()\rax.stock_img()\r# è®¾ç½®å¤§åˆ»åº¦å’Œå°åˆ»åº¦\rtick_proj = ccrs.PlateCarree()\rax.set_xticks(np.arange(-180, 180 + 60, 60), crs=tick_proj)\rax.set_xticks(np.arange(-180, 180 + 30, 30), minor=True, crs=tick_proj)\rax.set_yticks(np.arange(-90, 90 + 30, 30), crs=tick_proj)\rax.set_yticks(np.arange(-90, 90 + 15, 15), minor=True, crs=tick_proj)\r# åˆ©ç”¨Formatteræ ¼å¼åŒ–åˆ»åº¦æ ‡ç­¾\rax.xaxis.set_major_formatter(LongitudeFormatter())\rax.yaxis.set_major_formatter(LatitudeFormatter())\rplt.show()\r Cartopy ä¸­éœ€è¦ç”¨ GeoAxes ç±»çš„ set_xticks å’Œ set_yticks æ–¹æ³•æ¥åˆ†åˆ«è®¾ç½®ç»çº¬åº¦åˆ»åº¦ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•è¿˜å¯ä»¥é€šè¿‡ minor å‚æ•°ï¼ŒæŒ‡å®šæ˜¯å¦æ·»ä¸Šå°åˆ»åº¦ã€‚\nset_xticks ä¸­çš„ crs å…³é”®å­—æŒ‡çš„æ˜¯æˆ‘ä»¬ç»™å‡ºçš„ ticks æ˜¯åœ¨ä»€ä¹ˆåæ ‡ç³»ç»Ÿä¸‹å®šä¹‰çš„ï¼Œè¿™æ ·å¥½æ¢ç®—è‡³ ax æ‰€åœ¨çš„åæ ‡ç³»ç»Ÿï¼ŒåŸç†åŒä¸Šä¸€èŠ‚æ‰€è¿°ã€‚å¦‚æœä¸æŒ‡å®šï¼Œå°±å¾ˆå®¹æ˜“å‡ºç°æŠŠ ticks ç”»åˆ°åœ°å›¾å¤–çš„æƒ…å†µã€‚é™¤äº† set_xticksï¼Œset_extent æ–¹æ³•åŒæ ·æœ‰ crs å…³é”®å­—ï¼Œæˆ‘ä»¬éœ€è¦å¤šåŠ æ³¨æ„ã€‚\næ¥ç€åˆ©ç”¨ Cartopy ä¸“é—¨æä¾›çš„ Formatter æ¥æ ¼å¼åŒ–åˆ»åº¦çš„æ ‡ç­¾ï¼Œä½¿ä¹‹èƒ½æœ‰ä¸œç»è¥¿ç»ã€å—çº¬åŒ—çº¬çš„å­—æ¯æ ‡è¯†ã€‚\nåœ¨æ ‡è¯†åˆ»åº¦çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å¯èƒ½ä¼šå‡ºç°ä¸‹å›¾è¿™æ ·çš„é—®é¢˜\nå³å…¨çƒåœ°å›¾çš„æœ€å³ç«¯ç¼ºå¤±äº† 0Â° çš„æ ‡è¯†ï¼Œè¿™æ˜¯ Cartopy å†…éƒ¨åœ¨æ¢ç®— ticks çš„åæ ‡æ—¶ç”¨åˆ°äº† mod è®¡ç®—è€Œå¯¼è‡´çš„ï¼Œè§£å†³æ–¹æ³•è§ stack overflow ä¸Šçš„ è¿™ä¸ªè®¨è®ºï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚é¢å¤–æä¸€å¥ï¼ŒNCL å¯¹äºè¿™ç§æƒ…å†µå°±èƒ½æ­£ç¡®å¤„ç†ã€‚\nCartopy è¿˜æœ‰ä¸€ä¸ªå¾ˆå‘çš„åœ°æ–¹åœ¨äºï¼Œset_extent ä¸æŒ‡å®š ticks çš„æ•ˆæœä¼šäº’ç›¸è¦†ç›–ï¼šå¦‚æœä½ å…ˆç”¨å‰è€…è®¾ç½®å¥½äº†åœ°å›¾çš„æ˜¾ç¤ºèŒƒå›´ï¼Œæ¥ä¸‹æ¥çš„ set_xticks è¶…å‡ºäº† extent çš„èŒƒå›´çš„è¯ï¼Œæœ€åçš„å‡ºå›¾èŒƒå›´å°±ä¼šä»¥ ticks çš„èŒƒå›´ä¸ºå‡†ã€‚å› æ­¤ä½¿ç”¨æ—¶è¦æ³¨æ„ ticks çš„èŒƒå›´ï¼Œæˆ–æŠŠ set_extent æ“ä½œæ”¾åœ¨æœ€åå®æ–½ã€‚\né™¤äº†åˆ©ç”¨ set_xticks å’Œ set_yticks æ–¹æ³•ï¼Œè¿˜å¯ä»¥åœ¨ç”»ç½‘æ ¼çº¿çš„åŒæ—¶ç”»å‡ºåˆ»åº¦ã€‚ä¾‹å­å¦‚ä¸‹ï¼š\n# ä»Gridlinerç±»ä¸­å¯¼å…¥ç»çº¬åº¦ä¸“ç”¨çš„Formatter\rfrom cartopy.mpl.gridliner import LONGITUDE_FORMATTER, LATITUDE_FORMATTER\rax = plt.axes(projection=ccrs.Mercator())\rax.coastlines()\rgl = ax.gridlines(\rcrs=ccrs.PlateCarree(), draw_labels=True,\rlinewidth=1, color='gray', linestyle='--'\r)\rgl.top_labels = False\rgl.left_labels = False\r# è‡ªå®šä¹‰ç»™å‡ºxè½´Locatorçš„ä½ç½®\rgl.xlocator = mpl.ticker.FixedLocator([-180, -45, 0, 45, 180])\rgl.xformatter = LONGITUDE_FORMATTER\rgl.yformatter = LATITUDE_FORMATTER\r# æŠŠä¸€äº›ax.textä¼šç”¨åˆ°çš„å…³é”®å­—ç»„æˆè¯å…¸,ç”¨æ¥è°ƒèŠ‚æ ‡ç­¾\rgl.xlabel_style = {'size': 15, 'color': 'gray'}\rgl.xlabel_style = {'color': 'red', 'weight': 'bold'}\rplt.show()\r è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ Gridliner ç±»çš„å¯è°ƒé€‰é¡¹å¾ˆä¸°å¯Œï¼Œç¼ºç‚¹æ˜¯åæ ‡è½´ä¸Šä¼šç¼ºå°‘åˆ»åº¦çš„çªèµ·ã€‚ä¸€ä¸ªæœ‰æ„æ€çš„åœ°æ–¹æ˜¯ï¼ŒCartopy æä¾›çš„è¿™äº› Formatter é™¤äº†ç»™ GeoAxes ç”¨ï¼Œæ‹¿ç»™æ™®é€šçš„ Axes ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\nç»˜åˆ¶æ­£ç¡®çš„ä¸­å›½åœ°å›¾ æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸¤ä¸ªç»˜åˆ¶ä¸­å›½åœ°å›¾çš„æ•™ç¨‹ï¼š\n æå«ç¥–å›½é¢†åœŸä»æ¯ä¸€å¼ åœ°å›¾å¼€å§‹ Cartopy ç»˜å›¾ç¤ºä¾‹åº“  ç¬¬ä¸€ä¸ªé“¾æ¥æä¾›äº†æ­£ç¡®çš„ä¸­å›½çœç•Œçš„ shapefileï¼Œç”¨ Cartopy çš„ shapereader è¯»å–åå³å¯ç»˜åˆ¶ã€‚ç¬¬äºŒä¸ªé“¾æ¥åˆ™åˆ©ç”¨çš„æ˜¯ GMT ä¸­æ–‡ç¤¾åŒºä¸Šæä¾›çš„çœç•Œçš„ç»çº¬åº¦æ•°æ®ã€‚ä¸¤ä¸ªé“¾æ¥éƒ½ç»™å‡ºäº†å®Œæ•´çš„ä»£ç ï¼Œç»æµ‹è¯•éƒ½å¯ä»¥æ­£å¸¸ä½œå›¾ã€‚ç¬¬ä¸€ä¸ªé“¾æ¥çš„æ•ˆæœå›¾å¦‚ä¸‹ï¼š\né—®é¢˜åœ¨äºä¸¤ç§æ–¹æ³•çš„ç”»å›¾é€Ÿåº¦éƒ½éå¸¸æ…¢ï¼Œå¯èƒ½æ˜¯å› ä¸ºç»™å‡ºçš„ shapefile åˆ†è¾¨ç‡å¤ªé«˜ï¼Ÿæˆ‘è‡ªå·±ç”¨çš„æ˜¯ Meteoinfo é‡Œè‡ªå¸¦çš„ bou2_4p.shp æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åˆ†è¾¨ç‡é€‚ä¸­ï¼Œç”»å›¾é€Ÿåº¦æ¯”è¾ƒç†æƒ³ã€‚ä½¿ç”¨æ–¹æ³•åŒç¬¬ä¸€ä¸ªé“¾æ¥ã€‚\nä»å…¥é—¨åˆ°æ”¾å¼ƒ æœ€åæ¥ä¸ª NCL ä¸ Cartopy åœ¨ç”»å›¾æ–¹é¢çš„ç®€å•å¯¹æ¯”å§ã€‚\nNCLï¼š\n ç”»åœ°å›¾å‚æ•°å¤šï¼Œæ•ˆæœå¥½ï¼Œå®˜æ–¹æ–‡æ¡£è¯¦å°½ã€‚ ç”»å›¾é€Ÿåº¦è¾ƒå¿«ã€‚ ç»˜å›¾è¯­æ³•è™½ç„¶éº»çƒ¦ï¼Œä½†èƒ½å†™å‡ºå¾ˆè§„æ•´çš„ä»£ç ã€‚ é»˜è®¤çš„ç”»å›¾æ¨¡æ¿ä¸å¥½çœ‹ï¼Œæ”¹å–„æ•ˆæœå¾ˆéº»çƒ¦ã€‚  Cartopyï¼š\n ç”»åœ°å›¾çš„å¯è°ƒå‚æ•°æ¯” NCL å°‘ï¼Œéœ€è¦é€šè¿‡ Matplotlib é­”æ”¹ä¸Šå»ã€‚ å®˜æ–¹æ–‡æ¡£ä¿¡æ¯ä¸å…¨ï¼Œç¼ºä¹ä¾‹å­ï¼Œæœ‰é—®é¢˜åªèƒ½é  Stack Overflowã€‚ ç”»å›¾é€Ÿåº¦åæ…¢ã€‚ ç”»ç­‰ç»çº¬åº¦æŠ•å½±çš„æ•ˆæœè¿˜è¡Œï¼Œä½†æ˜¯å¯¹äºå…¶å®ƒæŠ•å½±ç»å¸¸ä¼šæœ‰ bugã€‚ pcolormesh ç­‰æ–¹æ³•ç»˜åˆ¶çš„å›¾åƒåœ¨è·¨è¶Š 0Â° ç»åº¦æ—¶å¸¸å¸¸ä¼šå‡ºé—®é¢˜ã€‚ ä¸ Matplotlib é…åˆè¾ƒå¥½ã€‚  æ€»ä¹‹ï¼Œæˆ‘ç°åœ¨è§‰å¾—ï¼Œé™¤éæ˜¯å¯¹ Python ä¸°å¯Œçš„æ‰©å±•åº“æœ‰éœ€æ±‚çš„è¯ï¼Œå•å°±ç”»ç‚¹ç§‘ç ”ç”¨çš„åœ°å›¾ï¼Œä» NCL è½¬ Python å¹¶æ²¡æœ‰å¤ªå¤§çš„ä¼˜åŠ¿ï¼Œè¿˜ä¼šè®©ä½ é™·å…¥åŒ bug ä½œæˆ˜çš„æ¼©æ¶¡ä¸­ã€‚NCL è¯­è¨€è™½ç„¶å†·é—¨ï¼Œä½†å®ƒä»ä¸Šä¸–çºª90å¹´ä»£å‘å±•è‡³ä»Šï¼Œç‰ˆæœ¬å·å·²ç»è¾¾åˆ° 6.6.2ï¼Œå¤šå¹´ä¸‹æ¥å·²ç»ç´¯è®¡äº†è¶³å¤Ÿå¤šçš„å®ç”¨åŠŸèƒ½ã€‚è™½ç„¶è¿™ä¸€ä¼˜ç§€çš„å·¥å…·åœæ­¢äº†å¼€å‘ï¼Œä½†å®ƒä¾æ—§é€‚ç”¨äºä¸€èˆ¬çš„æ•°æ®å¤„ç†å’Œå¯è§†åŒ–å·¥ä½œã€‚\nä¸è¿‡æŠ€å¤šä¸å‹èº«ï¼Œå­¦ç‚¹ Cartopyï¼Œå°±å½“æ˜¯ç†Ÿæ‚‰ä¸€ä¸‹ Python çš„åŠŸèƒ½å§ã€‚\nç”»å›¾çš„ä¾‹å­ ä¸‹é¢ä¸¾ä¸€ä¸ªè¯»å– NETCDF æ ¼å¼çš„ ERA5 æ–‡ä»¶å¹¶ç”»å›¾çš„ä¾‹å­ã€‚é¦–å…ˆåœ¨ map_funcs.py æ–‡ä»¶é‡Œå®šä¹‰ä¸€äº›å¸¸ç”¨çš„è‡ªå®šä¹‰å‡½æ•°\n#----------------------------------------------------------------------------\r# 2019-09-10\r# ç»˜åˆ¶åœ°å›¾ç”¨çš„å‡½æ•°.\r#----------------------------------------------------------------------------\rimport matplotlib as mpl\rimport cartopy.crs as ccrs\rimport cartopy.feature as cfeature\rfrom cartopy.io.shapereader import Reader\rfrom cartopy.mpl.ticker import LongitudeFormatter, LatitudeFormatter\rdef add_Chinese_provinces(ax, **feature_kw):\r'''\rç»™ä¸€ä¸ªGeoAxesæ·»åŠ ä¸Šä¸­å›½çœç•Œçš„shapefile.\rParameters\r----------\rax : GeoAxes\rè¦æ·»åŠ shapefileçš„åœ°å›¾.\r**feature_kw\rç»˜åˆ¶featureæ—¶çš„Matplotlibå…³é”®è¯å‚æ•°,ä¾‹å¦‚linewidth,facecolor,alphaç­‰.\r'''\rshp_filepath = 'D:/maps/shps/bou2_4p.shp'\rproj = ccrs.PlateCarree()\rreader = Reader(shp_filepath)\rgeometries = reader.geometries()\rprovinces = cfeature.ShapelyFeature(geometries, proj)\rax.add_feature(provinces, **feature_kw)\rdef set_map_extent_and_ticks(\rax, extent, xticks, yticks, nx=0, ny=0,\rxformatter=None, yformatter=None\r):\r'''\rä¸ºçŸ©å½¢æŠ•å½±çš„åœ°å›¾è®¾ç½®extentå’Œticks.\rParameters\r----------\rax : GeoAxes\réœ€è¦è¢«è®¾ç½®çš„åœ°å›¾.æ”¯æŒ_RectangularProjectionå’ŒMercatoræŠ•å½±.\rextent : 4-tuple of float\råœ°å›¾çš„ç»çº¬åº¦èŒƒå›´[lonmin, lonmax, latmin, latmax].\rè‹¥å€¼ä¸ºNone,åˆ™ç»™å‡ºå…¨çƒèŒƒå›´.\rxticks : list of float\rç»åº¦major ticksçš„ä½ç½®.\ryticks : list of float\rçº¬åº¦major ticksçš„ä½ç½®.\rnx : int\rç»åº¦çš„ä¸¤ä¸ªmajor ticksä¹‹é—´minor ticksçš„ä¸ªæ•°.é»˜è®¤æ²¡æœ‰minor ticks.\rå½“ç»åº¦ä¸æ˜¯ç­‰è·åˆ†å¸ƒæ—¶,è¯·ä¸è¦è¿›è¡Œè®¾ç½®.\rny : int\rçº¬åº¦çš„ä¸¤ä¸ªmajor ticksä¹‹é—´minor ticksçš„ä¸ªæ•°.é»˜è®¤æ²¡æœ‰minor ticks.\rå½“çº¬åº¦ä¸æ˜¯ç­‰è·åˆ†å¸ƒæ—¶,è¯·ä¸è¦è¿›è¡Œè®¾ç½®.\rxformatter : LongitudeFormatter\rç»åº¦çš„major ticksçš„formatter.é»˜è®¤ä½¿ç”¨æ— å‚æ•°çš„LongitudeFormatter.\ryformatter : LatitudeFormatter\rçº¬åº¦çš„major ticksçš„formatter.é»˜è®¤ä½¿ç”¨æ— å‚æ•°çš„LatitudeFormatter.\r'''\r# è®¾ç½®ticks.\rproj = ccrs.PlateCarree()\rax.set_xticks(xticks, crs=proj)\rax.set_yticks(yticks, crs=proj)\rif nx \u0026gt; 0:\rxlocator = mpl.ticker.AutoMinorLocator(nx + 1)\rax.xaxis.set_minor_locator(xlocator)\rif ny \u0026gt; 0:\rylocator = mpl.ticker.AutoMinorLocator(ny + 1)\rax.yaxis.set_minor_locator(ylocator)\r# æ·»åŠ ç»çº¬åº¦æ ‡è¯†.\rif xformatter is None:\rxformatter = LongitudeFormatter()\rif yformatter is None:\ryformatter = LatitudeFormatter()\rax.xaxis.set_major_formatter(xformatter)\rax.yaxis.set_major_formatter(yformatter)\r# æœ€åè®¾ç½®extent,é˜²æ­¢ticksè¶…å‡ºextentçš„èŒƒå›´.\rif extent is None:\rax.set_global()\relse:\rax.set_extent(extent, crs=proj)\rdef add_box_on_map(ax, extent, **plot_kw):\r'''\råœ¨çŸ©å½¢æŠ•å½±çš„GeoAxesä¸Šç”»å‡ºä¸€ä¸ªç©ºå¿ƒçš„æ–¹æ¡†.\rParameters\r----------\rax : GeoAxes\rè¢«ç»˜åˆ¶çš„GeoAxes.\rextent : 4-tuple of float\ræ–¹æ¡†çš„ç»çº¬åº¦èŒƒå›´[lonmin, lonmax, latmin, latmax].\r**plot_kw\råˆ©ç”¨plotæ–¹æ³•ç”»æ–¹æ¡†æ—¶çš„å‚æ•°,ä¾‹å¦‚linewidth,colorç­‰.\r'''\rlonmin, lonmax, latmin, latmax = extent\rx = [lonmin, lonmax, lonmax, lonmin, lonmin]\ry = [latmin, latmin, latmax, latmax, latmin]\rax.plot(x, y, transform=ccrs.PlateCarree(), **plot_kw)\r å…¶ä¸­ add_Chinese_provinces å‡½æ•°ç”¨äºåœ¨åœ°å›¾ä¸Šæ·»åŠ ä¸­å›½çœç•Œçš„ shapefileï¼›set_map_extent_and_ticks ç”¨äºè®¾ç½®çŸ©å½¢æŠ•å½±ï¼ˆä¾‹å¦‚ PlateCarreeï¼‰åœ°å›¾çš„æ˜¾ç¤ºèŒƒå›´å’Œåˆ»åº¦ï¼Œä»£ç å‚è€ƒäº† Cartopy å’Œ GeoCAT-viz çš„æºç ã€‚æ¥ç€æ˜¯ä¸»ç¨‹åº\n#-------------------------------------------------------------------------\r# 2019-09-10\r# ç”»å‡ºERA5æ•°æ®åœ¨500hPaé«˜åº¦çš„ç›¸å¯¹æ¹¿åº¦å’Œæ°´å¹³é£åœº.\r#-------------------------------------------------------------------------\rimport numpy as np\rimport xarray as xr\rimport matplotlib as mpl\rimport matplotlib.pyplot as plt\rimport cartopy.crs as ccrs\rfrom map_funcs import add_Chinese_provinces, set_map_extent_and_ticks\rif __name__ == '__main__':\r# è®¾ç½®ç»˜å›¾åŒºåŸŸ.\rlonmin, lonmax = 75, 150\rlatmin, latmax = 15, 60\rextent = [lonmin, lonmax, latmin, latmax]\r# è¯»å–extentåŒºåŸŸå†…çš„æ•°æ®.\rfilename = 't_uv_rh_gp_ERA5.nc'\rwith xr.open_dataset(filename) as ds:\r# ERA5æ–‡ä»¶çš„çº¬åº¦å•è°ƒé€’å‡,æ‰€ä»¥å…ˆåè½¬è¿‡æ¥.\rds = ds.sortby(ds.latitude)\rds = ds.isel(time=0).sel(\rlongitude=slice(lonmin, lonmax),\rlatitude=slice(latmin, latmax),\rlevel=500\r)\rproj = ccrs.PlateCarree()\rfig = plt.figure()\rax = fig.add_subplot(111, projection=proj)\r# æ·»åŠ æµ·å²¸çº¿å’Œä¸­å›½çœç•Œ.\rax.coastlines(resolution='10m', lw=0.3)\radd_Chinese_provinces(ax, lw=0.3, ec='k', fc='none')\r# è®¾ç½®ç»çº¬åº¦åˆ»åº¦.\rset_map_extent_and_ticks(\rax, extent,\rxticks=np.arange(-180, 190, 15),\ryticks=np.arange(-90, 100, 15),\rnx=1, ny=1\r)\rax.tick_params(labelsize='small')\r# ç”»å‡ºç›¸å¯¹æ¹¿åº¦çš„å¡«è‰²å›¾.\rim = ax.contourf(\rds.longitude, ds.latitude, ds.r,\rlevels=np.linspace(0, 100, 11), cmap='RdYlBu_r',\rextend='both', alpha=0.8\r)\rcbar = fig.colorbar(\rim, ax=ax, shrink=0.9, pad=0.1, orientation='horizontal',\rformat=mpl.ticker.PercentFormatter()\r)\rcbar.ax.tick_params(labelsize='small')\r# ç”»å‡ºé£ç®­å¤´.\r# ç›´æ¥ä½¿ç”¨DataArrayä¼šæŠ¥é”™,æ‰€ä»¥è½¬æ¢æˆndarray.\r# regrid_shapeç»™å‡ºåœ°å›¾æœ€çŸ­çš„é‚£ä¸ªç»´åº¦è¦ç”»å‡ºçš„é£ç®­å¤´æ•°.\r# anglesæŒ‡å®šç®­å¤´è§’åº¦çš„ç¡®å®šæ–¹å¼.\r# scale_unitsæŒ‡å®šç®­å¤´é•¿åº¦çš„å•ä½.\r# scaleç»™å‡ºdata units/arrow length unitsçš„å€¼.scaleè¶Šå°,ç®­å¤´è¶Šé•¿.\r# unitsæŒ‡å®šç®­å¤´ç»´åº¦(é•¿åº¦é™¤å¤–)çš„å•ä½.\r# widthç»™å‡ºç®­å¤´shaftçš„å®½åº¦.\rQ = ax.quiver(\rds.longitude.data, ds.latitude.data,\rds.u.data, ds.v.data,\rregrid_shape=20, angles='uv',\rscale_units='xy', scale=12,\runits='xy', width=0.15,\rtransform=proj\r)\r# åœ¨axå³ä¸‹è§’è…¾å‡ºæ”¾quiverkeyçš„ç©ºé—´.\r# zorderéœ€å¤§äº1,ä»¥é¿å…è¢«ä¹‹å‰ç”»è¿‡çš„å†…å®¹é®æŒ¡.\rw, h = 0.12, 0.12\rrect = mpl.patches.Rectangle(\r(1 - w, 0), w, h, transform=ax.transAxes,\rfc='white', ec='k', lw=0.5, zorder=1.1\r)\rax.add_patch(rect)\r# æ·»åŠ quiverkey.\r# UæŒ‡å®šé£ç®­å¤´å¯¹åº”çš„é€Ÿåº¦.\rqk = ax.quiverkey(\rQ, X=1-w/2, Y=0.7*h, U=40,\rlabel=f'{40} m/s', labelpos='S', labelsep=0.05,\rfontproperties={'size': 'x-small'}\r)\rtitle = 'Relative Humidity and Wind at 500 hPa'\rax.set_title(title, fontsize='medium')\rfig.savefig('rh_wnd.png', dpi=200, bbox_inches='tight')\rplt.close(fig)\r è¡¥å……é“¾æ¥ æœ¬æ–‡ä»‹ç»çš„åªæ˜¯ Cartopy çš„æœ€ç®€å•çš„åŠŸèƒ½ï¼Œè¿˜æœ‰è¯¸å¦‚è¯»å– shapefileã€åœ°å›¾ maskã€ä½¿ç”¨ç½‘ç»œåœ°å›¾ç­‰åŠŸèƒ½éƒ½æ²¡æœ‰ä»‹ç»ï¼ˆå› ä¸ºæˆ‘ä¹Ÿæ²¡ç”¨åˆ°è¿‡â€¦â€¦ï¼‰ã€‚ä¸‹é¢è¡¥å……ä¸€äº›å¯èƒ½æœ‰å¸®åŠ©çš„é“¾æ¥\n  ä¸€ä¸ªåœ°çƒä¸ç¯å¢ƒæ•°æ®ç§‘å­¦çš„æ•™ç¨‹ï¼šMaking Maps with Cartopy\n  äº‘å°ä¹¦ä½¿çš„ç»˜å›¾æ•™ç¨‹ï¼Œå†…å®¹éå¸¸å…¨é¢ï¼Œå«æœ‰åœ°å›¾è£å‰ªç­‰é«˜çº§å†…å®¹ï¼šPythonæ°”è±¡ç»˜å›¾æ•™ç¨‹\n  Unidata ç»™å‡ºçš„ä¾‹å­ï¼šUnidata Example Gallery\n  GeoCAT ç»™å‡ºçš„ä»¿ NCL çš„ä¾‹å­ï¼šGeoCAT-examples\n  Cartopy å¼€å‘æˆå‘˜å¯¹äºæ•°æ®è·¨è¶Šè¾¹ç•Œæ—¶çš„è§£è¯´ï¼špreventing spurious horizontal lines for ungridded pcolor(mesh) data\n  è°ˆåˆ°äº†å¦‚ä½•é‡å¤åˆ©ç”¨åº•å›¾çš„æ–¹æ³•ï¼š(ç­†è¨˜) pythonçš„cartopyä½¿ç”¨ã€æ¸…é™¤å·²ç•«çš„è³‡æ–™æ–¹æ³•\n ","date":"2021-03-23","permalink":"https://zhajiman.github.io/post/cartopy_introduction/","tags":["cartopy","matplotlib"],"title":"Cartopy ç³»åˆ—ï¼šä»å…¥é—¨åˆ°æ”¾å¼ƒ"},{"content":"ç°å®ä¸­è§‚æµ‹çš„æ•°æ®æˆ–å¤šæˆ–å°‘ä¼šæœ‰ç¼ºå¤±çš„éƒ¨åˆ†ï¼Œé€šå¸¸ç§°ä¸ºç¼ºæµ‹å€¼ï¼ˆmissing valueï¼‰ã€‚NumPy å› ä¸ºè®¾è®¡ä¸Šçš„é—®é¢˜ï¼Œä¸èƒ½åƒ R å’Œ NCL é‚£æ ·åŸç”Ÿæ”¯æŒç¼ºæµ‹ç±»å‹ï¼Œè€Œæ˜¯æœ‰ä¸¤ç§å¤„ç†ç¼ºæµ‹çš„å®ç°ï¼šNaN å’Œ masked arrayã€‚ä¸‹é¢ä¾¿æ¥ä¾æ¬¡ä»‹ç»å®ƒä»¬ã€‚ä»£ç åŸºäº NumPy 1.20.1ã€‚\nNaN NaNï¼ˆnot a numberï¼‰ç”± IEEE 754 æµ®ç‚¹æ•°æ ‡å‡†é¦–æ¬¡å¼•å…¥ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµ®ç‚¹æ•°ï¼Œç”¨äºè¡¨ç¤ºæœªå®šä¹‰æˆ–ä¸å¯è¡¨ç¤ºçš„å€¼ï¼ˆå³ç¼ºæµ‹ï¼‰ã€‚NaN çš„ä½æ¨¡å¼ï¼ˆbitpatternï¼‰æ˜¯ç¬¦å·ä½ä»»æ„ï¼Œé˜¶ç å…¨ä¸º 1ï¼Œå°¾æ•°æœ€é«˜ä½è¡¨ç¤º NaN ç±»å‹ï¼Œå°¾æ•°å‰©ä½™çš„ä½ä¸å…¨ä¸º 0ã€‚ä½œä¸ºå¯¹æ¯”ï¼Œæ— ç©·å¤§çš„ä½æ¨¡å¼æ˜¯ï¼Œç¬¦å·ä½å†³å®šæ— ç©·çš„æ­£è´Ÿï¼Œé˜¶ç å…¨ä¸º 1ï¼Œå°¾æ•°å…¨ä¸º 0ã€‚\nNumPy ä¸­ç”¨ np.nan è¡¨ç¤ºä¸€ä¸ª NaNï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•°ç»„ä¸­çš„å…ƒç´ èµ‹å€¼ä¸º np.nanï¼Œä»¥è¡¨ç¤ºè¯¥å…ƒç´ ç¼ºæµ‹ã€‚NaN çš„ç‰¹æ€§å¦‚ä¸‹\n NaN æ˜¯ä¸€ç§ç‰¹æ®Šçš„æµ®ç‚¹æ•°ï¼Œå®ƒå¯ä»¥æ˜¯ float32 æˆ– float64ï¼Œä½†æ˜¯é€šå¸¸æ²¡æœ‰å…¶å®ƒç±»å‹çš„ NaNã€‚æ‰€ä»¥ä¸è¦å°è¯•ç»™æ•´æ•°ç±»å‹çš„æ•°ç»„å…ƒç´ èµ‹å€¼ä¸º NaNï¼Œä¸ç„¶ä¼šå‘ç”Ÿç±»å‹é”™è¯¯ã€‚ å½“ NaN è¿›è¡ŒåŠ å‡ä¹˜é™¤æ—¶ï¼Œç»“æœä¹Ÿä¼šå˜ä¸º NaNã€‚å½“ NaN å‚ä¸æ¯”è¾ƒå¤§å°æ—¶ï¼Œç»“æœæ€»æ˜¯ Falseã€‚ ç”±äº NaN çš„ä½æ¨¡å¼çš„ä»»æ„æ€§ï¼Œä¸€èˆ¬æ¥è¯´ np.nan == np.nan çš„ç»“æœä¸º Falseã€‚è¦åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰ NaN çš„è¯ï¼Œæœ‰ä¸“é—¨çš„å‡½æ•° np.isnan æ¥è¿›è¡Œåˆ¤æ–­ã€‚ å½“æŠŠæ•°ç»„ä¸­çš„å…ƒç´ èµ‹å€¼ä¸º NaN æ—¶ï¼Œä¼šç›´æ¥è¦†ç›–æ‰è¯¥å…ƒç´ åŸæœ‰çš„å€¼ã€‚  ä¸€èˆ¬æˆ‘ä»¬å¾—åˆ°çš„åŸå§‹æ•°æ®ä¸­çš„ç¼ºæµ‹å€¼ä¸ä¼šç›´æ¥ç”¨ NaN è¡¨ç¤ºï¼Œè€Œæ˜¯ä¼šç”¨äººä¸ºç»™å®šçš„å¡«å……å€¼ï¼ˆfill valueï¼‰è¡¨ç¤ºï¼Œä¾‹å¦‚ç”¨ -9999 æŒ‡ç¤ºæŸä¸ªæ•°æ®ç¼ºæµ‹ã€‚åœ¨è¯»å–ä¸º ndarray åï¼Œä¸ºäº†é¿å…è¿™äº› -9999 å‚ä¸è®¡ç®—ï¼Œéœ€è¦æŠŠå®ƒä»¬èµ‹å€¼ä¸º NaNï¼Œæ­¤æ—¶å¯ä»¥ç”¨ np.isclose å‡½æ•°æ¥ç­›é€‰å‡ºå¡«å……å€¼\nfill_value = -9999.0\rmask = np.isclose(data, fill_value)\rdata[mask] = np.nan\r æœ‰æ—¶æˆ‘ä»¬éœ€è¦åˆ©ç”¨æ•°æ®ä¸­å‰©ä¸‹çš„æœ‰æ•ˆæ•°æ®è¿›è¡Œè®¡ç®—ï¼Œé‚£ä¹ˆä¾¿éœ€è¦å¿½ç•¥ï¼ˆignoreï¼‰è¿™äº›ç¼ºæµ‹å€¼ã€‚å®ç°æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯åˆ©ç”¨np.isnanå‡½æ•°ç­›é€‰å‡ºæœ‰æ•ˆå€¼å†è¿›è¡Œè®¡ç®—\ndata_valid = data[~np.isnan(data)]\rmean_value = np.mean(data_valid)\r äºŒæ˜¯ä½¿ç”¨ä¸€äº›ä¼šè‡ªåŠ¨è·³è¿‡ NaN çš„ç‰¹æ®Šå‡½æ•°\nmean_value = np.nanmean(data)\rstd_value = np.nanstd(data)\r å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™æ ·çš„å‡½æ•°ä»¥ \u0026ldquo;nan\u0026rdquo; ä½œä¸ºå‰ç¼€ï¼Œå¯æƒœè¿™ç§å‡½æ•°ä¸è¿‡åæ¥ä¸ªã€‚å¹¶ä¸”å½“æ•°ç»„å…ƒç´ ï¼ˆæ²¿æŸä¸€ç»´åº¦ï¼‰å…¨ä¸º NaN æ—¶ï¼Œè¿™äº›å‡½æ•°çš„è¡Œä¸ºè¿˜ä¼šæœ‰æ‰€ä¸åŒ\n nanargmin å’Œ nanargmax ä¼šç›´æ¥æŠ¥é”™ã€‚ nansumã€nancumsumã€nanprod å’Œ nancumprod ä¼šå°† NaN æ›¿æ¢ä¸º 0 æˆ– 1ï¼Œå†è®¡ç®—å‡ºæœ‰æ„ä¹‰çš„ç»“æœã€‚ å…¶å®ƒå‡½æ•°ä¼šæŠ¥è­¦ï¼ˆç©ºåˆ‡ç‰‡ã€å…¨ NaNã€è‡ªç”±åº¦å°äº 0ï¼‰ï¼Œå¹¶è¿”å› NaNã€‚  æ‰€ä»¥éœ€è¦å°å¿ƒå…¨ä¸º NaN çš„æƒ…å†µã€‚\nNumPy çš„æ™®é€šå‡½æ•°æ¥å—å« NaN çš„æ•°ç»„æ—¶ï¼Œæ•ˆæœäº”èŠ±å…«é—¨ï¼šæœ‰çš„ä¼šæŠ¥é”™ï¼Œæœ‰çš„ä¼šè¿”å› NaNï¼Œæœ‰çš„ä¼šè¿”å›æ­£ç¡®çš„ç»“æœï¼Œæœ‰çš„ä¼šè¿”å›é”™è¯¯çš„ç»“æœã€‚æ­¤å¤–ï¼Œæœ‰äº› SciPy çš„å‡½æ•°èƒ½å¤Ÿé€šè¿‡ nan_policy å‚æ•°æŒ‡å®šå¦‚ä½•å¯¹å¾… NaNã€‚æ€»ä¹‹ï¼Œä½¿ç”¨ NaN æ—¶è¦å¤šåŠ å°å¿ƒã€‚\nMasked Array NumPy ä¸­å¯¹ç¼ºæµ‹å€¼è¿˜æœ‰å¦ä¸€ç§å®ç°â€”â€”masked arrayã€‚æ€è·¯æ˜¯åˆ›å»ºä¸€ä¸ªå’Œ data æ•°ç»„åŒæ ·å½¢çŠ¶çš„å¸ƒå°”ç±»å‹ mask æ•°ç»„ï¼Œä¸¤ä¸ªæ•°ç»„çš„å…ƒç´ ä¸€ä¸€å¯¹åº”ã€‚è‹¥ mask æ•°ç»„ä¸­æŸä¸ªä½ç½®çš„å…ƒç´ å€¼ä¸º Trueï¼Œé‚£ä¹ˆ data æ•°ç»„ä¸­å¯¹åº”çš„å…ƒç´ åˆ™è¢«åˆ¤å®šä¸º maskedï¼ˆå³ç¼ºæµ‹ï¼‰ï¼›è‹¥å€¼ä¸º Falseï¼Œåˆ™ data æ•°ç»„å¯¹åº”çš„å…ƒç´ åˆ¤å®šä¸ºæœ‰æ•ˆã€‚\nData æ•°ç»„å’Œ mask æ•°ç»„æ‰“åŒ…è€Œæˆçš„å¯¹è±¡å°±ç§°ä½œ masked arrayï¼Œå±äº ndarray çš„å­ç±»ï¼Œç»§æ‰¿äº†è®¸å¤š ndarray çš„æ–¹æ³•ã€‚NumPy ä¸­çš„ ma æ¨¡å—æä¾›äº†åˆ›å»ºå’Œæ“ä½œ masked array çš„åŠŸèƒ½ã€‚\nmasked array çš„ç‰¹æ€§å¦‚ä¸‹\n å¯¹æ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”å‹æ•°ç»„éƒ½é€‚ç”¨ï¼Œå› ä¸º mask æ•°ç»„å¹¶ä¸ä¾èµ–äº NaN çš„ä½æ¨¡å¼ã€‚ ç¼ºæµ‹çš„å…ƒç´ è¿›è¡ŒåŠ å‡ä¹˜é™¤å’Œæ¯”è¾ƒå¤§å°æ—¶ï¼Œç»“æœä¹Ÿä¼šå˜æˆç¼ºæµ‹ã€‚ ä¸ä¿è¯ç¼ºæµ‹å…ƒç´ çš„åŸå§‹å€¼åœ¨ç»è¿‡å¤æ‚è®¡ç®—åä¾ç„¶ä¿ç•™ã€‚ èƒ½å¤Ÿè®°å½•ç»™å®šçš„å¡«å……å€¼ã€‚ ma æ¨¡å—æä¾›å¤§é‡èƒ½å¤Ÿå¿½ç•¥ç¼ºæµ‹å€¼çš„è®¡ç®—å‡½æ•°ï¼Œmasked array å¯¹è±¡ä¹Ÿå¸¦æœ‰è®¸å¤šæ–¹æ³•ã€‚  ä¸‹é¢ä»‹ç»ä½¿ç”¨ masked array çš„åŸºæœ¬æ–¹æ³•\nimport numpy.ma as ma\r# ç›´æ¥ç»™å‡ºåŸå§‹æ•°ç»„å’Œmaskæ¥åˆ›å»ºmasked array\rx = ma.array([1, 2, 3], mask=[True, False, False])\r# è¿”å›åŸå§‹æ•°ç»„\rx.data\r# è¿”å›maskæ•°ç»„\rx.mask\r# æŒ‡å®šå¡«å……å€¼\rx.fill_value = -9999\r# æŠŠdataä¸­æ•°å€¼ç­‰äºfill_valueçš„å…ƒç´ è®¾ä¸ºmaskedçŠ¶æ€,å¹¶æŒ‡å®šå¡«å……å€¼ä¸ºfill_value\rx = ma.masked_equal(data, fill_value)\r# åŒä¸Š,ä½†æ˜¯å†…éƒ¨ä½¿ç”¨äº†np.iscloseæ–¹æ³•,æ›´é€‚ç”¨äºæµ®ç‚¹æ•°\rx = ma.masked_values(data, fill_value)\r# æŠŠdataä¸­æ•°å€¼å¤§äº/å°äº(ç­‰äº)fill_valueçš„å…ƒç´ è®¾ä¸ºmaskedçŠ¶æ€\r# å¡«å……å€¼ä¼šè¢«è®¾å®šä¸ºé»˜è®¤å€¼\rx = ma.masked_greater(data, value)\rx = ma.masked_greater_equal(data, value)\rx = ma.masked_less(data, value)\rx = ma.masked_less_equal(data, value)\r# ç”¨æ¡ä»¶å¼å†³å®šæ˜¯å¦masked\r# å¡«å……å€¼ä¼šè¢«è®¾å®šä¸ºé»˜è®¤å€¼\rx = ma.masked_where(data \u0026gt; 0, data)\r# æŠŠNaNå’Œinfçš„å…ƒç´ maskæ‰\rx = ma.masked_invalid(data)\r# ç»Ÿè®¡æœ‰æ•ˆå€¼çš„ä¸ªæ•°\rn = x.count()\r# ä½¿ç”¨å¿½ç•¥ç¼ºæµ‹å€¼çš„å‡½æ•°å’Œæ–¹æ³•\rmean_value = ma.mean(x)\rmean_value = x.mean()\rcos_value = ma.cos(x)\r# ä»masked arrayä¸­æå–å‡ºæœ‰æ•ˆå€¼,è¿”å›ä¸€ç»´çš„ndarray\rx_valid = x[~x.mask]\rx_valid = x.compressed()\r# è®¾å®šfill_value\rx.fill_value = 0\r# å¡«å……ç¼ºæµ‹å€¼,è¿”å›ndarray,é»˜è®¤ä½¿ç”¨fill_valueå±æ€§å¡«å……\ry = x.filled()\r Masked array æ¯”è¾ƒå¤§å°åå¾—åˆ°çš„å¸ƒå°”æ•°ç»„ä¾æ—§æ˜¯ masked arrayï¼Œå¹¶ä¸”å¯èƒ½å«æœ‰ç¼ºæµ‹éƒ¨åˆ†ï¼Œå¦‚æœå†ç”¨è¿™ä¸ªå¸ƒå°”æ•°ç»„å»ç´¢å¼• masked arrayï¼Œé‚£ä¹ˆç»“æœé‡Œä¹Ÿä¼šå«æœ‰ç¼ºæµ‹éƒ¨åˆ†ï¼Œæ­¤æ—¶åªè¦å†ä½¿ç”¨ compressed æ–¹æ³•ï¼Œå°±èƒ½å¾—åˆ°çœŸæ­£ä¸å«ç¼ºæµ‹çš„æœ‰æ•ˆå€¼ã€‚ä¾‹å¦‚\n# x: [1, 2, -]\rx = ma.array([1, 2, 3], mask=[False, False, True])\r# cond: [False, True, -]\rcond = x \u0026gt;= 2\r# x_valid: [2, -]\rx_valid = x[cond]\r# x_valid_true: [2]\rx_valid_true = x.compressed()\r ä¸‹é¢å†æ¥è®²è®²å¦‚ä½•ä¿®æ”¹ maskã€‚é¦–å…ˆå¯ä»¥ç›´æ¥ä¿®æ”¹ mask æ•°ç»„çš„æ•°å€¼ã€‚åˆæˆ–è€…ï¼Œå¯ä»¥ç”¨æ¨¡å—ä¸­çš„ ma.masked æ¥è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥è®¾ç½®å…ƒç´ ç¼ºæµ‹çŠ¶æ€çš„å¸¸é‡\n# æŠŠç¬¬ä¸€ä¸ªå…ƒç´ è®¾ä¸º masked\rx[0] = ma.masked\r# å…¨éƒ¨è®¾ä¸ºç¼ºæµ‹\rx[:] = ma.masked\r éœ€è¦æ³¨æ„ï¼Œæ¨¡å—ä¸­è¿˜å­˜åœ¨ä¸€ä¸ª ma.nomask é‡ï¼Œä½†å®ƒæœ¬è´¨ä¸Šæ˜¯å¸ƒå°”ç±»å‹çš„ Falseï¼Œæ‰€ä»¥ä¸è¦ç”¨å®ƒæ¥åšä¸Šé¢çš„æ“ä½œï¼Œå¦åˆ™ä¼šå¯¼è‡´å…ƒç´ çš„æ•°å€¼ç›´æ¥å˜ä¸º 0ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥ç»™å¤„äº masked çŠ¶æ€çš„å…ƒç´ èµ‹å€¼ï¼Œè¿™æ ·ä¼šè®©å…ƒç´ ä¸å†ç¼ºæµ‹ï¼Œä½†å¦‚æœ masked array çš„ hard_mask å‚æ•°ä¸º True çš„è¯ï¼ˆé»˜è®¤ä¸º Falseï¼‰ï¼Œä¼šæ‹’ç»è¿™æ ·çš„ç›´æ¥æ”¹å†™ã€‚ä¸ªäººè§‰å¾—æœ€å¥½ä¸è¦è¿™æ ·ç›´æ¥æ”¹å†™ï¼Œæ‰€ä»¥å¯¹æ­¤æœ‰éœ€æ±‚çš„è¯»è€…å¯ä»¥å‚è€ƒ NumPy æ–‡æ¡£çš„è¯´æ˜ã€‚\nç±»ä¼¼äº NaN ä¸€èŠ‚çš„è®¨è®ºï¼Œè‹¥ masked arrayï¼ˆæ²¿æŸä¸€ç»´åº¦ï¼‰å…¨éƒ¨ç¼ºæµ‹æ—¶ï¼Œç”¨äº masked array çš„å‡½æ•°å’Œæ–¹æ³•å‡èƒ½ç›´æ¥è¿”å›ç¼ºæµ‹ï¼Œè€Œä¸ä¼šå¼¹å‡ºä¹±ä¸ƒå…«ç³Ÿçš„æŠ¥é”™å’Œè­¦å‘Šï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒç¬¦åˆç›´è§‰ã€‚å¯ä»¥çœ‹å‡º masked array å¯¹äºå…¨éƒ¨ç¼ºæµ‹çš„æƒ…å†µæ›´ä¸ºå®½å®¹ä¸€äº›ã€‚\nå¦‚æœä½¿ç”¨ NumPy çš„æ™®é€šå‡½æ•°æ¥æ“ä½œ masked array çš„è¯ï¼Œç»å¸¸æ— æ³•æ­£ç¡®å¤„ç†ç¼ºæµ‹å€¼ï¼Œå¹¶ä¸”ä¼šè¿”å› ndarray å¯¹è±¡ã€‚æ‰€ä»¥ ma æ¨¡å—æä¾›äº†å¾ˆå¤šåŒåçš„ä½†é€‚ç”¨äº masked array çš„å‡½æ•°ï¼Œä¾‹å¦‚ concatenateã€hstackã€vstackã€where ç­‰ã€‚æ­¤å¤– SciPy ä¸­è¿˜å­˜åœ¨ä¸€ä¸ª stats.mstats æ¨¡å—ï¼Œä¸“é—¨æä¾›å¤„ç† masked array çš„ç»Ÿè®¡å‡½æ•°ã€‚\nä¸¤ç§æ–¹æ³•çš„å¯¹æ¯” é¦–å…ˆæŒ‡å‡º masked array ç›¸æ¯” NaN æ–¹æ³•çš„ä¼˜åŠ¿\n æŠŠæ•°æ®ã€ç¼ºæµ‹å€¼ä½ç½®ï¼Œå’Œå¡«å……å€¼æ‰“åŒ…åˆ°äº†ä¸€èµ·ï¼Œå½“æ•°ç»„ç‰¹åˆ«å¤šæ—¶ï¼Œæ›´åŠ æ˜“äºç®¡ç†ã€‚ å¯¹äºæ•´å‹æ•°ç»„å’Œå¸ƒå°”æ•°ç»„ä¹Ÿèƒ½ä½¿ç”¨ã€‚ ç”¨äºå¤„ç† masked array çš„å‡½æ•°è¿œå¤šäºå¤„ç† NaN çš„å‡½æ•°ã€‚ å¯¹äºå…¨éƒ¨ç¼ºæµ‹çš„æƒ…å†µæ›´ä¸ºå®½å®¹ã€‚  ä½†æ˜¯ masked array çš„ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„\n å¤šé™„å¸¦äº†ä¸€ä¸ªå¸ƒå°”æ•°ç»„ï¼Œå¢åŠ äº†å†…å­˜çš„æ¶ˆè€—ã€‚ è®¡ç®—ä¸Šå¯èƒ½ä¼šæ›´æ…¢ã€‚  ä¸‹é¢å°±ä¸¾ä¸€ä¸ªæµ‹è¯•è®¡ç®—é€Ÿåº¦çš„ä¾‹å­\nimport numpy as np\rimport numpy.ma as ma\rx = np.random.rand(1000, 1000)\rflag = np.random.randint(0, 2, (1000, 1000))\r# è®¾ç½®NaNæ•°ç»„\rx_nan = x.copy()\rx_nan[flag] = np.nan\r# è®¾ç½®masked array\rx_mask = ma.array(x, mask=flag)\r æ¥ç€ç”¨ IPython çš„å‘½ä»¤è¿›è¡Œæµ‹è¯•\nå¯ä»¥çœ‹åˆ°è®¡ç®—é€Ÿåº¦æ…¢ä¸Š 6 å€ä¹‹å¤šã€‚ä¸è¿‡æœ‰ä¸€è¯´ä¸€ï¼Œæˆ‘åœ¨ä½¿ç”¨è¿‡ç¨‹ä¹Ÿç¢°åˆ°è¿‡ masked array åè€Œæ›´å¿«çš„æƒ…å†µã€‚æ‰€ä»¥åˆ°åº•é€‰æ‹©å“ªä¸€ç§å®ç°ï¼Œè¿˜å¾—ç”±å…·ä½“åœºæ™¯ã€æµ‹è¯•ç»“æœï¼Œä»¥åŠè‡ªå·±çš„ä½¿ç”¨ä¹ æƒ¯æ¥å†³å®šã€‚\nè¿˜æœ‰åˆ«çš„å¤„ç†æ–¹å¼å—ï¼Ÿ Pandas å’Œ xarray éƒ½é‡‡ç”¨äº† NaN çš„å®ç°æ–¹å¼ï¼Œå…¶å¯¹è±¡çš„è®¸å¤šæ–¹æ³•éƒ½é»˜è®¤å¼€å¯è·³è¿‡ NaN çš„ skipna çš„é€‰é¡¹ã€‚å…¶ä¸­ pandas ä» 1.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå®éªŒæ€§åœ°å¢åŠ äº†ç±»ä¼¼äº masked array çš„å®ç°â€”â€”pd.NAï¼Œä½¿æµ®ç‚¹å‹ä»¥å¤–çš„æ•°æ®ç±»å‹ä¹Ÿèƒ½ç”¨ä¸Šç¼ºæµ‹å€¼ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥å»è¯•è¯•ã€‚\nMatplotlib ä¸­çš„ç¼ºæµ‹å€¼ å¦‚æœæ˜¯ä½¿ç”¨ç®€å•çš„ plt.plot å‡½æ•°ï¼ŒNaN æˆ–è€… masked value çš„ç‚¹ä¼šè¢«è®¤ä¸ºæ•°æ®åœ¨é‚£é‡Œæ–­å¼€äº†ï¼Œæ•ˆæœå¦‚ä¸‹å›¾\nä¸è¿‡ plt.bar ä¼šäº§ç”Ÿè­¦å‘Šï¼Œå¹¶æŠŠ masked value è½¬æ¢ä¸º nanã€‚\nå¯¹äº plt.imshowã€plt.pcolorï¼Œå’Œ plt.pcolormeshï¼Œå®ƒä»¬ç»˜åˆ¶çš„æ˜¯è‰²å—ï¼ŒNaN æˆ–è€… masked value æ‰€åœ¨çš„è‰²å—é»˜è®¤ä¸ºé€æ˜çš„ã€‚å¦‚æœè¦ç”¨é¢œè‰²æŒ‡ç¤ºå‡ºç¼ºæµ‹å€¼ï¼Œéœ€è¦è°ƒæ•´ colormap çš„è®¾ç½®\nimport copy\r# ä½¿ç”¨copyä»¥å…å½±å“å…¨å±€çš„colormap\rcmap = copy.copy(plt.cm.viridis)\r# è®¾ç½®ç¼ºæµ‹å€¼çš„é¢œè‰²å’Œé€æ˜åº¦\rcmap.set_bad('gray', 1.0)\r ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç¼ºæµ‹å€¼çš„é¢œè‰²è¢«è®¾å®šæˆè“è‰²\nä»¥ä¸Šä¸¤ä¸ªä¾‹å­éƒ½æ¥è‡ª Matplotlib å®˜ç½‘ï¼Œä»£ç è§æ–‡æœ«çš„å‚è€ƒé“¾æ¥ã€‚\nè€Œå¯¹äºå¡«è‰²å›¾ plt.contourfï¼Œç¼ºæµ‹å€¼åŒºåŸŸä¸ä¼šè¢«ç”»å‡ºï¼Œä¼šç›´æ¥éœ²å‡º axes çš„èƒŒæ™¯è‰²ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¿®æ”¹èƒŒæ™¯è‰²æ¥è¡¨ç¤ºç¼ºæµ‹çš„é¢œè‰²ã€‚èŠèƒœäºæ— çš„æ˜¯ï¼Œè¿˜å¯ä»¥é€šè¿‡ corner_mask å‚æ•°æŒ‡å®šç¼ºæµ‹åŒºåŸŸçš„è¾¹è§’ç”»æ³•ã€‚ä¸è¿‡ä¸€èˆ¬è¿˜æ˜¯å»ºè®®ç»è¿‡æ’å€¼ç­‰å¡«è¡¥å¤„ç†åå†æ¥ç”»å¡«è‰²å›¾å§ã€‚\nå‚è€ƒé“¾æ¥ NumPy çš„æ–‡æ¡£å’Œä¸€äº›æ–‡ç« \nThe numpy.ma module\nNEP 12 â€” Missing Data Functionality in NumPy\nNEP 26 â€” Summary of Missing Data NEPs and discussion\npandas çš„æ–‡æ¡£\nWorking with missing data\nWiki å’Œ stack overflow ä¸Šçš„è®¨è®º\nNaN Wikipedia\nWhy are Numpy masked arrays useful?\nMatplotlib çš„ç¼ºæµ‹\nPlotting masked and NaN values\nImage Masked\nContour Demo\n","date":"2020-07-13","permalink":"https://zhajiman.github.io/post/numpy_missing_value/","tags":["numpy"],"title":"NumPy ç³»åˆ—ï¼šç¼ºæµ‹å€¼å¤„ç†"},{"content":"è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ç«‹ä½“è§’çš„æ¦‚å¿µã€‚\nå®šä¹‰ åœ¨è€ƒè™‘è¾å°„ä¼ è¾“é—®é¢˜æ—¶ï¼Œä¸ºäº†åº¦é‡æºç‚¹å¯¹æŸä¸€èŒƒå›´çš„è§†åœºè§’å¤§å°ï¼Œæˆ‘ä»¬å¼•å…¥ç«‹ä½“è§’çš„æ¦‚å¿µã€‚é€šå¸¸æ•™æä¸Šçš„å®šä¹‰å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€ä¸ªåŠå¾„ä¸º $r$ çš„çƒä½“ï¼Œç”¨é¡¶ç‚¹ä¸çƒå¿ƒé‡åˆçš„åœ†é”¥å»æˆªçƒé¢ï¼Œæˆªå–çš„çƒé¢ç§¯ $A$ çš„å¤§å°é™¤ä»¥åŠå¾„çš„å¹³æ–¹ï¼Œå³æ˜¯ç«‹ä½“è§’ã€‚\nå…¬å¼ä¸º $$ \\Omega = \\frac{A}{r^2} $$ ç«‹ä½“è§’çš„å•ä½æ˜¯æ— é‡çº²çš„çƒé¢åº¦ï¼ˆsteradianï¼‰ï¼Œç®€å†™ä¸º srã€‚å®é™…ä¸Šï¼Œé™¤äº†ç”¨åœ†é”¥ï¼Œä½ ç”¨ä»»ä½•å‡ ä½•ä½“å»æˆªéƒ½è¡Œï¼Œåªè¦èƒ½åœ¨çƒé¢ä¸Šåˆ’åˆ†ä¸€å—è¿ç»­çš„åŒºåŸŸï¼Œå…¶é¢ç§¯ä¸º $A$ï¼Œé‚£ä¹ˆä¾¿å¯ä»¥é€šè¿‡ä¸Šé¢çš„å®šä¹‰å¼è®¡ç®—å‡ºå…¶ç«‹ä½“è§’ã€‚\nå…³é”®åœ¨äºï¼Œç«‹ä½“è§’çš„æœ¬è´¨æ˜¯ä¸€æ®µå°é—­æ›²çº¿å¯¹äºè§‚å¯Ÿç‚¹æ‰€å¼ å¼€çš„è§’åº¦ï¼Œåªæœ‰è¿™ä¸ªè§’åº¦æ˜¯é‡è¦çš„ï¼Œæ¯•ç«Ÿæˆ‘ä»¬å¼•å…¥ç«‹ä½“è§’å°±æ˜¯ä¸ºäº†è·å¾—è¿™ä¸ªè§†åœºè§’ã€‚è€Œå°é—­æ›²çº¿å›´æˆçš„æ›²é¢å…·ä½“æ˜¯ä»€ä¹ˆå½¢çŠ¶ï¼Œå…¶å®å¹¶ä¸é‡è¦ã€‚å°±å¦‚åŒä¸‹å›¾æ‰€ç¤ºã€‚\näºæ˜¯ï¼Œä¸ºäº†ä»çƒé¢ç«‹ä½“è§’çš„å®šä¹‰å¼å‡ºå‘è®¡ç®—ä»»æ„æ›²é¢çš„ç«‹ä½“è§’ï¼ŒæŠŠæ›²é¢çš„é¢å¾®å…ƒéƒ½æŠ•å½±åˆ°ä»¥çŸ¢å¾„ä¸ºåŠå¾„çš„çƒé¢ä¸Šï¼ŒæŠ•å½±é¢ç§¯é™¤ä»¥çŸ¢å¾„é•¿åº¦çš„å¹³æ–¹åï¼Œå†åšé¢ç§¯åˆ†ï¼Œå¼å­ä¸º $$ \\Omega = \\iint_S \\frac{\\vec{e_r} \\cdot d\\vec{S}}{r^2} $$ å…¶ä¸­ $r$ ä¸ºè§‚å¯Ÿç‚¹åˆ°æ›²é¢ä¸Šä¸€ç‚¹çš„è·ç¦»ï¼Œ$\\vec{e_r}$ ä¸ºçŸ¢å¾„ $\\vec{r}$ çš„å•ä½çŸ¢é‡ï¼Œ$d\\vec{S}$ ä¸ºæ›²é¢ $S$ ä¸Šæ³•å‘çš„å¾®å…ƒé¢ç§¯ï¼Œ$\\vec{e_r} \\cdot d\\vec{S}$ å³æ„å‘³ç€æŠŠé¢ç§¯å¾®å…ƒæŠ•å½±åˆ°çƒé¢ä¸Šï¼Œäºæ˜¯æ ¹æ®çƒé¢çš„é¢ç§¯å¾®å…ƒè¡¨è¾¾å¼ï¼Œå¾—åˆ°ç«‹ä½“è§’çš„å¾®å…ƒè¡¨è¾¾å¼ $$ d\\Omega = \\frac{\\vec{e_r} \\cdot d\\vec{S}}{r^2} = \\frac{dS_0}{r^2} = \\frac{r^2 sin\\theta d\\theta d\\varphi}{r^2} = sin\\theta d\\theta d\\varphi $$ å…¶ä¸­ $\\theta$ ä¸ºå¤©é¡¶è§’ï¼Œ$\\varphi$ ä¸ºæ–¹ä½è§’ã€‚ä»è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥çœ‹å‡ºï¼Œç«‹ä½“è§’çš„å¤§å°ä¸ $r$ æ— å…³ï¼Œè€Œåªä¸æ›²é¢å¼ æˆçš„è§’åº¦ï¼ˆå³ $\\theta$ å’Œ $\\varphi$ çš„èŒƒå›´ï¼‰æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»™å®šä¸€ä¸ªè§’åº¦å¼ æˆçš„é”¥ä½“ï¼Œå…¶ä¸­æˆªå–çš„ä»»æ„å½¢çŠ¶ã€ä»»æ„è·ç¦»çš„æ›²é¢çš„ç©ºé—´è§’éƒ½ç›¸ç­‰ã€‚è‹¥è§‚å¯Ÿç‚¹è¢«å°é—­æ›²é¢åŒ…å›´ï¼Œå¯¹å…¨ç©ºé—´ç§¯åˆ†ï¼Œå¾ˆå®¹æ˜“å¾—åˆ° $$ \\Omega = \\iint d\\Omega = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} sin\\theta d\\theta d\\varphi = 4\\pi $$ å³å°é—­æ›²é¢å†…ä»»ä¸€ç‚¹æ‰€å¼ æˆçš„ç«‹ä½“è§’çš„å¤§å°ä¸º $4\\pi$ã€‚è¿™ä¸€ç»“æœè¿˜å¯ä»¥ä»çƒé¢çš„ä¾‹å­æ¥éªŒè¯ï¼Œçƒé¢é¢ç§¯ä¸º $4\\pi r^2$ï¼Œé™¤ä»¥ $r^2$ åå¾—çƒå¿ƒå¤„çš„ç«‹ä½“è§’ä¸º $4\\pi$ã€‚\næœ‰è¿™æ ·çš„å¯èƒ½ï¼Œæ›²é¢å¯¹äº $\\vec{r}$ æ¥è¯´ä¸æ˜¯å•å€¼çš„ï¼Œå³æ›²é¢åœ¨ç©ºé—´ä¸­ç»•æ¥ç»•å»å‘ç”Ÿäº†é‡å ã€‚æ­¤æ—¶ç«‹ä½“è§’çš„å…¬å¼ä¾ç„¶æˆç«‹ï¼Œå› ä¸ºä¸€æ—¦æ›²é¢å‘ç”Ÿé‡å ï¼Œç«‹ä½“è§’é”¥ä¸€å®šä¼šç©¿è¿‡æ›²é¢ä¸‰æ¬¡ï¼Œå…¶ä¸­ä¸¤æ¬¡è®¡ç®—çš„ç«‹ä½“è§’ç”±äºæŠ•å½±é¢ç§¯çš„æ–¹å‘æ€§ä¼šæŠµæ¶ˆï¼Œåªå‰©ä¸‹ç©¿è¿‡ä¸€æ¬¡çš„ç»“æœã€‚è¿™ç§æƒ…å†µçš„è¯æ˜å¯è§äºç”µç£å­¦æ•™æä¸Šï¼ˆè™½ç„¶è¿™ç§æƒ…å†µæˆ‘ä»¬ä¹Ÿå®Œå…¨ä¸ç”¨ç®¡å°±æ˜¯äº†ï¼‰ã€‚\nä¸€ä¸ªä¾‹å­ï¼šä¸¤ä¸ªç›¸éš”è¾ƒè¿œç‰©ä½“äº’ç›¸å¼ æˆçš„ç«‹ä½“è§’ ä¸¤ä¸ªä»»æ„å½¢çŠ¶çš„å‡ ä½•ä½“ $A$ å’Œ $B$ï¼Œç›¸è·ä¸º $R$ã€‚å›¾ç¤ºå¦‚ä¸‹\nè®¾ç‰©ä½“ $B$ å¯¹ ç‰©ä½“ $A$ ä¸­å¿ƒå¼ æˆçš„ç«‹ä½“è§’ä¸º $\\Omega_B$ï¼Œç‰©ä½“ $A$ å¯¹ ç‰©ä½“ $B$ ä¸­å¿ƒå¼ æˆçš„ç«‹ä½“è§’ä¸º $\\Omega_A$ã€‚è¿™ä¸ªå¼ è§’çš„èŒƒå›´æ˜¯ä»ä¸€ä¸ªç‰©ä½“ä¸­å¿ƒå‘å¦ä¸€ä¸ªç‰©ä½“è¡¨é¢åšåˆ‡çº¿å¾—åˆ°çš„ã€‚æ ¹æ®å®šä¹‰å¼ï¼Œæœ‰ $$ \\Omega = \\iint_S \\frac{\\vec{e_r} \\cdot d\\vec{S}}{r^2} $$ $\\vec{r}$ ä¸ºç‰©ä½“ä¸­å¿ƒåˆ°å¦ä¸€ä¸ªç‰©ä½“è¡¨é¢çš„çŸ¢å¾„ã€‚å½“ä¸¤ä¸ªç‰©ä½“ç›¸éš”å¾ˆè¿œï¼Œ$R$ è¿œå¤§äºå®ƒä»¬è‡ªèº«çš„é•¿åº¦å°ºåº¦æ—¶ï¼Œ$\\vec{r}$ çš„é•¿åº¦å˜åŠ¨å¾ˆå°ï¼Œé•¿åº¦è¿‘ä¼¼ç­‰äº $R$ ï¼Œå…¶æ–¹å‘å˜åŠ¨ä¹Ÿå¾ˆå°ï¼Œæ–¹å‘è¿‘ä¼¼ä¸å˜ï¼Œä¸ä¸¤ç‰©ä½“ä¸­å¿ƒè¿çº¿å¹³è¡Œã€‚è¿™ä¸€è¿‘ä¼¼å¯ä»¥ç”¨ç…§å°„åˆ°åœ°çƒçš„å¤ªé˜³å…‰è¿‘ä¹å¹³è¡Œçš„äº‹å®æ¥è¯´æ˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º\nå¤ªé˜³å…‰ä»å¤ªé˜³å‡ºå‘æ—¶æ˜¯ä»ä¸­å¿ƒå¾€å¤–è¾å°„çš„ï¼Œä½†ç”±äºæ—¥åœ°è·ç¦»è¿œå¤§äºå¤ªé˜³å’Œåœ°çƒçš„å°ºåº¦ï¼Œåˆ°è¾¾åœ°çƒçš„å¤ªé˜³å…‰è¿‘ä¹æ˜¯å¹³è¡Œå…‰ã€‚æˆ‘ä»¬æŠŠè¿™é‡Œçš„å¤ªé˜³å…‰æ¢æˆçŸ¢å¾„ $\\vec{r}$ï¼Œä¾¿èƒ½ç†è§£è¿™ä¸€è¿‘ä¼¼ã€‚äºæ˜¯æœ‰ $$ \\vec{r} \\approx \\vec{R} $$ $$ \\Omega \\approx \\iint_S \\frac{\\vec{e_R} \\cdot d\\vec{S}}{R^2} = \\frac{1}{R^2} \\iint_S \\vec{e_R} \\cdot d\\vec{S} = \\frac{S_0}{R^2} $$\nå…¶ä¸­ $S_0$ ä¸ºç‰©ä½“è¡¨é¢åœ¨ä»¥ $\\vec{\\rm{e}_R}$ ä¸ºæ³•å‘çš„å¹³é¢ä¸Šçš„æŠ•å½±é¢ç§¯ã€‚è®¾ç‰©ä½“ $A$ å’Œ ç‰©ä½“ $B$ çš„æŠ•å½±é¢ç§¯åˆ†åˆ«ä¸º $S_A$ å’Œ $S_B$ï¼Œæœ€åå¯ä»¥å¾—å‡ºå®ƒä»¬äº’ç›¸å¼ æˆçš„ç«‹ä½“è§’ $$ \\Omega_A = \\frac{S_A}{R^2} $$ åŒæ—¶æ˜“å¾—ç­‰å¼ $$ S_A\\Omega_B = S_B\\Omega_A $$ $$ \\Omega_B = \\frac{S_B}{R^2} $$\nè¿™ä¸ªç­‰å¼å¯ä»¥åº”ç”¨äºè¾å°„æµ‹é‡æˆ–é›·è¾¾æ¢æµ‹ä¸­ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚\nå‚è€ƒèµ„æ–™ Solid Angle Wikipedia\nSolid angle and projections\n","date":"2019-10-27","permalink":"https://zhajiman.github.io/post/solid_angle/","tags":["radiation"],"title":"ç«‹ä½“è§’ç®€ä»‹"},{"content":"é‚£æ˜¯è° æ˜¯è° æ˜¯è°\né‚£æ˜¯ç‚¸é¸¡ ç‚¸é¸¡äºº ç‚¸é¸¡äºº\nèƒŒè´Ÿç€å¿«é¤çš„åä¹‰\nèˆå¼ƒäº†ä¸€åˆ‡å»æˆ˜æ–—çš„ç”·äºº\nç‚¸é¸¡ä¹‹è…¿æ˜¯æ‰‹æªè…¿\nç‚¸é¸¡ä¹‹å—æ˜¯åŸå‘³é¸¡\nç‚¸é¸¡ä¹‹ç¿¼æ˜¯éº¦è¾£ç¿…\nç‚¸é¸¡çš„ç‰¹ç‚¹æ˜¯å¤–è„†é‡Œå«©\nå°†ç‚¸é¸¡ä¹‹åŠ› é›†äºä¸€èº«\nç¾å‘³çš„è‹±é›„\nç‚¸é¸¡äºº ç‚¸é¸¡äºº\n","date":"2019-08-22","permalink":"https://zhajiman.github.io/post/fried_chicken_man/","tags":["nonsense"],"title":"ç‚¸ é¸¡ äºº"}]